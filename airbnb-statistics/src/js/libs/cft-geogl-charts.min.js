/**
* ChartFactor v5.0.7
* @license
* Copyright (c) Aktiun, Inc. 2017-2024.  All rights reserved.
* License and Terms of Use: See https://chartfactor.com/terms-of-use
*/!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cf_geogl",[],t):"object"==typeof exports?exports.cf_geogl=t():e.cf_geogl=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=17)}([function(e,t,i){"use strict";(function(t){function r(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var n=function(){return new Function("try {return this===window;}catch(e){ return false;}")()?"browser":"node"},o=function(){return"browser"===n()?window.cf:t.cf},a=o(),s=a.getDependency("utils"),l=a.getDependency("lodash"),c=a.getDependency("jquery"),u=a.getDependency("chroma-js"),p="browser"===n()?window:t,d=a.getDependency("ui-legend"),h=i(19).default,f=i(23).default,_=!1;window.cf_tables&&(_=window.cf_tables.getAgGrid(),s.cssUtil.load("table-grid",_.styles));var m="cluster-scrollable-table",g={RAW:"cluster-raw",AGGREGATED:"aggregated",GEOHASH:"geohash"},y=["tile","tile-wms","fixed-marker","marker","shape","shape-only","circle","heatmap","3d"],v=function(e){var t=/(long|lon|lng)/,i=l.keys(e).find(function(e){return e.includes("lat")}),r=l.keys(e).find(function(e){return t.test(e)});return{latKey:i,longKey:r,lat:parseFloat(e[i]),lng:parseFloat(e[r])}},A=function(e){if(l.get(e.get(),"config.precision"))return g.GEOHASH;if(l.get(e.get(),"config.fields",[]).length>0)return g.RAW;var t=e.get("aql"),i=l.get(t,"_data[0]");if(i){if(i.geohash)return g.GEOHASH;var r=v(i),n=r.latKey,o=r.longKey;if(n&&o)return g.RAW}return g.AGGREGATED},b=function(e){return A(e)===g.RAW},w=function(e){return A(e)===g.GEOHASH},C=function(e){return A(e)===g.AGGREGATED},L=function(e,t){return e>=-90&&e<=90&&t>=-180&&t<=180},x=function(e,t){return function(e){return l.has(e,"[0].group[0]")}(e)||function(e,t){return"aggregated"!==t&&e&&e.length>0}(e,t)},k=function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=e.get("aql");n._fields=[],n.currentDef.config.precision=t,e.precision(t).set("fitBounds",r).set("legend","none"),i&&(L(i.getNorthEast().lat,i.getNorthEast().lng)||(i._northEast&&(i._northEast.lat=90,i._northEast.lng=180),i._ne&&(i._ne.lat=90,i._ne.lng=180)),L(i.getSouthWest().lat,i.getSouthWest().lng)||(i._southWest&&(i._southWest.lat=-90,i._southWest.lng=-180),i._sw&&(i._sw.lat=-90,i._sw.lng=-180)),e.bbox({topLeft:i.getNorthWest(),bottomRight:i.getSouthEast(),topRight:i.getNorthEast(),bottomLeft:i.getSouthWest()})),e.execute().catch(function(){})},I=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,o=e.get("limit")||1e4;if(e.precision(void 0).limit(o).set("fitBounds",!1).set("legend","none"),t&&(L(t.getNorthEast().lat,t.getNorthEast().lng)||(t._northEast&&(t._northEast.lat=90,t._northEast.lng=180),t._ne&&(t._ne.lat=90,t._ne.lng=180)),L(t.getSouthWest().lat,t.getSouthWest().lng)||(t._southWest&&(t._southWest.lat=-90,t._southWest.lng=-180),t._sw&&(t._sw.lat=-90,t._sw.lng=-180)),e.bbox({topLeft:t.getNorthWest(),bottomRight:t.getSouthEast(),topRight:t.getNorthEast(),bottomLeft:t.getSouthWest()})),2===n){var a=l.cloneDeep(e.get("config").location);l.isArray(i)&&a&&(l.isArray(a)||(a=[a]),(a=a.reverse()).forEach(function(e){i.includes(e)||i.unshift(e)}))}e._is3DLayer||(i?e.fields.apply(e,r(i)):e.fields()),e.execute().catch(function(){})},E=function(e){var t=e.aktive,i=e.nextPrecision,r=e.def,n=e.fitBounds,o=e.map,a=e.setAktiveLastQueriedBounds,s=e.getMapBounds,c=b(t),u=w(t),p=r.config.bbox;if(u||c&&p||t._is3DLayer){a(t,p);var d=o.getBounds(),_=!1;if(t._lastQueriedBounds){var m=d.getSouthWest(),g=d.getNorthEast(),y=t._lastQueriedBounds.getSouthWest(),v=t._lastQueriedBounds.getNorthEast(),A=[v.lng,v.lat,y.lng,y.lat],C=[g.lng,g.lat,m.lng,m.lat],L=f(A),x=f(C),E=h(L,x);_=l.isEmpty(t._lastQueriedBounds)||!E}if(_||i!==r.config.precision)if(u)t._lastQueriedBounds=s(),k(t,i,t._lastQueriedBounds,n);else{t._lastQueriedBounds=s(!1);var M=l.get(r,"config.fields",[]).map(function(e){return e.name});l.isArray(M)&&0===M.length&&(M=void 0);var S=l.get(r,"precisionLevels.raw.fields",M);I(t,t._lastQueriedBounds,S,2)}else if("Geo Map GL"===r.visualization&&(t._isMarkerLayer||t._isHeatMapLayer)){var P=t._parentAktive.get("visual")._renderedLayers[t._layer.name];P&&P._processData()}}},M=function(e,t){var i=e[0],r=e[e.length-1];if(t>=r.zoom)return r.precision;for(var n=0;n<e.length;n++){var o=n>0?e[n-1].precision:e[n].precision;if(e[n].zoom>t)return o}return i.precision},S=function(e){if(0===e.length)throw new Error("Invalid geohash");e=e.toLowerCase();for(var t=!0,i=-90,r=90,n=-180,o=180,a=0;a<e.length;a++){var s=e.charAt(a),l="0123456789bcdefghjkmnpqrstuvwxyz".indexOf(s);if(-1===l)throw new Error("Invalid geohash");for(var c=4;c>=0;c--){var u=l>>c&1;if(t){var p=(n+o)/2;1===u?n=p:o=p}else{var d=(i+r)/2;1===u?i=d:r=d}t=!t}}return{sw:{lat:i,lon:n},ne:{lat:r,lon:o}}},P=function(e){var t=S(e),i=t.sw.lat,r=t.sw.lon,n=t.ne.lat,o=(r+t.ne.lon)/2;return{center:{lat:Number((i+n)/2),lon:Number(o)},bounds:t}},F=function(e){return e.getAQLConfig(e._currentAQL)},D=function(e,t){var i=F(e);l.set(i,"currentDef.visualization",t),i.currentDef.config=i.currentDef.config||{}},B=function(e){return l.has(e,"levels[0].zoom")&&l.has(e,"levels[0].precision")&&l.has(e,"raw.zoom")&&l.has(e,"raw.fields")},z=function(e){var t=c("#"+m);!t.has(e.target).length>0&&t.remove()},T=function(e){var t="visible",i=l.get(e,"properties.visible");return"boolean"==typeof i&&(t=i?"visible":"none"),t},O=function(e,t){var i=T(e),r=l.get(e,"properties.visibilityZoomRange[0]",0),n=l.get(e,"properties.visibilityZoomRange[1]",24);return r>n&&(r=0,n=24),"visible"===i&&t>=r&&t<=n},R=function(e,t,i,r,n,o,c){if(o._metric&&!o.isColorByRange()){var u=l.get(r,"properties.min",l.get(r,"properties.options.min")),p=l.get(r,"properties.max",l.get(r,"properties.options.max"));i.type("metric"),i.metric(o._metric),i.colors(o._palette).min(u).max(p)}else{var d=[];if(o.isColorByRange()){if(!o._metric&&n.get("config").metrics.length>0&&o.metric(a.Metric().fromJSON(n.get("config").metrics[0])),c===g.AGGREGATED)n._isShapeLayer&&o._dynamic&&(o._range=[]),o.generateRange(t,"current");else if(g.GEOHASH===c&&l.isEmpty(o._range))o.generateRangeFromSerie(l.uniq(t.map(function(e){return e.count})));else if(g.RAW===c&&e.map){var h=Math.round(e.map.getZoom()),f=l.get(e._gridClusterConfig,"["+h+"]");if(f)o=f.clusterColor;else if(l.isEmpty(o._range)){var _=[];l.each(e.map._layers,function(e){if(e.options.clusterPane===r.pane)return l.each(l.get(e,"_featureGroup._layers"),function(e){_.push(l.get(e,"_childCount",1))}),!1}),_.length>0&&o.generateRangeFromSerie(l.uniq(_))}}d=o._range.slice().reverse().map(function(e){var t=s.formatNumericValue(e.min,o._metric,e.min>=1e4),i=s.formatNumericValue(e.max,o._metric,e.max>=1e4);return{color:e.color,label:t+" - "+i}})}else{var m=0,y=l.get(n.get("rows"),"[0]");y&&s.getLegendFormatter(n.get(),y[0]),d=t.map(function(e,t){var i=c===g.GEOHASH?e.count:e.group[0];m=m===o._palette.length?0:m;var r=o._palette[m];return o._match&&o._match[i]&&(r=o._match[i]),m++,{color:r,label:i}})}i.items(d)}},N=function(e,t){if(e._legend&&(e._legend.remove(),delete e._legend),t&&t.id){var i=a.getVisualization(t.id);if(!i._isHeatMapLayer){var r=t.properties.legend,n=l.get(t,"properties.clusterColor",a.Color().palette(["#f18017b3","#f0c20cb3","#6ecc39b3"]).autoRange({dynamic:!0})),o=g.GEOHASH;w(i)&&(o=g.GEOHASH),b(i)&&(o=g.RAW),C(i)&&(n=i._options.options.color,o=g.AGGREGATED),"string"==typeof(r=r||"none")&&(r=new d(r)),c("#"+e._mapElement).find(".adt-legend").remove(),"none"!==r._position&&(!function(e,t,i,r,n,o){var a=i._data;if(e._legend=r?new d(r._position,r._width,r._height):new d,e._legend._element=e._element,x(a,o)){R(e,a,e._legend,t,i,n,o),"reverse"===r._sort&&e._legend._items.reverse();var s=c("#"+e._mapElement),l=e._legend._position,u={"z-index":1e3,width:"min-content",height:"min-content",left:"unset","justify-content":"unset",background:"rgba(255, 255, 255, 0.64)"};if("metric"===e._legend._type){var p=e._legend._height.value+e._legend._height.unit;u.width=e._legend._width>140?110:e._legend._width,u.background="transparent",u.height="100%"===p?"30%":p}var h=("metric"===e._legend._type?e._legend.renderByMetric():e._legend.renderByCategory()).html;s.find(".adt-legend").remove();var f={height:"30%"},_=!0;u.top=10,u.right=10,f.bottom="unset",f.top=10,["left","top-left"].includes(l)?(u.top=10,u.left=40,f.bottom="unset",f.top=10,_=!1):["bottom","bottom-right"].includes(l)?(u.top="unset",u.bottom=10,u.right=10,f.top="unset",f.bottom=10):"bottom-left"===l&&(u.top="unset",u.bottom=10,u.left=10,f.top="unset",f.bottom=10,_=!1),s.append(h),s.find(".adt-legend").css(u),s.find(".adt-legend > .adt-list-container").css({width:"unset","margin-left":"0px"}),s.find(".adt-legend > .adt-list-container > ul").removeClass("ul-horizontal"),s.find(".adt-legend > .adt-list-container > ul").css({width:"auto",padding:7,margin:0}),_&&(f.left="35%"),s.find(".cft-legend-metric-values-ct").css(f),_&&(f.left="89.1%",f.right=0),s.find(".cft-legend-metric-gradient").css(f)}}(e,t,i,r,n,o),e.width=e.width-r._width),e._definition.legend=r}}},V=function(e){var t=e._definition.layers||[],i=[];if("Geo Map V2"===e._aktive._chartType)i=t.filter(function(t){return y.includes(t.type)&&(!e.map.getPane(t.pane)||e.map.getPane(t.pane)&&"hidden"!==e.map.getPane(t.pane).style.visibility)});else{var r=e._map.getZoom();i=t.filter(function(t){return!!e.getRenderedLayer(t.name)&&(y.includes(t.type)&&O(t,r))})}return i.sort(function(e,t){return t.priority-e.priority}),i},G=function(e,t){var i=t.levels.map(function(e){return e.zoom}),r=l.min(i);return!i.includes(e)&&e>r},j=function(e,t){var i=t.levels.map(function(e){return e.zoom});return Math.max.apply(Math,r(i.filter(function(t){return t<=e})))};e.exports.addBoundingBox=function(e,t,i,r){var n=(e.map||e._map).getBounds();if(n){var o=n._northEast||n._ne,a=n._southWest||n._sw;L(o.lat,o.lng)||(n._northEast&&(n._northEast.lat=90,n._northEast.lng=180),n._ne&&(n._ne.lat=90,n._ne.lng=180)),L(a.lat,a.lng)||(n._southWest&&(n._southWest.lat=-90,n._southWest.lng=-180),n._sw&&(n._sw.lat=-90,n._sw.lng=-180)),i.bbox({topLeft:n.getNorthWest(),bottomRight:n.getSouthEast(),topRight:n.getNorthEast(),bottomLeft:n.getSouthWest()}),i.location(r)}},e.exports.hexToHsl=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),i=parseInt(t[1],16),r=parseInt(t[2],16),n=parseInt(t[3],16);i/=255,r/=255,n/=255;var o=Math.max(i,r,n),a=Math.min(i,r,n),s=void 0,l=void 0,c=(o+a)/2;if(o===a)s=l=0;else{var u=o-a;switch(l=c>.5?u/(2-o-a):u/(o+a),o){case i:s=(r-n)/u+(r<n?6:0);break;case r:s=(n-i)/u+2;break;case n:s=(i-r)/u+4}s/=6}var p={};return p.h=s,p.s=l,p.l=c,p},e.exports.degreesToRadians=function(e){return e*Math.PI/180},e.exports.validateNum=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return isNaN(e)||null===e?t:Number(e)},e.exports.MAP_MODE=g,e.exports.LAYER_TYPES=y,e.exports.CLUSTER_TOOLTIP_TABLE=m,e.exports.getEnvironment=n,e.exports.getToolkit=o,e.exports.getCurrentMapMode=A,e.exports.getLatLongValues=v,e.exports.isRawData=b,e.exports.isGeoHashData=w,e.exports.isAggregatedData=C,e.exports.validCoords=L,e.exports.isValidData=x,e.exports.getLayerVisibility=T,e.exports.isLayerVisible=O,e.exports.runGeoHashQuery=k,e.exports.runBoundedRawQuery=I,e.exports.changeMapBoundariesFilter=function(e){var t=e.aktive,i=e.eventType,r=e.map,n=e.setAktiveLastQueriedBounds,o=e.getMapBounds,a=t.get();if(i.includes("moveend")){var s={aktive:t,nextPrecision:a.config.precision,def:a,fitBounds:!1,map:r,setAktiveLastQueriedBounds:n,getMapBounds:o};E(s)}},e.exports.changeGeoHashPrecisionLevel=function(e){var t=e.aktive,i=e.zoom,r=e.map,n=e.setAktiveLastQueriedBounds,o=e.getMapBounds;if(!isNaN(i)){var a=t.get(),s=a.precisionLevels,c=l.get(t,"_provider._providerCfg.provider"),u=b(t),p=w(t);if(!l.isEmpty(s)&&["elasticsearch","google-bigquery","redshift","cfnode"].includes(c)){var d=s.raw,h=s.levels[0],f=M(s.levels,i),_=i<=h.zoom;if(i>=d.zoom&&p)return t._lastQueriedBounds=o(!1),I(t,t._lastQueriedBounds,d.fields,2),void(t._lastUsedZoom=i);if(i<d.zoom&&u)return t._lastQueriedBounds=o(),k(t,f,t._lastQueriedBounds,_),void(t._lastUsedZoom=i);t._lastUsedZoom!==i&&(t._lastUsedZoom=i,u&&(f=a.config.precision),E({aktive:t,nextPrecision:f,def:a,fitBounds:_,map:r,setAktiveLastQueriedBounds:n,getMapBounds:o}))}else if("Geo Map GL"===a.visualization&&(t._isMarkerLayer||t._isHeatMapLayer)){var m=t._parentAktive.get("visual")._renderedLayers[t._layer.name];m&&m._processData()}}},e.exports.createLayerAktive=function(e,t){t.id=e+"-"+t.name;var i=void 0;a.getVisualization(t.id)?((i=a.getVisualization(t.id)).provider(t.provider),i.source(t.source)):(i=a.provider(t.provider).source(t.source)).element(t.id);return i._loaded=!0,i},e.exports.getBoundsFromGeoHash=S,e.exports.decodeGeoHash=P,e.exports.processGeohashData=function(e){if(e.length>0){if(e[0].geohash)return e.map(function(e){var t=P(e.geohash);return{originalGeohash:e.geohash,latitude:t.center.lat,longitude:t.center.lon,ne:t.bounds.ne,sw:t.bounds.sw,type:"geohash",count:e.count}});if(e.rn&&void 0===e.count)return e.map(function(e){return e.count=1,e})}return e},e.exports.getGeoHashPrecisionByZoomLevel=M,e.exports.getAktiveAql=F,e.exports.setAqlVisualization=D,e.exports.storeLayerAktive=function(e,t){D(t,e._definition.visualization),e._layersAktive||(e._layersAktive=[]),e._layersAktive.some(function(e){return e._elementId===t._elementId})||e._layersAktive.push(t),e._definition._childVisualizations||(e._definition._childVisualizations=[]),e._definition._childVisualizations.some(function(e){return e.id===t._elementId})||(t._options.options._isChild=!0,e._definition._childVisualizations.push({id:t._elementId}))},e.exports.isValidPrecisionLevels=B,e.exports.setLocationPrecisionAndFields=function(e,t,i,n,o,a){var s=arguments.length>6&&void 0!==arguments[6]&&arguments[6];if(n){var c=e.map||e._map,u=e._definition.zoom,p=c.getBounds(),d=B(a);if(d&&(a.levels.sort(function(e,t){return e.zoom-t.zoom}),o=M(a.levels,u)),p){var h=p._northEast||p._ne,f=p._southWest||p._sw;L(h.lat,h.lng)||(p._northEast&&(p._northEast.lat=90,p._northEast.lng=180),p._ne&&(p._ne.lat=90,p._ne.lng=180)),L(f.lat,f.lng)||(p._southWest&&(p._southWest.lat=-90,p._southWest.lng=-180),p._sw&&(p._sw.lat=-90,p._sw.lng=-180)),i.bbox({topLeft:p.getNorthWest(),bottomRight:p.getSouthEast(),topRight:p.getNorthEast(),bottomLeft:p.getSouthWest()})}if(d&&u>=a.raw.zoom){var _=[];_=l.get(a,"raw.fields",[]);var m=l.cloneDeep(n);l.isArray(m)||(m=[m]),(m=m.reverse()).forEach(function(e){_.includes(e)||_.unshift(e)}),_.length>0&&i.fields.apply(i,r(_)),o=void 0}else(!l.isArray(l.get(t,"properties.fields"))&&"marker"===t.type||d&&s)&&(F(i)._fields=[]);i.location(n).precision(o)}},e.exports.checkAndProcessSerieAndColor=function(e,t){var i=l.min(e),r=l.max(e),n=!0;return t._range&&l.each(t._range,function(e){u.valid(e.color)?e.color=u(e.color).hex():(n=!1,s.error("Error parsing the colors. '"+e.color+"' is not a valid color.",!1))}),n&&t.generateRangeFromSerie(e),{minVal:i,maxVal:r,clusterColor:t,validColors:n}},e.exports.getMarkerIcon=function(e){return function(t,i){var r=s.contrastColor(t);return'<div class="marker_container">\n          <div class="'+e+'" style="background-color: '+t+'">\n            <div class="pin_value" style="color:'+r+'">'+(i||"")+"</div>\n          </div>\n          <div class='pulse'></div>\n        </div>"}},e.exports.renderScrollableTooltip=function(e,t,i,n,o,a){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,d=700,h=[].concat(r(i||[])),f={},g=[];if(!n)if(o.length>=2){var y="GEO_POINT"===h[0].type?[o[0]]:[o[0],o[1]];h=h.filter(function(e){return!y.includes(e.name)})}else"GEO_POINT"===h[0].type?h.splice(0,1):h.splice(0,2);if(0!==h.length){h.forEach(function(e){var t={field:e.name,headerName:e.label||e.name};u&&u.fields.includes(e.name)&&(t.cellRenderer=function(t){var i=u.format(e.name,t.getValue());return'<div style="'+Object.keys(i.style).map(function(e){return e+": "+i.style[e]}).join(";")+'">'+i.value+"</div>"}),f[e.name]=e,g.push(t)});var v=t.map(function(e){var t={};return l.keys(e._data).map(function(i){var r=e._data[i],n=f[i];n&&s.isNumber(n.type)&&(r=s.formatNumericValue(r,n)),t[i]=r}),t});g.length>0&&g.length<7&&(d=150*g.length);var A=document.getElementById(a._element);d>=A.offsetWidth&&(d=d-Math.abs(d-A.offsetWidth)-30);var b="left: "+(e.offsetX+30)+"px;",w="top: "+(e.offsetY+30)+"px;";if(e.offsetX>A.offsetWidth/2){var C=A.offsetWidth-e.offsetX+30;if(b="right: "+C+"px;",C+d>A.offsetWidth){var L=d-A.offsetWidth;b="right: "+(L<0?0:L)+"px;"}}else if(e.offsetX+30+d>A.offsetWidth){var x=d-A.offsetWidth;b="left: "+(x<0?0:x)+"px;"}e.offsetY>A.offsetHeight/2&&(w="bottom: "+(A.offsetHeight-e.offsetY+30)+"px;"),window.removeEventListener("click",z),c("."+m).remove();var k='style="'+w+b+'"';if("visualization-full-view"===a._element&&(k='style="'+w+b+' z-index: 3000;"'),c(A).append('<div id="cluster-scrollable-table"\n                        class="cluster-scrollable-table"\n                        '+k+"></div>"),_){var I={defaultColDef:{sortable:!0,resizable:!0,scrollbarWidth:8},columnDefs:g,onRowClicked:function(e){(a.onChartClick||a._onChartClick)(e),c("."+m).remove()},suppressFieldDotNotation:!0},E=document.querySelector("."+m);E.style.width=d+"px",E.classList.add("ag-theme-balham"),new _.Grid(E,I),I.api.setRowData(v),I.columnApi.autoSizeAllColumns()}else{var M='<div class="cluster-table-wrapper">\n                              <table>\n                                <thead><tr>'+g.map(function(e){return"<th>"+(e.headerName||e.field)+"</th>"}).join("")+"</tr></thead>\n                                <tbody>"+v.map(function(e,t){return'<tr class="cluster-table-wrapper-tr" id='+t+">"+g.map(function(t){var i=e[t.field],r="";if(u&&u.fields.includes(t.field)){var n=u.format(t.field,i),o=Object.keys(n.style).map(function(e){return e+": "+n.style[e]}).join(";");i=n.value,r='style="'+o+'"'}return"<td "+r+">"+i+"</td>"}).join("")+"</tr>"}).join("")+"</tbody>\n                              </table>\n                            </div>";c("."+m).css({width:d}),c("."+m).append(M),c(".cluster-table-wrapper-tr").click(function(e){var t="TD"===e.target.tagName?c(e.target).parent():"TR"===e.target.tagName?c(e.target):null;if(t){var i=v[Number(t.attr("id"))];(a.onChartClick||a._onChartClick)({data:i}),c("."+m).remove()}})}setTimeout(function(){p.addEventListener("click",z)},500)}},e.exports.updateLayerWithDrillConf=function(e){return function(t){var i=t.properties,r=t.nextConf,n=t.oldConf,o=t.oldProperties;switch(e._layer.type){case"shape":var a={},s=i.prevShape;delete i.prevShape,l.keys(i).forEach(function(t){["zoom","center"].includes(t)?(e._parentAktive.set(t,i[t],!0),e._layer._checkZoomCenterDifferent=!0):"legend"===t?e._layer.properties[t]=i[t]:"shape"===t?a.url=i[t]:a[t]=i[t]}),a.name||(a.name=r.rows[0].label);var c=l.get(e._layer,"properties.shapes",[]),u=c.findIndex(function(e){return(e.name===r.rows[0].name||e.name===r.rows[0].label)&&e.url===a.url});if(-1!==u&&c.length>u){var p=c.splice(u+1);p&&p.length>0&&(e._layer.shapesToRemove||(e._layer.shapesToRemove=[]),l.each(p,function(t){e._layer.shapesToRemove.some(function(e){return e.name===t.name})||e._layer.shapesToRemove.push(t)})),c[u]=a}else l.remove(c,function(e){return e.name===a.name}),c.push(a);var d=c.length-2,h=c[d];d>=0&&h&&(!h.name||h.name===n.rows[0].label||h.name===n.rows[0].name)&&(h.name=n.rows[0].label||n.rows[0].name,l.keys(o).forEach(function(e){["zoom","center","legend","source"].includes(e)||("shape"===e?h.url=o[e]:h[e]=o[e])}),l.keys(s).forEach(function(e){h[e]=s[e]})),l.set(e._layer,"properties.shapes",c)}}},e.exports.renderLegend=function(e){var t=function(e){var t=V(e);return"Geo Map V2"===e._aktive._chartType?t.filter(function(e){return l.get(e,"properties.legend")})[0]:t.filter(function(t){return!!e.getRenderedLayer(t.name)&&void 0!==l.get(t,"properties.legend")})[0]}(e);N(e,t)},e.exports.processLegendData=R,e.exports.getHeatmapLayerRadius=function(e,t,i){if(!i)return{heatmapRadius:t*e,layerRadius:t};var r=1.75+.75*(e-j(e,i)-1),n=G(e,i);return{heatmapRadius:n?t*r*e:t*e,layerRadius:n?t*r:t}},e.exports.getClosestSmallerZoom=j,e.exports.shouldApplyPercent=G,e.exports.exportCsv=function(e,t){var i={fileName:l.get(e,"fileName")},r=function(e){return V(e)[0]}(t),n=r&&r.id?a.getVisualization(r.id):null;n?(i.data=n._data,s.exportAsCsv(n,i)):console.info("There is no data to export either because the map has no data layers or they are hidden.")}}).call(t,i(1))},function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";(function(t){var r=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(i.push(a.value),!t||i.length!==t);r=!0);}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function a(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function r(n,o){try{var a=t[n](o),s=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}var s=i(0),l=s.getToolkit,c=s.getEnvironment,u=i(11).error,p=l(),d=p.getDependency("jquery"),h=p.getDependency("lodash"),f=p.getDependency("chroma-js"),_="browser"===c()?window:t;_._cachedShapes=new Map;var m=window.document,g=function(e){return new Promise(function(t,i){e.onload=function(){e.isLoaded=!0,t(!0)}})},y=function(){var e=m.createElement("script"),t=m.createElement("link"),i=_.mapLibreJsUrl||"https://unpkg.com/maplibre-gl@3.2.0/dist/maplibre-gl.js",r=_.mapLibreCssUrl||"https://unpkg.com/maplibre-gl@3.2.0/dist/maplibre-gl.css";return e.setAttribute("src",i),m.head.appendChild(e),t.setAttribute("href",r),t.setAttribute("type","text/css"),t.setAttribute("rel","stylesheet"),t.setAttribute("media","screen,print"),t.setAttribute("crossorigin","anonymous"),m.head.appendChild(t),e},v=function(){var e=m.createElement("script"),t=_.threeJsUrl||"https://unpkg.com/three@0.147.0/build/three.min.js";return e.setAttribute("src",t),m.head.appendChild(e),e},A=function(){var e=m.createElement("script"),t=_.css2DRendererUrl||"https://unpkg.com/three@0.147.0/examples/js/renderers/CSS2DRenderer.js";return e.setAttribute("src",t),m.head.appendChild(e),e},b=function(){var e=m.createElement("script"),t=_.gltfLoaderUrl||"https://unpkg.com/three@0.147.0/examples/js/loaders/GLTFLoader.js";return e.setAttribute("src",t),m.head.appendChild(e),e},w=function(){var e=a(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(_.THREE){e.next=3;break}return e.next=3,g(v());case 3:if(_.THREE.GLTFLoader){e.next=6;break}return e.next=6,g(b());case 6:if(_.THREE.CSS2DRenderer){e.next=9;break}return e.next=9,g(A());case 9:return e.abrupt("return",!0);case 10:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),C=function(){var e=a(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(_.maplibregl){e.next=3;break}return e.next=3,g(y());case 3:return e.abrupt("return",!0);case 4:case"end":return e.stop()}},e,void 0)}));return function(){return e.apply(this,arguments)}}(),L=function(e,t){if(e){var i=h.flatten(e.map(function(e){return[e.zoom,["case",["!",["coalesce",["feature-state","clicked"],!1]],e.fillOpacity,.2]]}));return["interpolate",["exponential",.5],["zoom"]].concat(o(i))}return t},x=function(){var e=a(regeneratorRuntime.mark(function e(t){var i,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t);case 2:return(i=e.sent).ok||console.error("Error loading shape resource: "+t),e.next=6,i.json();case 6:return r=e.sent,_._cachedShapes.set(t,r),e.abrupt("return",r);case 9:case"end":return e.stop()}},e,void 0)}));return function(t){return e.apply(this,arguments)}}(),k=function(e,t){var i=t[1].lat-t[0].lat;return(t[0].lng-t[1].lng)*(e.lat-t[0].lat)+i*(e.lng-t[0].lng)},I=function e(t,i){var r=[],n=function(e,t){var i=0,r=null,n=[],o=void 0,a=void 0,s=void 0;for(o=t.length-1;o>=0;o--)a=t[o],(s=k(a,e))>0&&(n.push(a),s>i&&(i=s,r=a));return{maxPoint:r,newPoints:n}}(t,i);return n.maxPoint?r=(r=r.concat(e([t[0],n.maxPoint],n.newPoints))).concat(e([n.maxPoint,t[1]],n.newPoints)):[t[0]]};e.exports.error=u,e.exports.DEFAULT_MARKER_COLOR="#034e7b",e.exports.DEFAULT_MARKER_ICON="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACqElEQVR4nO1YTWsUQRDtTY4qHsJsz3s9s+iKoKBIDPj5EzzkLoi6GhDBk+SmRI+KBiQqCKLoRfGgMVfxIvkNgmc/8OxHiDEhUtph12Hd7mR7JhOZBwVDT031e91d1d2jVIUKFSr8jxhM05QARsTkWdpUmVGv15skx0nOklwiuZyxRftuXHxVWZAkiSF5zxJc9rQlAM+01tvWlTzJFoC5VRD/y/Dn21PrwX0QwORaiXcRcrPQHAlJnm0RNwohT/JkaPJsixgrImG/5yhgjmSamwAAD/Miz7bdz4V8mqY7fEolgHmSU8aYQ0NDQ1vESB6WNgA/PAQsaq23BxdgNykX+Q/GmH09YgyLj4eIi3kImHWNfAf5GoAzJKdJXlZKDWREuGbiTWj+gx7L55b1HQAws9JujNmZDQbgtiPWz6D7ghzGXNOeJMkBS26ssz2O46gj1O+ZkPxwxWs0GggmQE6Urg6jKNpsfWcyS+upiACwi+Q18bGJ7cqnkWACZHRdHQqpbgIyNu0rILEzGrKE9uzQGHPQCjjbw68lPras9owXupRKEn91dDrVkcQv/zH6NSvyjiPWl+CHOwCvHWtWSuOwda+RPE3yBcnn8txBfsRVRgG8CkrednzBI/E+dojoFmO/9ekZh+T54AKiKIp9jgLiY5fIkWazuVUMwFEAdwEseHw/r7WuqzwA4JHH6PVlAB6ovBDH8W6fUeyD/ILsF2qj3cbYFnBd5Q3ZhAB8ykHAZ8kXVQTiOD6Rw+gfV0WC5OOA5J+ooqG13kTybQDy71bOUYUjSZK9fV7yv2mt96j1hDHmmFxA1kB+EcCoKgOylxhPC39c6AcArqyC/CVVRgC46kF+QpUZJCd6kJc/FOUHyVYmseWPxjm1kQBgFMB7a+WoNhUqVKigQuMXVkBSz5TFP9MAAAAASUVORK5CYII=",e.exports.DECIMAL_DEGREES_PRECISION=5,e.exports.ZOOM_PRECISION=2,e.exports.checkThreeJsLibraries=w,e.exports.checkMapLibreLibraries=C,e.exports.getDefaultMapStyle=function(){return{id:"43f36e14-e3f5-43c1-84c0-50a9c80dc5c7",name:"ChartFactor MapLibre Style",glyphs:"https://demotiles.maplibre.org/font/{fontstack}/{range}.pbf",layers:[],sources:{},version:8,metadata:{"chartfactor:copyright":"This style was generated by ChartFactor"}}},e.exports.getDefaultPopupCss=function(){return"\n    .maplibregl-popup-tip {\n        display: none !important;\n    }\n\n    .maplibregl-popup-content {\n        background: white;\n        color: black;\n        padding: 0.5% !important;\n        pointer-events: none !important;\n        font-size: 12px;\n        border-radius: 10px;\n        border: 3px solid rgb(3, 78, 123);\n    }\n    "},e.exports.createMapLibrePopupInstance=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"240px",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"rgb(3, 78, 123)",r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=new _.maplibregl.Popup({closeButton:!1,closeOnClick:!1,maxWidth:t});return n.on("open",function(){r?(d(".maplibregl-popup-content").css({border:"solid 3px "+i}),d(".maplibregl-popup-content").css({"border-radius":"10px"})):(d(".maplibregl-popup-content").css({border:"unset"}),d(".maplibregl-popup-content").css({"border-radius":"unset"}))}),e._popupsCreated.push(n),n},e.exports.setPopupPosition=function(e,t){var i=t.getElement(),r=e.point,n=i.clientWidth,o=i.clientHeight,a=r.y+10,s=r.x+15,l=e.target._canvas,c=l.clientWidth,u=l.clientHeight,p=a,d=s;s+n>c&&(d=c-(n+30)),a+o>u&&(p=u-(o+30)),i.style.transform="translate("+d+"px, "+p+"px)"},e.exports.sanitize=function(e){return e.replace(/[\.\,\;\:\'\"\s\%\(\)\[\]\{\}\|\\\/\*\+\-\=\$\@\!\#\^\&]*/g,"")},e.exports.getMetrics=function(e){if(e&&h.isArray(e))return e.map(function(e){return"object"!==(void 0===e?"undefined":n(e))||h.has(e,"_label")?e:p.Metric().fromJSON(e)})},e.exports.getRows=function(e){if(e&&h.isArray(e))return e.map(function(e){return"object"!==(void 0===e?"undefined":n(e))||h.has(e,"_name")?e:p.Row().fromJSON(e)})},e.exports.getFields=function(e){if(e&&h.isArray(e))return e.map(function(e){return"object"!==(void 0===e?"undefined":n(e))||h.has(e,"_name")?e:p.Field().fromJSON(e)})},e.exports.getJsonRows=function(e){if(e&&h.isArray(e))return e.map(function(e){return"object"!==(void 0===e?"undefined":n(e))||h.has(e,"_name")?e.toJSON():e})},e.exports.getFilters=function(e){if(e&&h.isArray(e))return e.map(function(e){return"object"===(void 0===e?"undefined":n(e))&&h.has(e,"_path")?e.toJSON():e})},e.exports.splitData=function(e){var t=h.findIndex(e,{group:["$columnTotal"]});return t>=0?e.splice(t):e},e.exports.getMetricName=function(e){return!!e&&(e.isComparative?e.useName:e.name)},e.exports.getMetricPath=function(e){var t=h.get(e,"useName",h.get(e,"name","")),i=h.get(e,"func","");return"count"===t?"current.count":"current.metrics['"+t+"']."+i},e.exports.getColorFromValue=function(e,t,i,r){return e.isColorByRange()?e.getColorByRange(t):function(e,t,i,r){return f.scale(e._palette).domain([r,i])(t).hex()}(e,t,i,r)},e.exports.buildColorExpression=function(e,t,i,r){var n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"#CCC",a=i._metric,s=""+t+(a.func?a.name+"_"+a.func:a.name),l=h.uniq(r.features.map(function(e){return h.get(e,"properties['"+s+"']")}).filter(function(e){return e})),c=i;if(0===l.length)return n;i._range||i._autoRange||(c=p.Color().palette(i._palette).autoRange({dynamic:!0})),c.generateRangeFromSerie(l);var u=h.find(c._range,function(e){return e.color}),d=h.flattenDeep(c._range.map(function(e){return[e.min,e.color||u.color]})),f=[],_=["any",["==",["has",s],!1],["==",["get",s],null]],m=["step",["get",s],u.color].concat(o(d));if(i._match){f.push("match"),f.push(["get",e]),h.each(i._match,function(e,t){f.push(t),f.push(e)});var g=[];g.push("case"),g.push(_),g.push(n),g.push(m),f.push(g)}else f.push("case"),f.push(_),f.push(n),f.push(m);return f},e.exports.buildOpacityExpression=L,e.exports.getColor=function(e,t){var i=h.cloneDeep(h.get(e,"properties.options.color",p.Color()));return"object"!==(void 0===i?"undefined":n(i))&&(i=p.Color().palette([i])),i._defaultPalette&&(i._palette=t),i},e.exports.getRandomInt=function(){return parseInt(Date.now()*Math.random(),10)},e.exports.getLngLatFields=function(e){var t=void 0,i=void 0;return e&&("string"==typeof e?(t=e+".lat",i=e+".lon"):(i=e[0],t=e[1])),{lngField:i,latField:t}},e.exports.getColorFromRange=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#CCC";if(!t)return i;if(e){var r=e.map(function(e){return{value:e.min,color:e.color}}),n=r[0],o=r[r.length-1];if(t>=o.value)return o.color;for(var a=0;a<r.length;a++){var s=a>0?r[a-1].color:r[a].color;if(r[a].value>=t)return s}return n.color}return t<=10?"rgba(110, 204, 57, 0.7)":t>10&&t<100?"rgba(240, 194, 12, 0.7)":"rgba(241, 128, 23, 0.7)"},e.exports.getShapeColor=function(e){var t=h.get(e,"shapeBorderColor","#575656"),i=h.get(e,"shapeOpacity",.5);i=(i=i>1?1:i)<0?0:i;var r=h.get(e,"shapeFillColor","#CCC");return{noHighlightColors:{lineColor:h.get(e,"style.color",t),lineWidth:h.get(e,"style.weight",.5),lineOpacity:h.get(e,"style.opacity",1),fillOpacity:h.get(e,"style.fillOpacity",i),fillColor:h.get(e,"style.fillColor",r),originalFillColor:h.get(e,"style.fillColor",r)},highlightColors:{lineColor:h.get(e,"shapeBorderColorHl",t),lineWidth:h.get(e,"shapeBorderWeightHl",.5),lineOpacity:1,fillOpacity:h.get(e,"shapeOpacityHl",i),fillColor:h.get(e,"shapeFillColorHl")}}},e.exports.addShapeSource=function(e,t,i,r){var n=e._map.getSource(i);n?n.setData(r):(e._sourceIds[t]=i,e._featureCollections[t]=r,e._map.addSource(i,{type:"geojson",data:r,generateId:!1}))},e.exports.removeShapeSource=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t?e._map.getSource(e._sourceIds[t])&&e._map.removeSource(e._sourceIds[t]):h.each(e._sourceIds,function(t){e._map.getSource(t)&&e._map.removeSource(t)})},e.exports.addShapeLayer=function(e,t,i,r,n){var o=t+"_fill_layer",a=t+"_line_layer",s=["case",["boolean",["feature-state","hover"],!1],r.highlightColors.fillOpacity,r.noHighlightColors.fillOpacity],l=["case",["boolean",["feature-state","hover"],!1],r.highlightColors.lineOpacity,r.noHighlightColors.lineOpacity],c=L(n.opacityZoomLevels,s),u=L(n.opacityZoomLevels,l);e._layerIds[t]=[o,a],e._mapVisualization._storeTooltipLayerId(o),e._fillLayerIds.includes(o)||e._fillLayerIds.push(o),e._fillLayerColors[o]={highlightColors:r.highlightColors,noHighlightColors:r.noHighlightColors,clientFilteredOutColor:h.get(n,"clientFilteredOutColor","#CCC"),clientFilteredOutColorOpacity:h.get(n,"clientFilteredOutColorOpacity",.5),featureProperty:h.get(n,"featureProperty","name"),opacityZoomLevels:n.opacityZoomLevels};var p=e._map.getLayer(o);p?(e._map.setLayoutProperty(o,"visibility",e._visibility),e._map.setPaintProperty(o,"fill-color",["case",["boolean",["feature-state","hover"],!1],r.highlightColors.fillColor,r.noHighlightColors.fillColor]),e._map.setPaintProperty(o,"fill-opacity",c)):e._map.addLayer({id:o,type:"fill",source:i,filter:["all",["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"]]],layout:{visibility:e._visibility},paint:{"fill-color":["case",["boolean",["feature-state","hover"],!1],r.highlightColors.fillColor,r.noHighlightColors.fillColor],"fill-opacity":c}});var d=n.featureProperty||"name",f=n.dataField.label||n.dataField.name,_=h.get(e,"_config.properties.filters",[]).find(function(e){return e.path===f||e.label===f}),m="",g="!=";if(_){var y=_._operation;m=_.value,g="IN"===y?"==":"!="}var v=["case",["any",["boolean",["feature-state","hover"],!1],[g,["index-of",["get",d],["literal",m]],-1]],r.highlightColors.lineColor,r.noHighlightColors.lineColor],A=["case",["any",["boolean",["feature-state","hover"],!1],[g,["index-of",["get",d],["literal",m]],-1]],r.highlightColors.lineWidth,r.noHighlightColors.lineWidth],b=e._map.getLayer(a);if(b?(e._map.setLayoutProperty(a,"visibility",e._visibility),e._map.setPaintProperty(a,"line-color",v),e._map.setPaintProperty(a,"line-opacity",u),e._map.setPaintProperty(a,"line-width",A)):e._map.addLayer({id:a,type:"line",source:i,filter:["all",["any",["==",["geometry-type"],"Polygon"],["==",["geometry-type"],"MultiPolygon"],["==",["geometry-type"],"LineString"],["==",["geometry-type"],"MultiLineString"]]],layout:{visibility:e._visibility},paint:{"line-color":v,"line-opacity":u,"line-width":A}}),e._mapVisualization._renderedLayers[e._config.name]=e,e._mapVisualization._setVisibilityZoomRange(o,e._config),e._mapVisualization._setVisibilityZoomRange(a,e._config),e._mainLayerId=o,e._aktive&&(e._aktive._mainLayerId=o),e._addEventListeners(o),e._mapVisualization._reorganizeLayers(),!p&&!b){var w=[];h.each(e._layerIds,function(t){h.isArray(t)&&h.each(t,function(t){w.push(e._map.getLayer(t))})}),e._mapVisualization.dispatch({name:"geo:layer-added",element:e._mapVisualization._element,layer:e._config,mapLibreLayers:w})}},e.exports.removeShapeLayer=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,i=[];t?(i=h.cloneDeep(e._layerIds[t]),delete e._layerIds[t]):(i=h.cloneDeep(e._layerIds),e._layerIds={}),h.each(i,function(t){h.isArray(t)?h.each(t,function(t){e._map.getLayer(t)&&e._map.removeLayer(t),h.remove(e._fillLayerIds,function(e){return e===t}),h.remove(e._mapVisualization._tooltipLayerIds,function(e){return e===t})}):(e._map.getLayer(t)&&e._map.removeLayer(t),h.remove(e._fillLayerIds,function(e){return e===t}),h.remove(e._mapVisualization._tooltipLayerIds,function(e){return e===t}))})},e.exports.getFeatureCollection=x,e.exports.toFixedDecimals=function(e,t){var i=new RegExp("^-?\\d+(?:.\\d{0,"+(t||-1)+"})?");return parseFloat(e.toString().match(i)[0])},e.exports.getConvexHull=function(e){var t=!1,i=!1,r=!1,n=!1,o=null,a=null,s=null,l=null,c=null,u=null,p=void 0;for(p=e.length-1;p>=0;p--){var d=e[p];(!1===t||d.lat>t)&&(o=d,t=d.lat),(!1===i||d.lat<i)&&(a=d,i=d.lat),(!1===r||d.lng>r)&&(s=d,r=d.lng),(!1===n||d.lng<n)&&(l=d,n=d.lng)}return i!==t?(u=a,c=o):(u=l,c=s),[].concat(I([u,c],e),I([c,u],e))},e.exports.removeFeatureState=function(e,t){var i=!0,n=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var l=a.value,c=r(l,2),u=c[0],p=c[1];e.getSource(p.hoveredSourceId)&&e.setFeatureState({source:p.hoveredSourceId,id:p.hoveredFeatureId},{hover:!1}),t.delete(u)}}catch(e){n=!0,o=e}finally{try{!i&&s.return&&s.return()}finally{if(n)throw o}}},e.exports.getCountField=function(e,t){var i={label:"Transactions",func:"",type:"INTEGER",name:"count"};return t&&h.extend(i,t),(e&&e.get().volumeMetric?e.get().volumeMetric:null)||i},e.exports.shouldProcessData=function(e,t){var i=!e._mapVisualization._renderedLayers[e._config.name],r=!h.isEqual(e._aktive._data,t),n=h.isEmpty(e._aktive._data)&&h.isEmpty(t);return i||r||n}}).call(t,i(1))},function(e,t,i){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=i(24);e.exports.renderLayersControl=function(e){if(e._layersControl&&(e._layersControl.remove(),delete e._layersControl),e._definition.layersControl){e._layersControl=new n(e);var t="right",i=!1;"string"==typeof e._definition.layersControl?t=e._definition.layersControl:"object"===r(e._definition.layersControl)&&(t=e._definition.layersControl.position||t,i=e._definition.layersControl.multipleLayersOpen||i),e._layersControl.position(t),e._layersControl.multipleLayersOpen(i),e._layersControl.render()}}},function(e,t,i){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=i(29);e.exports.renderDrawControl=function(e){if(e._drawControl&&(e._drawControl.remove(),delete e._drawControl),e._definition.drawControl){e._drawControl||(e._drawControl=new n(e));var t="left",i=!1;"string"==typeof e._definition.drawControl?t=e._definition.drawControl:"object"===r(e._definition.drawControl)&&(t=e._definition.drawControl.position||t,i=e._definition.drawControl.multipleDrawOpen||i),e._drawControl.position(t),e._drawControl.multipleDrawOpen(i),e._drawControl.render()}}},function(e,t,i){"use strict";t.b=n,t.g=o,t.h=a,t.f=s,t.j=l,t.e=c,t.i=u,t.a=function(e){return e%360*Math.PI/180},t.c=p,t.d=function(e){return!!e&&e.constructor===Object};var r={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:6371008.8*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6371008.8*1.0936};function n(e,t,i){void 0===i&&(i={});var r={type:"Feature"};return(0===i.id||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=t||{},r.geometry=e,r}function o(e,t,i){if(void 0===i&&(i={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!p(e[0])||!p(e[1]))throw new Error("coordinates must contain numbers");return n({type:"Point",coordinates:e},t,i)}function a(e,t,i){void 0===i&&(i={});for(var r=0,o=e;r<o.length;r++){var a=o[r];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return n({type:"Polygon",coordinates:e},t,i)}function s(e,t,i){if(void 0===i&&(i={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return n({type:"LineString",coordinates:e},t,i)}function l(e,t){void 0===t&&(t="kilometers");var i=r[t];if(!i)throw new Error(t+" units is invalid");return e*i}function c(e,t){void 0===t&&(t="kilometers");var i=r[t];if(!i)throw new Error(t+" units is invalid");return e/i}function u(e){return 180*(e%(2*Math.PI))/Math.PI}function p(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}},function(e,t,i){"use strict";t.a=function(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")},t.b=function(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")},t.c=function(e){if("Feature"===e.type)return e.geometry;return e};i(5)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(20);function n(e){var t=[1/0,1/0,-1/0,-1/0];return Object(r.a)(e,function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])}),t}n.default=n,t.default=n},function(e,t,i){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var i=function(e,t){var i=e[1]||"",r=e[3];if(!r)return i;if(t&&"function"==typeof btoa){var n=function(e){var t=btoa(unescape(encodeURIComponent(JSON.stringify(e)))),i="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(t);return"/*# ".concat(i," */")}(r),o=r.sources.map(function(e){return"/*# sourceURL=".concat(r.sourceRoot||"").concat(e," */")});return[i].concat(o).concat([n]).join("\n")}return[i].join("\n")}(t,e);return t[2]?"@media ".concat(t[2]," {").concat(i,"}"):i}).join("")},t.i=function(e,i,r){"string"==typeof e&&(e=[[null,e,""]]);var n={};if(r)for(var o=0;o<this.length;o++){var a=this[o][0];null!=a&&(n[a]=!0)}for(var s=0;s<e.length;s++){var l=[].concat(e[s]);r&&n[l[0]]||(i&&(l[2]?l[2]="".concat(i," and ").concat(l[2]):l[2]=i),t.push(l))}},t}},function(e,t,i){var r={},n=function(e){var t;return function(){return void 0===t&&(t=e.apply(this,arguments)),t}}(function(){return window&&document&&document.all&&!window.atob}),o=function(e){var t={};return function(e){return void 0===t[e]&&(t[e]=function(e){return document.querySelector(e)}.call(this,e)),t[e]}}(),a=null,s=0,l=[],c=i(27);function u(e,t){for(var i=0;i<e.length;i++){var n=e[i],o=r[n.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](n.parts[a]);for(;a<n.parts.length;a++)o.parts.push(m(n.parts[a],t))}else{var s=[];for(a=0;a<n.parts.length;a++)s.push(m(n.parts[a],t));r[n.id]={id:n.id,refs:1,parts:s}}}}function p(e,t){for(var i=[],r={},n=0;n<e.length;n++){var o=e[n],a=t.base?o[0]+t.base:o[0],s={css:o[1],media:o[2],sourceMap:o[3]};r[a]?r[a].parts.push(s):i.push(r[a]={id:a,parts:[s]})}return i}function d(e,t){var i=o(e.insertInto);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var r=l[l.length-1];if("top"===e.insertAt)r?r.nextSibling?i.insertBefore(t,r.nextSibling):i.appendChild(t):i.insertBefore(t,i.firstChild),l.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");i.appendChild(t)}}function h(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e);var t=l.indexOf(e);t>=0&&l.splice(t,1)}function f(e){var t=document.createElement("style");return e.attrs.type="text/css",_(t,e.attrs),d(e,t),t}function _(e,t){Object.keys(t).forEach(function(i){e.setAttribute(i,t[i])})}function m(e,t){var i,r,n,o;if(t.transform&&e.css){if(!(o=t.transform(e.css)))return function(){};e.css=o}if(t.singleton){var l=s++;i=a||(a=f(t)),r=y.bind(null,i,l,!1),n=y.bind(null,i,l,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(i=function(e){var t=document.createElement("link");return e.attrs.type="text/css",e.attrs.rel="stylesheet",_(t,e.attrs),d(e,t),t}(t),r=function(e,t,i){var r=i.css,n=i.sourceMap,o=void 0===t.convertToAbsoluteUrls&&n;(t.convertToAbsoluteUrls||o)&&(r=c(r));n&&(r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(n))))+" */");var a=new Blob([r],{type:"text/css"}),s=e.href;e.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}.bind(null,i,t),n=function(){h(i),i.href&&URL.revokeObjectURL(i.href)}):(i=f(t),r=function(e,t){var i=t.css,r=t.media;r&&e.setAttribute("media",r);if(e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}.bind(null,i),n=function(){h(i)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else n()}}e.exports=function(e,t){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(t=t||{}).attrs="object"==typeof t.attrs?t.attrs:{},t.singleton||(t.singleton=n()),t.insertInto||(t.insertInto="head"),t.insertAt||(t.insertAt="bottom");var i=p(e,t);return u(i,t),function(e){for(var n=[],o=0;o<i.length;o++){var a=i[o];(s=r[a.id]).refs--,n.push(s)}e&&u(p(e,t),t);for(o=0;o<n.length;o++){var s;if(0===(s=n[o]).refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete r[s.id]}}}};var g=function(){var e=[];return function(t,i){return e[t]=i,e.filter(Boolean).join("\n")}}();function y(e,t,i,r){var n=i?"":r.css;if(e.styleSheet)e.styleSheet.cssText=g(t,n);else{var o=document.createTextNode(n),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(o,a[t]):e.appendChild(o)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(38);const n={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},o=Math.fround||(e=>t=>(e[0]=+t,e[0]))(new Float32Array(1));function a(e,t,i,r,n){return{x:o(e),y:o(t),zoom:1/0,id:i,parentId:-1,numPoints:r,properties:n}}function s(e,t){const[i,r]=e.geometry.coordinates;return{x:o(u(i)),y:o(p(r)),zoom:1/0,index:t,parentId:-1}}function l(e){return{type:"Feature",id:e.id,properties:c(e),geometry:{type:"Point",coordinates:[function(e){return 360*(e-.5)}(e.x),function(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}(e.y)]}}}function c(e){const t=e.numPoints,i=t>=1e4?`${Math.round(t/1e3)}k`:t>=1e3?`${Math.round(t/100)/10}k`:t;return d(d({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:i})}function u(e){return e/360+.5}function p(e){const t=Math.sin(e*Math.PI/180),i=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return i<0?0:i>1?1:i}function d(e,t){for(const i in t)e[i]=t[i];return e}function h(e){return e.x}function f(e){return e.y}t.default=class{constructor(e){this.options=d(Object.create(n),e),this.trees=new Array(this.options.maxZoom+1)}load(e){const{log:t,minZoom:i,maxZoom:n,nodeSize:o}=this.options;t&&console.time("total time");const a=`prepare ${e.length} points`;t&&console.time(a),this.points=e;let l=[];for(let t=0;t<e.length;t++)e[t].geometry&&l.push(s(e[t],t));this.trees[n+1]=new r.a(l,h,f,o,Float32Array),t&&console.timeEnd(a);for(let e=n;e>=i;e--){const i=+Date.now();l=this._cluster(l,e),this.trees[e]=new r.a(l,h,f,o,Float32Array),t&&console.log("z%d: %d clusters in %dms",e,l.length,+Date.now()-i)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let i=((e[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,e[1]));let n=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)i=-180,n=180;else if(i>n){const e=this.getClusters([i,r,180,o],t),a=this.getClusters([-180,r,n,o],t);return e.concat(a)}const a=this.trees[this._limitZoom(t)],s=a.range(u(i),p(o),u(n),p(r)),c=[];for(const e of s){const t=a.points[e];c.push(t.numPoints?l(t):this.points[t.index])}return c}getChildren(e){const t=this._getOriginId(e),i=this._getOriginZoom(e),r="No cluster with the specified id.",n=this.trees[i];if(!n)throw new Error(r);const o=n.points[t];if(!o)throw new Error(r);const a=this.options.radius/(this.options.extent*Math.pow(2,i-1)),s=n.within(o.x,o.y,a),c=[];for(const t of s){const i=n.points[t];i.parentId===e&&c.push(i.numPoints?l(i):this.points[i.index])}if(0===c.length)throw new Error(r);return c}getLeaves(e,t,i){t=t||10,i=i||0;const r=[];return this._appendLeaves(r,e,t,i,0),r}getTile(e,t,i){const r=this.trees[this._limitZoom(e)],n=Math.pow(2,e),{extent:o,radius:a}=this.options,s=a/o,l=(i-s)/n,c=(i+1+s)/n,u={features:[]};return this._addTileFeatures(r.range((t-s)/n,l,(t+1+s)/n,c),r.points,t,i,n,u),0===t&&this._addTileFeatures(r.range(1-s/n,l,1,c),r.points,n,i,n,u),t===n-1&&this._addTileFeatures(r.range(0,l,s/n,c),r.points,-1,i,n,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const i=this.getChildren(e);if(t++,1!==i.length)break;e=i[0].properties.cluster_id}return t}_appendLeaves(e,t,i,r,n){const o=this.getChildren(t);for(const t of o){const o=t.properties;if(o&&o.cluster?n+o.point_count<=r?n+=o.point_count:n=this._appendLeaves(e,o.cluster_id,i,r,n):n<r?n++:e.push(t),e.length===i)break}return n}_addTileFeatures(e,t,i,r,n,o){for(const a of e){const e=t[a],s=e.numPoints;let l,d,h;if(s)l=c(e),d=e.x,h=e.y;else{const t=this.points[e.index];l=t.properties,d=u(t.geometry.coordinates[0]),h=p(t.geometry.coordinates[1])}const f={type:1,geometry:[[Math.round(this.options.extent*(d*n-i)),Math.round(this.options.extent*(h*n-r))]],tags:l};let _;s?_=e.id:this.options.generateId?_=e.index:this.points[e.index].id&&(_=this.points[e.index].id),void 0!==_&&(f.id=_),o.features.push(f)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const i=[],{radius:r,extent:n,reduce:o,minPoints:s}=this.options,l=r/(n*Math.pow(2,t));for(let r=0;r<e.length;r++){const n=e[r];if(n.zoom<=t)continue;n.zoom=t;const c=this.trees[t+1],u=c.within(n.x,n.y,l),p=n.numPoints||1;let d=p;for(const e of u){const i=c.points[e];i.zoom>t&&(d+=i.numPoints||1)}if(d>p&&d>=s){let e=n.x*p,s=n.y*p,l=o&&p>1?this._map(n,!0):null;const h=(r<<5)+(t+1)+this.points.length;for(const i of u){const r=c.points[i];if(r.zoom<=t)continue;r.zoom=t;const a=r.numPoints||1;e+=r.x*a,s+=r.y*a,r.parentId=h,o&&(l||(l=this._map(n,!0)),o(l,this._map(r)))}n.parentId=h,i.push(a(e/d,s/d,h,d,l))}else if(i.push(n),d>1)for(const e of u){const r=c.points[e];r.zoom<=t||(r.zoom=t,i.push(r))}}return i}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t){if(e.numPoints)return t?d({},e.properties):e.properties;const i=this.points[e.index].properties,r=this.options.map(i);return t&&r===i?d({},r):r}}},function(e,t,i){"use strict";var r=function(e,t,i){return function e(t,i){for(var r=arguments.length,n=Array(r>2?r-2:0),o=2;o<r;o++)n[o-2]=arguments[o];return void 0!==t&&(0===n.length&&t.hasOwnProperty(i)?t[i]:e.apply(void 0,[t[i]].concat(n)))}.apply(void 0,[e].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(t.split("."))))||i};e.exports.getUniqueMetrics=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.originalConfig&&!t?"originalConfig":"config",n=r(e,i+".groups",[]).map(function(e){return e.sort}).filter(function(e){return void 0!==e}),o=r(e,i+".metrics",[]),a=r(e,"color._metric",!1),s=[],l=function(e,t){var i=s.find(function(t){return t.name===e.name&&t.originalFunc===e.originalFunc&&t.func===e.func});i?t&&(i[t]=!0):(t&&(e[t]=!0),s.push(e))},c=function(e,i){"CFT_DERIVED"===e.originalType&&t?e.dependencies.forEach(function(e){return l(e,i)}):e.isComparative&&!t&&o.find(function(t){return t.name===e.useName})||l(e,i)};return o.forEach(function(e){return c(e)}),n.forEach(function(t){if(t.metricFunc)t.func=t.metricFunc,c(t,"isSort");else if(t.derived){var i=r(e,"originalConfig.groups"),n=(i=i||r(e,"config.groups",[])).find(function(e){return e.name===t.name});n.name!==t.derived&&c(n.sort,"isSort")}}),a&&c(a,"isColor"),s},e.exports.error=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(t)throw Error(e);i&&console.error(e)},e.exports.closeIcon=function(e,t){return'<svg id="'+e+'" class="'+t+'" xmlns="http://www.w3.org/2000/svg" height="18" viewBox="0 0 24 24" width="18">\n        <path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z" fill="#909090"/>\n        <path d="M0 0h24v24H0z" fill="none"/>\n    </svg>'}},function(e,t,i){(t=i(8)(!1)).push([e.i,"@charset \"UTF-8\";\n\n@font-face {\n\tfont-family: 'cf-icons';\n\tsrc: url(data:font/woff;base64,d09GRgABAAAAAArcAAsAAAAACpAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABCAAAAGAAAABgDxIMqWNtYXAAAAFoAAAAsAAAALAAkNq0Z2FzcAAAAhgAAAAIAAAACAAAABBnbHlmAAACIAAABmQAAAZk5goCCWhlYWQAAAiEAAAANgAAADYjR47faGhlYQAACLwAAAAkAAAAJAhCBElobXR4AAAI4AAAACAAAAAgFYAASWxvY2EAAAkAAAAAEgAAABIGBAMybWF4cAAACRQAAAAgAAAAIAAuAcBuYW1lAAAJNAAAAYYAAAGGmUoJ+3Bvc3QAAAq8AAAAIAAAACAAAwAAAAMDgAGQAAUAAAKZAswAAACPApkCzAAAAesAMwEJAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAQAAA//8DwP/AAEADwABAAAAAAQAAAAAAAAAAAAAAIAAAAAAABgAAAAMAAAA0AAAABAAAAGQAAQADAAAANAABAAQAAABkAAMAAQAAADQAAwAKAAAAZAAEADAAAAAIAAgAAgAAAAEAIP/9//8AAAAAACD//f//AAH/4wADAAEAAAAAAAAAAAAMAAAAAABMAAAAAAAAAAUAAAAAAAAAAQAAAAEAAAAgAAAAIAAAAAMADPkBAAz5AgAAAAQADPlLAAz5SwAAAAYADPmpAAz5qQAAAAcAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAAD/2gMAA8AAHgAAARQHDgEHBgcGIicmJy4BJyY1NDc+ATc2MzIXHgEXFgMAJiZrOjknEjoSJzk6ayYmHh5pRkVQT0ZGaR4eAkBCVlatTk0wFxcwTU6tVlZCT0ZGaR4eHh5pRkUAACUAAAACBIADfgAhACUAKQAtADkARQBRAF0AaQB1AIEAjQCZAKUAsQC9AMoA1gDjAO8A+wEHARMBHwErATcBQwFPAVsBZwF0AYEBjQGZAaUBsQG9AAABHgEVERQGBwUGIiclBQYmJy4BNRE0NjclNjIXBSU2FhcxATcRBwUlEQU/AREHBTQ2MzIWFRQGIyImJzQ2MzIWFRQGIyImNzQ2MzIWFRQGIyImBzQ2MzIWFRQGIyImNzQ2MzIWFRQGIyImNzQ2MzIWFRQGIyImBzQ2MzIWFRQGIyImFzQ2MzIWFRQGIyImBzQ2MzIWFRQGIyImNzQ2MzIWFRQGIyImBzQ2MzIWFRQGIyImJTQ2MzIWFRQGIyImJzQ2MzIWFRQGIyImNTc0NjMyFhUUBiMiJgc0NjMyFhUUBiMiJjU3NDYzMhYVFAYjIiY3NDYzMhYVFAYjIiYHNDYzMhYVFAYjIiYXNDYzMhYVFAYjIiYHNDYzMhYVFAYjIiY3NDYzMhYVFAYjIiYHNDYzMhYVFAYjIiYlNDYzMhYVFAYjIiYnNDYzMhYVFAYjIiY3NDYzMhYVFAYjIiYHNDYzMhYVFAYjIiY3NDYzMhYVFAYjIiY1NzQ2MzIWFRQGIyImNQc0NjMyFhUUBiMiJhc0NjMyFhUUBiMiJgc0NjMyFhUUBiMiJjc0NjMyFhUUBiMiJgc0NjMyFhUUBiMiJgRrCgsRDv6wCBAI/pD+wAsXCgoLEQ4BUAgQCAFwAUALFwr79fDwAnD+4AEgYPDw/ZgPCwsPDwsLDzUGBAUGBgUEBhsPCwsPDwsLDxUPCwsPDwsLD00GBAUGBgUEBjgHBAQHBwQEB5oGBQQGBgQFBo4GBAUGBgUEBjsGBAUGBgUEBh0PCwsPDwsLD0MPCwsPDwsLDwF3EAoLEBALChA1BgQFBgYFBAYbDwsLDw8LCw8VEAoLEBALChBNBgQFBgYFBAY5BgQFBgYFBAabBgUEBgYEBQaOBgQFBgYFBAY7BgUEBgYEBQYdDwsLDw8LCw9DEAsKEBAKCxABiQ8LCw8PCwsPNQYEBQYGBQQGGw8LCw8PCwsPFQ8LCxAQCwsPTQYEBQYGBQQGOAcEBAcHBAQHmgYFBAYGBAUGjgYEBQYGBQQGOwYFBAYGBAUGHQ8LCw8PCwsPQxAKCxAQCwoQA3gHFQz9YA4aBYADAnt6BAMGBxUMAqAPGQWAAwJ7egQDBvz+WwI5WwJg/cZgA1sCOVudChAQCgsQEAgFBgYFBAYGcwsPDwsLDw/BCxAQCwoQECcEBgYEBQYGQQUGBgUEBgZ0BQYGBQQHB0UEBgYEBQYGRwQGBgQFBgacCw8PCwsPDzgLEBALChAQwAsPDwsLDw8JBAcHBAQHBwRvCw8PCwsPD8ELDw8LCw8PCxwFBgYFBAYGQQQHBwQEBwd0BAYGBAUGBkUFBgYFBAYGSAUGBgUEBgacCw8PCwsPDzgLDw8LCw8PzQoQEAoLEBAIBQYGBQQGBnMLDw8LCw8PwQsPDwsLDw8oBAYGBAUGBgU8BQYGBQQGBgR4BAcHBAQHB0UEBgYEBQYGRwQGBgQFBgacCw8PCwsPDzgLEBALChAQAAAAAAMAAP/gBAADoAADAAcACwAAEyURBQEFESUBJREFAAFA/sABgAFA/sABgAEA/wADAID9AIADoMD9IKACQMD9AMAAAAAAAQBJ/8ADowPAAEAAAAUmNjc+ATEwFgc2Nz4BNzYnFhceAQcGBzY3NiYnJicWBgcmJy4BJyYxFgcOAQcGBy4BJwYHDgEHBgcGFx4BFxYXAUEzICgrHSgNHhITEgEBBEMvLywHBifPLy5CR0cbEgElHzAxWyIhCQ4OOScnKAMOGQMQDygTEwkMBgU4NTVRQGuIOT9oUkQhKSlQIiMUL0hHpFVWTHWKifRYWRQocSB1SUpSDw88Pz55OTgyMEwuKykoUCgpKzw0NGAuLS4AAQAAAAAAAJHK1K1fDzz1AAsEAAAAAADf1KUxAAAAAN/UpTEAAP/ABIADwAAAAAgAAgAAAAAAAAABAAADwP/AAAAEgAAAAAAEgAABAAAAAAAAAAAAAAAAAAAACAQAAAAAAAAAAAAAAAIAAAADAAAABIAAAAQAAAAEAABJAAAAAAAKABQAHgBSAqoCzAMyAAAAAQAAAAgBvgAlAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGljb21vb24AaQBjAG8AbQBvAG8AblZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGljb21vb24AaQBjAG8AbQBvAG8Abmljb21vb24AaQBjAG8AbQBvAG8AblJlZ3VsYXIAUgBlAGcAdQBsAGEAcmljb21vb24AaQBjAG8AbQBvAG8AbkZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=) format('woff');\n}\n\n@font-face {\n\tfont-family: 'cf 3d';\n\tsrc: url(data:font/woff;base64,d09GRgABAAAAAAPQAAoAAAAABeQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAAA9AAAAEAAAABWVrljN2NtYXAAAAE0AAAAPAAAAUoAlAF3Z2x5ZgAAAXAAAACQAAAAkDiL6BFoZWFkAAACAAAAAC4AAAA2JLgWLWhoZWEAAAIwAAAAGAAAACQIXQQDaG10eAAAAkgAAAAIAAAACAgAAABsb2NhAAACUAAAAAYAAAAGAEgAAG1heHAAAAJYAAAAIAAAACABDwA0bmFtZQAAAngAAAE/AAACSZaYBGxwb3N0AAADuAAAABUAAAApARAAAHicY2BkYWCcwMDKwMHUyXSGgYGhH0IzvmYwYuRgYGBiYGVmwAoC0lxTGBwYHBkcWUDcGBYWBhCDEcQBAJgPB6R4nGNgYGBmgGAZBkYGEHAB8hjBfBYGDSDNBqQZGZiALMf//8EqwPT/A1D1QMDIxkA5YCSsZDADALO5BwcAAwAA//wEAAQEABcAHwAnAAABNhcFHgEXEQ4BBwUGJyUuAScRPgE3JTAXBg8BBS0BMBM2PwERBREwAdUrKwGAJy0BAS0n/oArK/6AJy0BAS0nAYArFpitAVsBW/6lQBSMoP7AA/UPD4kPQSn+GilBDokPD4kOQSkB5ilBD4l5CDY+fHx8/R8HMjkBeHL+iAB4nGNgZGBgAOKXezf/jue3+crAzcIAAg/OZMxA0P//sDCwgCQ4GJhAogB7OAxuAAB4nGNgZGBgYQCCGDAJYjMyoAImAAtGAG0EAAAABAAAAAAAAAAASAAAAAEAAAACACgAAwAAAAAAAgAAAAoACgAAAP8AAAAAAAB4nHWQu07DQBREx3khEokCBAXV0qQAxXlJFKEm6VOkd5x1HnK81noTKd9DzRdQU/MHdNT8AsP6ShAkvLrec+fOjh8AzvGOAOV1ySo5QJ1dyRWc4Fq4Sv1GuEZuC9fRwp1wg929cJPqg3ALF0iYENRO2d3iIBzQ9SRcwRmehavUX4Rr5FfhOq7wJtyg/iHcxAyfwi20g8eJzrSNnF6o+UFN0kO+ctrGSWe4mOrlLo1K9reZtsXaZKof9nx/dLTYLwfOJSqxZqvGJnM6TY3Krdno2IUr5/JRt5uIHsZmiwk0MpZFBMd9AYU5P1hxknLPsfK6Rcxf0sGQjin7JXacR0f6D838iQJrGKYr9BGi92v+/1ML7Jk9oOroVizLjC1p7LO+3SmXoZL72YZKTD30b+qojtDlSv74Q7qY9AUkfWJgAHicY2BigAAuBuwAKM8IUgMAAdYAEgAAAA==) format('woff');\n}\n\n/*!\n * Bootstrap  v5.2.0 (https://getbootstrap.com/)\n * Copyright 2011-2022 The Bootstrap Authors\n * Copyright 2011-2022 Twitter, Inc.\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n */\n\n.card {\n    --bs-card-spacer-y: 1rem;\n    --bs-card-spacer-x: 1rem;\n    --bs-card-title-spacer-y: 0.5rem;\n    --bs-card-border-width: 1px;\n    /* --bs-card-border-color: rgba(0, 0, 0, 0.175); */\n    --bs-card-border-radius: 0.375rem;\n    --bs-card-box-shadow: ;\n    --bs-card-inner-border-radius: calc(0.375rem - 1px);\n    --bs-card-cap-padding-y: 0.5rem;\n    --bs-card-cap-padding-x: 1rem;\n    --bs-card-cap-bg: rgba(0, 0, 0, 0.03);\n    --bs-card-cap-color: ;\n    --bs-card-height: ;\n    --bs-card-color: ;\n    --bs-card-bg: #fff;\n    --bs-card-img-overlay-padding: 1rem;\n    --bs-card-group-margin: 0.75rem;\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    min-width: 0;\n    word-wrap: break-word;\n    background-color: var(--bs-card-bg);\n    background-clip: border-box;\n    justify-content: center;\n    z-index: 2000;\n    height: auto !important;\n}\n\n.card>.list-group {\n    border-top: inherit;\n    border-bottom: inherit\n}\n\n.card>.list-group:last-child {\n    border-bottom-width: 0;\n    border-bottom-right-radius: var(--bs-card-inner-border-radius);\n    border-bottom-left-radius: var(--bs-card-inner-border-radius)\n}\n\n.card>.card-header+.list-group {\n    border-top: 0\n}\n\n.card-header {\n    padding: var(--bs-card-cap-padding-y) var(--bs-card-cap-padding-x);\n    margin-bottom: 0;\n    color: var(--bs-card-cap-color);\n    background-color: white;\n    border-bottom: var(--bs-card-border-width) solid var(--bs-card-border-color)\n}\n\n.card-header:first-child {\n  border-bottom: 1px solid #F5F7FA !important;\n  border: var(--bs-card-border-width) solid var(--bs-card-border-color);\n  border-radius: var(--bs-card-inner-border-radius) var(--bs-card-inner-border-radius) 0 0\n}\n\n.ui-accordion .ui-accordion-content {\n    height: auto !important;\n}\n\n.accordion-item-header {\n\tborder: none !important;\n\tborder-bottom: 1px solid #F5F7FA !important;\n    font-weight: bold !important;\n    font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji;\n    cursor: -moz-grab !important;\n    cursor: -webkit-grab !important;\n    cursor: grab !important;\n}\n\n.accordion-item-header:active {\n    cursor: grabbing !important;\n    cursor: -moz-grabbing !important;\n    cursor: -webkit-grabbing !important;\n}\n\n.accordion-item-header:hover .accordion-hide-layer-btn,\n.accordion-item-header:hover .accordion-show-lagend-btn,\n.accordion-item-header:hover .accordion-hide-layer-btn > i,\n.accordion-item-header:hover .accordion-show-lagend-btn > i {\n\tdisplay: block;\n}\n\n.accordion-body {\n\tmax-height: 246px;\n}\n\n.accordion-show-lagend-btn {\n    position: absolute;\n    right: 36px;\n    top: 5px;\n    cursor: pointer;\n\tdisplay: none;\n}\n\n.accordion-hide-layer-btn {\n    position: absolute;\n    right: 10px;\n    top: 7px;\n    cursor: pointer;\n\tdisplay: none;\n}\n\n.accordion-hide-layer-btn:hover i,\n.accordion-show-lagend-btn:hover i {\n    transform: scale(1.3);\n}\n\n.fa-eye {\n\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 576 512'%3E%3C!-- Font Awesome Pro 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) --%3E%3Cpath d='M572.52 241.4C518.29 135.59 410.93 64 288 64S57.68 135.64 3.48 241.41a32.35 32.35 0 0 0 0 29.19C57.71 376.41 165.07 448 288 448s230.32-71.64 284.52-177.41a32.35 32.35 0 0 0 0-29.19zM288 400a144 144 0 1 1 144-144 143.93 143.93 0 0 1-144 144zm0-240a95.31 95.31 0 0 0-25.31 3.79 47.85 47.85 0 0 1-66.9 66.9A95.78 95.78 0 1 0 288 160z'/%3E%3C/svg%3E\");\n\tbackground-repeat: no-repeat;\n\twidth: 16px;\n  \theight: 16px;\n}\n\n.fa-eye-slash {\n\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 640 512'%3E%3C!-- Font Awesome Pro 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) --%3E%3Cpath d='M320 400c-75.85 0-137.25-58.71-142.9-133.11L72.2 185.82c-13.79 17.3-26.48 35.59-36.72 55.59a32.35 32.35 0 0 0 0 29.19C89.71 376.41 197.07 448 320 448c26.91 0 52.87-4 77.89-10.46L346 397.39a144.13 144.13 0 0 1-26 2.61zm313.82 58.1l-110.55-85.44a331.25 331.25 0 0 0 81.25-102.07 32.35 32.35 0 0 0 0-29.19C550.29 135.59 442.93 64 320 64a308.15 308.15 0 0 0-147.32 37.7L45.46 3.37A16 16 0 0 0 23 6.18L3.37 31.45A16 16 0 0 0 6.18 53.9l588.36 454.73a16 16 0 0 0 22.46-2.81l19.64-25.27a16 16 0 0 0-2.82-22.45zm-183.72-142l-39.3-30.38A94.75 94.75 0 0 0 416 256a94.76 94.76 0 0 0-121.31-92.21A47.65 47.65 0 0 1 304 192a46.64 46.64 0 0 1-1.54 10l-73.61-56.89A142.31 142.31 0 0 1 320 112a143.92 143.92 0 0 1 144 144c0 21.63-5.29 41.79-13.9 60.11z'/%3E%3C/svg%3E\");\n\tbackground-repeat: no-repeat;\n\twidth: 16px;\n  \theight: 16px;\n}\n\n.fa-tile:before {\n\tcontent: \"\\cf94b\";\n\tfont-family: 'cf-icons', serif;\n\tfont-weight: normal;\n\tfont-style: normal;\n\tfont-size: 14px;\n}\n\n.fa-3d:before {\n\tcontent: \"\\0041\";\n\tfont-family: 'cf 3d', serif;\n\tfont-weight: normal;\n\tfont-style: normal;\n\tfont-size: 14px;\n}\n\n.fa-tile-wms:before {\n\tcontent: \"\\cf902\";\n\tfont-family: 'cf-icons', serif;\n\tfont-weight: normal;\n\tfont-style: normal;\n\tfont-size: 14px;\n}\n\n.fa-shape:before {\n\tcontent: \"\\cf900\";\n\tfont-family: 'cf-icons', serif;\n\tfont-weight: normal;\n\tfont-style: normal;\n\tfont-size: 14px;\n}\n\n.fa-shape-only:before {\n\tcontent: \"\\cf900\";\n\tfont-family: 'cf-icons', serif;\n\tfont-weight: normal;\n\tfont-style: normal;\n\tfont-size: 14px;\n}\n\n.fa-heatmap {\n\tbackground: linear-gradient(royalblue, lime, red, red);\n    background-clip: border-box;\n\t-webkit-background-clip: text;\n\t-webkit-text-fill-color: transparent;\n}\n\n.fa-heatmap:before {\n\tcontent: \"\\cf9a9\";\n\tfont-family: 'cf-icons', serif;\n\tfont-weight: normal;\n\tfont-style: normal;\n\tfont-size: 14px;\n}\n\n.fa-marker:before {\n\tcontent: \"\\cf901\";\n\tfont-family: 'cf-icons', serif;\n\tfont-weight: normal;\n\tfont-style: normal;\n\tfont-size: 14px;\n\t-webkit-text-stroke: 1px black;\n}\n\n.fa-angle-down {\n\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512'%3E%3C!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --%3E%3Cpath d='M201.4 374.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 306.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z'/%3E%3C/svg%3E\");\n\tbackground-repeat: no-repeat;\n\twidth: 16px;\n  \theight: 16px;\n}\n\n.fa-angle-up {\n\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 448 512'%3E%3C!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --%3E%3Cpath d='M201.4 137.4c12.5-12.5 32.8-12.5 45.3 0l160 160c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L224 205.3 86.6 342.6c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3l160-160z'/%3E%3C/svg%3E\");\n\tbackground-repeat: no-repeat;\n\twidth: 16px;\n  \theight: 16px;\n}\n\n.fa-angles-right {\n\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3C!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --%3E%3Cpath d='M470.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 256 265.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160zm-352 160l160-160c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L210.7 256 73.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0z'/%3E%3C/svg%3E\");\n\tbackground-repeat: no-repeat;\n\twidth: 16px;\n  \theight: 16px;\n}\n\n.fa-angles-left {\n\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'%3E%3C!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. --%3E%3Cpath d='M41.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L109.3 256 246.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-160 160zm352-160l-160 160c-12.5 12.5-12.5 32.8 0 45.3l160 160c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L301.3 256 438.6 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0z'/%3E%3C/svg%3E\");\n\tbackground-repeat: no-repeat;\n\twidth: 16px;\n  \theight: 16px;\n}\n\n\n/*! jQuery UI - v1.13.2 - 2022-09-05\n* http://jqueryui.com\n* Includes: core.css, accordion.css, theme.css\n* To view and modify this theme, visit http://jqueryui.com/themeroller/?scope=&folderName=base&cornerRadiusShadow=8px&offsetLeftShadow=0px&offsetTopShadow=0px&thicknessShadow=5px&opacityShadow=30&bgImgOpacityShadow=0&bgTextureShadow=flat&bgColorShadow=666666&opacityOverlay=30&bgImgOpacityOverlay=0&bgTextureOverlay=flat&bgColorOverlay=aaaaaa&iconColorError=cc0000&fcError=5f3f3f&borderColorError=f1a899&bgTextureError=flat&bgColorError=fddfdf&iconColorHighlight=777620&fcHighlight=777620&borderColorHighlight=dad55e&bgTextureHighlight=flat&bgColorHighlight=fffa90&iconColorActive=ffffff&fcActive=ffffff&borderColorActive=003eff&bgTextureActive=flat&bgColorActive=007fff&iconColorHover=555555&fcHover=2b2b2b&borderColorHover=cccccc&bgTextureHover=flat&bgColorHover=ededed&iconColorDefault=777777&fcDefault=454545&borderColorDefault=c5c5c5&bgTextureDefault=flat&bgColorDefault=f6f6f6&iconColorContent=444444&fcContent=333333&borderColorContent=dddddd&bgTextureContent=flat&bgColorContent=ffffff&iconColorHeader=444444&fcHeader=333333&borderColorHeader=dddddd&bgTextureHeader=flat&bgColorHeader=e9e9e9&cornerRadius=3px&fwDefault=normal&fsDefault=1em&ffDefault=Arial%2CHelvetica%2Csans-serif\n* Copyright jQuery Foundation and other contributors; Licensed MIT */\n\n/* Layout helpers\n----------------------------------*/\n.ui-helper-hidden {\n\tdisplay: none;\n}\n.ui-helper-hidden-accessible {\n\tborder: 0;\n\tclip: rect(0 0 0 0);\n\theight: 1px;\n\tmargin: -1px;\n\toverflow: hidden;\n\tpadding: 0;\n\tposition: absolute;\n\twidth: 1px;\n}\n.ui-helper-reset {\n\tmargin: 0;\n\tpadding: 0;\n\tborder: 0;\n\toutline: 0;\n\tline-height: 1.3;\n\ttext-decoration: none;\n\tfont-size: 100%;\n\tlist-style: none;\n}\n.ui-helper-clearfix:before,\n.ui-helper-clearfix:after {\n\tcontent: \"\";\n\tdisplay: table;\n\tborder-collapse: collapse;\n}\n.ui-helper-clearfix:after {\n\tclear: both;\n}\n.ui-helper-zfix {\n\twidth: 100%;\n\theight: 100%;\n\ttop: 0;\n\tleft: 0;\n\tposition: absolute;\n\topacity: 0;\n\t-ms-filter: \"alpha(opacity=0)\"; /* support: IE8 */\n}\n\n.ui-front {\n\tz-index: 100;\n}\n\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-disabled {\n\tcursor: default !important;\n\tpointer-events: none;\n}\n\n\n/* Icons\n----------------------------------*/\n.ui-icon {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n\tmargin-top: -.25em;\n\tposition: relative;\n\ttext-indent: -99999px;\n\toverflow: hidden;\n\tbackground-repeat: no-repeat;\n}\n\n.ui-widget-icon-block {\n\tleft: 50%;\n\tmargin-left: -8px;\n\tdisplay: block;\n}\n\n/* Misc visuals\n----------------------------------*/\n\n/* Overlays */\n.ui-widget-overlay {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n}\n.ui-accordion .ui-accordion-header {\n\tdisplay: block;\n\tcursor: pointer;\n\tposition: relative;\n\tmargin: 0 0 0 0;\n\tpadding: .5em .5em .5em .7em;\n\tfont-size: 12px;\n    background-color: white;\n}\n.ui-accordion .ui-accordion-content {\n\tpadding: 1em 2.2em;\n\tborder-top: 0;\n\toverflow: auto;\n}\n\n/* Component containers\n----------------------------------*/\n.ui-widget {\n\tfont-family: Arial,Helvetica,sans-serif;\n\tfont-size: 1em;\n}\n.ui-widget .ui-widget {\n\tfont-size: 1em;\n}\n.ui-widget input,\n.ui-widget select,\n.ui-widget textarea,\n.ui-widget button {\n\tfont-family: Arial,Helvetica,sans-serif;\n\tfont-size: 1em;\n}\n.ui-widget.ui-widget-content {\n\tborder: 1px solid #c5c5c5;\n}\n.ui-widget-content {\n\tborder: 0px solid #dddddd;\n\tbackground: #fafbfd;\n\tcolor: #333333;\n}\n.ui-widget-content a {\n\tcolor: #333333;\n}\n.ui-widget-header {\n\tborder: 1px solid #dddddd;\n\tbackground: #e9e9e9;\n\tcolor: #333333;\n\tfont-weight: bold;\n}\n.ui-widget-header a {\n\tcolor: #333333;\n}\n\n/* Interaction states\n----------------------------------*/\n.ui-state-default,\n.ui-widget-content .ui-state-default,\n.ui-widget-header .ui-state-default,\n.ui-button,\n\n/* We use html here because we need a greater specificity to make sure disabled\nworks properly when clicked or hovered */\nhtml .ui-button.ui-state-disabled:hover,\nhtml .ui-button.ui-state-disabled:active {\n\tborder: 1px solid #c5c5c5;\n\tbackground: #f6f6f6;\n\tfont-weight: normal;\n\tcolor: #454545;\n}\n.ui-state-default a,\n.ui-state-default a:link,\n.ui-state-default a:visited,\na.ui-button,\na:link.ui-button,\na:visited.ui-button,\n.ui-button {\n\tcolor: #454545;\n\ttext-decoration: none;\n}\n.ui-state-hover,\n.ui-widget-content .ui-state-hover,\n.ui-widget-header .ui-state-hover,\n.ui-state-focus,\n.ui-widget-content .ui-state-focus,\n.ui-widget-header .ui-state-focus,\n.ui-button:hover,\n.ui-button:focus {\n\tborder: 1px solid #cccccc;\n\tbackground: #ededed;\n\tfont-weight: normal;\n\tcolor: #2b2b2b;\n}\n.ui-state-hover a,\n.ui-state-hover a:hover,\n.ui-state-hover a:link,\n.ui-state-hover a:visited,\n.ui-state-focus a,\n.ui-state-focus a:hover,\n.ui-state-focus a:link,\n.ui-state-focus a:visited,\na.ui-button:hover,\na.ui-button:focus {\n\tcolor: #2b2b2b;\n\ttext-decoration: none;\n}\n\n.ui-visual-focus {\n\tbox-shadow: 0 0 3px 1px rgb(94, 158, 214);\n}\n.ui-state-active,\n.ui-widget-content .ui-state-active,\n.ui-widget-header .ui-state-active,\na.ui-button:active,\n.ui-button:active,\n.ui-button.ui-state-active:hover {\n\tborder: 1px solid #c5c5c5;\n\tbackground: #ededed !important;\n\tfont-weight: normal;\n\tcolor: #454545;\n}\n.ui-icon-background,\n.ui-state-active .ui-icon-background {\n\tborder: #003eff;\n\tbackground-color: #ffffff;\n}\n.ui-state-active a,\n.ui-state-active a:link,\n.ui-state-active a:visited {\n\ttext-decoration: none;\n}\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-highlight,\n.ui-widget-content .ui-state-highlight,\n.ui-widget-header .ui-state-highlight {\n\tborder: 1px solid #dad55e;\n\tbackground: #fffa90;\n\tcolor: #777620;\n}\n.ui-state-checked {\n\tborder: 1px solid #dad55e;\n\tbackground: #fffa90;\n}\n.ui-state-highlight a,\n.ui-widget-content .ui-state-highlight a,\n.ui-widget-header .ui-state-highlight a {\n\tcolor: #777620;\n}\n.ui-state-error,\n.ui-widget-content .ui-state-error,\n.ui-widget-header .ui-state-error {\n\tborder: 1px solid #f1a899;\n\tbackground: #fddfdf;\n\tcolor: #5f3f3f;\n}\n.ui-state-error a,\n.ui-widget-content .ui-state-error a,\n.ui-widget-header .ui-state-error a {\n\tcolor: #5f3f3f;\n}\n.ui-state-error-text,\n.ui-widget-content .ui-state-error-text,\n.ui-widget-header .ui-state-error-text {\n\tcolor: #5f3f3f;\n}\n.ui-priority-primary,\n.ui-widget-content .ui-priority-primary,\n.ui-widget-header .ui-priority-primary {\n\tfont-weight: bold;\n}\n.ui-priority-secondary,\n.ui-widget-content .ui-priority-secondary,\n.ui-widget-header .ui-priority-secondary {\n\topacity: .7;\n\t-ms-filter: \"alpha(opacity=70)\"; /* support: IE8 */\n\tfont-weight: normal;\n}\n.ui-state-disabled,\n.ui-widget-content .ui-state-disabled,\n.ui-widget-header .ui-state-disabled {\n\topacity: .35;\n\t-ms-filter: \"alpha(opacity=35)\"; /* support: IE8 */\n\tbackground-image: none;\n}\n.ui-state-disabled .ui-icon {\n\t-ms-filter: \"alpha(opacity=35)\"; /* support: IE8 - See #6059 */\n}\n\n/* Misc visuals\n----------------------------------*/\n\n/* Corner radius */\n.ui-corner-all,\n.ui-corner-top,\n.ui-corner-left,\n.ui-corner-tl {\n\tborder-top-left-radius: 0px;\n}\n.ui-corner-all,\n.ui-corner-top,\n.ui-corner-right,\n.ui-corner-tr {\n\tborder-top-right-radius: 0px;\n}\n.ui-corner-all,\n.ui-corner-bottom,\n.ui-corner-left,\n.ui-corner-bl {\n\tborder-bottom-left-radius: 0px;\n}\n.ui-corner-all,\n.ui-corner-bottom,\n.ui-corner-right,\n.ui-corner-br {\n\tborder-bottom-right-radius: 0px;\n}\n\n/* Overlays */\n.ui-widget-overlay {\n\tbackground: #aaaaaa;\n\topacity: .3;\n\t-ms-filter: Alpha(Opacity=30); /* support: IE8 */\n}\n\n.ui-widget-shadow {\n\t-webkit-box-shadow: 0px 0px 5px #666666;\n\tbox-shadow: 0px 0px 5px #666666;\n}\n\n.cft-layers-control-card {\n\tborder-radius: 4px;\n\tbox-shadow: 1px 1px 7px -2px rgba(0,0,0,0.68);\n}\n\n.cft-layers-control-card > .ui-accordion {\n\tborder-radius: 4px;\n}\n\n.cft-layers-control-card > .card-header {\n\tborder-radius: 2px 2px 0 0;\n\tpadding-bottom: 10px;\n}\n\n.cft-layer-identifier{\n\tdisplay: grid;\n\tgrid-template-columns: 15px auto auto;\n\tgrid-gap: 5px;\n}\n\n.cft-layer-color-indicator-circle {\n\tborder: 1px solid black;\n\tborder-radius: 13px;\n\twidth: 13px;\n}\n\n.cft-layer-color-indicator {\n\tborder: 1px solid black;\n\tborder-radius: 4px;\n\twidth: 14px;\n}\n\n.collapsible-layers-control {\n\tborder-radius: 3px;\n\tbox-shadow: 1px 1px 7px -2px rgba(0,0,0,0.68);\n}\n",""]),e.exports=t},function(e,t,i){(t=i(8)(!1)).push([e.i,".example{\n\n}\n\n.draw-card {\n    --bs-card-spacer-y: 1rem;\n    --bs-card-spacer-x: 1rem;\n    --bs-card-title-spacer-y: 0.5rem;\n    --bs-card-border-width: 1px;\n    /* --bs-card-border-color: rgba(0, 0, 0, 0.175); */\n    --bs-card-border-radius: 0.375rem;\n    --bs-card-box-shadow: ;\n    --bs-card-inner-border-radius: calc(0.375rem - 1px);\n    --bs-card-cap-padding-y: 0.5rem;\n    --bs-card-cap-padding-x: 1rem;\n    --bs-card-cap-bg: rgba(0, 0, 0, 0.03);\n    --bs-card-cap-color: ;\n    --bs-card-height: ;\n    --bs-card-color: ;\n    --bs-card-bg: #fff;\n    --bs-card-img-overlay-padding: 1rem;\n    --bs-card-group-margin: 0.75rem;\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    min-width: 0;\n    word-wrap: break-word;\n    background-color: var(--bs-card-bg);\n    background-clip: border-box;\n    justify-content: center;\n    z-index: 3000;\n    height: auto !important;\n}\n\n.draw-control-tool {\n    --bs-card-spacer-y: 1rem;\n    --bs-card-spacer-x: 1rem;\n    --bs-card-title-spacer-y: 0.5rem;\n    --bs-card-border-width: 1px;\n    /* --bs-card-border-color: rgba(0, 0, 0, 0.175); */\n    --bs-card-border-radius: 0.375rem;\n    --bs-card-box-shadow: ;\n    --bs-card-inner-border-radius: calc(0.375rem - 1px);\n    --bs-card-cap-padding-y: 0.5rem;\n    --bs-card-cap-padding-x: 1rem;\n    --bs-card-cap-bg: rgba(0, 0, 0, 0.03);\n    --bs-card-cap-color: ;\n    --bs-card-height: ;\n    --bs-card-color: ;\n    --bs-card-bg: #fff;\n    --bs-card-img-overlay-padding: 1rem;\n    --bs-card-group-margin: 0.75rem;\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    min-width: 0;\n    word-wrap: break-word;\n    background-color: var(--bs-card-bg);\n    background-clip: border-box;\n    justify-content: center;\n    z-index: 3000;\n    height: auto !important;\n}\n\n.collapse:not(.show) {\n    display: none;\n}\n\n@font-face {\n\tfont-family: 'cf-icons';\n\tsrc: url(data:font/woff;base64,d09GRgABAAAAAArcAAsAAAAACpAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABCAAAAGAAAABgDxIMqWNtYXAAAAFoAAAAsAAAALAAkNq0Z2FzcAAAAhgAAAAIAAAACAAAABBnbHlmAAACIAAABmQAAAZk5goCCWhlYWQAAAiEAAAANgAAADYjR47faGhlYQAACLwAAAAkAAAAJAhCBElobXR4AAAI4AAAACAAAAAgFYAASWxvY2EAAAkAAAAAEgAAABIGBAMybWF4cAAACRQAAAAgAAAAIAAuAcBuYW1lAAAJNAAAAYYAAAGGmUoJ+3Bvc3QAAAq8AAAAIAAAACAAAwAAAAMDgAGQAAUAAAKZAswAAACPApkCzAAAAesAMwEJAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAQAAA//8DwP/AAEADwABAAAAAAQAAAAAAAAAAAAAAIAAAAAAABgAAAAMAAAA0AAAABAAAAGQAAQADAAAANAABAAQAAABkAAMAAQAAADQAAwAKAAAAZAAEADAAAAAIAAgAAgAAAAEAIP/9//8AAAAAACD//f//AAH/4wADAAEAAAAAAAAAAAAMAAAAAABMAAAAAAAAAAUAAAAAAAAAAQAAAAEAAAAgAAAAIAAAAAMADPkBAAz5AgAAAAQADPlLAAz5SwAAAAYADPmpAAz5qQAAAAcAAQAB//8ADwABAAAAAAAAAAAAAgAANzkBAAAAAAEAAAAAAAAAAAACAAA3OQEAAAAAAQAAAAAAAAAAAAIAADc5AQAAAAABAAD/2gMAA8AAHgAAARQHDgEHBgcGIicmJy4BJyY1NDc+ATc2MzIXHgEXFgMAJiZrOjknEjoSJzk6ayYmHh5pRkVQT0ZGaR4eAkBCVlatTk0wFxcwTU6tVlZCT0ZGaR4eHh5pRkUAACUAAAACBIADfgAhACUAKQAtADkARQBRAF0AaQB1AIEAjQCZAKUAsQC9AMoA1gDjAO8A+wEHARMBHwErATcBQwFPAVsBZwF0AYEBjQGZAaUBsQG9AAABHgEVERQGBwUGIiclBQYmJy4BNRE0NjclNjIXBSU2FhcxATcRBwUlEQU/AREHBTQ2MzIWFRQGIyImJzQ2MzIWFRQGIyImNzQ2MzIWFRQGIyImBzQ2MzIWFRQGIyImNzQ2MzIWFRQGIyImNzQ2MzIWFRQGIyImBzQ2MzIWFRQGIyImFzQ2MzIWFRQGIyImBzQ2MzIWFRQGIyImNzQ2MzIWFRQGIyImBzQ2MzIWFRQGIyImJTQ2MzIWFRQGIyImJzQ2MzIWFRQGIyImNTc0NjMyFhUUBiMiJgc0NjMyFhUUBiMiJjU3NDYzMhYVFAYjIiY3NDYzMhYVFAYjIiYHNDYzMhYVFAYjIiYXNDYzMhYVFAYjIiYHNDYzMhYVFAYjIiY3NDYzMhYVFAYjIiYHNDYzMhYVFAYjIiYlNDYzMhYVFAYjIiYnNDYzMhYVFAYjIiY3NDYzMhYVFAYjIiYHNDYzMhYVFAYjIiY3NDYzMhYVFAYjIiY1NzQ2MzIWFRQGIyImNQc0NjMyFhUUBiMiJhc0NjMyFhUUBiMiJgc0NjMyFhUUBiMiJjc0NjMyFhUUBiMiJgc0NjMyFhUUBiMiJgRrCgsRDv6wCBAI/pD+wAsXCgoLEQ4BUAgQCAFwAUALFwr79fDwAnD+4AEgYPDw/ZgPCwsPDwsLDzUGBAUGBgUEBhsPCwsPDwsLDxUPCwsPDwsLD00GBAUGBgUEBjgHBAQHBwQEB5oGBQQGBgQFBo4GBAUGBgUEBjsGBAUGBgUEBh0PCwsPDwsLD0MPCwsPDwsLDwF3EAoLEBALChA1BgQFBgYFBAYbDwsLDw8LCw8VEAoLEBALChBNBgQFBgYFBAY5BgQFBgYFBAabBgUEBgYEBQaOBgQFBgYFBAY7BgUEBgYEBQYdDwsLDw8LCw9DEAsKEBAKCxABiQ8LCw8PCwsPNQYEBQYGBQQGGw8LCw8PCwsPFQ8LCxAQCwsPTQYEBQYGBQQGOAcEBAcHBAQHmgYFBAYGBAUGjgYEBQYGBQQGOwYFBAYGBAUGHQ8LCw8PCwsPQxAKCxAQCwoQA3gHFQz9YA4aBYADAnt6BAMGBxUMAqAPGQWAAwJ7egQDBvz+WwI5WwJg/cZgA1sCOVudChAQCgsQEAgFBgYFBAYGcwsPDwsLDw/BCxAQCwoQECcEBgYEBQYGQQUGBgUEBgZ0BQYGBQQHB0UEBgYEBQYGRwQGBgQFBgacCw8PCwsPDzgLEBALChAQwAsPDwsLDw8JBAcHBAQHBwRvCw8PCwsPD8ELDw8LCw8PCxwFBgYFBAYGQQQHBwQEBwd0BAYGBAUGBkUFBgYFBAYGSAUGBgUEBgacCw8PCwsPDzgLDw8LCw8PzQoQEAoLEBAIBQYGBQQGBnMLDw8LCw8PwQsPDwsLDw8oBAYGBAUGBgU8BQYGBQQGBgR4BAcHBAQHB0UEBgYEBQYGRwQGBgQFBgacCw8PCwsPDzgLEBALChAQAAAAAAMAAP/gBAADoAADAAcACwAAEyURBQEFESUBJREFAAFA/sABgAFA/sABgAEA/wADAID9AIADoMD9IKACQMD9AMAAAAAAAQBJ/8ADowPAAEAAAAUmNjc+ATEwFgc2Nz4BNzYnFhceAQcGBzY3NiYnJicWBgcmJy4BJyYxFgcOAQcGBy4BJwYHDgEHBgcGFx4BFxYXAUEzICgrHSgNHhITEgEBBEMvLywHBifPLy5CR0cbEgElHzAxWyIhCQ4OOScnKAMOGQMQDygTEwkMBgU4NTVRQGuIOT9oUkQhKSlQIiMUL0hHpFVWTHWKifRYWRQocSB1SUpSDw88Pz55OTgyMEwuKykoUCgpKzw0NGAuLS4AAQAAAAAAAJHK1K1fDzz1AAsEAAAAAADf1KUxAAAAAN/UpTEAAP/ABIADwAAAAAgAAgAAAAAAAAABAAADwP/AAAAEgAAAAAAEgAABAAAAAAAAAAAAAAAAAAAACAQAAAAAAAAAAAAAAAIAAAADAAAABIAAAAQAAAAEAABJAAAAAAAKABQAHgBSAqoCzAMyAAAAAQAAAAgBvgAlAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAA4ArgABAAAAAAABAAcAAAABAAAAAAACAAcAYAABAAAAAAADAAcANgABAAAAAAAEAAcAdQABAAAAAAAFAAsAFQABAAAAAAAGAAcASwABAAAAAAAKABoAigADAAEECQABAA4ABwADAAEECQACAA4AZwADAAEECQADAA4APQADAAEECQAEAA4AfAADAAEECQAFABYAIAADAAEECQAGAA4AUgADAAEECQAKADQApGljb21vb24AaQBjAG8AbQBvAG8AblZlcnNpb24gMS4wAFYAZQByAHMAaQBvAG4AIAAxAC4AMGljb21vb24AaQBjAG8AbQBvAG8Abmljb21vb24AaQBjAG8AbQBvAG8AblJlZ3VsYXIAUgBlAGcAdQBsAGEAcmljb21vb24AaQBjAG8AbQBvAG8AbkZvbnQgZ2VuZXJhdGVkIGJ5IEljb01vb24uAEYAbwBuAHQAIABnAGUAbgBlAHIAYQB0AGUAZAAgAGIAeQAgAEkAYwBvAE0AbwBvAG4ALgAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=) format('woff');\n}\n\n/*!\n * Bootstrap  v5.2.0 (https://getbootstrap.com/)\n * Copyright 2011-2022 The Bootstrap Authors\n * Copyright 2011-2022 Twitter, Inc.\n * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)\n */\n\n.card {\n    --bs-card-spacer-y: 1rem;\n    --bs-card-spacer-x: 1rem;\n    --bs-card-title-spacer-y: 0.5rem;\n    --bs-card-border-width: 1px;\n    /* --bs-card-border-color: rgba(0, 0, 0, 0.175); */\n    --bs-card-border-radius: 0.375rem;\n    --bs-card-box-shadow: ;\n    --bs-card-inner-border-radius: calc(0.375rem - 1px);\n    --bs-card-cap-padding-y: 0.5rem;\n    --bs-card-cap-padding-x: 1rem;\n    --bs-card-cap-bg: rgba(0, 0, 0, 0.03);\n    --bs-card-cap-color: ;\n    --bs-card-height: ;\n    --bs-card-color: ;\n    --bs-card-bg: #fff;\n    --bs-card-img-overlay-padding: 1rem;\n    --bs-card-group-margin: 0.75rem;\n    position: absolute;\n    display: flex;\n    flex-direction: column;\n    min-width: 0;\n    word-wrap: break-word;\n    background-color: var(--bs-card-bg);\n    background-clip: border-box;\n    justify-content: center;\n    z-index: 2000;\n    height: auto !important;\n}\n\n.card>.list-group {\n    border-top: inherit;\n    border-bottom: inherit\n}\n\n.card>.list-group:last-child {\n    border-bottom-width: 0;\n    border-bottom-right-radius: var(--bs-card-inner-border-radius);\n    border-bottom-left-radius: var(--bs-card-inner-border-radius)\n}\n\n.card>.card-header+.list-group {\n    border-top: 0\n}\n\n.card-header {\n    padding: var(--bs-card-cap-padding-y) var(--bs-card-cap-padding-x);\n    margin-bottom: 0;\n    color: var(--bs-card-cap-color);\n    background-color: white;\n    border-bottom: var(--bs-card-border-width) solid var(--bs-card-border-color)\n}\n\n.card-header:first-child {\n  border-bottom: 1px solid #F5F7FA !important;\n  border: var(--bs-card-border-width) solid var(--bs-card-border-color);\n  border-radius: var(--bs-card-inner-border-radius) var(--bs-card-inner-border-radius) 0 0\n}\n\n.accordion-draw-item-header {\n\tborder: none !important;\n\tborder-bottom: 1px solid #F5F7FA !important;\n    font-weight: bold !important;\n    font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Helvetica, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji;\n}\n\n.accordion-draw-item-header:hover .accordion-hide-draw-btn,\n.accordion-draw-item-header:hover .accordion-show-lagend-btn,\n.accordion-draw-item-header:hover .accordion-hide-draw-btn > i,\n.accordion-draw-item-header:hover .accordion-show-lagend-btn > i {\n\tdisplay: block;\n}\n\n.accordion-body {\n\tmax-height: 246px;\n}\n\n.accordion-show-lagend-btn {\n    position: absolute;\n    right: 36px;\n    top: 5px;\n    cursor: pointer;\n\tdisplay: none;\n}\n\n.accordion-hide-draw-btn {\n    position: absolute;\n    right: 10px;\n    top: 7px;\n    cursor: pointer;\n\tdisplay: none;\n}\n\n.accordion-hide-draw-btn:hover i,\n.accordion-show-lagend-btn:hover i {\n    transform: scale(1.3);\n}\n\n\n/*! jQuery UI - v1.13.2 - 2022-09-05\n* http://jqueryui.com\n* Includes: core.css, accordion.css, theme.css\n* To view and modify this theme, visit http://jqueryui.com/themeroller/?scope=&folderName=base&cornerRadiusShadow=8px&offsetLeftShadow=0px&offsetTopShadow=0px&thicknessShadow=5px&opacityShadow=30&bgImgOpacityShadow=0&bgTextureShadow=flat&bgColorShadow=666666&opacityOverlay=30&bgImgOpacityOverlay=0&bgTextureOverlay=flat&bgColorOverlay=aaaaaa&iconColorError=cc0000&fcError=5f3f3f&borderColorError=f1a899&bgTextureError=flat&bgColorError=fddfdf&iconColorHighlight=777620&fcHighlight=777620&borderColorHighlight=dad55e&bgTextureHighlight=flat&bgColorHighlight=fffa90&iconColorActive=ffffff&fcActive=ffffff&borderColorActive=003eff&bgTextureActive=flat&bgColorActive=007fff&iconColorHover=555555&fcHover=2b2b2b&borderColorHover=cccccc&bgTextureHover=flat&bgColorHover=ededed&iconColorDefault=777777&fcDefault=454545&borderColorDefault=c5c5c5&bgTextureDefault=flat&bgColorDefault=f6f6f6&iconColorContent=444444&fcContent=333333&borderColorContent=dddddd&bgTextureContent=flat&bgColorContent=ffffff&iconColorHeader=444444&fcHeader=333333&borderColorHeader=dddddd&bgTextureHeader=flat&bgColorHeader=e9e9e9&cornerRadius=3px&fwDefault=normal&fsDefault=1em&ffDefault=Arial%2CHelvetica%2Csans-serif\n* Copyright jQuery Foundation and other contributors; Licensed MIT */\n\n/* Layout helpers\n----------------------------------*/\n.ui-helper-hidden {\n\tdisplay: none;\n}\n.ui-helper-hidden-accessible {\n\tborder: 0;\n\tclip: rect(0 0 0 0);\n\theight: 1px;\n\tmargin: -1px;\n\toverflow: hidden;\n\tpadding: 0;\n\tposition: absolute;\n\twidth: 1px;\n}\n.ui-helper-reset {\n\tmargin: 0;\n\tpadding: 0;\n\tborder: 0;\n\toutline: 0;\n\tline-height: 1.3;\n\ttext-decoration: none;\n\tfont-size: 100%;\n\tlist-style: none;\n}\n.ui-helper-clearfix:before,\n.ui-helper-clearfix:after {\n\tcontent: \"\";\n\tdisplay: table;\n\tborder-collapse: collapse;\n}\n.ui-helper-clearfix:after {\n\tclear: both;\n}\n.ui-helper-zfix {\n\twidth: 100%;\n\theight: 100%;\n\ttop: 0;\n\tleft: 0;\n\tposition: absolute;\n\topacity: 0;\n\t-ms-filter: \"alpha(opacity=0)\"; /* support: IE8 */\n}\n\n.ui-front {\n\tz-index: 100;\n}\n\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-disabled {\n\tcursor: default !important;\n\tpointer-events: none;\n}\n\n\n/* Icons\n----------------------------------*/\n\n.fa-circle {\n\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='1em' viewBox='0 0 512 512'%3E%3C!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --%3E%3Cpath d='M464 256A208 208 0 1 0 48 256a208 208 0 1 0 416 0zM0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256z'/%3E%3C/svg%3E\");\n\tbackground-repeat: no-repeat;\n\twidth: 16px;\n  \theight: 16px;\n}\n\n.data-filter-icon {\n\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 80' x='0px' y='0px'%3E%3Cg%3E%3Cpath d='M20 7V25H14V7a2 2 0 0 1 2-2h2A2 2 0 0 1 20 7Zm6 3H24a2 2 0 0 0-2 2V25h6V12A2 2 0 0 0 26 10Zm7-8H31a2 2 0 0 0-2 2V25h6V4A2 2 0 0 0 33 2Zm14 8H45a2 2 0 0 0-2 2V25h6V12A2 2 0 0 0 47 10ZM40 8H38a2 2 0 0 0-2 2V25h6V10A2 2 0 0 0 40 8ZM15.74573 34 26.69629 44.62842A1.00338 1.00338 0 0 1 27 45.34619V58.98242a3.00054 3.00054 0 0 0 4.16895 2.7627l2-.84619A2.99367 2.99367 0 0 0 35 58.13623V45.41211a.99945.99945 0 0 1 .34375-.75537L47.61554 34Zm-2.06061-2H49.9187l1.71607-1.49023A1.99969 1.99969 0 0 0 50.32324 27H13.46582a2 2 0 0 0-1.39258 3.43555Z'/%3E%3C/g%3E%3C/svg%3E\");\n\tbackground-repeat: no-repeat;\n\twidth: 18px;\n  \theight: 22px;;\n}\n\n.fa-draw-polygon {\n\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='1em' viewBox='0 0 512 512'%3E%3C!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --%3E%3Cpath d='M96 151.4V360.6c9.7 5.6 17.8 13.7 23.4 23.4H328.6c0-.1 .1-.2 .1-.3l-4.5-7.9-32-56 0 0c-1.4 .1-2.8 .1-4.2 .1c-35.3 0-64-28.7-64-64s28.7-64 64-64c1.4 0 2.8 0 4.2 .1l0 0 32-56 4.5-7.9-.1-.3H119.4c-5.6 9.7-13.7 17.8-23.4 23.4zM384.3 352c35.2 .2 63.7 28.7 63.7 64c0 35.3-28.7 64-64 64c-23.7 0-44.4-12.9-55.4-32H119.4c-11.1 19.1-31.7 32-55.4 32c-35.3 0-64-28.7-64-64c0-23.7 12.9-44.4 32-55.4V151.4C12.9 140.4 0 119.7 0 96C0 60.7 28.7 32 64 32c23.7 0 44.4 12.9 55.4 32H328.6c11.1-19.1 31.7-32 55.4-32c35.3 0 64 28.7 64 64c0 35.3-28.5 63.8-63.7 64l-4.5 7.9-32 56-2.3 4c4.2 8.5 6.5 18 6.5 28.1s-2.3 19.6-6.5 28.1l2.3 4 32 56 4.5 7.9z'/%3E%3C/svg%3E\");\n\tbackground-repeat: no-repeat;\n\twidth: 16px;\n  \theight: 16px;\n}\n\n.fa-square-full {\n\tbackground-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='1em' viewBox='0 0 512 512'%3E%3C!-- Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --%3E%3Cpath d='M368 80h32v32H368V80zM352 32c-17.7 0-32 14.3-32 32H128c0-17.7-14.3-32-32-32H32C14.3 32 0 46.3 0 64v64c0 17.7 14.3 32 32 32V352c-17.7 0-32 14.3-32 32v64c0 17.7 14.3 32 32 32H96c17.7 0 32-14.3 32-32H320c0 17.7 14.3 32 32 32h64c17.7 0 32-14.3 32-32V384c0-17.7-14.3-32-32-32V160c17.7 0 32-14.3 32-32V64c0-17.7-14.3-32-32-32H352zM96 160c17.7 0 32-14.3 32-32H320c0 17.7 14.3 32 32 32V352c-17.7 0-32 14.3-32 32H128c0-17.7-14.3-32-32-32V160zM48 400H80v32H48V400zm320 32V400h32v32H368zM48 112V80H80v32H48z'/%3E%3C/svg%3E\");\n\tbackground-repeat: no-repeat;\n\twidth: 16px;\n  \theight: 16px;\n}\n\n.ui-icon {\n\tdisplay: inline-block;\n\tvertical-align: middle;\n\tmargin-top: -.25em;\n\tposition: relative;\n\ttext-indent: -99999px;\n\toverflow: hidden;\n\tbackground-repeat: no-repeat;\n}\n\n.ui-widget-icon-block {\n\tleft: 50%;\n\tmargin-left: -8px;\n\tdisplay: block;\n}\n\n/* Misc visuals\n----------------------------------*/\n\n/* Overlays */\n.ui-widget-overlay {\n\tposition: fixed;\n\ttop: 0;\n\tleft: 0;\n\twidth: 100%;\n\theight: 100%;\n}\n\n/* Component containers\n----------------------------------*/\n.ui-widget {\n\tfont-family: Arial,Helvetica,sans-serif;\n\tfont-size: 1em;\n}\n.ui-widget .ui-widget {\n\tfont-size: 1em;\n}\n.ui-widget input,\n.ui-widget select,\n.ui-widget textarea,\n.ui-widget button {\n\tfont-family: Arial,Helvetica,sans-serif;\n\tfont-size: 1em;\n}\n.ui-widget.ui-widget-content {\n\tborder: 1px solid #c5c5c5;\n}\n.ui-widget-content {\n\tborder: 0px solid #dddddd;\n\tbackground: #fafbfd;\n\tcolor: #333333;\n}\n.ui-widget-content a {\n\tcolor: #333333;\n}\n.ui-widget-header {\n\tborder: 1px solid #dddddd;\n\tbackground: #e9e9e9;\n\tcolor: #333333;\n\tfont-weight: bold;\n}\n.ui-widget-header a {\n\tcolor: #333333;\n}\n\n/* Interaction states\n----------------------------------*/\n.ui-state-default,\n.ui-widget-content .ui-state-default,\n.ui-widget-header .ui-state-default,\n.ui-button,\n\n/* We use html here because we need a greater specificity to make sure disabled\nworks properly when clicked or hovered */\nhtml .ui-button.ui-state-disabled:hover,\nhtml .ui-button.ui-state-disabled:active {\n\tborder: 1px solid #c5c5c5;\n\tbackground: #f6f6f6;\n\tfont-weight: normal;\n\tcolor: #454545;\n}\n.ui-state-default a,\n.ui-state-default a:link,\n.ui-state-default a:visited,\na.ui-button,\na:link.ui-button,\na:visited.ui-button,\n.ui-button {\n\tcolor: #454545;\n\ttext-decoration: none;\n}\n.ui-state-hover,\n.ui-widget-content .ui-state-hover,\n.ui-widget-header .ui-state-hover,\n.ui-state-focus,\n.ui-widget-content .ui-state-focus,\n.ui-widget-header .ui-state-focus,\n.ui-button:hover,\n.ui-button:focus {\n\tborder: 1px solid #cccccc;\n\tbackground: #ededed;\n\tfont-weight: normal;\n\tcolor: #2b2b2b;\n}\n.ui-state-hover a,\n.ui-state-hover a:hover,\n.ui-state-hover a:link,\n.ui-state-hover a:visited,\n.ui-state-focus a,\n.ui-state-focus a:hover,\n.ui-state-focus a:link,\n.ui-state-focus a:visited,\na.ui-button:hover,\na.ui-button:focus {\n\tcolor: #2b2b2b;\n\ttext-decoration: none;\n}\n\n.ui-visual-focus {\n\tbox-shadow: 0 0 3px 1px rgb(94, 158, 214);\n}\n.ui-state-active,\n.ui-widget-content .ui-state-active,\n.ui-widget-header .ui-state-active,\na.ui-button:active,\n.ui-button:active,\n.ui-button.ui-state-active:hover {\n\tborder: 1px solid #c5c5c5;\n\tbackground: #ededed !important;\n\tfont-weight: normal;\n\tcolor: #454545;\n}\n.ui-icon-background,\n.ui-state-active .ui-icon-background {\n\tborder: #003eff;\n\tbackground-color: #ffffff;\n}\n.ui-state-active a,\n.ui-state-active a:link,\n.ui-state-active a:visited {\n\ttext-decoration: none;\n}\n\n/* Interaction Cues\n----------------------------------*/\n.ui-state-highlight,\n.ui-widget-content .ui-state-highlight,\n.ui-widget-header .ui-state-highlight {\n\tborder: 1px solid #dad55e;\n\tbackground: #fffa90;\n\tcolor: #777620;\n}\n.ui-state-checked {\n\tborder: 1px solid #dad55e;\n\tbackground: #fffa90;\n}\n.ui-state-highlight a,\n.ui-widget-content .ui-state-highlight a,\n.ui-widget-header .ui-state-highlight a {\n\tcolor: #777620;\n}\n.ui-state-error,\n.ui-widget-content .ui-state-error,\n.ui-widget-header .ui-state-error {\n\tborder: 1px solid #f1a899;\n\tbackground: #fddfdf;\n\tcolor: #5f3f3f;\n}\n.ui-state-error a,\n.ui-widget-content .ui-state-error a,\n.ui-widget-header .ui-state-error a {\n\tcolor: #5f3f3f;\n}\n.ui-state-error-text,\n.ui-widget-content .ui-state-error-text,\n.ui-widget-header .ui-state-error-text {\n\tcolor: #5f3f3f;\n}\n.ui-priority-primary,\n.ui-widget-content .ui-priority-primary,\n.ui-widget-header .ui-priority-primary {\n\tfont-weight: bold;\n}\n.ui-priority-secondary,\n.ui-widget-content .ui-priority-secondary,\n.ui-widget-header .ui-priority-secondary {\n\topacity: .7;\n\t-ms-filter: \"alpha(opacity=70)\"; /* support: IE8 */\n\tfont-weight: normal;\n}\n.ui-state-disabled,\n.ui-widget-content .ui-state-disabled,\n.ui-widget-header .ui-state-disabled {\n\topacity: .35;\n\t-ms-filter: \"alpha(opacity=35)\"; /* support: IE8 */\n\tbackground-image: none;\n}\n.ui-state-disabled .ui-icon {\n\t-ms-filter: \"alpha(opacity=35)\"; /* support: IE8 - See #6059 */\n}\n\n/* Misc visuals\n----------------------------------*/\n\n/* Corner radius */\n.ui-corner-all,\n.ui-corner-top,\n.ui-corner-left,\n.ui-corner-tl {\n\tborder-top-left-radius: 0px;\n}\n.ui-corner-all,\n.ui-corner-top,\n.ui-corner-right,\n.ui-corner-tr {\n\tborder-top-right-radius: 0px;\n}\n.ui-corner-all,\n.ui-corner-bottom,\n.ui-corner-left,\n.ui-corner-bl {\n\tborder-bottom-left-radius: 0px;\n}\n.ui-corner-all,\n.ui-corner-bottom,\n.ui-corner-right,\n.ui-corner-br {\n\tborder-bottom-right-radius: 0px;\n}\n\n/* Overlays */\n.ui-widget-overlay {\n\tbackground: #aaaaaa;\n\topacity: .3;\n\t-ms-filter: Alpha(Opacity=30); /* support: IE8 */\n}\n\n.ui-widget-shadow {\n\t-webkit-box-shadow: 0px 0px 5px #666666;\n\tbox-shadow: 0px 0px 5px #666666;\n}\n\n.cft-draw-control-card {\n\tborder-radius: 4px;\n\tbox-shadow: 1px 1px 7px -2px rgba(0,0,0,0.68);\n}\n\n.cft-draw-control-card > .ui-accordion {\n\tborder-radius: 4px;\n}\n\n.cft-draw-control-card > .card-header {\n\tborder-radius: 2px 2px 0 0;\n\tpadding-bottom: 10px;\n}\n\n.cft-draw-identifier{\n\tdisplay: grid;\n\tgrid-template-columns: 15px auto auto;\n\tgrid-gap: 5px;\n}\n\n.accordion-draw-item-header:hover .cft-draw-identifier span{\n\ttext-decoration: underline;\n}\n\n.cft-draw-color-indicator-circle {\n\tborder: 1px solid black;\n\tborder-radius: 13px;\n\twidth: 13px;\n}\n\n.cft-draw-color-indicator {\n\tborder: 1px solid black;\n\tborder-radius: 4px;\n\twidth: 14px;\n}\n\n.collapsible-draw-control {\n\tborder-radius: 3px;\n\tbox-shadow: 1px 1px 7px -2px rgba(0,0,0,0.68);\n}\n\n/* select styles */ \n.draw-form-label {\n\tpadding: 7px 12px;\n}\n\n#shape-label{\n\tmargin-bottom: 10px;\n}\n\nbutton#btn-accept-draw {\n    background-color: #1976D2;\n    border: 0px;\n    color: #FFF;\n    font-size: 12px;\n    cursor: pointer;\n    padding: 4px;\n    border-radius: 3px;\n\twidth: 90px;\n}\n\nbutton#btn-cancel-draw {\n    background-color: #E71D36;\n    border: 0px;\n    color: #FFF;\n    font-size: 12px;\n    cursor: pointer;\n    padding: 4px;\n    border-radius: 3px;\n\twidth: 90px;\n}\n\n#form-button-container {\n\ttext-align: center;\n}\n\nbutton#btn-accept-draw:disabled,\nbutton#btn-accept-draw[disabled]{\n  border: 1px solid #999999;\n  background-color: #cccccc;\n  color: #666666;\n}\n\n  ",""]),e.exports=t},function(e,t,i){"use strict";e.exports={DRAW_FILTER_SHAPES:{POLYGON:{shapeName:"POLYGON",esFilter:"geo_shape",shape:"Polygon"},BOUNDING_BOX:{shapeName:"BOUNDING_BOX",esFilter:"geo_shape",shape:"Polygon"},DISTANCE:{shapeName:"DISTANCE",esFilter:"geo_distance"}},DRAW_FILTER_OPERATIONS:{IN:"IN",NOT_IN:"NOT_IN"},DRAW_FILTER_RELATIONS:{INTERSECTS:"INTERSECTS",DISJOINT:"DISJOINT",WITHIN:"WITHIN",CONTAINS:"CONTAINS"},DRAW_FILTER_TYPES:["POLYGON","DISTANCE"],DRAW_SHAPES:[{id:"0",label:"Shape",mode:"SHAPE",iconName:"draw-polygon",drawMode:"draw_polygon",defaultAlias:"shape",tooltipText:"Click to start shape. Click to add vertex. Double click to finish"},{id:"1",label:"Bounds",mode:"BOUNDS",iconName:"square-full",drawMode:"draw_rectangle",defaultAlias:"bound",tooltipText:"Click to start rectangle. Move mouse to adjust rectangle size. Click again to finish"},{id:"2",label:"Distance",mode:"DISTANCE",iconName:"circle",drawMode:"draw_circle",defaultAlias:"distance",tooltipText:"Click to set point. Move mouse to adjust distance. Click to finish"}],CHARTS_ORIENTATIONS:{HORIZONTAL:"horizontal",VERTICAL:"vertical"},CF_CHARTS_NAMES:{BOX_PLOT:"Box Plot"},ECHARTS_CHARTS_NAMES:{BOX_PLOT:"boxplot"}}},function(e,t,i){"use strict";(function(t){var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function r(n,o){try{var a=t[n](o),s=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}var a=i(0),s=a.getToolkit,l=a.getAktiveAql,c=a.createLayerAktive,u=a.setLocationPrecisionAndFields,p=a.checkAndProcessSerieAndColor,d=a.processGeohashData,h=a.renderScrollableTooltip,f=a.getLayerVisibility,_=a.isLayerVisible,m=a.renderLegend,g=i(2),y=g.error,v=g.DEFAULT_MARKER_COLOR,A=g.DEFAULT_MARKER_ICON,b=g.sanitize,w=g.getRows,C=g.getFields,L=g.getMetrics,x=g.getFilters,k=g.splitData,I=g.getLngLatFields,E=g.getColorFromRange,M=g.createMapLibrePopupInstance,S=g.setPopupPosition,P=g.getConvexHull,F=g.buildOpacityExpression,D=g.getRandomInt,B=g.shouldProcessData,z=i(3).renderLayersControl,T=i(4).renderDrawControl,O=s(),R=O.getDependency("utils"),N=R.getEnvironment(),V=O.getDependency("lodash"),G=i(10).default,j=i(7).default,Q="browser"===N?window:t;e.exports=function(){function e(i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mapVisualization=i,this._map=i._map,this._config=r,this._type=r.type,this._sanitizedName=b(this._config.name),this._sourceId=this._sanitizedName+"_source",this._circleLayerId=this._sanitizedName+"_circle_layer",this._symbolLayerId=this._sanitizedName+"_symbol_layer",this._markerLayerId=this._sanitizedName+"_image_layer",this._spiderifyId=this._sanitizedName+"_spiderify",this._mainLayerId=this._circleLayerId,this._featureCollection={type:"FeatureCollection",features:[]},this._isCustomData=!1,this._isHeatMapLayerRawMarker=!1,this._window="browser"===N?window:t,this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseLeave=this._handleMouseLeave.bind(this),this._handleMouseClick=this._handleMouseClick.bind(this),this._handleMapMouseClick=this._handleMapMouseClick.bind(this),this._handleMouseMoveMarker=this._handleMouseMoveMarker.bind(this),this._handleMouseLeaveMarker=this._handleMouseLeaveMarker.bind(this),this._handleMouseClickMarker=this._handleMouseClickMarker.bind(this),this._config.properties=this._config.properties||{},this._properties=this._config.properties,this._min=this._properties.min,this._max=this._properties.max,this._manualMinMax=V.isNumber(this._min)&&V.isNumber(this._max),this._shouldRenderClusters=!0,this._useClickEvent=!0,this._init()}return n(e,[{key:"_init",value:function(){this._spiderfyDistanceMultiplier=1,this._2PI=2*Math.PI,this._circleFootSeparation=25,this._circleStartAngle=0,this._spiralFootSeparation=28,this._spiralLengthStart=11,this._spiralLengthFactor=5,this._circleSpiralSwitchover=9,this._markerColor=v;var e=V.cloneDeep(this._properties.color);e&&("string"==typeof e&&(e=O.Color().palette([e]),this._properties.color=e),e._default||this._properties.clusterColor||(e&&void 0===e._dynamic&&!e._range&&e.autoRange({dynamic:!0}),this._properties.clusterColor=e),this._properties.clusterColor?this._markerColor=V.get(this._properties,"clusterColor._palette[0]"):this._markerColor=V.get(this._properties,"color._palette[0]")),this._visibility=f(this._config),this._rows=w(this._properties.rows),this._fields=C(this._properties.fields),this._metrics=L(this._properties.metrics),this._location=this._properties.location,this._precisionLevels=this._properties.precisionLevels;var t=I(this._location),i=t.lngField,r=t.latField;this._lngField=i,this._latField=r}},{key:"_rows",value:function(e){return this._rows=e,this}},{key:"_configureAktive",value:function(){var e=this;if(this._config.provider&&this._config.source){this._aktive=c(this._mapVisualization._element,this._config);var t=l(this._aktive),i=this._properties.limit,r=this._properties.precision,n=x(this._properties.filters||[]),a=x(this._properties.staticFilters||[]),s=this._properties.textFilter||"",p=this._properties.color||O.Color();if(p._defaultPalette&&(p._palette=[v]),this._config.properties.color=p,this._aktive._options.set("color",p),V.isArray(this._rows)?this._aktive.rows(this._rows):t._rows=[],V.isArray(this._fields)){if(this._location){var h=V.cloneDeep(this._location);V.isArray(h)||(h=[h]),(h=h.reverse()).forEach(function(t){e._fields.includes(t)||e._fields.unshift(t)})}this._aktive.fields(this._fields)}else t._fields=[];V.isArray(this._metrics)?this._aktive.metrics(this._metrics):t._metrics=[],i&&this._aktive.limit(i),this._precisionLevels&&this._aktive.set("precisionLevels",this._precisionLevels),u(this._mapVisualization,this._config,this._aktive,this._location,r,this._precisionLevels),this._aktive.staticFilters(a),this._aktive.filters(n),this._aktive.textfilter(s),this._aktive._layer=this._config,this._aktive._isAktiveLayer=!0,this._aktive._isMarkerLayer=!0,this._aktive._mainLayerId=this._circleLayerId,this._aktive._options.set("isMarkerLayer",!0),this._aktive._parentAktive=this._mapVisualization._aktive,this._mapVisualization._storeLayerAktive(this._aktive),this._aktive.on("execute:start",function(t){e._mapVisualization._runningAktives[e._aktive._elementId]||(e._mapVisualization._runningAktives[e._aktive._elementId]=e._aktive,e._mapVisualization.dispatch({name:"geo:layers-execution-start",element:e._mapVisualization._element}))}),this._aktive.on("execute:stop",function(){var t=o(regeneratorRuntime.mark(function t(i){var r,n,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e._mapVisualization._storeLayerAktive(e._aktive),i.error||(r=d(k(i.data)),B(e,r)?(e._aktive._data=r,e._data=r,n=e._aktive.get().rows,o=e._aktive.get("config").fields,a=e._aktive.get("config").metrics,e._rows=n,e._fields=o,e._metrics=a,V.set(e._config,"properties.metrics",a),e._processData()):(e._visibility=f(e._config),e._map.setLayoutProperty(e._circleLayerId,"visibility",e._visibility),e._map.setLayoutProperty(e._symbolLayerId,"visibility",e._visibility),e._map.setLayoutProperty(e._markerLayerId,"visibility",e._visibility))),delete e._mapVisualization._runningAktives[e._aktive._elementId],V.isEmpty(e._mapVisualization._runningAktives)&&e._mapVisualization.dispatch({name:"geo:layers-execution-stop",element:e._mapVisualization._element});case 4:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}())}else y("Please specify a provider and a source for the marker layer "+this._config.name)}},{key:"_processClusterColor",value:function(e,t){var i=void 0;if(e){e&&void 0===e._dynamic&&!e._range&&e.autoRange({dynamic:!0}),i=p(t,e);var r=V.first(i.clusterColor._range),n=V.flattenDeep(i.clusterColor._range.map(function(e){return[e.min,e.color]}));this._colorExpression=["step",["get","point_count"],r.color].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(n))}else this._colorExpression=["case",["<=",["get","point_count"],10],"rgba(110, 204, 57, 0.7)",["all",[">",["get","point_count"],10],["<",["get","point_count"],100]],"rgba(240, 194, 12, 0.7)","rgba(241, 128, 23, 0.7)"];var o=V.min(t),a=V.max(t),s=this._manualMinMax?this._min:o,l=this._manualMinMax?this._max:a;return this._min=s,this._max=l,V.set(this._config,"properties.min",s),V.set(this._config,"properties.max",l),i}},{key:"_generateSpiderLegPoints",value:function(e,t){var i=this._map.project(t);return e>=this._circleSpiralSwitchover?this._generatePointsSpiral(e,i):this._generatePointsCircle(e,i)}},{key:"_generatePointsSpiral",value:function(e,t){var i=this._spiderfyDistanceMultiplier*this._spiralLengthStart,r=this._spiderfyDistanceMultiplier*this._spiralFootSeparation,n=this._spiderfyDistanceMultiplier*this._spiralLengthFactor*this._2PI,o=0,a=[],s=void 0;for(a.length=e,s=e;s>=0;s--)s<e&&(a[s]=new Q.maplibregl.Point(t.x+i*Math.cos(o),t.y+i*Math.sin(o))._round()),i+=n/(o+=r/i+5e-4*s);return a}},{key:"_generatePointsCircle",value:function(e,t){var i=this._spiderfyDistanceMultiplier*this._circleFootSeparation*(2+e)/this._2PI,r=this._2PI/e,n=[],o=void 0,a=void 0;for(i=Math.max(i,35),n.length=e,o=0;o<e;o++)a=this._circleStartAngle+o*r,n[o]=new Q.maplibregl.Point(t.x+i*Math.cos(a),t.y+i*Math.sin(a))._round();return n}},{key:"_generateFeatures",value:function(e){for(var t=this._properties.ignoreCoords,i=V.get(e,"clusterColor._range"),r=this._data.length,n=[],o=0;o<r;o++){var a=this._data[o],s=a.type,l=a.count,c=a.ne,u=a.sw,p=parseFloat(a[this._lngField]||a.longitude),d=parseFloat(a[this._latField]||a.latitude);if((!t||p!==t[0]||d!==t[1])&&(!Number.isNaN(p)&&!Number.isNaN(d))){var h={id:D(),type:"Feature",geometry:{type:"Point",coordinates:[p,d]},properties:{__cf_type__:"geohash"===s?"geohash":"raw",__cf_data__:a}};if("geohash"===s){var f=E(i,l),_=R.contrastColor(f),m=l<1e3?l:R.formatNumericValue(l,{type:"INTEGER"},!0);Object.assign(h.properties,{ne:c,sw:u,point_count:l,point_count_formatted:m,__cf_cluster_text_color__:_,color:f})}else h.properties.marker_color=this._markerColor,h.properties.point_count=1;n.push(h)}}this._featureCollection.features=n}},{key:"_generateFeatureCollectionPolygon",value:function(e,t,i,r){for(var n={type:"Feature",geometry:{type:"Polygon",coordinates:[]}},o=e.getLeaves(i,"Infinity"),a=o.length,s=[],l=[],c=0;c<a;c++){var u=o[c];l.push({lng:u.geometry.coordinates[0],lat:u.geometry.coordinates[1]});var p=r[c],d=this._map.unproject(p);u.geometry.coordinates[0]=d.lng,u.geometry.coordinates[1]=d.lat,Object.assign(t.properties,{__cf_marker_offset_x_y__:[p.x,p.y],__cf_marker_offset_x__:p.x,__cf_marker_offset_y__:p.y})}for(var h=P(l),f=0;f<h.length;f++){var _=h[f];s.push([_.lng,_.lat])}s.push(s[0]),n.geometry.coordinates.push(s);var m=j({type:"FeatureCollection",features:o});Object.assign(t.properties,{__cf_lat_lng_points__:l,__cf_cluster_polygon_feature__:n,__cf_cluster_leaves_features__:o,__cf_cluster_leaves_bounds__:m})}},{key:"_generateRawClusters",value:function(){var e=new G({maxZoom:24}).load(this._featureCollection.features),t=this._map.getBounds(),i=[t._sw.lng,t._sw.lat,t._ne.lng,t._ne.lat],r=e.getClusters(i,this._map.getZoom()),n=r.length;if(n>0){var o=V.uniq(r.map(function(e){return e.properties.point_count})).filter(function(e){return e});V.isEmpty(o)&&o.push(1);for(var a=this._processClusterColor(this._properties.clusterColor,o),s=V.get(a,"clusterColor._range"),l=0;l<n;l++){var c=r[l],u=c.properties,p=u.cluster_id,d=u.point_count;if(c.id=D(),c.properties.__cf_type__="raw",p&&d){var h=new Q.maplibregl.LngLat(c.geometry.coordinates[0],c.geometry.coordinates[1]),f=this._generateSpiderLegPoints(d,h),_=E(s,d),m=R.contrastColor(_),g=d<1e3?d:R.formatNumericValue(d,{type:"INTEGER"},!0),y=e.getChildren(p).some(function(e){return e.properties.cluster});Object.assign(c.properties,{__cf_has_child_clusters__:y,point_count_formatted:g,__cf_cluster_text_color__:m,color:_}),this._generateFeatureCollectionPolygon(e,c,p,f)}else c.properties.point_count=1}this._featureCollection.features=r,this._shouldRenderClusters=!0}else this._shouldRenderClusters=!1}},{key:"_addImage",value:function(e,t){var i=this;return new Promise(function(r,n){i._map.loadImage(e,function(e,o){e&&n(e),i._map.hasImage(t)&&i._map.removeImage(t),i._map.addImage(t,o,{sdf:!0}),r(o)})})}},{key:"_processData",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,i,r,n,o,a,s,l=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._useClickEvent=!0,this._mapVisualization._removeAllPopups(),this._visibility=f(this._config),t=this._properties,i=t.markerIcon,r=void 0===i?A:i,n=t.clusterIcon,this._markerIcon=r,this._clusterIcon=n,this._showLocation=R.getBoolValue(V.get(this._config,"properties.showLocation",!0)),this._allowClickInRawMarker=R.getBoolValue(V.get(this._config,"properties.allowClickInRawMarker",!0)),this._disableMarkerEvents=R.getBoolValue(V.get(this._config,"properties.disableMarkerEvents",!1)),this._maxSpiderifyMarkers=this._properties.maxSpiderifyMarkers||500,e.next=12,this._addImage(this._markerIcon,this._markerLayerId);case 12:if(this._markerIconImage=e.sent,!this._clusterIcon){e.next=17;break}return e.next=16,this._addImage(this._clusterIcon,this._circleLayerId);case 16:this._clusterIconImage=e.sent;case 17:V.isEmpty(this._data)?this._removeLayer():(o="geohash"===V.get(this._data,"[0].type",!1),a=null,s=null,o&&(a=V.uniq(this._data.map(function(e){return e.count})),s=this._processClusterColor(this._properties.clusterColor,a)),this._generateFeatures(s),o||this._generateRawClusters(),this._map.once("styleimagemissing",function(e){e.id===l._markerLayerId&&l._map.addImage(e.id,l._markerIconImage,{sdf:!0}),e.id===l._circleLayerId&&l._map.addImage(e.id,l._clusterIconImage,{sdf:!0})}),this._addSource(),this._addLayer()),setTimeout(function(){m(l._mapVisualization),z(l._mapVisualization),T(l._mapVisualization)},1);case 19:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_addSource",value:function(){var e=this._map.getSource(this._sourceId);e?e.setData(this._featureCollection):this._map.addSource(this._sourceId,{type:"geojson",data:this._featureCollection,buffer:0})}},{key:"_removeSource",value:function(){this._map.getSource(this._sourceId)&&this._map.removeSource(this._sourceId)}},{key:"_addLayer",value:function(){var e=this._properties.opacityZoomLevels,t=F(e,["case",["!",["coalesce",["feature-state","clicked"],!1]],1,.2]),i=F(e,["case",["!",["coalesce",["feature-state","clicked"],!1]],.55,.2]),r=this._map.getLayer(this._circleLayerId);this._shouldRenderClusters&&(this._clusterIcon?r&&"symbol"===r.type?(this._map.setLayoutProperty(this._circleLayerId,"visibility",this._visibility),this._map.setLayoutProperty(this._circleLayerId,"icon-image",this._circleLayerId),this._map.setLayoutProperty(this._circleLayerId,"icon-overlap","always"),this._map.setPaintProperty(this._circleLayerId,"icon-opacity",t),this._map.setPaintProperty(this._circleLayerId,"icon-color",this._colorExpression)):(r&&this._map.removeLayer(this._circleLayerId),this._map.addLayer({id:this._circleLayerId,type:"symbol",source:this._sourceId,filter:["any",["==",["get","__cf_type__"],"geohash"],["all",["==",["get","__cf_type__"],"raw"],[">",["get","point_count"],1]]],layout:{visibility:this._visibility,"icon-image":this._circleLayerId,"icon-overlap":"always"},paint:{"icon-opacity":t,"icon-color":this._colorExpression}})):r&&"circle"===r.type?(this._map.setLayoutProperty(this._circleLayerId,"visibility",this._visibility),this._map.setLayoutProperty(this._circleLayerId,"circle-sort-key",["get","point_count"]),this._map.setPaintProperty(this._circleLayerId,"circle-color",this._colorExpression),this._map.setPaintProperty(this._circleLayerId,"circle-opacity",t),this._map.setPaintProperty(this._circleLayerId,"circle-stroke-color",this._colorExpression),this._map.setPaintProperty(this._circleLayerId,"circle-stroke-opacity",i),this._map.setPaintProperty(this._circleLayerId,"circle-stroke-width",3),this._map.setPaintProperty(this._circleLayerId,"circle-radius",16)):(r&&this._map.removeLayer(this._circleLayerId),this._map.addLayer({id:this._circleLayerId,type:"circle",source:this._sourceId,filter:["any",["==",["get","__cf_type__"],"geohash"],["all",["==",["get","__cf_type__"],"raw"],[">",["get","point_count"],1]]],layout:{visibility:this._visibility,"circle-sort-key":["get","point_count"]},paint:{"circle-color":this._colorExpression,"circle-opacity":t,"circle-stroke-color":this._colorExpression,"circle-stroke-opacity":i,"circle-stroke-width":3,"circle-radius":16}})),this._map.getLayer(this._symbolLayerId)?(this._map.setLayoutProperty(this._symbolLayerId,"visibility",this._visibility),this._map.setLayoutProperty(this._symbolLayerId,"symbol-sort-key",["-",["get","point_count"]]),this._map.setLayoutProperty(this._symbolLayerId,"text-field",["get","point_count_formatted"]),this._map.setLayoutProperty(this._symbolLayerId,"text-size",12),this._map.setLayoutProperty(this._symbolLayerId,"text-overlap","never"),this._map.setLayoutProperty(this._symbolLayerId,"text-allow-overlap",!1),this._map.setPaintProperty(this._symbolLayerId,"text-color",["get","__cf_cluster_text_color__"]),this._map.setPaintProperty(this._symbolLayerId,"text-halo-color",["get","__cf_cluster_text_color__"]),this._map.setPaintProperty(this._symbolLayerId,"text-halo-width",.1),this._map.setPaintProperty(this._symbolLayerId,"text-opacity",t)):this._map.addLayer({id:this._symbolLayerId,type:"symbol",source:this._sourceId,filter:["any",["==",["get","__cf_type__"],"geohash"],["all",["==",["get","__cf_type__"],"raw"],[">",["get","point_count"],1]]],layout:{visibility:this._visibility,"symbol-sort-key":["-",["get","point_count"]],"text-field":["get","point_count_formatted"],"text-size":12,"text-overlap":"never","text-allow-overlap":!1},paint:{"text-color":["get","__cf_cluster_text_color__"],"text-halo-color":["get","__cf_cluster_text_color__"],"text-halo-width":.1,"text-opacity":t}}),this._mapVisualization._storeTooltipLayerId(this._circleLayerId),this._mapVisualization._setVisibilityZoomRange(this._circleLayerId,this._config),this._mapVisualization._setVisibilityZoomRange(this._symbolLayerId,this._config));var n=this._map.getLayer(this._markerLayerId);n?(this._map.setLayoutProperty(this._markerLayerId,"visibility",this._visibility),this._map.setLayoutProperty(this._markerLayerId,"icon-image",this._markerLayerId),this._map.setLayoutProperty(this._markerLayerId,"icon-overlap","cooperative"),this._map.setPaintProperty(this._markerLayerId,"icon-color",this._markerColor),this._map.setPaintProperty(this._markerLayerId,"icon-opacity",t)):this._map.addLayer({id:this._markerLayerId,type:"symbol",source:this._sourceId,filter:["all",["==",["get","point_count"],1],["==",["get","__cf_type__"],"raw"]],layout:{visibility:this._visibility,"icon-image":this._markerLayerId,"icon-overlap":"cooperative"},paint:{"icon-color":this._markerColor,"icon-opacity":t}}),this._mapVisualization._renderedLayers[this._config.name]=this,this._mapVisualization._storeTooltipLayerId(this._markerLayerId),this._mapVisualization._setVisibilityZoomRange(this._markerLayerId,this._config),this._mapVisualization._reorganizeLayers(),r||n||this._mapVisualization.dispatch({name:"geo:layer-added",element:this._mapVisualization._element,layer:this._config,mapLibreLayers:[this._map.getLayer(this._circleLayerId),this._map.getLayer(this._symbolLayerId),this._map.getLayer(this._markerLayerId)]})}},{key:"_removeLayer",value:function(){var e=this;this._map.getLayer(this._circleLayerId)&&this._map.removeLayer(this._circleLayerId),this._map.getLayer(this._symbolLayerId)&&this._map.removeLayer(this._symbolLayerId),this._map.getLayer(this._markerLayerId)&&this._map.removeLayer(this._markerLayerId),this._map.hasImage(this._markerLayerId)&&this._map.removeImage(this._markerLayerId),this._map.hasImage(this._circleLayerId)&&this._map.removeImage(this._circleLayerId),V.remove(this._mapVisualization._tooltipLayerIds,function(t){return[e._circleLayerId,e._symbolLayerId,e._markerLayerId].includes(t)}),this._hideGeohashSquare(),this._hideRawPolygon(),this._unspiderifyMarkers()}},{key:"_showGeohashSquare",value:function(e){var t=JSON.parse(e.properties.ne),i=JSON.parse(e.properties.sw),r={geometry:{coordinates:[[[i.lon,i.lat],[i.lon,t.lat],[t.lon,t.lat],[t.lon,i.lat],[i.lon,i.lat]]],type:"Polygon"},type:"Feature",properties:{}},n=this._map.getSource("rectangle");n?n.setData(r):(this._map.addSource("rectangle",{type:"geojson",data:r}),this._map.addLayer({id:"rectangle_fill",type:"fill",source:"rectangle",paint:{"fill-color":e.properties.color,"fill-opacity":.1}},this._circleLayerId),this._map.addLayer({id:"rectangle_line",type:"line",source:"rectangle",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":e.properties.color,"line-opacity":.7,"line-width":3}}))}},{key:"_hideGeohashSquare",value:function(){this._map.getLayer("rectangle_fill")&&this._map.removeLayer("rectangle_fill"),this._map.getLayer("rectangle_line")&&this._map.removeLayer("rectangle_line"),this._map.getSource("rectangle")&&this._map.removeSource("rectangle")}},{key:"_showRawPolygon",value:function(e){var t=V.get(e,"properties.__cf_cluster_polygon_feature__");if(t){t=JSON.parse(t);var i=this._map.getSource("polygon");i?i.setData(t):(this._map.addSource("polygon",{type:"geojson",data:t}),this._map.addLayer({id:"polygon_fill",type:"fill",source:"polygon",paint:{"fill-color":"#3388ff","fill-opacity":.2}},this._circleLayerId),this._map.addLayer({id:"polygon_line",type:"line",source:"polygon",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3388ff","line-opacity":1,"line-width":3}},this._circleLayerId))}}},{key:"_hideRawPolygon",value:function(){this._map.getLayer("polygon_fill")&&this._map.removeLayer("polygon_fill"),this._map.getLayer("polygon_line")&&this._map.removeLayer("polygon_line"),this._map.getSource("polygon")&&this._map.removeSource("polygon")}},{key:"_isDrawingModeInProcess",value:function(){return this._mapVisualization._drawShapeControl&&"simple_select"!==this._mapVisualization._drawShapeControl.getMode()}},{key:"_skipMouseEvents",value:function(){return V.isEmpty(this)||this._isDrawingModeInProcess()}},{key:"_skipMouseEventsAndClick",value:function(){return V.isEmpty(this)||this._isDrawingModeInProcess()||!this._useClickEvent}},{key:"_handleMouseMove",value:function(e){if(!this._skipMouseEvents()){this._map.getCanvas().style.cursor="pointer";var t=(this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds})||[])[0];t&&this._circleLayerId===t.layer.id?"geohash"===t.properties.__cf_type__?this._showGeohashSquare(t):this._showRawPolygon(t):(this._hideGeohashSquare(),this._hideRawPolygon())}}},{key:"_handleMouseLeave",value:function(e){if(!this._skipMouseEvents()){this._map.getCanvas().style.cursor="";var t=(this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds})||[])[0];t&&this._circleLayerId===t.layer.id||(this._hideGeohashSquare(),this._hideRawPolygon())}}},{key:"_spiderifyMarkers",value:function(e){this._unspiderifyMarkers(),this._map.getSource(this._spiderifyId)||(this._map.addSource(this._spiderifyId,{type:"geojson",data:e}),this._map.addLayer({id:this._spiderifyId,type:"symbol",source:this._spiderifyId,layout:{"icon-image":this._markerLayerId,"icon-overlap":"cooperative"},paint:{"icon-color":this._markerColor}}),this._mapVisualization._storeTooltipLayerId(this._spiderifyId))}},{key:"_unspiderifyMarkers",value:function(){var e=this;this._map.getLayer(this._spiderifyId)&&this._map.removeLayer(this._spiderifyId),this._map.getSource(this._spiderifyId)&&this._map.removeSource(this._spiderifyId),V.remove(this._mapVisualization._tooltipLayerIds,function(t){return t===e._spiderifyId})}},{key:"_removeClickedFeatureState",value:function(){this._map.getSource(this._sourceId)&&this._clickedFeatureId&&this._map.removeFeatureState({source:this._sourceId,id:this._clickedFeatureId},"clicked"),delete this._clickedFeatureId}},{key:"_handleMouseClick",value:function(e){if(!this._skipMouseEventsAndClick()){this._removeClickedFeatureState();var t=(this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds})||[])[0];if(t&&this._circleLayerId===t.layer.id){var i=t.geometry,r=t.id,n=i.coordinates,o=this._map.getZoom();if("geohash"===t.properties.__cf_type__){this._hideGeohashSquare();var a=this._properties.geoHashMarkerClickEvent;if(this._precisionLevels){var s=this._precisionLevels.raw.zoom,l=this._precisionLevels.levels,c=l[l.length-1].zoom,u=l.filter(function(e){return e.zoom>o})[0],p=o>=c?s:u?u.zoom:o;this._map.flyTo({center:n,zoom:p})}"function"==typeof a&&a({name:"geohash-marker-click",data:{currentZoom:o,lon:n[0],lat:n[1],point:e.lngLat}})}else{if(t.properties.__cf_has_child_clusters__){var d=JSON.parse(t.properties.__cf_cluster_leaves_bounds__);this._map.fitBounds(d,{linear:!0})}else{var f=t.properties.__cf_cluster_leaves_features__;if(f)if((f=JSON.parse(f)).length<this._maxSpiderifyMarkers){var _={type:"FeatureCollection",features:f};this._spiderifyMarkers(_),this._map.setFeatureState({source:this._sourceId,id:r},{clicked:!0}),this._clickedFeatureId=r}else{var m=f.map(function(e){return{_data:e.properties.__cf_data__}});this._unspiderifyMarkers(),h(e.originalEvent,m,this._fields,this._showLocation,this._precisionLevels,this._mapVisualization)}}}}else t&&t.layer.id===this._spiderifyId||this._unspiderifyMarkers()}}},{key:"_handleMapMouseClick",value:function(e){this._skipMouseEventsAndClick()||((this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds})||[])[0]||(this._removeClickedFeatureState(),this._unspiderifyMarkers()))}},{key:"_showMarkerTooltip",value:function(e,t,i,r){var n=this;t&&t.remove();var o=V.get(this._config,"properties.customTooltip"),a=void 0;if(o&&"function"==typeof o)a=o(e,r);else{if(a='<div style="padding: 5px;">',this._showLocation){var s=e.find(function(e){return e.name===n._latField||"latitude"===e.name}),l=e.find(function(e){return e.name===n._lngField||"longitude"===e.name}),c=parseFloat(l.value),u=parseFloat(s.value);a+='<span style="white-space: nowrap;display: table;"><b>Position:</b> '+[c,u].join(", ")+"</span>"}this._fields&&e.forEach(function(e){if(![n._location,n._latField,n._lngField,"longitude","latitude"].includes(e.name)){var t=e.label||e._label,i="Metric"===e.is?e.hideFunction?t:t+" ("+e.func+")":t;a+='<span style="white-space: nowrap;display: table;">\n                        <b>'+i+":</b> "+R.formatMetricValue(e.value,e)+"\n                    </span>"}}),a+="</div>"}t.setHTML(a).addTo(this._map),S(i,this._popup)}},{key:"_handleMouseMoveMarker",value:function(e){if(!this._skipMouseEvents()){this._map.getCanvas().style.cursor="pointer";var t=(this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds})||[])[0];if(t&&[this._markerLayerId,this._spiderifyId].includes(t.layer.id)){var i=JSON.parse(t.properties.__cf_data__),n=this._fields.map(function(e){return r({},e,{value:i[e.name]})});i[this._latField]&&n.push({name:this._latField,value:i[this._latField]}),i[this._lngField]&&n.push({name:this._lngField,value:i[this._lngField]});var o=t.properties.marker_color,a=V.get(this._config,"properties.customTooltip"),s=!(a&&"function"==typeof a);this._popup&&this._popup.remove(),this._popup=M(this._mapVisualization,"none",o,s),this._popup.setLngLat(e.lngLat),this._showMarkerTooltip(n,this._popup,e,o),e.aktive=this._aktive,e.data=n,this._mapVisualization._onChartMouseMove(e)}else this._popup&&this._popup.remove()}}},{key:"_handleMouseLeaveMarker",value:function(e){if(!this._skipMouseEvents()){this._map.getCanvas().style.cursor="";var t=(this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds})||[])[0];t&&[this._markerLayerId,this._spiderifyId].includes(t.layer.id)||(this._popup&&(this._popup.remove(),delete this._popup),e.aktive=this._aktive,e.data={lngLat:e.lngLat},this._mapVisualization._onChartMouseLeave(e))}}},{key:"_handleMouseClickMarker",value:function(e){if(!this._skipMouseEvents()){var t=(this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds})||[])[0];t&&[this._markerLayerId,this._spiderifyId].includes(t.layer.id)&&(e.aktive=this._aktive,e.data=JSON.parse(t.properties.__cf_data__),this._mapVisualization._onChartClick(e)),this._unspiderifyMarkers()}}},{key:"_removeEventListeners",value:function(){this._map.off("mousemove",this._circleLayerId,this._handleMouseMove),this._map.off("mouseleave",this._circleLayerId,this._handleMouseLeave),this._map.off("click",this._circleLayerId,this._handleMouseClick),this._map.off("click",this._handleMapMouseClick),this._map.off("mousemove",this._markerLayerId,this._handleMouseMoveMarker),this._map.off("mousemove",this._spiderifyId,this._handleMouseMoveMarker),this._map.off("mouseleave",this._markerLayerId,this._handleMouseLeaveMarker),this._map.off("mouseleave",this._spiderifyId,this._handleMouseLeaveMarker),this._map.off("click",this._markerLayerId,this._handleMouseClickMarker),this._map.off("click",this._spiderifyId,this._handleMouseClickMarker),this._map.checkAndRemoveLayerDelegatedListeners("mousemove",this._circleLayerId),this._map.checkAndRemoveLayerDelegatedListeners("mouseleave",this._circleLayerId),this._map.checkAndRemoveLayerDelegatedListeners("click",this._circleLayerId),this._map.checkAndRemoveLayerDelegatedListeners("mousemove",this._markerLayerId),this._map.checkAndRemoveLayerDelegatedListeners("mousemove",this._spiderifyId),this._map.checkAndRemoveLayerDelegatedListeners("mouseleave",this._markerLayerId),this._map.checkAndRemoveLayerDelegatedListeners("mouseleave",this._spiderifyId),this._map.checkAndRemoveLayerDelegatedListeners("click",this._markerLayerId),this._map.checkAndRemoveLayerDelegatedListeners("click",this._spiderifyId)}},{key:"_addEventListeners",value:function(){this._removeEventListeners(),this._map.on("mousemove",this._circleLayerId,this._handleMouseMove),this._map.on("mouseleave",this._circleLayerId,this._handleMouseLeave),this._map.on("click",this._circleLayerId,this._handleMouseClick),this._map.on("click",this._handleMapMouseClick),this._disableMarkerEvents||(this._map.on("mousemove",this._markerLayerId,this._handleMouseMoveMarker),this._map.on("mousemove",this._spiderifyId,this._handleMouseMoveMarker),this._map.on("mouseleave",this._markerLayerId,this._handleMouseLeaveMarker),this._map.on("mouseleave",this._spiderifyId,this._handleMouseLeaveMarker),this._allowClickInRawMarker&&(this._map.on("click",this._markerLayerId,this._handleMouseClickMarker),this._map.on("click",this._spiderifyId,this._handleMouseClickMarker)))}},{key:"fields",value:function(e){return this._fields=e,this}},{key:"metrics",value:function(e){return this._metrics=e,this}},{key:"isHeatMapLayerRawMarker",value:function(){return this._isHeatMapLayerRawMarker=!0,this}},{key:"data",value:function(e){return this._data=d(e),this._isCustomData=!0,this}},{key:"addToMap",value:function(){var e=this;return new Promise(function(){var t=o(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e._isCustomData){t.next=8;break}return t.next=4,e._processData();case 4:e._addEventListeners(),i(e),t.next=10;break;case 8:e._configureAktive(),_(e._config,e._map.getZoom())?e._aktive.execute().then(function(){e._addEventListeners(),i(e)}).catch(function(e){return r(e)}):(e._addEventListeners(),i(e));case 10:t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),r(t.t0);case 15:case"end":return t.stop()}},t,e,[[0,12]])}));return function(e,i){return t.apply(this,arguments)}}())}},{key:"remove",value:function(){var e=this;return new Promise(function(){var t=o(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{e._removeEventListeners(),e._removeLayer(),e._removeSource(),delete e._mapVisualization._renderedLayers[e._config.name],V.each(V.keys(e),function(t){return delete e[t]}),i(!0)}catch(e){r(e)}case 1:case"end":return t.stop()}},t,e)}));return function(e,i){return t.apply(this,arguments)}}())}}]),e}()}).call(t,i(1))},function(e,t,i){(t=i(8)(!1)).push([e.i,'.custom-pin:after,\n.user-pin:after,\n.fixed-pin:after {\n  content: "";\n  width: 14px;\n  height: 14px;\n  margin: -34px 0 0 -6px;\n  background: white;\n  position: absolute;\n  border-radius: 50%;\n}\n\n.fixed-marker-tooltip {\n  padding: 5px;\n}\n\n.geo-no-data-span {\n  position: absolute;\n  top: calc(50% - 10px);\n  left: calc(50% - 25px);\n  font-size: 14px;\n  color: #696363;\n  background: white;\n  opacity: 0.7;\n  border: 0.5px solid #aaa;\n  padding: 0px 10px;\n  font-weight: bold;\n  text-transform: uppercase;\n  z-index: 1000;\n}\n\n/*========  MARKER STYES ========== */\n.marker_container {\n  position: relative;\n}\n\n.custom-pin,\n.user-pin,\n.fixed-pin {\n  width: 30px;\n  height: 30px;\n  border-radius: 50% 50% 50% 0;\n  background: #89849b;\n  position: absolute;\n  transform: rotate(-45deg);\n  left: 50%;\n  top: 50%;\n  margin: 0px 0 0 -20px;\n}\n\n.geohash-pin {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-left: -20px;\n  margin-top: 4px;\n  width: 28px;\n  height: 28px;\n  border-radius: 50%;\n  border: 4px solid #dbe1f18c;\n  transform: rotate(-45deg);\n  animation-name: fadein;\n  animation-fill-mode: both;\n  animation-duration: 0.3s;\n  -webkit-box-sizing: unset !important;\n  box-sizing: unset !important;\n}\n\n.custom-geohash-pin,\n.custom-cluster-pin {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin-left: -20px;\n  margin-top: 2px;\n  width: 28px;\n  height: 28px;\n  border-radius: 50%;\n  background: #54acdfc7;\n  border: 4px solid #dbe1f18c;\n  transform: rotate(-45deg);\n  animation-name: fadein;\n  animation-fill-mode: both;\n  animation-duration: 0.3s;\n  -webkit-box-sizing: unset !important;\n  box-sizing: unset !important;\n}\n\n.custom-cluster-pin {\n  margin-left: -10px;\n  margin-top: -10px;\n}\n\n.custom-pin {\n  animation-name: unset;\n  animation-fill-mode: unset;\n  animation-duration: unset;\n}\n\n.custom-pin:after,\n.user-pin:after,\n.fixed-pin:after {\n  content: "";\n  width: 14px;\n  transform: rotate(45deg);\n  height: 14px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  margin: 8px 0 0 8px;\n  background: white;\n  position: absolute;\n  border-radius: 50%;\n}\n.pin_value {\n  position: absolute;\n  transform: rotate(45deg);\n  width: 100%;\n  font-size: 12px;\n  font-weight: 500;\n  height: 100%;\n  z-index: 10;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.pin-shadow {\n  background: rgba(0, 0, 0, 0.2);\n  border-radius: 50%;\n  height: 14px;\n  width: 14px;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  margin: 11px 0px 0px -12px;\n  transform: rotateX(55deg);\n  z-index: -2;\n}\n.pin-shadow :after {\n  content: "";\n  border-radius: 50%;\n  height: 40px;\n  width: 40px;\n  position: absolute;\n  margin: -13px 0 0 -13px;\n  animation: pulsate 1s ease-out;\n  animation-iteration-count: infinite;\n  opacity: 0;\n  animation-delay: 1.1s;\n}\n\n.cluster-scrollable-table {\n  position: absolute;\n  width: 700px;\n  background: white;\n  height: 250px;\n  z-index: 10001;\n  box-shadow: 0px 25px 50px rgba(0, 0, 0, 0.2);\n}\n\n.cluster-scrollable-table div::-webkit-scrollbar,\n.cluster-scrollable-table::-webkit-scrollbar-thumb {\n  -webkit-appearance: none;\n  width: 8px;\n  height: 8px;\n}\n.cluster-scrollabel-table div.ag-body-horizontal-scroll {\n  height: 8px !important;\n  min-height: 8px !important ;\n  max-height: 8px !important ;\n}\n\n.cluster-scrollable-table div::-webkit-scrollbar-thumb,\n.cluster-scrollable-table::-webkit-scrollbar-thumb {\n  border-radius: 4px;\n  background-color: rgba(0, 0, 0, 0.5);\n  box-shadow: 0 0 1px rgba(255, 255, 255, 0.5);\n}\n\n/* This is what we are focused on */\n.cluster-table-wrapper {\n  overflow-y: scroll;\n  width: 100%;\n  border: 1px solid #bbb;\n  height: 100%;\n}\n\n.cluster-table-wrapper table {\n  border-collapse: collapse;\n  table-layout: auto;\n  font-size: 12px;\n  color: #393838;\n}\n\n.cluster-table-wrapper th {\n  position: sticky;\n  background: #dfdede;\n  padding: 5px;\n  width: 100%;\n  color: #5a5959;\n  top: -1;\n  border: 0.5px solid #ccc;\n}\n\n.cluster-table-wrapper td {\n  white-space: nowrap;\n  padding: 5px;\n  border-bottom: 0.5px solid #ccc;\n}\n\n.cluster-table-wrapper td:last-child {\n  width: 100%;\n}\n\n@-webkit-keyframes fadein {\n  0% {\n    opacity: 0;\n  }\n  60% {\n    opacity: 0.4;\n  }\n  80% {\n    opacity: 0.8;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n\n/*======== START GEOHASH ICON MARKER STYES ========== */\n.marker_container-image {\n  display: table;\n  position: absolute;\n  margin-left: -18px;\n}\n.geohash-pin-image {\n  position: relative;\n  float: right;\n  margin-left: 20px;\n  margin-top: -10px;\n  border-radius: 50%;\n  border: 4px solid #dbe1f18c;\n  transform: rotate(-45deg);\n  animation-name: fadein;\n  animation-fill-mode: both;\n  animation-duration: 0.3s;\n  width: 25px;\n  height: 25px;\n}\n\n.custom-geohash-pin-image {\n  position: relative;\n  float: right;\n  margin-left: 20px;\n  margin-top: -10px;\n  border-radius: 50%;\n  background: #54acdfc7;\n  border: 4px solid #dbe1f18c;\n  transform: rotate(-45deg);\n  animation-name: fadein;\n  animation-fill-mode: both;\n  animation-duration: 0.3s;\n  width: 25px;\n  height: 25px;\n}\n\n.pin_value-image {\n  position: absolute;\n  transform: rotate(45deg);\n  width: 100%;\n  font-weight: 500;\n  height: 100%;\n  z-index: 10;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 12px;\n}\n\n.icon-image {\n  display: table;\n  justify-content: center;\n  align-items: center;\n  margin: 0px;\n  transform: rotate(0deg);\n  animation-name: fadein;\n  animation-fill-mode: both;\n  animation-duration: 0.3s;\n\n  border-radius: 50%;\n  border-color: lightgray;\n  border-width: 1px;\n  border-style: solid;\n  padding: 3px;\n  width: 34px;\n  height: 34px;\n}\n/*======== END GEOHASH ICON MARKER STYES ========== */\n\n/*======== START ZOOMCONTROL VERTICAL POSITIONS V2========== */\n.leaflet-verticalcenter {\n  /* Same as .leaflet-top and .leaflet-bottom */\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n  /********************************************/\n  top: 50%;\n  transform: translateY(-50%);\n  padding-top: 10px;\n}\n\n.leaflet-verticalcenter .leaflet-control {\n  margin-bottom: 10px;\n}\n/*======== END ZOOMCONTROL VERTICAL POSITIONS V2========== */\n\n/*======== START ZOOMCONTROL VERTICAL POSITIONS GL========== */\n.mapboxgl-ctrl-vertical-center-left, .maplibregl-ctrl-vertical-center-left {\n  bottom: 50%;\n  left: 0;\n  pointer-events: none;\n  position: absolute;\n  z-index: 2;\n  margin-left: 12px;\n}\n\n.mapboxgl-ctrl-vertical-center-left .mapboxgl-ctrl, .maplibregl-ctrl-vertical-center-left .maplibregl-ctrl {\n  float: left;\n  margin: 10px 0 0 10px;\n}\n\n.mapboxgl-ctrl-vertical-center-right, .maplibregl-ctrl-vertical-center-right {\n  bottom: 50%;\n  right: 0;\n  pointer-events: none;\n  position: absolute;\n  z-index: 2;\n  margin-right: 12px;\n}\n\n.mapboxgl-ctrl-vertical-center-right .mapboxgl-ctrl, .maplibregl-ctrl-vertical-center-right .maplibregl-ctrl {\n  float: right;\n  margin: 10px 10px 0 0;\n}\n/*======== END ZOOMCONTROL VERTICAL POSITIONS GL========== */\n\n/*Heatmap Canvas Overlay  Properties*/\ndiv.leaflet-zoom-hide {\n  z-index: 200 !important;\n  pointer-events: none;\n}\n/*This style allows to show miltuple heat layers in one map*/\n.cf-heatmap-layer-div {\n  position: absolute !important;\n}\n\n.leaflet-container .cft-categorical-legend.adt-legend {\n  border-radius: 3px;\n  box-shadow: 1px 1px 7px -2px rgba(0,0,0,0.68);\n}\n\n.maplibregl-map.mapboxgl-map .cft-categorical-legend.adt-legend {\n  border-radius: 3px;\n  box-shadow: 1px 1px 7px -2px rgba(0,0,0,0.68);\n}\n\n/*Map State Viewer Control styles*/\n#zoom-center-info-control {\n  justify-content: center;\n  pointer-events: none;\n}\n\n.zoom-center-info,\n.zoom-center-info small {\n  font-weight: 400;\n  font-size: 12px;\n  line-height: 1rem;\n  color: rgba(0,0,0,.75);\n}\n\n.zoom-center-info small > strong {\n  font-weight: bold;\n}\n\n.cf-3d-model-label {\n  color: white;\n  text-shadow: -1px 0px 0px black, 1px 0px 0px black, 0px -1px 0px black, 0px 1px 0px black;\n  font-size: 13px;\n  font-weight: bold;\n}\n\n.maplibregl-popup {\n  z-index: 10000;\n}\n',""]),e.exports=t},function(e,t,i){"use strict";var r=i(18),n=i(56).lc;e.exports.list=function(){return n(),["Geo Map GL"]},e.exports.build=function(e,t,i){switch(e){case"Geo Map GL":return new r(t,i);default:return null}}},function(e,t,i){"use strict";(function(t){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),o=function e(t,i,r){null===t&&(t=Function.prototype);var n=Object.getOwnPropertyDescriptor(t,i);if(void 0===n){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,i,r)}if("value"in n)return n.value;var a=n.get;return void 0!==a?a.call(r):void 0};function a(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function s(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function r(n,o){try{var a=t[n](o),s=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}var l=i(0),c=l.LAYER_TYPES,u=l.CLUSTER_TOOLTIP_TABLE,p=l.getToolkit,d=l.isRawData,h=l.isGeoHashData,f=l.isAggregatedData,_=l.getGeoHashPrecisionByZoomLevel,m=l.validCoords,g=l.renderLegend,y=l.getLayerVisibility,v=l.isLayerVisible,A=l.storeLayerAktive,b=l.changeMapBoundariesFilter,w=l.changeGeoHashPrecisionLevel,C=l.processGeohashData,L=l.exportCsv,x=l.getAktiveAql,k=i(2),I=k.DECIMAL_DEGREES_PRECISION,E=k.ZOOM_PRECISION,M=k.checkMapLibreLibraries,S=k.getDefaultMapStyle,P=k.getDefaultPopupCss,F=k.buildOpacityExpression,D=i(3).renderLayersControl,B=i(4).renderDrawControl,z=i(11).error,T=p(),O=T.getDependency("utils"),R=O.getEnvironment(),N="browser"===R?window:t,V=T.getDependency("jquery"),G=T.getDependency("lodash"),j=T.getDependency("base-visualization"),Q=i(33),H=i(34),U=i(35),Y=i(36),Z=i(42),W=i(43),J=i(15),q=i(44),K=i(45);i(46);var X=i(49),$=i(50).default,ee=i(51),te=ee.DrawCircle,ie=ee.DRAW_CIRCLE_RADIUS_LABEL_STYLE,re=i(14).DRAW_FILTER_SHAPES,ne=i(55).default;e.exports=function(e){function t(e,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i));return r._firstLoad=!0,r._mapElement="map"+r._element,r._runningAktives={},r._renderedLayers={},r._tilesHeaders=new Map,r._tooltipLayerIds=[],r._popupsCreated=[],r._custom3dLayers=[],r.tooltip3D=!1,r._mapZoomHandler=r._mapZoomHandler.bind(r),r._mapMoveHandler=r._mapMoveHandler.bind(r),r._mapMoveHandlerDebounce=G.debounce(function(e){return r._mapMoveHandler(e)},250),r._mapPitchHandler=r._mapPitchHandler.bind(r),r._mapRotateHandler=r._mapRotateHandler.bind(r),r._onChartClick=r._onChartClick.bind(r),r._onChartMouseLeave=r._onChartMouseLeave.bind(r),r._onChartMouseMove=r._onChartMouseMove.bind(r),r._getMapBounds=r._getMapBounds.bind(r),r._setAktiveLastQueriedBounds=r._setAktiveLastQueriedBounds.bind(r),r._handleMouseLeave=r._handleMouseLeave.bind(r),r._mapZoomStartHandler=r._mapZoomStartHandler.bind(r),r._mapMoveStartHandler=r._mapMoveStartHandler.bind(r),r._endDrawFilter=r._endDrawFilter.bind(r),r._removeCustom3dLayers=r._removeCustom3dLayers.bind(r),r._init(),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,j),n(t,[{key:"renderLegend",value:function(){g(this)}},{key:"_init",value:function(){"browser"===R&&(V("#"+this._element).append(V("<div id='"+this._mapElement+"' style='width:100%; height:100%;'></div>")),window.cf_tables&&(this._AgGrid=window.cf_tables.getAgGrid(),O.cssUtil.load("table-grid",this._AgGrid.styles)),O.cssUtil.load("cf-maplibre-gl--default-poppup",P()))}},{key:"_onChartClick",value:function(e){e.data&&this.dispatch({name:"click",chart:G.get(e,"aktive._elementId",this._element),data:e.data,nativeData:e})}},{key:"_onChartMouseMove",value:function(e){e.data&&(T.tooltip.set(),this.dispatch({name:"mousemove",chart:G.get(e,"aktive._elementId",this._element),data:e.data,nativeData:e,position:{x:e.pageX,y:e.pageY}}))}},{key:"_onChartMouseLeave",value:function(e){e.data&&this.dispatch({name:"mouseleave",chart:G.get(e,"aktive._elementId",this._element),data:e.data,nativeData:e})}},{key:"_removeAllPopups",value:function(){for(var e=0;e<this._popupsCreated.length;e++){var t=this._popupsCreated[e];try{t.remove()}catch(e){}}this._popupsCreated=[]}},{key:"resize",value:function(){var e=this._definition.legend;this._width=V("#"+this._element).width(),this._height=V("#"+this._element).height(),e&&(this._width=this._width-e._width,this._width<0&&(this._width=0)),this._map&&this._map.invalidateSize()}},{key:"remove",value:function(){this._map&&this._map.remove(),V(".cf-3d-model-label-container."+this._element).remove()}},{key:"exportCsv",value:function(e){L(e,this)}},{key:"processData",value:function(){var e=s(regeneratorRuntime.mark(function e(i,r){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"processData",this).call(this,i,r),V("#"+this._mapElement).find(".geo-no-data-span").remove(),x(this._aktive)._data=i,this._updateDefinitionWithUtilities(),e.next=7,this._renderMap();case 7:case"end":return e.stop()}},e,this)}));return function(t,i){return e.apply(this,arguments)}}()},{key:"_updateDefinitionWithUtilities",value:function(){this._definition.addLayer=this.addLayer.bind(this),this._definition.updateLayer=this.updateLayer.bind(this),this._definition.removeLayer=this.removeLayer.bind(this),this._definition.getDefinedLayer=this.getDefinedLayer.bind(this),this._definition.getAllDefinedLayers=this.getAllDefinedLayers.bind(this),this._definition.getRenderedLayer=this.getRenderedLayer.bind(this),this._definition.getAllRenderedLayers=this.getAllRenderedLayers.bind(this),this._definition.isLayerDefined=this.isLayerDefined.bind(this),this._definition.getHighestLayerPriority=this.getHighestLayerPriority.bind(this),this._definition.getLayerPriority=this.getLayerPriority.bind(this),this._definition.isAggregatedData=function(e){return f(e)},this._definition.isGeoHashData=function(e){return h(e)},this._definition.isRawData=function(e){return d(e)},this._definition.changeMapBoundariesFilter=this._changeMapBoundariesFilter.bind(this),this._definition.changeGeoHashPrecisionLevel=this._changeGeoHashPrecisionLevel.bind(this),this._definition.getGeoHashPrecisionByZoomLevel=_,this._definition.getOpacityByZoomLevel=this.getOpacityByZoomLevel.bind(this),this._definition.isLayerVisible=this.isLayerVisible.bind(this),this._definition.validCoords=m,this._definition.reorganizeLayers=this._reorganizeLayers.bind(this),this._definition.processGeohashData=this.processGeohashData.bind(this),this._definition.getNavigationControl=this.getNavigationControl.bind(this),this._definition.getZoomCenterInfoControl=this.getZoomCenterInfoControl.bind(this),this._definition.getFullScreenControl=this.getFullScreenControl.bind(this),this._definition.getDrawShapeControl=this.getDrawShapeControl.bind(this)}},{key:"_renderMap",value:function(){var e=this;return new Promise(function(){var t=s(regeneratorRuntime.mark(function t(i,r){var n,o,l,c,u,p;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,e._width=V("#"+e._element).width(),e._height=V("#"+e._element).height(),e._definition.zoom||(e._definition.zoom=-.12348307389299135),e._definition.center||(e._definition.center=[-12.205643247916555,43.17470268118143]),e._definition.maxZoom||(e._definition.maxZoom=24),e._definition.minZoom||(e._definition.minZoom=0),e._definition.layers||(e._definition.layers=[]),e._validateLayers(e._definition.layers),e._validateShapesFitBounds(),e._map){t.next=17;break}return t.next=13,M();case 13:e._createMapLibreInstance(),e._map.once("load",s(regeneratorRuntime.mark(function t(){var n,o,s,l,c,u,p;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,n=[].concat(a(G.get(e._definition,"layers",[]))),!(e._firstLoad&&n.length>0)){t.next=32;break}delete e._definition._childVisualizations,n.sort(function(e,t){return e.priority-t.priority}),o=!0,s=!1,l=void 0,t.prev=8,c=n[Symbol.iterator]();case 10:if(o=(u=c.next()).done){t.next=17;break}return p=u.value,t.next=14,e.addLayer(p);case 14:o=!0,t.next=10;break;case 17:t.next=23;break;case 19:t.prev=19,t.t0=t.catch(8),s=!0,l=t.t0;case 23:t.prev=23,t.prev=24,!o&&c.return&&c.return();case 26:if(t.prev=26,!s){t.next=29;break}throw l;case 29:return t.finish(26);case 30:return t.finish(23);case 31:e._firstLoad=!1;case 32:i(!0),t.next=38;break;case 35:t.prev=35,t.t1=t.catch(0),r(t.t1);case 38:case"end":return t.stop()}},t,e,[[0,35],[8,19,23,31],[24,,26,30]])}))),t.next=34;break;case 17:e._renderNavigationControl(),e._renderZoomCenterInfoControl(),e._renderFullScreenControl(),e._renderDrawShapeControl(),n=e._definition.zoom,o=e._definition.center,l=e._definition.bearing,c=e._definition.pitch,u=e._definition.minZoom,p=e._definition.maxZoom,G.isNumber(n)&&n!==e._map.getZoom()&&e._map.setZoom(n),G.isArray(o)&&o!==e._map.getCenter()&&e._map.setCenter(o),G.isNumber(l)&&l!==e._map.getBearing()&&e._map.setBearing(l),G.isNumber(c)&&c!==e._map.getPitch()&&e._map.setPitch(c),G.isNumber(u)&&u!==e._map.getMinZoom()&&e._map.setMinZoom(u),G.isNumber(p)&&p!==e._map.getMaxZoom()&&e._map.setMaxZoom(p),i(!0);case 34:t.next=39;break;case 36:t.prev=36,t.t0=t.catch(0),r(t.t0);case 39:case"end":return t.stop()}},t,e,[[0,36]])}));return function(e,i){return t.apply(this,arguments)}}())}},{key:"_reorganizeLayers",value:function(){var e=this,t=(this._definition.layers||[]).filter(function(e){return c.includes(e.type)}).sort(function(e,t){return t.priority-e.priority});t.reverse();var i=t.map(function(t){var i=e.getRenderedLayer(t.name);if(i){if(["shape","shape-only"].includes(t.type)){var r=i._layerIds,n=[];return G.each(r,function(e){if(G.isArray(e))for(var t=0;t<e.length;t++)n.push(e[t])}),n}if("marker"===t.type){var o=i;return[o._circleLayerId,o._symbolLayerId,o._markerLayerId]}if("heatmap"===t.type){var a=i;if(!a)return;return a._isHeatMapLayerRawMarker?[a._circleLayerId,a._symbolLayerId,a._markerLayerId]:[a._layerId]}return i._layerId}}),r=["mapbox-gl-draw-hot","mapbox-gl-draw-cold"],n=this._map.getStyle().layers.filter(function(e){return r.includes(e.source)}).map(function(e){return e.id}),o=this._custom3dLayers.map(function(e){return e.id});this._map.reorganizeLayers([].concat(a(G.flattenDeep(i).filter(function(e){return e})),a(o),a(n)))}},{key:"_includeReorganizeFunction",value:function(){N.maplibregl.Style.prototype.reorganizeLayers=function(e){this._order.sort(function(t,i){return e.indexOf(t)-e.indexOf(i)}),this._layerOrderChanged=!0},N.maplibregl.Map.prototype.reorganizeLayers=function(e){return this.style.reorganizeLayers(e),this._update(!0)}}},{key:"_includeGetSizeFunction",value:function(){N.maplibregl.Map.prototype.getSize=function(){return new N.maplibregl.Point(this._container.clientWidth||0,this._container.clientHeight||0)}}},{key:"_includeInvalidateSizeFunction",value:function(){N.maplibregl.Map.prototype.invalidateSize=function(e){if(!this._loaded)return this;e=G.extend({pan:!0},e),this._lastCenter=null;var t=this._lastSize.clone(),i=this.getSize(),r=t.div(2).round(),n=i.div(2).round(),o=r.sub(n);return this._lastSize=i,o.x||o.y?(e.pan&&this.panBy(o),this.fire("move"),e.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(this.fire.bind(this,"moveend"),200)):this.fire("moveend"),this.resize(),this.fire("resize",{size:[i.x,i.y]})):this}}},{key:"_includeCheckAndRemoveLayerDelegatedListeners",value:function(){N.maplibregl.Map.prototype.checkAndRemoveLayerDelegatedListeners=function(e,t){if(this._delegatedListeners&&this._delegatedListeners[e])for(var i=this._delegatedListeners[e],r=0;r<i.length;r++){var n=i[r];if(n.layer===t){for(var o in n.delegates)this.off(o,n.delegates[o]);return i.splice(r,1),this}}return this}}},{key:"_registerCustomControlPositions",value:function(){if(!this._map._controlPositions["vertical-center-left"]||!this._map._controlPositions["vertical-center-right"]){var e=document.createElement("div"),t=document.createElement("div");e.className="mapboxgl-ctrl-vertical-center-left maplibregl-ctrl-vertical-center-left",t.className="mapboxgl-ctrl-vertical-center-right maplibregl-ctrl-vertical-center-right",this._map._controlContainer.appendChild(e),this._map._controlContainer.appendChild(t),this._map._controlPositions["vertical-center-left"]=e,this._map._controlPositions["vertical-center-right"]=t}}},{key:"_translatePosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top-left";return"topleft"===(e=e.toString().replace(/-/g,""))?"top-left":"topright"===e?"top-right":"bottomleft"===e?"bottom-left":"bottomright"===e?"bottom-right":"verticalcenterleft"===e?"vertical-center-left":"verticalcenterright"===e?"vertical-center-right":t}},{key:"_renderNavigationControl",value:function(){this._navigationControl&&this._map.hasControl(this._navigationControl)&&this._map.removeControl(this._navigationControl);var e=G.get(this._definition,"enableZoom",{position:"top-left",showCompass:!0,showZoom:!0,visualizePitch:!1});if(e){"object"!==(void 0===e?"undefined":r(e))&&(e={position:"top-left",showCompass:!0,showZoom:!0,visualizePitch:!1}),this._navigationControl=new N.maplibregl.NavigationControl(e),e.showCompass?(this._map.dragRotate.enable(),this._map.touchZoomRotate.enableRotation()):(this._map.dragRotate.disable(),this._map.touchZoomRotate.disableRotation());var t=G.get(e,"position","top-left");this._map.addControl(this._navigationControl,this._translatePosition(t))}}},{key:"_renderZoomCenterInfoControl",value:function(){this._zoomCenterInfoControl&&this._map.hasControl(this._zoomCenterInfoControl)&&(this._map.removeControl(this._zoomCenterInfoControl),delete this._zoomCenterInfoControl);var e=G.get(this._definition,"zoomCenterInfo",{position:"bottom-right"});if(e){var t=G.get(e,"position","bottom-right");t=this._translatePosition(t,"bottom-right"),this._zoomCenterInfoControl=new K(this),this._map.addControl(this._zoomCenterInfoControl,t)}}},{key:"_renderFullScreenControl",value:function(){this._fullScreenControl&&this._map.hasControl(this._fullScreenControl)&&(this._map.removeControl(this._fullScreenControl),delete this._fullScreenControl);var e=G.get(this._definition,"fullScreen"),t=G.get(e,"position","top-right");t=this._translatePosition(t,"top-right"),this._fullScreenControl=new N.maplibregl.FullscreenControl({container:this._map.getContainer().parentElement}),this._map.addControl(this._fullScreenControl,t),e||(this._fullScreenControl._fullscreenButton.style.display="none")}},{key:"_renderDrawShapeControl",value:function(){if(this._definition.drawControl){this._drawShapeControl&&(this._map.removeControl(this._drawShapeControl),delete this._map._drawShapeControl);var e=X.modes;e.draw_rectangle=$,e.draw_circle=te,this._drawShapeControl=new X({displayControlsDefault:!1,modes:e,styles:[].concat(a(ne),[ie])}),this._map.addControl(this._drawShapeControl,"top-left");var t=G.get(this._drawControl,"registerEvents");t&&(t=t.bind(this._drawControl))()}}},{key:"_getMapState",value:function(){var e=this._map.getZoom(),t=this._map.getCenter(),i=this._map.getBounds();return{zoom:G.round(e,E),center:{lon:G.round(t.lng,I),lat:G.round(t.lat,I)},extent:{minLon:G.round(i.getWest(),I),minLat:G.round(i.getSouth(),I),maxLon:G.round(i.getEast(),I),maxLat:G.round(i.getNorth(),I)}}}},{key:"_handleMouseLeave",value:function(e){this._removeAllPopups()}},{key:"_createMapLibreInstance",value:function(){var e=this,t=this._definition.zoom,i=this._definition.center,r=this._definition.bearing,n=this._definition.pitch,o=this._definition.maxZoom,s=this._definition.minZoom,l=this._definition.style,c=G.get(this._definition,"enableZoom",!0),u=this._definition.credentials||"omit";this._map=new N.maplibregl.Map({container:this._mapElement,style:l||S(),center:i,zoom:t,pitch:n||0,bearing:r||0,minZoom:s,maxZoom:o,interactive:!!c,transformRequest:function(t,i){var r=[].concat(a(e._tilesHeaders.keys())).find(function(e){return t.includes(e)});if("Tile"===i){var n={url:t,credentials:u},o={};return(e._tilesHeaders.get(r)||[]).forEach(function(e){o[e.header]=e.value}),G.isEmpty(o)||(n.headers=o),n}return{url:t}}}),this._prevZoom=this._map.getZoom(),this._map.once("load",function(){e._map._lastSize=e._map.getSize(),e._map.on("mouseleave",e._handleMouseLeave),e._map.on("mouseout",e._handleMouseLeave)}),this._definition.map=this._map,this._includeReorganizeFunction(),this._includeGetSizeFunction(),this._includeInvalidateSizeFunction(),this._includeCheckAndRemoveLayerDelegatedListeners(),this._registerCustomControlPositions(),this._renderNavigationControl(),this._renderZoomCenterInfoControl(),this._renderFullScreenControl(),this._renderDrawShapeControl(),this._addBaseMapEvents()}},{key:"_getMapBounds",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=N.maplibregl,i=this._map.getBounds(),r=i.getNorthEast(),n=i.getSouthWest(),o=this._map.getSize(),a=o.x/2,s=o.y/2;if(e){var l=o.x/o.y;l>1?s=(a=.2*o.x)/l:a=(s=.2*o.y)*l}else a=30,s=30;var c=this._map.project([r.lng,r.lat]),u=this._map.project([n.lng,n.lat]);c.x+=a,c.y-=s,u.x-=a,u.y+=s;var p=this._map.unproject(c),d=this._map.unproject(u);return m(p.lat,p.lng)&&m(d.lat,d.lng)?new t.LngLatBounds(d,p):i}},{key:"_changeGeoHashPrecisionLevel",value:function(e,t){var i={aktive:e,zoom:t,map:this._map,setAktiveLastQueriedBounds:this._setAktiveLastQueriedBounds,getMapBounds:this._getMapBounds};w(i)}},{key:"_setAktiveLastQueriedBounds",value:function(e,t){var i=N.maplibregl;if(!e._lastQueriedBounds&&t){var r=new i.LngLat(t.topRight.lng,t.topRight.lat),n=new i.LngLat(t.bottomLeft.lng,t.bottomLeft.lat);e._lastQueriedBounds=new i.LngLatBounds(n,r)}}},{key:"_changeMapBoundariesFilter",value:function(e,t){var i={aktive:e,eventType:G.get(t,"type",""),map:this._map,setAktiveLastQueriedBounds:this._setAktiveLastQueriedBounds,getMapBounds:this._getMapBounds};b(i)}},{key:"_mapZoomHandler",value:function(e){var t=this,i=this._map.getZoom();this._aktive._options.set("zoom",i),this._definition.zoom=i,setTimeout(function(){if(t._layersAktive&&t._layersAktive.length>0){var e=!0,r=!1,n=void 0;try{for(var o,a=t._layersAktive[Symbol.iterator]();!(e=(o=a.next()).done);e=!0){var s=o.value;v(s._layer,i)?h(s)||d(s)?t._changeGeoHashPrecisionLevel(s,i):s._executed||s.execute():(s._lastQueriedBounds=new N.maplibregl.LngLatBounds(new N.maplibregl.LngLat(0,0),new N.maplibregl.LngLat(0,0)),s._lastUsedZoom=i)}}catch(e){r=!0,n=e}finally{try{!e&&a.return&&a.return()}finally{if(r)throw n}}}t._reorganizeLayers()},1);var r=this._map.getCenter();g(this),this._setInfoToViewInfoControl(r.lng,r.lat),this.dispatch({name:"mapzoom",chart:this._element,data:i,nativeData:e})}},{key:"_evaluate3DLayersVisibility",value:function(){var e=this,t=this._map.getZoom(),i=this.getAllDefinedLayers().filter(function(i){return"3d"===i.type&&!e.isLayerVisible(i,t)});if(0!==i.length){var r=i.map(function(e){return e.name});this._custom3dLayers.filter(function(e){return r.includes(e.layerName)}).map(function(e){return e.id}).forEach(function(t){e._map.getLayer(t)&&(e._map.removeLayer(t),e._custom3dLayers.splice(e._custom3dLayers.map(function(e){return e.id}).indexOf(t),1))})}}},{key:"_mapMoveHandler",value:function(e){var t=this,i=this._map.getCenter(),r=[i.lng,i.lat];this._map._lastCenter=i,this._aktive._options.set("center",r),this._definition.center=r,this._evaluate3DLayersVisibility(),setTimeout(function(){var i=t._prevZoom!==t._map.getZoom();if(t._layersAktive&&t._layersAktive.length>0){var r=t._map.getZoom(),n=!0,o=!1,a=void 0;try{for(var s,l=t._layersAktive[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var c=s.value;!v(c._layer,r)&&c._is3DLayer&&V(".cf-3d-model-label.cf-3d-label-element."+t._element.replace(/\s/g,"")).remove(),v(c._layer,r)&&(h(c)||d(c)||c._is3DLayer)&&(c._skip3DLayersRemoval=!i,t._changeMapBoundariesFilter(c,e))}}catch(e){o=!0,a=e}finally{try{!n&&l.return&&l.return()}finally{if(o)throw a}}}t._reorganizeLayers(),t._prevZoom=t._map.getZoom()},1),this.dispatch({name:"mapmove",chart:this._element,data:r,nativeData:e})}},{key:"_removeMarkersClickedFeatureState",value:function(){G.each(this._renderedLayers,function(e){e._removeClickedFeatureState&&e._removeClickedFeatureState(),e._unspiderifyMarkers&&e._unspiderifyMarkers()})}},{key:"_mapZoomStartHandler",value:function(e){var t=this._map.getZoom();this.dispatch({name:"mapzoomstart",chart:this._element,data:t,nativeData:e}),V("."+u).remove(),this._removeMarkersClickedFeatureState()}},{key:"_mapMoveStartHandler",value:function(e){V("."+u).remove(),this._removeMarkersClickedFeatureState()}},{key:"_setInfoToViewInfoControl",value:function(e,t){var i=document.getElementById(this._element+"-zoom-center-info");if(i){var r=G.round(this._map.getZoom(),E);i.innerHTML=e&&t?"\n                <small>\n                    <strong>lon:</strong> "+G.round(e,I)+",\n                    <strong>lat:</strong> "+G.round(t,I)+",\n                    <strong>zoom:</strong> "+r+"\n                </small>\n                ":"\n                <small>\n                    <strong>zoom:</strong> "+r+"\n                </small>\n                "}}},{key:"_mapPitchHandler",value:function(e){var t=this._map.getPitch();this._aktive._options.set("pitch",t),this.dispatch({name:"mappitch",chart:this._element,data:t,nativeData:e})}},{key:"_mapRotateHandler",value:function(e){var t=this._map.getBearing();this._aktive._options.set("bearing",t),this.dispatch({name:"maprotate",chart:this._element,data:t,nativeData:e})}},{key:"_endDrawFilter",value:function(e){var t=this,i=this._drawShapeControl;V("#"+this._drawControl._visualElementId+"-draw-tooltip").css("visibility","hidden");for(var r=T.getAllVisualizations().filter(function(e){return e._elementId.includes(t._drawControl._visualElementId+"-")}),n=r.sort(function(e,t){return t._layer.priority-e._layer.priority})[0],o=0;o<r.length;o++){var a=r[o],s=this._renderedLayers[a._layer.name];s&&(s._useClickEvent=!1)}var l=void 0,c=void 0;n&&!T.getVisualization(n._elementId)._isShapeLayer?(l=this._getLayerLocation(n._elementId))&&(Object.keys(e.features[0].properties).length>0?(c=re.DISTANCE.shapeName,this._roundCircleData(e)):(this._roundPolygonData(e),c=e.features[0].geometry.type.toUpperCase()),this._drawControl._drawVisualization.dispatch({name:"drawfilter",element:this._drawControl._drawVisualization._element,drawControl:i,type:c,label:this._drawControl._labelInput,path:l,data:e})):n&&this._getLayerShapes(n._elementId,e),this._map.getCanvas().style.cursor="grab",i.deleteAll(),this._drawControl.showTooltip=!1}},{key:"_roundCircleData",value:function(e){var t=G.round(e.features[0].properties.radiusKm,e.features[0].properties.radiusKm>10?0:2),i=2;t<=1?i=5:t<=10?i=4:t<=100&&(i=3),e.features[0].properties.center=[G.round(e.features[0].properties.center[0],i),G.round(e.features[0].properties.center[1],i)],e.features[0].properties.radiusKm=t}},{key:"_roundPolygonData",value:function(e){e.features[0].geometry.coordinates[0]=e.features[0].geometry.coordinates[0].map(function(e){return[G.round(e[0],5),G.round(e[1],5)]})}},{key:"_getLayerShapes",value:function(e,t){var i=this,r=T.getVisualization(e);if(r._layer){for(var n=this._map.queryRenderedFeatures(t.features[0].geometry.coordinates[0].map(function(e){var t=i._map.project(e);return[t.x,t.y]}),{layers:this._tooltipLayerIds}).filter(function(e){return e.layer.id===r._mainLayerId}),o=[],a=0;a<n.length;a++){var s=n[a].properties.name;o.push(s)}return o}}},{key:"_getLayerLocation",value:function(e){if(T.getVisualization(e)._layer)return G.get(T.getVisualization(e)._layer.properties,"location")}},{key:"_addBaseMapEvents",value:function(){var e=this;this._map.off("zoomstart",this._mapZoomStartHandler),this._map.on("zoomstart",this._mapZoomStartHandler),this._map.off("movestart",this._mapMoveStartHandler),this._map.on("movestart",this._mapMoveStartHandler),this._map.off("draw.create",this._endDrawFilter),this._map.on("draw.create",this._endDrawFilter);var t=G.throttle(function(t){var i=t.lngLat;if(!e._drawControl||e._drawControl.showTooltip){var r=e._map.project(i);V(".tooltip-popup-text").css({visibility:"hidden"}),e._drawControl&&(V("#"+e._drawControl._visualElementId+"-draw-tooltip").css({transform:"translate("+(r.x+5)+"px, "+(r.y-45)+"px)",visibility:"visible",background:"gray",color:"white",height:"auto",width:"fit-content",padding:"2px 5px","border-radius":"5px"}).text(e._drawControl.tooltipText),e._map.getCanvas().style.cursor="crosshair")}},200);this._map.off("mousemove",t).on("mousemove",t),this._map.off("zoomend",this._mapZoomHandler),this._map.on("zoomend",this._mapZoomHandler),this._map.off("moveend",this._mapMoveHandlerDebounce),this._map.on("moveend",this._mapMoveHandlerDebounce);var i=G.throttle(function(t){e._setInfoToViewInfoControl(t.lngLat.lng,t.lngLat.lat)},100);this._map.on("mousemove",i),this._map.on("mouseout",function(){i.cancel(),e._setInfoToViewInfoControl()}),this._map.off("pitchend",this._mapPitchHandler),this._map.on("pitchend",this._mapPitchHandler),this._map.off("rotateend",this._mapRotateHandler),this._map.on("rotateend",this._mapRotateHandler)}},{key:"_saveLayerDefinition",value:function(e){this.isLayerDefined(e.name)||this._definition.layers.push(e)}},{key:"_storeLayerAktive",value:function(e){A(this,e)}},{key:"_setVisibilityProperties",value:function(e,t){var i=G.get(t,"properties.visible"),r=G.get(t,"properties.visibilityZoomRange");delete e.properties.visible,!1===i&&G.set(e,"properties.visible",i),delete e.properties.visibilityZoomRange,void 0!==r&&G.set(e,"properties.visibilityZoomRange",r)}},{key:"_setVisibilityZoomRange",value:function(e,t){var i=G.get(t,"properties.visibilityZoomRange[0]"),r=G.get(t,"properties.visibilityZoomRange[1]");this._setLayerVisibility(e,i,r)}},{key:"_removeCustom3dLayers",value:function(){var e=this;this._custom3dLayers.forEach(function(t){e._map.getLayer(t.id)&&e._map.removeLayer(t.id)}),this._custom3dLayers=[],V(".cf-3d-model-label.cf-3d-label-element."+this._element.replace(/\s/g,"")).remove()}},{key:"_setLayerVisibility",value:function(e,t,i){G.isNumber(t)&&G.isNumber(i)?this._map.setLayerZoomRange(e,t,i):this._map.setLayerZoomRange(e,0,24)}},{key:"_validateShapesFitBounds",value:function(){var e=this._getShapesFitBoundsTrue(),t=e.map(function(e){return e.name}).join();e.length>1&&console.warn('Geo Map GL with element ID "'+this._element+'" is setting "fitBounds" to true for layers '+t+'. Only one layer is allowed to set "fitBounds" to true. Please fix your layer configuration.')}},{key:"getLayerPaneId",value:function(e){return e.replace(/[\.\,\;\:\'\"\s\%\(\)\[\]\{\}\|\\\/\*\+\-\=\$\@\!\#\^\&]*/g,"")}},{key:"_getShapesFitBoundsTrue",value:function(){return(this._definition.layers||[]).filter(function(e){return["shape","shape-only"].includes(e.type)&&(O.getBoolValue(G.get(e,"properties.options.fitBounds"))||G.get(e,"properties.shapes",[]).some(function(e){return O.getBoolValue(e.fitBounds)}))})}},{key:"_getDifferentCenter",value:function(){var e=G.get(this._aktive,"_options.options.zoom",this._definition.zoom),t=G.get(this._aktive,"_options.options.center",this._definition.center),i=this._map.getCenter(),r=this._map.getZoom();return i.lat!==t[0]||i.lng!==t[1]||r!==e?{zoom:e,center:t}:null}},{key:"_storeTooltipLayerId",value:function(e){this._tooltipLayerIds.includes(e)||this._tooltipLayerIds.push(e)}},{key:"_validateLayers",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e.some(function(e){return G.isEmpty(e.name)}),r=new Set(e.map(function(e){return e.name})).size!==e.length,n=e.some(function(e){return!G.isNumber(e.priority)||e.priority<=0});if(i?z("Please define a name for all layers."):r?z("The name of the layers must be unique for each one of them."):n&&z("Please define a valid priority for all layers. The priority must be an integer greater than zero."),t){var o=e?e.filter(function(e){return["marker","heatmap"].includes(e.type)}):[];G.each(o,function(e){var t=G.get(e,"properties.location"),i=G.get(e,"properties.precision"),r=G.get(e,"properties.precisionLevels"),n=G.has(r,"levels[0].zoom")&&G.has(r,"levels[0].precision")&&G.has(r,"raw.zoom")&&G.has(r,"raw.fields");r&&!n?z('Geo Map GL: The "precisionLevels" settings are not correct, please check and fix them on your map layer configuration.'):void 0!==t&&null!==t&&""!==t?r&&n&&G.isNumber(i)?console.warn('Geo Map GL: "precisionLevels" and "precision" settings are mutually exclusive. Please remove one of these settings on your map layer configuration. Disregarding the "precision" setting. It is being calculated given the map zoom and the "precisionLevels" configuration provided.'):G.isNumber(i)&&!(i<=0)||n||G.get(e,"properties.fields")||z('Geo Map GL: When specifying a location field, you must also provide the "precisionLevels" or "precision" or "fields" properties of the geo-hash query.'):G.isNumber(i)&&i>0?z('Geo Map GL: When the geo-hash query precision is specified, you also need to provide a location field by using the "location" property.'):r&&n?z('Geo Map GL: When the geo-hash query precisionLevels is specified, you also need to provide a location field by using the "location" property.'):G.get(e,"properties.rows")||z("Geo Map GL: Please specify the location information for your "+("marker"===e.type?"markers":"heatmap")+".")})}}},{key:"addLayer",value:function(){var e=s(regeneratorRuntime.mark(function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._firstLoad||!this.isLayerDefined(t.name)||this.getDefinedLayer(t.name).type!==t.type){e.next=2;break}throw new Error("Layer "+t.name+" already exists. Please remove it before re-adding it.");case 2:i||this._validateLayers([t],!0),e.t0=t.type,e.next="tile"===e.t0?6:"tile-wms"===e.t0?6:"fixed-marker"===e.t0?9:"circle"===e.t0?12:"3d"===e.t0?15:"shape"===e.t0?18:"shape-only"===e.t0?18:"heatmap"===e.t0?21:"marker"===e.t0?24:27;break;case 6:return e.next=8,this._addTileLayer(t);case 8:return e.abrupt("break",28);case 9:return e.next=11,this._addOrUpdateFixedMarkerLayer(t);case 11:return e.abrupt("break",28);case 12:return e.next=14,this._addCirclesLayer(t,i);case 14:return e.abrupt("break",28);case 15:return e.next=17,this._add3DLayer(t,i);case 17:return e.abrupt("break",28);case 18:return e.next=20,this._addShapeLayer(t,i);case 20:return e.abrupt("break",28);case 21:return e.next=23,this._addHeatMapLayer(t,i);case 23:return e.abrupt("break",28);case 24:return e.next=26,this._addMarkerLayer(t,i);case 26:case 27:return e.abrupt("break",28);case 28:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateLayer",value:function(){var e=s(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.type,e.next="tile"===e.t0?3:"tile-wms"===e.t0?3:"fixed-marker"===e.t0?6:"circle"===e.t0?9:"heatmap"===e.t0?12:"marker"===e.t0?15:"shape"===e.t0?18:"shape-only"===e.t0?18:21;break;case 3:return e.next=5,this._updateTileLayer(t);case 5:return e.abrupt("break",22);case 6:return e.next=8,this._addOrUpdateFixedMarkerLayer(t);case 8:return e.abrupt("break",22);case 9:return e.next=11,this._updateCirclesLayer(t);case 11:return e.abrupt("break",22);case 12:return e.next=14,this._updateHeatMapLayer(t);case 14:return e.abrupt("break",22);case 15:return e.next=17,this._updateMarkerLayer(t);case 17:return e.abrupt("break",22);case 18:return e.next=20,this._updateShapeLayer(t);case 20:case 21:return e.abrupt("break",22);case 22:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"removeLayer",value:function(){var e=s(regeneratorRuntime.mark(function e(t){var i,r,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!(i=this.getDefinedLayer(t))){e.next=16;break}if(r=this._renderedLayers[t],this._layersAktive=(this._layersAktive||[]).filter(function(e){return e._elementId!==i.id}),T.remove(i.id),!r){e.next=9;break}return e.next=9,r.remove();case 9:n=this._definition.layers.filter(function(e){return e.name!==t}),this._aktive._options.set("layers",n),this._definition.layers=n,g(this),D(this),B(this),this.dispatch({name:"geo:layer-removed",element:this._element,layer:i});case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(0),z(e.t0);case 21:return e.abrupt("return",!0);case 22:case"end":return e.stop()}},e,this,[[0,18]])}));return function(t){return e.apply(this,arguments)}}()},{key:"_addTileLayer",value:function(e){var t=this;return new Promise(function(){var i=s(regeneratorRuntime.mark(function i(r,n){var o;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,t._saveLayerDefinition(e),(o=t._renderedLayers[e.name])&&o.remove(),o=new H(t,e),i.next=7,o.addToMap();case 7:r(!0),i.next=13;break;case 10:i.prev=10,i.t0=i.catch(0),n(i.t0);case 13:case"end":return i.stop()}},i,t,[[0,10]])}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"_updateTileLayer",value:function(e){var t=this;return new Promise(function(){var i=s(regeneratorRuntime.mark(function i(r,n){var o,a,s,l,c;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,(o=t.getDefinedLayer(e.name))||r(!0),a=t._renderedLayers[e.name],s=G.get(o,"properties.source"),l=G.get(e,"properties.source"),G.isEqual(s,l)){i.next=11;break}return G.set(o,"properties.source",l),i.next=10,t._addTileLayer(o);case 10:r(!0);case 11:G.set(o,"properties.layer",G.get(e,"properties.layer",{})),t._setVisibilityProperties(o,e),t._setVisibilityZoomRange(a._layerId,o),(c=G.cloneDeep(G.get(o,"properties.layer",{}))).visibility=y(o),G.keys(c).forEach(function(e){"visibility"===e?t._map.setLayoutProperty(a._layerId,e,c[e]):t._map.setPaintProperty(a._layerId,e,c[e])}),t._reorganizeLayers(),r(!0),i.next=24;break;case 21:i.prev=21,i.t0=i.catch(0),n(i.t0);case 24:case"end":return i.stop()}},i,t,[[0,21]])}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"_addOrUpdateFixedMarkerLayer",value:function(e){var t=this;return new Promise(function(i,r){try{t._saveLayerDefinition(e);var n=G.get(e,"properties.lngLat",[]);if(n&&!isNaN(n[0])&&!isNaN(n[1])){var o=t._renderedLayers[e.name];o&&o.remove(),o=new Q(t,e).addToMap()}i(!0)}catch(e){r(e)}})}},{key:"_addCirclesLayer",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return new Promise(function(){var r=s(regeneratorRuntime.mark(function r(n,o){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,t._saveLayerDefinition(e),(a=t._renderedLayers[e.name])&&a.remove(),a=new U(t,e),!G.isArray(i)){r.next=10;break}return r.next=8,a.data(i).addToMap();case 8:r.next=12;break;case 10:return r.next=12,a.addToMap();case 12:n(!0),r.next=18;break;case 15:r.prev=15,r.t0=r.catch(0),o(r.t0);case 18:case"end":return r.stop()}},r,t,[[0,15]])}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_add3DLayer",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return new Promise(function(){var r=s(regeneratorRuntime.mark(function r(n,o){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,t._saveLayerDefinition(e),(a=t._renderedLayers[e.name])&&a.remove(),a=new Y(t,e),!G.isArray(i)){r.next=10;break}return r.next=8,a.data(i).addToMap();case 8:r.next=12;break;case 10:return r.next=12,a.addToMap();case 12:n(!0),r.next=18;break;case 15:r.prev=15,r.t0=r.catch(0),o(r.t0);case 18:case"end":return r.stop()}},r,t,[[0,15]])}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_updateCirclesLayer",value:function(e){var t=this;return new Promise(function(i,r){try{var n=t.getDefinedLayer(e.name),o=t._renderedLayers[e.name];if(!n||!o)return;var a=G.get(e,"properties.options.allowClick",!0),s=O.getBoolValue(G.get(e,"properties.options.showLocation",!0)),l=G.get(e,"properties.options.name");G.set(n,"priority",e.priority),G.set(n,"properties.options.allowClick",a),G.set(n,"properties.options.showLocation",s),G.set(n,"properties.options.name",l),o._addEventListeners();var c=G.get(e,"properties.options.opacityZoomLevels"),u=G.get(e,"properties.options.fillOpacity");delete n.properties.options.opacityZoomLevels,void 0!==c?G.set(n,"properties.options.opacityZoomLevels",c):void 0!==u&&t._map.setPaintProperty(o._layerId,"circle-opacity",u),t._setVisibilityProperties(n,e),t._setVisibilityZoomRange(o._layerId,n),t._map.setLayoutProperty(o._layerId,"visibility",y(n)),t._reorganizeLayers(),g(t),D(t),B(t),i(!0)}catch(e){r(e)}})}},{key:"_addShapeLayer",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return new Promise(function(){var r=s(regeneratorRuntime.mark(function r(n,o){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,t._saveLayerDefinition(e),(a=t._renderedLayers[e.name])&&a.remove(),a="shape"===e.type?new Z(t,e):new W(t,e),!G.isArray(i)||"shape"!==e.type){r.next=10;break}return r.next=8,a.data(i).addToMap();case 8:r.next=12;break;case 10:return r.next=12,a.addToMap();case 12:n(!0),r.next=18;break;case 15:r.prev=15,r.t0=r.catch(0),o(r.t0);case 18:case"end":return r.stop()}},r,t,[[0,15]])}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_updateShapeLayer",value:function(e){var t=this;return new Promise(function(){var i=s(regeneratorRuntime.mark(function i(r,n){var o,a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(i.prev=0,o=t.getDefinedLayer(e.name),a=t._renderedLayers[e.name],o&&a){i.next=5;break}return i.abrupt("return");case 5:G.set(o,"priority",e.priority),G.set(o,"properties",e.properties),a._processData(),G.each(a._fillLayerIds,function(e){a._addEventListeners(e)}),t._setVisibilityProperties(o,e),G.each(a._layerIds,function(e){G.isArray(e)&&G.each(e,function(e){t._setVisibilityZoomRange(e,o),t._map.setLayoutProperty(e,"visibility",y(o))})}),t._reorganizeLayers(),g(t),D(t),B(t),r(!0),i.next=21;break;case 18:i.prev=18,i.t0=i.catch(0),n(i.t0);case 21:case"end":return i.stop()}},i,t,[[0,18]])}));return function(e,t){return i.apply(this,arguments)}}())}},{key:"_addMarkerLayer",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return new Promise(function(){var r=s(regeneratorRuntime.mark(function r(n,o){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,t._saveLayerDefinition(e),(a=t._renderedLayers[e.name])&&a.remove(),a=new J(t,e),!G.isArray(i)){r.next=10;break}return r.next=8,a.data(i).addToMap();case 8:r.next=12;break;case 10:return r.next=12,a.addToMap();case 12:n(!0),r.next=18;break;case 15:r.prev=15,r.t0=r.catch(0),o(r.t0);case 18:case"end":return r.stop()}},r,t,[[0,15]])}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_updateMarkerLayer",value:function(e){var t=this;return new Promise(function(i,r){try{var n=t.getDefinedLayer(e.name),o=t._renderedLayers[e.name];if(!n||!o)return;G.set(n,"priority",e.priority),G.set(n,"properties",e.properties);var a=G.get(e,"properties.precisionLevels");if(a){var s=T.getVisualization(n.id);s.getAQLConfig(s._currentAQL).currentDef.precisionLevels=a,s._options.options.precisionLevels=a,G.set(n,"properties.precisionLevels",a)}o._processData();var l=[o._circleLayerId,o._symbolLayerId,o._markerLayerId];G.each(l,function(e){t._setVisibilityZoomRange(e,n),t._map.setLayoutProperty(e,"visibility",y(n))}),t._reorganizeLayers(),g(t),D(t),B(t),i(!0)}catch(e){r(e)}})}},{key:"_addHeatMapLayer",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return new Promise(function(){var r=s(regeneratorRuntime.mark(function r(n,o){var a;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(r.prev=0,t._saveLayerDefinition(e),(a=t._renderedLayers[e.name])&&a.remove(),a=new q(t,e),!G.isArray(i)){r.next=10;break}return r.next=8,a.data(i).addToMap();case 8:r.next=12;break;case 10:return r.next=12,a.addToMap();case 12:n(!0),r.next=18;break;case 15:r.prev=15,r.t0=r.catch(0),o(r.t0);case 18:case"end":return r.stop()}},r,t,[[0,15]])}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"_updateHeatMapLayer",value:function(e){var t=this;return new Promise(function(i,r){try{var n=t.getDefinedLayer(e.name),o=t._renderedLayers[e.name];if(!n||!o)return;G.set(n,"priority",e.priority),G.set(n,"properties.options",G.get(e,"properties.options"));var a=G.get(n,"properties.options.heatmap-weight",1),s=G.get(n,"properties.options.heatmap-intensity",1),l=G.get(n,"properties.options.heatmap-color",["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"]),c=G.get(n,"properties.options.heatmap-radius",30),u=G.get(n,"properties.options.heatmap-opacity",1),p=G.get(e,"properties.options.opacityZoomLevels");delete n.properties.options.opacityZoomLevels,void 0!==p&&G.set(n,"properties.options.opacityZoomLevels",p);var d=F(p,u);if(t._setVisibilityProperties(n,e),G.get(o,"_aktive._isHeatMapLayer",!0))t._setVisibilityZoomRange(o._layerId,n),t._map.setLayoutProperty(o._layerId,"visibility",y(n)),t._map.setPaintProperty(o._layerId,"heatmap-weight",a),t._map.setPaintProperty(o._layerId,"heatmap-intensity",s),t._map.setPaintProperty(o._layerId,"heatmap-color",l),t._map.setPaintProperty(o._layerId,"heatmap-radius",c),t._map.setPaintProperty(o._layerId,"heatmap-opacity",d);else if(o._markerLayer){o._markerLayer._processData();for(var h=[o._markerLayer._circleLayerId,o._markerLayer._symbolLayerId,o._markerLayer._markerLayerId],f=0;f<h.length;f++){var _=h[f];t._setVisibilityZoomRange(_,n),t._map.setLayoutProperty(_,"visibility",y(n))}}var m=G.get(e,"properties.precisionLevels");if(m){var v=T.getVisualization(n.id);v.getAQLConfig(v._currentAQL).currentDef.precisionLevels=m,v._options.options.precisionLevels=m,G.set(n,"properties.precisionLevels",m)}t._reorganizeLayers(),g(t),D(t),B(t),i(!0)}catch(e){r(e)}})}},{key:"isLayerDefined",value:function(e){return void 0!==this.getDefinedLayer(e)}},{key:"getHighestLayerPriority",value:function(){return this._definition.layers&&0!==this._definition.layers.length?G.maxBy(this._definition.layers,function(e){return e.priority}).priority:0}},{key:"getLayerPriority",value:function(e){var t=this._definition.layers.find(function(t){return t.name===e});return t?t.priority:0}},{key:"getDefinedLayer",value:function(e){return this._definition.layers.find(function(t){return t.name===e})}},{key:"getAllDefinedLayers",value:function(){return this._definition.layers||[]}},{key:"getRenderedLayer",value:function(e){return this._renderedLayers[e]}},{key:"getAllRenderedLayers",value:function(){return this._renderedLayers}},{key:"getLayerVisibility",value:function(e){return y(e)}},{key:"renderLayersControl",value:function(){D(this)}},{key:"renderDrawControl",value:function(){B(this)}},{key:"isLayerVisible",value:function(e,t){return v(e,t)}},{key:"getOpacityByZoomLevel",value:function(e,t){var i=e[0],r=e[e.length-1];if(t>=r.zoom)return r.fillOpacity;for(var n=0;n<e.length;n++){var o=n>0?e[n-1].fillOpacity:e[n].fillOpacity;if(e[n].zoom>t)return o}return i.fillOpacity}},{key:"processGeohashData",value:function(e){return C(e)}},{key:"getNavigationControl",value:function(){return this._navigationControl}},{key:"getZoomCenterInfoControl",value:function(){return this._zoomCenterInfoControl}},{key:"getFullScreenControl",value:function(){return this._fullScreenControl}},{key:"getDrawShapeControl",value:function(){return this._drawShapeControl}}]),t}()}).call(t,i(1))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var i=Object(a.c)(e),r=Object(a.c)(t),f=i.type,m=r.type,g=i.coordinates,y=r.coordinates;switch(f){case"Point":switch(m){case"Point":return _(g,y);default:throw new Error("feature2 "+m+" geometry not supported")}case"MultiPoint":switch(m){case"Point":return s(i,r);case"MultiPoint":return l(i,r);default:throw new Error("feature2 "+m+" geometry not supported")}case"LineString":switch(m){case"Point":return Object(o.a)(r,i,{ignoreEndVertices:!0});case"LineString":return p(i,r);case"MultiPoint":return c(i,r);default:throw new Error("feature2 "+m+" geometry not supported")}case"Polygon":switch(m){case"Point":return Object(n.a)(r,i,{ignoreBoundary:!0});case"LineString":return d(i,r);case"Polygon":return h(i,r);case"MultiPoint":return u(i,r);default:throw new Error("feature2 "+m+" geometry not supported")}default:throw new Error("feature1 "+f+" geometry not supported")}},t.isPointInMultiPoint=s,t.isMultiPointInMultiPoint=l,t.isMultiPointOnLine=c,t.isMultiPointInPoly=u,t.isLineOnLine=p,t.isLineInPoly=d,t.isPolyInPoly=h,t.doBBoxOverlap=f,t.compareCoords=_,t.getMidpoint=m;var r=i(7),n=i(21),o=i(22),a=i(6);function s(e,t){var i,r=!1;for(i=0;i<e.coordinates.length;i++)if(_(e.coordinates[i],t.coordinates)){r=!0;break}return r}function l(e,t){for(var i=0,r=t.coordinates;i<r.length;i++){for(var n=r[i],o=!1,a=0,s=e.coordinates;a<s.length;a++){if(_(n,s[a])){o=!0;break}}if(!o)return!1}return!0}function c(e,t){for(var i=!1,r=0,n=t.coordinates;r<n.length;r++){var a=n[r];if(Object(o.a)(a,e,{ignoreEndVertices:!0})&&(i=!0),!Object(o.a)(a,e))return!1}return!!i}function u(e,t){for(var i=0,r=t.coordinates;i<r.length;i++){var o=r[i];if(!Object(n.a)(o,e,{ignoreBoundary:!0}))return!1}return!0}function p(e,t){for(var i=!1,r=0,n=t.coordinates;r<n.length;r++){var a=n[r];if(Object(o.a)({type:"Point",coordinates:a},e,{ignoreEndVertices:!0})&&(i=!0),!Object(o.a)({type:"Point",coordinates:a},e,{ignoreEndVertices:!1}))return!1}return i}function d(e,t){var i=!1,o=0;if(!f(Object(r.default)(e),Object(r.default)(t)))return!1;for(;o<t.coordinates.length-1;o++){var a=m(t.coordinates[o],t.coordinates[o+1]);if(Object(n.a)({type:"Point",coordinates:a},e,{ignoreBoundary:!0})){i=!0;break}}return i}function h(e,t){if("Feature"===e.type&&null===e.geometry)return!1;if("Feature"===t.type&&null===t.geometry)return!1;if(!f(Object(r.default)(e),Object(r.default)(t)))return!1;for(var i=0,o=Object(a.c)(t).coordinates;i<o.length;i++)for(var s=0,l=o[i];s<l.length;s++){var c=l[s];if(!Object(n.a)(c,e))return!1}return!0}function f(e,t){return!(e[0]>t[0])&&(!(e[2]<t[2])&&(!(e[1]>t[1])&&!(e[3]<t[3])))}function _(e,t){return e[0]===t[0]&&e[1]===t[1]}function m(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}},function(e,t,i){"use strict";i.d(t,"a",function(){return r});i(5);function r(e,t,i){if(null!==e)for(var n,o,a,s,l,c,u,p,d=0,h=0,f=e.type,_="FeatureCollection"===f,m="Feature"===f,g=_?e.features.length:1,y=0;y<g;y++){l=(p=!!(u=_?e.features[y].geometry:m?e.geometry:e)&&"GeometryCollection"===u.type)?u.geometries.length:1;for(var v=0;v<l;v++){var A=0,b=0;if(null!==(s=p?u.geometries[v]:u)){c=s.coordinates;var w=s.type;switch(d=!i||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===t(c,h,y,A,b))return!1;h++,A++;break;case"LineString":case"MultiPoint":for(n=0;n<c.length;n++){if(!1===t(c[n],h,y,A,b))return!1;h++,"MultiPoint"===w&&A++}"LineString"===w&&A++;break;case"Polygon":case"MultiLineString":for(n=0;n<c.length;n++){for(o=0;o<c[n].length-d;o++){if(!1===t(c[n][o],h,y,A,b))return!1;h++}"MultiLineString"===w&&A++,"Polygon"===w&&b++}"Polygon"===w&&A++;break;case"MultiPolygon":for(n=0;n<c.length;n++){for(b=0,o=0;o<c[n].length;o++){for(a=0;a<c[n][o].length-d;a++){if(!1===t(c[n][o][a],h,y,A,b))return!1;h++}b++}A++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(!1===r(s.geometries[n],t,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}},function(e,t,i){"use strict";t.a=function(e,t,i){void 0===i&&(i={});if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var o=Object(r.a)(e),a=Object(r.c)(t),s=a.type,l=t.bbox,c=a.coordinates;if(l&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(o,l))return!1;"Polygon"===s&&(c=[c]);for(var u=!1,p=0;p<c.length&&!u;p++)if(n(o,c[p][0],i.ignoreBoundary)){for(var d=!1,h=1;h<c[p].length&&!d;)n(o,c[p][h],!i.ignoreBoundary)&&(d=!0),h++;d||(u=!0)}return u};var r=i(6);function n(e,t,i){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var n=0,o=t.length-1;n<t.length;o=n++){var a=t[n][0],s=t[n][1],l=t[o][0],c=t[o][1];if(e[1]*(a-l)+s*(l-e[0])+c*(e[0]-a)==0&&(a-e[0])*(l-e[0])<=0&&(s-e[1])*(c-e[1])<=0)return!i;s>e[1]!=c>e[1]&&e[0]<(l-a)*(e[1]-s)/(c-s)+a&&(r=!r)}return r}},function(e,t,i){"use strict";var r=i(6);function n(e,t,i,r,n){var o=i[0],a=i[1],s=e[0],l=e[1],c=t[0],u=t[1],p=c-s,d=u-l,h=(i[0]-s)*d-(i[1]-l)*p;if(null!==n){if(Math.abs(h)>n)return!1}else if(0!==h)return!1;return r?"start"===r?Math.abs(p)>=Math.abs(d)?p>0?s<o&&o<=c:c<=o&&o<s:d>0?l<a&&a<=u:u<=a&&a<l:"end"===r?Math.abs(p)>=Math.abs(d)?p>0?s<=o&&o<c:c<o&&o<=s:d>0?l<=a&&a<u:u<a&&a<=l:"both"===r&&(Math.abs(p)>=Math.abs(d)?p>0?s<o&&o<c:c<o&&o<s:d>0?l<a&&a<u:u<a&&a<l):Math.abs(p)>=Math.abs(d)?p>0?s<=o&&o<=c:c<=o&&o<=s:d>0?l<=a&&a<=u:u<=a&&a<=l}t.a=function(e,t,i){void 0===i&&(i={});for(var o=Object(r.a)(e),a=Object(r.b)(t),s=0;s<a.length-1;s++){var l=!1;if(i.ignoreEndVertices&&(0===s&&(l="start"),s===a.length-2&&(l="end"),0===s&&s+1===a.length-1&&(l="both")),n(a[s],a[s+1],o,l,void 0===i.epsilon?null:i.epsilon))return!0}return!1}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){void 0===t&&(t={});var i=Number(e[0]),n=Number(e[1]),o=Number(e[2]),a=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[i,n],l=[i,a],c=[o,a],u=[o,n];return Object(r.h)([[s,u,c,l,s]],t.properties,{bbox:e,id:t.id})};var r=i(5)},function(e,t,i){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var o=i(25).toString(),a=i(0),s=a.MAP_MODE,l=a.LAYER_TYPES,c=a.getToolkit,u=a.setLocationPrecisionAndFields,p=a.isAggregatedData,d=a.isGeoHashData,h=a.isRawData,f=a.isValidData,_=a.processLegendData,m=a.renderLegend,g=a.isLayerVisible,y=c(),v=y.getDependency("ui-legend"),A=y.getDependency("lodash"),b=y.getDependency("jquery");e.exports=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mapVisualization=t,this._map=t.map||t._map,this._visualElementId=t._element,this._layers=t._definition.layers,this._position=i,this._multipleLayersOpen=!1,y.loadCss("layers-control",o)}return n(e,[{key:"position",value:function(e){return this._position=e,this}},{key:"multipleLayersOpen",value:function(e){this._multipleLayersOpen=e}},{key:"remove",value:function(){this._visualElementId&&""!==this._visualElementId&&b('[id="'+this._visualElementId+'-layers-control"]').remove()}},{key:"getPosition",value:function(){var e={top:10,right:10};return["left","top-left"].includes(this._position)?(e.top=10,e.left=40):["bottom","bottom-right"].includes(this._position)?(e.top="unset",e.bottom=16,e.right=10):"bottom-left"===this._position&&(e.top="unset",e.bottom=16,e.left=10),e}},{key:"getLegendCode",value:function(e){var t=e.properties.legend,i=y.getVisualization(e.id);if(i&&!i._isHeatMapLayer){var r=A.get(e,"properties.clusterColor",y.Color().palette(["#f18017b3","#f0c20cb3","#6ecc39b3"]).autoRange({dynamic:!0})),n=s.GEOHASH;if(d(i)&&(n=s.GEOHASH),h(i)&&(n=s.RAW),p(i)&&(r=i.get().color,n=s.AGGREGATED),t){var o=new v("right");if(o.mainCssClass("adt-legend-lctrl"),"none"!==o._position){var a=i._data;if(f(a,n))return _(this._mapVisualization,a,o,e,i,r,n),"reverse"===t._sort&&o._items.reverse(),b('[id="'+this._visualElementId+"-"+e.name+'-legend"]').remove(),"metric"===o._type?o.renderByMetric().html.replace('<div class="adt-legend-lctrl cft-categorical-legend" style="','<div id="'+this._visualElementId+"-"+e.name+'-legend" class="adt-legend-lctrl" style="display:flex !important; position: relative !important;').replace("cft-legend-metric-values-ct","cft-legend-metric-values-ct-lctrl").replace("cft-legend-metric-gradient","cft-legend-metric-gradient-lcrtl"):(o.width(290),o.renderByCategory().html.replace('<div class="adt-legend-lctrl cft-categorical-legend" style="','<div id="'+this._visualElementId+"-"+e.name+'-legend" class="adt-legend-lctrl" style="display:flex !important; position: relative !important;'))}}}return""}},{key:"setGlLayerVisibility",value:function(e,t,i){var r=this;if("Geo Map GL"===e._definition.visualization){var n=e._renderedLayers[t.name],o=e._map.getZoom(),a=g(t,o);switch(t.type){case"tile":case"tile-wms":case"fixed-marker":case"circle":if("circle"===t.type&&a&&(!n||!n._isCustomData)){this.executeLayerAktive(e,t,i);break}if(!n)break;this._map.setLayoutProperty(n._layerId,"visibility",i);break;case"heatmap":if(!a||n&&n._isCustomData){if(!n)break;n._isHeatMapLayerRawMarker?(this._map.setLayoutProperty(n._circleLayerId,"visibility",i),this._map.setLayoutProperty(n._symbolLayerId,"visibility",i),this._map.setLayoutProperty(n._markerLayerId,"visibility",i)):this._map.setLayoutProperty(n._layerId,"visibility",i)}else this.executeLayerAktive(e,t,i);break;case"marker":if(!a||n&&n._isCustomData){if(!n)break;this._map.setLayoutProperty(n._circleLayerId,"visibility",i),this._map.setLayoutProperty(n._symbolLayerId,"visibility",i),this._map.setLayoutProperty(n._markerLayerId,"visibility",i)}else this.executeLayerAktive(e,t,i);break;case"shape":case"shape-only":if("shape"===t.type&&a&&(!n||!n._isCustomData)){this.executeLayerAktive(e,t,i);break}if(!n)break;A.each(n._layerIds,function(e){A.isArray(e)&&A.each(e,function(e){r._map.setLayoutProperty(e,"visibility",i)})})}}}},{key:"setV2LayerVisibility",value:function(e,t,i,r){if("Geo Map V2"===e._definition.visualization){var n=e.map.getPane(t);n&&(b(n).css("visibility",r),b(n).find("*").css("visibility",r)),this.executeLayerAktive(e,i,r)}}},{key:"executeLayerAktive",value:function(e,t,i){var r=y.getVisualization(t.id);if(r&&"visible"===i){var n=A.get(t,"properties.location"),o=A.get(t,"properties.precision"),a=A.get(t,"properties.precisionLevels"),s="heatmap"===t.type;"shape"===t.type&&(t._disableFitBounds=!0),u(e,t,r,n,o,a,s),r.execute()}}},{key:"registerEvents",value:function(){var e=this;b("."+this._visualElementId+"-accordion-item-header").off("click").on("click",function(t){if(["fa-angle-down","fa-angle-up"].includes(t.target.className)){var i=e._accordion.accordion("option","active"),r=b(this).data("index");i!==r&&!1===i||(b("."+e._visualElementId+"-accordion-show-lagend-btn i").removeClass("fa-angle-up"),b("."+e._visualElementId+"-accordion-show-lagend-btn i").removeClass("fa-angle-down"),b("."+e._visualElementId+"-accordion-show-lagend-btn i").addClass("fa-angle-down"),b("."+e._visualElementId+"-accordion-show-lagend-btn").attr("title","Show Legend")),i===r?(e._accordion.accordion("option","active",!1),b(this).find(".accordion-show-lagend-btn").attr("title","Show Legend")):(e._accordion.accordion("option","active",r),b(this).find(".accordion-show-lagend-btn").attr("title","Hide Legend"),b(this).find(".accordion-show-lagend-btn i").removeClass("fa-angle-down"),b(this).find(".accordion-show-lagend-btn i").addClass("fa-angle-up"))}else t.preventDefault(),t.stopPropagation()}),b("."+this._visualElementId+"-accordion-hide-layer-btn").off("click").on("click",function(t){var i=this;t.stopPropagation();var r=e._layers.find(function(e){return e.name===b(i).data("name")});b(this).data("visible")?(b(this).attr("title","Show layer"),b(this).data("visible",!1),b(this).find("i").removeClass("fa-eye-slash"),b(this).find("i").addClass("fa-eye"),r&&A.set(r,"properties.visible",!1),e.setV2LayerVisibility(e._mapVisualization,b(this).data("pane"),r,"hidden"),e.setGlLayerVisibility(e._mapVisualization,r,"none")):(b(this).attr("title","Hide layer"),b(this).data("visible",!0),b(this).find("i").removeClass("fa-eye"),b(this).find("i").addClass("fa-eye-slash"),r&&delete r.properties.visible,e.setV2LayerVisibility(e._mapVisualization,b(this).data("pane"),r,"visible"),e.setGlLayerVisibility(e._mapVisualization,r,"visible")),m(e._mapVisualization),"Geo Map GL"===e._mapVisualization._definition.visualization&&e._mapVisualization._reorganizeLayers(),e._mapVisualization.dispatch({name:"geo:layer-changed",element:e._mapVisualization._element,layer:r})}),b("."+e._visualElementId+"-collapse-layers-control").off("click").on("click",function(t){t.stopPropagation();var i=y.getVisualization(e._visualElementId).get().layersControl;"object"!==(void 0===i?"undefined":r(i))&&(i="string"==typeof i?{position:i}:{position:"right"}),b(this).data("collapsed")?(b(this).attr("title","Collapse layers control"),b(this).removeClass("collapsible-layers-control"),b(this).data("collapsed",!1),b(this).find("i").hasClass("fa-angles-left")?(b(this).find("i").removeClass("fa-angles-left"),b(this).find("i").addClass("fa-angles-right")):(b(this).find("i").removeClass("fa-angles-right"),b(this).find("i").addClass("fa-angles-left")),b('[id="'+e._visualElementId+'-layers-control"]').css("visibility","visible"),i.collapsed=!1,y.getVisualization(e._visualElementId).set("layersControl",i,!0)):(b(this).attr("title","Expand layers control"),b(this).addClass("collapsible-layers-control"),b(this).data("collapsed",!0),b(this).find("i").hasClass("fa-angles-left")?(b(this).find("i").removeClass("fa-angles-left"),b(this).find("i").addClass("fa-angles-right")):(b(this).find("i").removeClass("fa-angles-right"),b(this).find("i").addClass("fa-angles-left")),b('[id="'+e._visualElementId+'-layers-control"]').css("visibility","hidden"),b("."+e._visualElementId+"-collapse-layers-control").css("visibility","visible"),i.collapsed=!0,y.getVisualization(e._visualElementId).set("layersControl",i,!0)),e._mapVisualization.dispatch({name:"geo:layers-control-changed",element:e._mapVisualization._element,layersControl:i})})}},{key:"render",value:function(){var e=this,t=[],i=this._layers.filter(function(e){return l.includes(e.type)}).sort(function(e,t){return t.priority-e.priority}),r=y.getVisualization(this._visualElementId),n=A.get(r.get().layersControl,"collapsed",!1);this.remove();for(var o=0;o<i.length;o++){var a=i[o],s=A.get(a,"properties.visible",!0),c=s?this.getLegendCode(a):"",u=A.get(a,"properties.options.color",A.get(a,"properties.color",A.get(a,"properties.clusterColor")));u="string"==typeof u?y.Color().palette([u]):u;var p=A.get(u,"_palette",!1),d=!["shape","shape-only","circle"].includes(a.type),h=!(!["shape","shape-only","circle","marker"].includes(a.type)||!p)&&p[parseInt(p.length/2,10)];t.push('\n            <div id="'+this._visualElementId+"-"+a.name+'-accordion-item" data-name="'+a.name+'" data-pane="'+a.pane+'" class="accordion-item">\n                <h6 class="'+this._visualElementId+'-accordion-item-header accordion-item-header" data-index="'+o+'">\n                    <div style="display:inline-block;margin: 0px;">\n                        <div class="cft-layer-identifier">\n                            '+(d?'<i class="fa-'+a.type+'" '+(h?'style="color: '+h+'"':"")+"></i>":"")+"\n                            "+(!d&&h?'<div class="'+("circle"===a.type?"cft-layer-color-indicator-circle":"cft-layer-color-indicator")+'" style="background-color: '+h+'"></div>':"")+"\n                            <span>"+a.name+"</span>\n                        </div>\n                    </div>\n                    "+(""!==c?'<a data-visible="true" data-name="'+a.name+'" data-pane="'+a.pane+'" class="'+this._visualElementId+'-accordion-show-lagend-btn accordion-show-lagend-btn" title="Show Legend" href="javascript:void(0)">\n                            <i class="fa-angle-down"></i>\n                        </a>':"")+'                    \n                    <a data-visible="'+(s?"true":"false")+'" data-name="'+a.name+'" data-pane="'+a.pane+'" class="'+this._visualElementId+'-accordion-hide-layer-btn accordion-hide-layer-btn" title="'+(s?"Hide layer":"Show layer")+'" href="javascript:void(0)">\n                        <i class="'+(s?"fa-eye-slash":"fa-eye")+'"></i>\n                    </a>                    \n                </h6>\n                <div class="accordion-body">\n                    '+c+"\n                </div>\n            </div>")}var f=n?"hidden":"visible",_=this._position.includes("left")?"left":"right";_="hidden"===f?"left"===_?"right":"left":_;var g='\n        <div id="'+this._visualElementId+'-layers-control" class="card cft-layers-control-card" style="width: 25rem; visibility: '+f+'">\n            <div class="card-header">\n                <strong style="font-size: 12px;font-weight: bold;'+(this._position.includes("left")?"margin-left: 25px;":"")+'">LAYERS</strong>\n                <a class="'+this._visualElementId+"-collapse-layers-control "+("hidden"===f?"collapsible-layers-control":"")+'"\n                   data-collapsed="'+("hidden"===f?"true":"false")+'" \n                   style="visibility:visible;position:absolute;top:1px;'+(this._position.includes("left")?"left":"right")+':3px;padding:6px;background-color:white;" \n                   title="Collapse layers control" \n                   href="javascript:void(0)">\n                   <i style="font-size:large;color:black;display:block;" class="fa-angles-'+_+'"></i>\n                </a>                \n            </div>\n            <div id="'+this._visualElementId+'-accordion">\n                '+t.join("\n")+'\n                <div style="width:100%;height:5px;background-color:white;border-radius: 0 0 2px 2px;"></div>\n            </div>\n        </div>\n        ',v=b('[id="'+this._visualElementId+'"]').find('[id="map'+this._visualElementId+'"]');v?v.append(g):b('[id="'+this._visualElementId+'"]').append(g),b('[id="'+this._visualElementId+'"]').find('[id="'+this._visualElementId+'-layers-control"]').css(this.getPosition()),this._accordion=b('[id="'+this._visualElementId+'-accordion"]').accordion({collapsible:!0,active:!1,heightStyle:"content",header:"h6",animate:100,beforeActivate:function(t,i){if(e._multipleLayersOpen){var r=i.newHeader[0]?i.newHeader:i.oldHeader,n=r.next(".ui-accordion-content"),o="true"===r.attr("aria-selected");return r.toggleClass("ui-corner-all",o).toggleClass("accordion-header-active ui-state-active ui-corner-top",!o).attr("aria-selected",(!o).toString()),r.children(".ui-icon").toggleClass("ui-icon-triangle-1-e",o).toggleClass("ui-icon-triangle-1-s",!o),n.toggleClass("accordion-content-active",!o),o?n.slideUp():n.slideDown(),!1}return!0}}),this._accordion.sortable({items:".accordion-item",start:function(e,t){b(this).css({"background-color":"#f6f6f6"})},stop:function(e,t){b(this).css({"background-color":"#ffffff"})},update:function(t,i){for(var r=b(this).sortable("toArray").reverse(),n=function(t){var i=b('[id="'+r[t]+'"]').data("name");if(e._layers.find(function(e){return e.name===i}).priority=t+1,"Geo Map V2"===e._mapVisualization._definition.visualization){var n=b('[id="'+r[t]+'"]').data("pane");if(n){var o=e._map.getPane(n);o&&(o.style.zIndex=1e3*(t+1))}}},o=0;o<r.length;o++)n(o);"Geo Map GL"===e._mapVisualization._definition.visualization&&e._mapVisualization._reorganizeLayers(),e._mapVisualization.dispatch({name:"geo:layers-priority-changed",element:e._mapVisualization._element,layers:e._layers}),m(e._mapVisualization)}}),this.registerEvents()}}]),e}()},function(e,t,i){i(26),e.exports=i(28)},function(e,t,i){var r=i(12);"string"==typeof r&&(r=[[e.i,r,""]]);var n={transform:void 0};i(9)(r,n);r.locals&&(e.exports=r.locals)},function(e,t){e.exports=function(e){var t="undefined"!=typeof window&&window.location;if(!t)throw new Error("fixUrls requires window.location");if(!e||"string"!=typeof e)return e;var i=t.protocol+"//"+t.host,r=i+t.pathname.replace(/\/[^\/]*$/,"/");return e.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(e,t){var n,o=t.trim().replace(/^"(.*)"$/,function(e,t){return t}).replace(/^'(.*)'$/,function(e,t){return t});return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(o)?e:(n=0===o.indexOf("//")?o:0===o.indexOf("/")?i+o:r+o.replace(/^\.\//,""),"url("+JSON.stringify(n)+")")})}},function(e,t,i){var r=i(12);r&&r.__esModule&&(r=r.default),e.exports="string"==typeof r?r:r.toString()},function(e,t,i){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var o=i(0).getToolkit,a=i(30).toString(),s=o(),l=s.getDependency("jquery"),c=s.getDependency("lodash"),u=i(14).DRAW_SHAPES;e.exports=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"right";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._drawVisualization=t,this._map=t.map||t._map,this._visualElementId=t._element,this._position=i,this._multipleDrawOpen=!1,this.showTooltip=!1,this.tooltipText=u[0].tooltipText,this._labelInput="",s.loadCss("draw-control",a),this.updateTooltipLocation=this.updateTooltipLocation.bind(this)}return n(e,[{key:"position",value:function(e){return this._position=e,this}},{key:"multipleDrawOpen",value:function(e){this._multipleDrawOpen=e}},{key:"remove",value:function(){if(this._visualElementId&&""!==this._visualElementId){l('[id="'+this._visualElementId+'-draw-control"]').remove();for(var e=0;e<u.length;e++){var t=u[e];l("#"+this._visualElementId+"-"+t.mode+"-accordion-item").remove()}}}},{key:"getPosition",value:function(){var e={top:10,right:10};return e.top=107,e.left=7,e}},{key:"registerEvents",value:function(){var e=this,t=this;l("."+t._visualElementId+"-collapse-draw-control").off("click").on("click",function(e){e.stopPropagation();var i=s.getVisualization(t._visualElementId).get().drawControl;"object"!==(void 0===i?"undefined":r(i))&&(i="string"==typeof i?{position:i}:{position:"right"}),l(this).data("collapsed")?(l(this).attr("title","Collapse draw control"),l(this).removeClass("collapsible-draw-control"),l(this).data("collapsed",!1),l('[id="'+t._visualElementId+'-draw-control"]').css("visibility","visible"),i.collapsed=!1,s.getVisualization(t._visualElementId).set("drawControl",i,!0)):(l(this).attr("title","Expand draw control"),l(this).addClass("collapsible-draw-control"),l(this).data("collapsed",!0),l('[id="'+t._visualElementId+'-draw-control"]').css("visibility","hidden"),l("."+t._visualElementId+"-collapse-draw-control").css("visibility","visible"),i.collapsed=!0,s.getVisualization(t._visualElementId).set("drawControl",i,!0))});for(var i=s.getVisualization(t._visualElementId)._visualization._drawShapeControl,n=function(r){var n=u[r];l("#"+t._visualElementId+"-"+n.mode+"-accordion-item").off("click").on("click",function(r){r.stopPropagation(),l("#"+e._visualElementId+"-accordion-draw").empty().append(e.shapesFormAccordionHtml()),l("#shape-label").focus().val(n.defaultAlias),l("#btn-cancel-draw").on("click",function(e){l("#"+t._visualElementId+"-accordion-draw").empty().append(t.shapesAccordionItemsHtml()),t.registerEvents()}),l("#btn-accept-draw").on("click",function(e){return o(t,e,!1)}),l("#shape-label").on("keypress",function(e){return o(t,e,!0)});var o=function(t,r,o){if(!o||13==r.which){i.changeMode(n.drawMode),t._labelInput=l("#shape-label").val(),e.showTooltip=!0,e.tooltipText=n.tooltipText;var a=l("."+t._visualElementId+"-collapse-draw-control");a.attr("title","Expand draw control"),a.addClass("collapsible-draw-control"),a.data("collapsed",!0),l('[id="'+t._visualElementId+'-draw-control"]').css("visibility","hidden"),l("."+t._visualElementId+"-collapse-draw-control").css("visibility","visible"),i.collapsed=!0,s.getVisualization(t._visualElementId).set("drawControl",i,!0),l("#"+t._visualElementId+"-accordion-draw").empty().append(t.shapesAccordionItemsHtml()),t.registerEvents()}};l("#shape-label").on("keyup",function(e){var t=l("#shape-label").val().trim();l("#btn-accept-draw").prop("disabled",""===t)})})},o=0;o<u.length;o++)n(o);l('[id="'+t._visualElementId+'-accordion-draw"]').accordion({collapsible:!0,active:!1,heightStyle:"content",header:"h6",animate:100,beforeActivate:!0})}},{key:"updateTooltipLocation",value:function(){return c.throttle(function(e){var t=e.lngLat,i=self._map.project(t);l("#"+self._visualElementId+"-draw-tooltip").css({transform:"translate("+(i.x+5)+"px, "+(i.y-45)+"px)",visibility:"visible",background:"gray",color:"white",height:"auto",width:"fit-content",padding:"2px 5px","border-radius":"5px"})},200)}},{key:"shapesAccordionItemsHtml",value:function(){for(var e=[],t=0;t<u.length;t++){var i=u[t];e.push('\n            <div id="'+this._visualElementId+"-"+i.mode+'-accordion-item" data-name="'+i.mode+'" data-pane="'+i.mode+'" class="accordion-item">\n                <h6 class="'+this._visualElementId+'-accordion-item-header ui-accordion-header accordion-draw-item-header" data-index="'+t+'">\n                    <div style="display:inline-block;margin: 0px;">\n                        <div class="cft-draw-identifier">\n                            <i class="fa-'+i.iconName+'"></i>\n                            <span> '+i.label+" filter</span>\n                        </div>\n                    </div>                                   \n                </h6>\n            </div>")}return e}},{key:"shapesFormAccordionHtml",value:function(){return'\n        <div class="draw-form-label">\n            <label for="shape-label" class="form-label">Shape Label</label>\n            <input type="text" class="form-control" id="shape-label" placeholder="My shape">\n            <div id="form-button-container">\n                <button id="btn-cancel-draw">Cancel</button>\n                <button id="btn-accept-draw">Accept</button>\n            </div>\n        </div>\n        '}},{key:"render",value:function(){var e=this.shapesAccordionItemsHtml(),t=s.getVisualization(this._visualElementId),i=c.get(t.get().drawControl,"collapsed",!0);this.remove();var r=i?"hidden":"visible",n=this._position.includes("left")?"left":"right";n="hidden"===r?"left"===n?"right":"left":n;var o='\n        <div id="'+this._visualElementId+'-draw-control" class="draw-card cft-draw-control-card" style="width: 16rem; visibility: '+r+'">\n            <div class="card-header">\n                <a class="'+this._visualElementId+"-collapse-draw-control "+("hidden"===r?"collapsible-draw-control":"")+'"\n                   data-collapsed="'+("hidden"===r?"true":"false")+'" \n                   style="visibility:visible;position:absolute;top:4px;left:4px;padding:5px 5px 2px 5px;background-color:white;" \n                   title="Expand drawing control" \n                   href="javascript:void(0)">\n                   <i style="font-size:large;color:black;display:block;" class="data-filter-icon"></i>\n                </a>\n                <strong style="font-size: 12px;font-weight: bold;'+(this._position.includes("left")?"margin-left: 25px;":"")+'">Drawing</strong>\n            </div>\n            <div id="'+this._visualElementId+'-accordion-draw">\n                '+e.join("\n")+'\n                <div style="width:100%;height:5px;background-color:white;border-radius: 0 0 2px 2px;"></div>\n            </div>\n        </div>\n        ',a='<div id="'+this._visualElementId+'-draw-tooltip" class="tooltip-popup-text" style="height: 26px; width: 26px; visibility:hidden;">'+u[0].tooltipText+"</div>",p=l('[id="'+this._visualElementId+'"]').find('[id="map'+this._visualElementId+'"]');p?(p.append(o),l('[id="map'+this._visualElementId+'"] > .tooltip-popup-text').length||p.append(a)):l('[id="'+this._visualElementId+'"]').append(o),l('[id="'+this._visualElementId+'"]').find('[id="'+this._visualElementId+'-draw-control"]').css(this.getPosition()),this.registerEvents()}}]),e}()},function(e,t,i){i(31),e.exports=i(32)},function(e,t,i){var r=i(13);"string"==typeof r&&(r=[[e.i,r,""]]);var n={transform:void 0};i(9)(r,n);r.locals&&(e.exports=r.locals)},function(e,t,i){var r=i(13);r&&r.__esModule&&(r=r.default),e.exports="string"==typeof r?r:r.toString()},function(e,t,i){"use strict";(function(t){var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var n=i(0),o=n.getToolkit,a=n.getLayerVisibility,s=i(2),l=s.createMapLibrePopupInstance,c=s.setPopupPosition,u=s.sanitize,p=s.DEFAULT_MARKER_COLOR,d=s.DEFAULT_MARKER_ICON,h=i(3).renderLayersControl,f=i(4).renderDrawControl,_=o(),m=_.getDependency("utils").getEnvironment(),g=_.getDependency("lodash");e.exports=function(){function e(i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mapVisualization=i,this._map=i._map,this._config=r,this._type=r.type,this._sanitizedName=u(this._config.name),this._sourceId=this._sanitizedName+"_source",this._layerId=this._sanitizedName+"_layer",this._mainLayerId=this._layerId,this._window="browser"===m?window:t,this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseLeave=this._handleMouseLeave.bind(this),this._init()}return r(e,[{key:"_init",value:function(){var e=this;this._visibility=a(this._config),this._lngLat=g.get(this._config,"properties.lngLat",[0,0]),this._label=g.get(this._config,"properties.label","No label was specified"),this._tooltipHtml=this._label?'<div style="padding: 5px;">'+this._label+"</div>":"",this._markerIcon=g.get(this._config,"properties.icon",d),this._markerColor=g.get(this._config,"properties.color",p),this._featureCollection={type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(this._lngLat[0]),parseFloat(this._lngLat[1])]}}]},this._map.loadImage(this._markerIcon,function(t,i){if(t)throw t;e._map.hasImage(e._layerId)&&e._map.removeImage(e._layerId),e._map.addImage(e._layerId,i,{sdf:!0})})}},{key:"_addSource",value:function(){var e=this._map.getSource(this._sourceId);e?e.setData(this._featureCollection):this._map.addSource(this._sourceId,{type:"geojson",data:this._featureCollection})}},{key:"_removeSource",value:function(){this._map.getSource(this._sourceId)&&this._map.removeSource(this._sourceId)}},{key:"_addLayer",value:function(){this._mapVisualization._removeAllPopups(),this._visibility=a(this._config),this._mapVisualization._storeTooltipLayerId(this._layerId);var e=this._map.getLayer(this._layerId);e?(this._map.setLayoutProperty(this._layerId,"visibility",this._visibility),this._map.setLayoutProperty(this._layerId,"icon-image",this._layerId),this._map.setLayoutProperty(this._layerId,"icon-overlap","cooperative"),this._map.setPaintProperty(this._layerId,"icon-color",this._markerColor)):this._map.addLayer({id:this._layerId,type:"symbol",source:this._sourceId,layout:{visibility:this._visibility,"icon-image":this._layerId,"icon-overlap":"cooperative"},paint:{"icon-color":this._markerColor}}),this._mapVisualization._renderedLayers[this._config.name]=this,this._mapVisualization._setVisibilityZoomRange(this._layerId,this._config),this._mapVisualization._reorganizeLayers(),h(this._mapVisualization),f(this._mapVisualization),e||this._mapVisualization.dispatch({name:"geo:layer-added",element:this._mapVisualization._element,layer:this._config,mapLibreLayers:[this._map.getLayer(this._layerId)]})}},{key:"_removeLayer",value:function(){var e=this;this._map.getLayer(this._layerId)&&this._map.removeLayer(this._layerId),g.remove(this._mapVisualization._tooltipLayerIds,function(t){return t===e._layerId})}},{key:"_handleMouseMove",value:function(e){if(!g.isEmpty(this)){this._map.getCanvas().style.cursor="pointer";var t=this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds}),i=g.get(t,"[0]");i&&this._layerId===i.layer.id?(this._popup&&this._popup.remove(),this._popup=l(this._mapVisualization,"none",this._markerColor),this._popup.setLngLat(e.lngLat).setHTML(this._tooltipHtml).addTo(this._map),c(e,this._popup),e.data={lngLat:this._lngLat,label:this.label},this._mapVisualization._onChartMouseMove(e)):this._popup&&this._popup.remove()}}},{key:"_handleMouseLeave",value:function(e){if(!g.isEmpty(this)){this._map.getCanvas().style.cursor="";var t=this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds}),i=g.get(t,"[0]");i&&this._layerId===i.layer.id||(this._popup&&(this._popup.remove(),delete this._popup),e.data={lngLat:this._lngLat,label:this.label},this._mapVisualization._onChartMouseLeave(e))}}},{key:"_removeEventListeners",value:function(){this._map.off("mousemove",this._layerId,this._handleMouseMove),this._map.off("mouseleave",this._layerId,this._handleMouseLeave),this._map.checkAndRemoveLayerDelegatedListeners("mousemove",this._layerId),this._map.checkAndRemoveLayerDelegatedListeners("mouseleave",this._layerId)}},{key:"_addEventListeners",value:function(){this._removeEventListeners(),this._map.on("mousemove",this._layerId,this._handleMouseMove),this._map.on("mouseleave",this._layerId,this._handleMouseLeave)}},{key:"addToMap",value:function(){var e=this;return new Promise(function(t,i){try{e._addSource(),e._addLayer(),e._addEventListeners(),t(e)}catch(e){i(e)}})}},{key:"remove",value:function(){var e=this;return new Promise(function(){var t=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function r(n,o){try{var a=t[n](o),s=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{e._removeEventListeners(),e._removeLayer(),e._removeSource(),delete e._mapVisualization._renderedLayers[e._config.name],g.each(g.keys(e),function(t){return delete e[t]}),i(!0)}catch(e){r(e)}case 1:case"end":return t.stop()}},t,e)}));return function(e,i){return t.apply(this,arguments)}}())}}]),e}()}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var o=i(0),a=o.getToolkit,s=o.getLayerVisibility,l=i(2).sanitize,c=i(3).renderLayersControl,u=i(4).renderDrawControl,p=a(),d=p.getDependency("utils").getEnvironment(),h=p.getDependency("lodash");e.exports=function(){function e(i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mapVisualization=i,this._map=i._map,this._config=r,this._type=r.type,this._sanitizedName=l(this._config.name),this._sourceId=this._sanitizedName+"_source",this._layerId=this._sanitizedName+"_layer",this._mainLayerId=this._layerId,this._window="browser"===d?window:t,this._init()}return n(e,[{key:"_init",value:function(){this._visibility=s(this._config)}},{key:"_addSource",value:function(){var e=this,t=h.cloneDeep(h.get(this._config,"properties.source",{})),i=h.get(t,"tiles",[]),n=h.get(t,"headers"),o=n;"function"==typeof n&&(o=n()),delete t.headers,h.isArray(o)&&"tile-wms"===this._type&&h.each(i,function(t){var i=t.split("?")[0];e._mapVisualization._tilesHeaders.set(i,o)}),this._map.addSource(this._sourceId,r({type:"raster",tiles:[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(i))},t))}},{key:"_removeSource",value:function(){this._map.getSource(this._sourceId)&&this._map.removeSource(this._sourceId)}},{key:"_addLayer",value:function(){this._mapVisualization._removeAllPopups(),this._visibility=s(this._config);var e=h.cloneDeep(h.get(this._config,"properties.layer",{}));delete e.visibility,this._map.addLayer({id:this._layerId,type:"raster",source:this._sourceId,layout:{visibility:this._visibility},paint:r({},e)}),this._mapVisualization._renderedLayers[this._config.name]=this,this._mapVisualization._setVisibilityZoomRange(this._layerId,this._config),this._mapVisualization._reorganizeLayers(),c(this._mapVisualization),u(this._mapVisualization),this._mapVisualization.dispatch({name:"geo:layer-added",element:this._mapVisualization._element,layer:this._config,mapLibreLayers:[this._map.getLayer(this._layerId)]})}},{key:"_removeLayer",value:function(){this._map.getLayer(this._layerId)&&this._map.removeLayer(this._layerId)}},{key:"addToMap",value:function(){var e=this;return new Promise(function(t,i){try{e._addSource(),e._addLayer(),t(e)}catch(e){i(e)}})}},{key:"remove",value:function(){var e=this;return new Promise(function(){var t=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function r(n,o){try{var a=t[n](o),s=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{e._removeLayer(),e._removeSource(),delete e._mapVisualization._renderedLayers[e._config.name],h.each(h.keys(e),function(t){return delete e[t]}),i(!0)}catch(e){r(e)}case 1:case"end":return t.stop()}},t,e)}));return function(e,i){return t.apply(this,arguments)}}())}}]),e}()}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function r(n,o){try{var a=t[n](o),s=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}var a=i(0),s=a.getToolkit,l=a.getAktiveAql,c=a.createLayerAktive,u=a.getLayerVisibility,p=a.isLayerVisible,d=a.renderLegend,h=i(2),f=h.error,_=h.DEFAULT_MARKER_COLOR,m=h.sanitize,g=h.getRows,y=h.getMetrics,v=h.getMetricPath,A=h.getFilters,b=h.splitData,w=h.createMapLibrePopupInstance,C=h.setPopupPosition,L=h.buildColorExpression,x=h.buildOpacityExpression,k=h.getColor,I=h.getColorFromRange,E=h.getRandomInt,M=h.getCountField,S=h.shouldProcessData,P=i(3).renderLayersControl,F=i(4).renderDrawControl,D=s(),B=D.getDependency("utils"),z=B.getEnvironment(),T=D.getDependency("lodash"),O=D.getDependency("d3-scale").scaleLinear;e.exports=function(){function e(i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mapVisualization=i,this._map=i._map,this._config=r,this._type=r.type,this._sanitizedName=m(this._config.name),this._sourceId=this._sanitizedName+"_source",this._layerId=this._sanitizedName+"_layer",this._mainLayerId=this._layerId,this._featureCollection={type:"FeatureCollection",features:[]},this._min=T.get(this._config,"properties.min"),this._max=T.get(this._config,"properties.max"),this._manualMinMax=T.isNumber(this._min)&&T.isNumber(this._max),this._isCustomData=!1,this._propsConfig={},this._useClickEvent=!0,this._window="browser"===z?window:t,this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseLeave=this._handleMouseLeave.bind(this),this._handleMouseClick=this._handleMouseClick.bind(this),this._init()}return n(e,[{key:"_init",value:function(){this._visibility=u(this._config);var e=B.getBoolValue(T.get(this._config,"properties.options.showLocation",!0));T.set(this._config,"properties.options.showLocation",e)}},{key:"_configureAktive",value:function(){var e=this;if(this._config.provider&&this._config.source){this._aktive=c(this._mapVisualization._element,this._config);var t=l(this._aktive),i=A(T.get(this._config,"properties.filters",[])),r=A(T.get(this._config,"properties.staticFilters",[])),n=T.get(this._config,"properties.textFilter",""),a=T.get(this._config,"properties.limit");this._rows=g(T.get(this._config,"properties.rows")),this._metrics=y(T.get(this._config,"properties.options.metrics")),T.isArray(this._rows)?this._aktive.rows(this._rows):t._rows=[],T.isArray(this._metrics)?this._aktive.metrics(this._metrics):t._metrics=[],a&&this._aktive.limit(a);var s=k(this._config,[_]);T.set(this._config,"properties.options.color",s),this._aktive._options.set("color",s),this._aktive.staticFilters(r),this._aktive.filters(i),this._aktive.textfilter(n),this._aktive._layer=this._config,this._aktive._isAktiveLayer=!0,this._aktive._isCircleLayer=!0,this._aktive._mainLayerId=this._layerId,this._aktive._options.set("isCircleLayer",!0),this._aktive._parentAktive=this._mapVisualization._aktive,this._mapVisualization._storeLayerAktive(this._aktive),this._aktive.on("execute:start",function(t){e._mapVisualization._runningAktives[e._aktive._elementId]||(e._mapVisualization._runningAktives[e._aktive._elementId]=e._aktive,e._mapVisualization.dispatch({name:"geo:layers-execution-start",element:e._mapVisualization._element}))}),this._aktive.on("execute:stop",function(){var t=o(regeneratorRuntime.mark(function t(i){var r,n,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e._mapVisualization._storeLayerAktive(e._aktive),i.error||(r=b(i.data),S(e,r)?(e._aktive._data=r,e._data=r,n=e._aktive.get().rows,o=e._aktive.get("config").metrics,e._rows=n,e._metrics=o,T.set(e._config,"properties.rows",n),T.set(e._config,"properties.options.metrics",o),e._processData()):(e._visibility=u(e._config),e._map.setLayoutProperty(e._layerId,"visibility",e._visibility))),delete e._mapVisualization._runningAktives[e._aktive._elementId],T.isEmpty(e._mapVisualization._runningAktives)&&e._mapVisualization.dispatch({name:"geo:layers-execution-stop",element:e._mapVisualization._element});case 4:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}())}else f("Please specify a provider and a source for the circle layer "+this._config.name)}},{key:"_getRadiusScale",value:function(){var e=T.cloneDeep(T.get(this._config,"properties.options.radiusScale",{min:1,max:50}));return"object"!==(void 0===e?"undefined":r(e))&&(e={min:1,max:50}),T.isNumber(e.min)||(e.min=1),T.isNumber(e.max)||(e.max=50),(e.min<=0||e.max<=0||e.min>=e.max)&&(e.min=1,e.max=50),e}},{key:"_processData",value:function(){if(this._useClickEvent=!0,this._mapVisualization._removeAllPopups(),this._visibility=u(this._config),this._preprocessor=T.get(this._config,"properties.options.preprocessor"),!T.isEmpty(this._data)){var e=T.get(this._config,"properties.options.color"),t=this._metrics[0],i=v(t),n=this._data.map(function(e){return T.get(e,i)}).filter(function(e){return e}),o=T.min(n),a=T.max(n),s=this._getRadiusScale();this._scale=O().domain([o,a]).range([s.min,s.max]),"object"!==(void 0===e?"undefined":r(e))||e._metric||e.metric(D.Metric().fromJSON(t));var l=v(e._metric||t),c=e;e._range||e._autoRange||(c=D.Color().palette(e._palette).metric(D.Metric().fromJSON(e._metric)).autoRange({dynamic:!0})),this._featureCollection.features=[];var p=this._data.length,h=this._rows||[],f=this._metrics||[];c._metric&&!f.find(function(e){return e.name===c._metric.name})&&f.push(c._metric);for(var _=0;_<p;_++){for(var m=this._data[_],g={id:E(),type:"Feature",geometry:{type:"Point",coordinates:[parseFloat(m.group[0]),parseFloat(m.group[1])]},properties:{__cf_color_definition__:c}},y=2;y<h.length;y++){var A=h[y];g.properties[A.name]=m.group[y],this._propsConfig[A.name]=A}for(var b=0;b<f.length;b++){var w=f[b],C=v(w),x=T.get(m,C),k=w.func?w.name+"_"+w.func:w.name;g.properties[k]=x,this._propsConfig[k]="count"!==w.name?w:M(this._aktive,w)}var I=f.some(function(e){return"count"===e.name});if(T.has(m,"current.count")&&!g.properties.count&&I&&(g.properties.count=m.current.count,this._propsConfig.count=M(this._aktive)),g.properties.__cf_radius__=this._scale(T.get(m,i)),g.properties.__cf_data__=m,this._featureCollection.features.push(g),!this._manualMinMax){var S=T.get(m,l);this._min||(this._min=S),this._max||(this._max=S),(S<this._min||S>this._max)&&(this._min=Math.min(S,this._min),this._max=Math.max(S,this._max))}}this._min===this._max&&(this._min=0,0===this._max&&(this._max=100)),T.set(this._config,"properties.options.min",this._min),T.set(this._config,"properties.options.max",this._max),"function"==typeof this._preprocessor&&this._preprocessor(T.cloneDeep(this._data),this._featureCollection),this._colorExpression="green","string"==typeof c?this._colorExpression=c:"object"===(void 0===c?"undefined":r(c))&&this._rows&&this._rows[2]&&(this._colorExpression=L(this._rows[2].name,"",c,this._featureCollection)),this._addSource(),this._addLayer()}d(this._mapVisualization),P(this._mapVisualization),F(this._mapVisualization)}},{key:"_addSource",value:function(){var e=this._map.getSource(this._sourceId);e?e.setData(this._featureCollection):this._map.addSource(this._sourceId,{type:"geojson",data:this._featureCollection,generateId:!0})}},{key:"_removeSource",value:function(){this._map.getSource(this._sourceId)&&this._map.removeSource(this._sourceId)}},{key:"_addLayer",value:function(){var e=T.get(this._config,"properties.options.fillOpacity",.5),t=T.get(this._config,"properties.options.opacityZoomLevels"),i=x(t,e),r=T.get(this._config,"properties.options.circle-radius",["get","__cf_radius__"]),n=this._map.getLayer(this._layerId);n?(this._map.setLayoutProperty(this._layerId,"visibility",this._visibility),this._map.setPaintProperty(this._layerId,"circle-color",this._colorExpression),this._map.setPaintProperty(this._layerId,"circle-opacity",i),this._map.setPaintProperty(this._layerId,"circle-stroke-color",this._colorExpression),this._map.setPaintProperty(this._layerId,"circle-stroke-opacity",.8),this._map.setPaintProperty(this._layerId,"circle-stroke-width",3),this._map.setPaintProperty(this._layerId,"circle-radius",r)):this._map.addLayer({id:this._layerId,type:"circle",source:this._sourceId,layout:{visibility:this._visibility},paint:{"circle-color":this._colorExpression,"circle-opacity":i,"circle-stroke-color":this._colorExpression,"circle-stroke-opacity":.8,"circle-stroke-width":3,"circle-radius":r}}),this._mapVisualization._storeTooltipLayerId(this._layerId),this._mapVisualization._renderedLayers[this._config.name]=this,this._mapVisualization._setVisibilityZoomRange(this._layerId,this._config),this._mapVisualization._reorganizeLayers(),n||this._mapVisualization.dispatch({name:"geo:layer-added",element:this._mapVisualization._element,layer:this._config,mapLibreLayers:[this._map.getLayer(this._layerId)]})}},{key:"_removeLayer",value:function(){var e=this;this._map.getLayer(this._layerId)&&this._map.removeLayer(this._layerId),T.remove(this._mapVisualization._tooltipLayerIds,function(t){return t===e._layerId})}},{key:"_isDrawingModeInProcess",value:function(){return this._mapVisualization._drawShapeControl&&"simple_select"!==this._mapVisualization._drawShapeControl.getMode()}},{key:"_skipMouseEvents",value:function(){return T.isEmpty(this)||this._isDrawingModeInProcess()}},{key:"_skipMouseEventsAndClick",value:function(){return T.isEmpty(this)||this._isDrawingModeInProcess()||!this._useClickEvent}},{key:"_handleMouseMove",value:function(e){var t=this;if(!this._skipMouseEvents()){this._map.getCanvas().style.cursor="pointer";var i=this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds}),n=T.get(i,"[0]");if(n&&this._layerId===n.layer.id&&!this._mapVisualization.tooltip3D){this._popup&&this._popup.remove();var o=this._rows[2],a=T.get(this._config,"properties.options.name",o.label),s=B.getBoolValue(T.get(this._config,"properties.options.showLocation",!0)),l='<div style="padding: 5px;">';l+='<span style="white-space: nowrap;display: table;"><b>'+a+":</b> "+T.get(n.properties,o.name)+'</span>\n            <div style="border-bottom:1px solid #CCC; margin-top: 5px; margin-bottom: 5px"></div>\n            ',s&&(l+='<span style="white-space: nowrap;display: table;"><b>Position:</b> '+n.geometry.coordinates.join(", ")+"</span>"),T.each(n.properties,function(e,i){if(![o.name,"__cf_data__","__cf_color_definition__","__cf_radius__"].includes(i)){var r=t._propsConfig[i];if(r){var a="Metric"===r.is?r.hideFunction?r.label:r.label+" ("+r.func+")":r.label;l+='<span style="white-space: nowrap;display: table;">\n                            <b>'+a+":</b> "+B.formatMetricValue(T.get(n.properties,i),r)+"\n                        </span>"}}}),l+="</div>";var c=T.get(n.properties,"__cf_color_definition__"),u=c||"#CCC";try{c=JSON.parse(c)}catch(e){}if(c&&this._rows&&this._rows[2])if("string"==typeof c)u=c;else if("object"===(void 0===c?"undefined":r(c))){var p=c._metric,d=p.func?p.name+"_"+p.func:p.name,h=n.properties[d],f=n.properties[this._rows[2].name||this._rows[2]._name];u=c._match&&c._match[f]?c._match[f]:c._range?I(c._range,h):u}this._popup=w(this._mapVisualization,"none",u),this._popup.setLngLat(e.lngLat).setHTML(l).addTo(this._map),C(e,this._popup),e.aktive=this._aktive,e.data=JSON.parse(T.get(n.properties,"__cf_data__")),this._mapVisualization._onChartMouseMove(e)}else this._popup&&this._popup.remove()}}},{key:"_handleMouseLeave",value:function(e){if(!this._skipMouseEvents()){this._map.getCanvas().style.cursor="";var t=this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds}),i=T.get(t,"[0]");i&&this._layerId===i.layer.id||(this._popup&&(this._popup.remove(),delete this._popup),e.aktive=this._aktive,e.data={lngLat:e.lngLat},this._mapVisualization._onChartMouseLeave(e))}}},{key:"_handleMouseClick",value:function(e){if(!this._skipMouseEventsAndClick()){var t=this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds}),i=T.get(t,"[0]");i&&this._layerId===i.layer.id&&(e.aktive=this._aktive,e.data=JSON.parse(T.get(i.properties,"__cf_data__")),this._mapVisualization._onChartClick(e))}}},{key:"_removeEventListeners",value:function(){this._map.off("mousemove",this._layerId,this._handleMouseMove),this._map.off("mouseleave",this._layerId,this._handleMouseLeave),this._map.off("click",this._layerId,this._handleMouseClick),this._map.checkAndRemoveLayerDelegatedListeners("mousemove",this._layerId),this._map.checkAndRemoveLayerDelegatedListeners("mouseleave",this._layerId),this._map.checkAndRemoveLayerDelegatedListeners("click",this._layerId)}},{key:"_addEventListeners",value:function(){this._removeEventListeners(),this._map.on("mousemove",this._layerId,this._handleMouseMove),this._map.on("mouseleave",this._layerId,this._handleMouseLeave),T.get(this._config,"properties.options.allowClick",!0)&&!this._isCustomData&&this._map.on("click",this._layerId,this._handleMouseClick)}},{key:"data",value:function(e){return this._data=e,this._isCustomData=!0,this._rows=T.get(this._config,"properties.rows"),this._metrics=T.get(this._config,"properties.options.metrics"),this}},{key:"addToMap",value:function(){var e=this;return new Promise(function(){var t=o(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{e._isCustomData?(e._processData(),e._addEventListeners(),i(e)):(e._configureAktive(),p(e._config,e._map.getZoom())?e._aktive.execute().then(function(){e._addEventListeners(),i(e)}).catch(function(e){return r(e)}):(e._addEventListeners(),i(e)))}catch(e){r(e)}case 1:case"end":return t.stop()}},t,e)}));return function(e,i){return t.apply(this,arguments)}}())}},{key:"remove",value:function(){var e=this;return new Promise(function(){var t=o(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{e._removeEventListeners(),e._removeLayer(),e._removeSource(),delete e._mapVisualization._renderedLayers[e._config.name],T.each(T.keys(e),function(t){return delete e[t]}),i(!0)}catch(e){r(e)}case 1:case"end":return t.stop()}},t,e)}));return function(e,i){return t.apply(this,arguments)}}())}}]),e}()}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(e[r]=i[r])}return e},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),a=i(2),s=p(i(37)),l=p(i(10)),c=i(0),u=i(4);function p(e){return e&&e.__esModule?e:{default:e}}function d(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function r(n,o){try{var a=t[n](o),s=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}function h(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var f=i(0),_=f.getToolkit,m=f.getAktiveAql,g=f.createLayerAktive,y=f.getLayerVisibility,v=f.isLayerVisible,A=f.addBoundingBox,b=i(2),w=b.error,C=b.DEFAULT_MARKER_COLOR,L=b.sanitize,x=b.getRows,k=b.getFields,I=b.getMetrics,E=b.getMetricPath,M=b.getFilters,S=b.splitData,P=b.createMapLibrePopupInstance,F=b.setPopupPosition,D=b.getColor,B=b.getRandomInt,z=b.shouldProcessData,T=b.checkThreeJsLibraries,O=i(3).renderLayersControl,R=_(),N=R.getDependency("utils"),V=R.getDependency("lodash"),G="browser"===(0,c.getEnvironment)()?window:t;e.exports=function(){function e(t,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._gltfModels=[],this._mapVisualization=t,this._map=t._map,this._config=i,this._type=i.type,this._sanitizedName=L(this._config.name),this._sourceId=this._sanitizedName+"_source",this._layerId=this._sanitizedName+"_layer",this._mainLayerId=this._layerId,this._prevZoom=this._map.getZoom(),this._featureCollection={type:"FeatureCollection",features:[]},this._isCustomData=!1,this._queryType="row",this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseClick=this._handleMouseClick.bind(this),this._handleRayCastMoveEvent=this._handleRayCastMoveEvent.bind(this),this._handleRayCastClickEvent=this._handleRayCastClickEvent.bind(this),this._init()}return o(e,[{key:"_init",value:function(){this._visibility=y(this._config);var e=N.getBoolValue(V.get(this._config,"properties.options.showLocation",!0));this._location=V.get(this._config,"properties.location");var t=(0,a.getLngLatFields)(this._location),i=t.lngField,r=t.latField;this._lngField=i,this._latField=r,V.set(this._config,"properties.options.showLocation",e)}},{key:"_getModelMetrics",value:function(){var e=[],t=V.get(this._config,"properties.options.metrics",[]),i=V.get(this._config,"model.rotation",{}),r=t.some(function(e){return e._name===V.get(i,"x._name")&&e._func===V.get(i,"x._func")}),n=t.some(function(e){return e._name===V.get(i,"y._name")&&e._func===V.get(i,"y._func")}),o=t.some(function(e){return e._name===V.get(i,"z._name")&&e._func===V.get(i,"z._func")});return i.x&&V.isObject(i.x)&&i.x._name&&!r&&e.push(i.x),i.y&&V.isObject(i.y)&&i.y._name&&!n&&e.push(i.y),i.z&&V.isObject(i.z)&&i.z._name&&!o&&e.push(i.z),e}},{key:"_getModelFields",value:function(){var e=[],t=V.get(this._config,"properties.fields",[]),i=V.get(this._config,"model.rotation",{}),r=t.some(function(e){return e._name===V.get(i,"x._name")}),n=t.some(function(e){return e._name===V.get(i,"y._name")}),o=t.some(function(e){return e._name===V.get(i,"z._name")});return i.x&&V.isObject(i.x)&&i.x._name&&!r&&e.push(i.x),i.y&&V.isObject(i.y)&&i.y._name&&!n&&e.push(i.y),i.z&&V.isObject(i.z)&&i.z._name&&!o&&e.push(i.z),e}},{key:"_configureAktive",value:function(){var e=this;if(this._config.provider&&this._config.source){this._aktive=g(this._mapVisualization._element,this._config);var t=m(this._aktive),i=M(V.get(this._config,"properties.filters",[])),r=M(V.get(this._config,"properties.staticFilters",[])),n=V.get(this._config,"properties.textFilter",""),o=V.get(this._config,"properties.limit");if(this._rows=x(V.get(this._config,"properties.rows")),this._fields=k(V.get(this._config,"properties.fields")),t._rows=[],t._fields=[],V.isArray(this._rows)&&this._rows.length>0){this._aktive.rows(this._rows),this._queryType="row";var a=I(V.get(this._config,"properties.options.metrics")),s=this._getModelMetrics();this._metrics=[].concat(h(a),h(s))}else if(V.isArray(this._fields)&&this._fields.length>0){var l=this._getModelFields(),c=V.isArray(this._location)?this._location.map(function(e){return R.Field(e)}):[R.Field(this._location)];this._fields=[].concat(h(c),h(this._fields||[]),h(l)),this._aktive.fields(this._fields),this._queryType="field"}V.isArray(this._metrics)?this._aktive.metrics(this._metrics):t._metrics=[],o&&this._aktive.limit(o),A(this._mapVisualization,this._config,this._aktive,this._location);var u=D(this._config,[C]);V.set(this._config,"properties.options.color",u),this._aktive.staticFilters(r),this._aktive.filters(i),this._aktive.textfilter(n),this._aktive._layer=this._config,this._aktive._isAktiveLayer=!0,this._aktive._is3DLayer=!0,this._aktive._mainLayerId=this._mainLayerId,this._aktive._options.set("is3DLayer",!0),this._aktive._parentAktive=this._mapVisualization._aktive,this._mapVisualization._storeLayerAktive(this._aktive),this._aktive.on("execute:start",function(t){e._mapVisualization._runningAktives[e._aktive._elementId]||(e._mapVisualization._runningAktives[e._aktive._elementId]=e._aktive,e._mapVisualization.dispatch({name:"geo:layers-execution-start",element:e._mapVisualization._element})),e._prevZoom=e._map.getZoom()}),this._aktive.on("execute:stop",function(){var t=d(regeneratorRuntime.mark(function t(i){var r,n,o,a;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e._mapVisualization._storeLayerAktive(e._aktive),i.error){t.next=20;break}if(r=S(i.data),!z(e,r)){t.next=18;break}return e._aktive._data=r,e._data=r,n=e._aktive.get().rows,o=e._aktive.get("config").fields,a=e._aktive.get("config").metrics,"row"===e._queryType?(e._rows=n,V.set(e._config,"properties.rows",n)):(e._fields=o,V.set(e._config,"properties.fields",o)),e._metrics=a,V.set(e._config,"properties.options.metrics",a),t.next=14,T();case 14:e._label3DRenderer=e._getLabel3DRenderer(),e._processData(),t.next=20;break;case 18:e._visibility=y(e._config),e._map.setLayoutProperty(e._layerId,"visibility",e._visibility);case 20:delete e._mapVisualization._runningAktives[e._aktive._elementId],V.isEmpty(e._mapVisualization._runningAktives)&&e._mapVisualization.dispatch({name:"geo:layers-execution-stop",element:e._mapVisualization._element});case 22:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}())}else w("Please specify a provider and a source for the circle layer "+this._config.name)}},{key:"_getLabel3DRenderer",value:function(){var e=document.getElementById(this._mapVisualization._element),t=new G.THREE.CSS2DRenderer;return t.setSize(e.offsetWidth,e.offsetHeight),t.domElement.style.position="absolute",t.domElement.style.top="0px",t.domElement.style.pointerEvents="none",t.domElement.className="cf-3d-model-label-container "+this._mapVisualization._element,e.appendChild(t.domElement),t}},{key:"_processData",value:function(){var e=this;if(this._mapVisualization._removeAllPopups(),this._visibility=y(this._config),!V.isEmpty(this._data)){this._featureCollection.features=[];for(var t=this._data.length,i=this._rows||[],r=this._fields||[],o=this._metrics||[],a=function(t){var a=e._data[t],s=B(),l={id:s,type:"Feature",geometry:{type:"Point",coordinates:"row"===e._queryType?[parseFloat(a.group[0]),parseFloat(a.group[1])]:[parseFloat(a[e._lngField]),parseFloat(a[e._latField])]},layer:{id:e._config.name+"-"+s},mainLayerId:e._mainLayerId,properties:{}};if("row"===e._queryType)l.properties.__cf_row_values__=i.slice(2).map(function(e,t){return n({},e,{value:a.group[t+2]})}),l.properties.__cf_metric_values__=o.map(function(e,t){var i=E(e),r=V.get(a,i);return n({},e,{value:r})});else if("field"===e._queryType){var c=V.isArray(e._location)?e._location.length:1;l.properties.__cf_field_values__=r.slice(c).map(function(e,t){return n({},e,{value:a[e.name]})})}l.properties.__cf_data__=a,e._featureCollection.features.push(l)},s=0;s<t;s++)a(s);this._featureCollection.features=this._getClusteredFeatures(),this._aktive._skip3DLayersRemoval||this._mapVisualization._removeCustom3dLayers(),this._aktive._skip3DLayersRemoval=!1;var l=this._getCountLabel();this._featureCollection.features.forEach(function(t){e._add3dCustomLayer(t,l)}),this._addSource(),this._addEventListeners()}O(this._mapVisualization),(0,u.renderDrawControl)(this._mapVisualization)}},{key:"_getCountLabel",value:function(){if(V.has(this._aktive,"_providers[0].metadata")){var e=this._aktive._providers[0].metadata[this._config.source];return V.get(e,"count.label")}return null}},{key:"_getClusteredFeatures",value:function(){var e=new l.default({maxZoom:24}).load(this._featureCollection.features),t=this._map.getBounds(),i=[t._sw.lng,t._sw.lat,t._ne.lng,t._ne.lat],r=e.getClusters(i,this._map.getZoom()),n=r.length;if(n>0){var o=V.uniq(r.map(function(e){return e.properties.point_count})).filter(function(e){return e});V.isEmpty(o)&&o.push(1);for(var a=0;a<n;a++){var s=r[a],c=s.properties,u=c.cluster_id,p=c.point_count;if(s.id=B(),u&&p){var d=p<1e3?p:N.formatNumericValue(p,{type:"INTEGER"},!0),h=e.getLeaves(u,"Infinity");Object.assign(s,{layer:{id:this._config.name+"-"+s.id},mainLayerId:this._mainLayerId}),Object.assign(s.properties,{point_count_formatted:d,__cf_cluster_leaves_features__:h})}else s.properties.point_count=1}return r}return this._featureCollection.features}},{key:"_addSource",value:function(){var e=this._map.getSource(this._sourceId);e?e.setData(this._featureCollection):this._map.addSource(this._sourceId,{type:"geojson",data:this._featureCollection,generateId:!0})}},{key:"_removeSource",value:function(){this._map.getSource(this._sourceId)&&this._map.removeSource(this._sourceId)}},{key:"_add3dCustomLayer",value:function(e,t){var i=e.geometry.coordinates,r=e.layer.id,n=this._map.getLayer(r),o=this._mapVisualization._custom3dLayers.find(function(e){return e.location[0]===i[0]&&e.location[1]===i[1]});if(!n&&!o){var a={layerName:this._config.name,location:i,modelConfig:this._config.model,id:r,featureItem:e},l=new s.default(a,this._gltfModels,this._label3DRenderer,this._mapVisualization._element,t);this._map.addLayer(l),this._mapVisualization._custom3dLayers.push(l),this._mapVisualization._setVisibilityZoomRange(r,this._config)}}},{key:"_removeLayer",value:function(){var e=this;this._map.getLayer(this._layerId)&&this._map.removeLayer(this._layerId),V.remove(this._mapVisualization._tooltipLayerIds,function(t){return t===e._layerId}),this._mapVisualization._removeCustom3dLayers()}},{key:"_isDrawingModeInProcess",value:function(){return this._mapVisualization._drawShapeControl&&"simple_select"!==this._mapVisualization._drawShapeControl.getMode()}},{key:"_skipMouseEvents",value:function(){return V.isEmpty(this)||this._isDrawingModeInProcess()}},{key:"_skipMouseEventsAndClick",value:function(){return V.isEmpty(this)||this._isDrawingModeInProcess()||!this._useClickEvent}},{key:"_handleMouseMove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._skipMouseEvents()){this._map.getCanvas().style.cursor="pointer";var i=!1,n=this._map.getLayer(V.get(t,"layer.id"));if(n){var o=n.maxzoom,a=n.minzoom,s=this._map.getZoom();i=a<=s&&s<=o}if(t&&this._mainLayerId===t.mainLayerId&&i){this._mapVisualization.tooltip3D=!0,this._popup&&this._popup.remove();var l=V.isArray(this._location)?this._location.length:1,c="row"===this._queryType?this._rows[2]:this._fields[l],u=V.get(this._config,"properties.options.name",c.label),p=V.get(t,"row"===this._queryType?'properties["__cf_row_values__"]':'properties["__cf_field_values__"]',[]),d=p.find(function(e){return e.name===c.name}),h=N.getBoolValue(V.get(this._config,"properties.options.showLocation",!0)),f='<div style="padding: 5px;">',_=V.get(t,"properties.cluster",!1)?"#CCC":"#034e7b",m=V.get(this._config,"properties.tooltip.color");if(m&&"function"==typeof m)_=m(V.get(t,"properties.__cf_data__",{}))||_;else m&&"string"==typeof m&&(_=m||_);var g=V.get(this._config,"properties.tooltip.content");if(g&&"function"==typeof g){var y=V.get(t,"properties.__cf_data__",{});f+=g(y)||"",f+="</div>",this._popup=P(this._mapVisualization,"none",_),this._popup.setLngLat(e.lngLat).setHTML(f).addTo(this._map),F(e,this._popup)}else if(!V.get(t,"properties.cluster",!1)){f+='<span style="white-space: nowrap;display: table;"><b>'+u+":</b> "+d.value+'</span>\n            <div style="border-bottom:1px solid #CCC; margin-top: 5px; margin-bottom: 5px"></div>\n            ',h&&(f+='<span style="white-space: nowrap;display: table;"><b>Position:</b> '+t.geometry.coordinates.join(", ")+"</span>"),p.filter(function(e){return e.name!==d.name}).forEach(function(e){f+='<span style="white-space: nowrap;display: table;">\n                            <b>'+e.label+":</b> "+N.formatMetricValue(e.value,e)+"\n                        </span>"}),V.get(t,'properties["__cf_metric_values__"]',[]).forEach(function(e){var t=e.hideFunction||!e.func?e.label:e.label+" ("+e.func+")";f+='<span style="white-space: nowrap;display: table;">\n                            <b>'+t+":</b> "+N.formatMetricValue(e.value,e)+"\n                        </span>"}),f+="</div>",this._popup=P(this._mapVisualization,"none",_),this._popup.setLngLat(e.lngLat).setHTML(f).addTo(this._map),F(e,this._popup),e.aktive=this._aktive;var v=V.get(t.properties,"__cf_data__");e.data="object"===(void 0===v?"undefined":r(v))?v:JSON.parse(V.get(t.properties,"__cf_data__")),this._mapVisualization._onChartMouseMove(e)}}else this._popup&&this._popup.remove(),this._mapVisualization.tooltip3D=!1,this._map.getCanvas().style.cursor="grab"}}},{key:"_handleMouseClick",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._skipMouseEvents()&&V.get(i,"properties.cluster",!1)){var r=V.get(i,'properties["__cf_cluster_leaves_features__"]',[]).map(function(e){var i=V.get(e,'properties["__cf_row_values__"]',[]),r=V.get(e,'properties["__cf_metric_values__"]',[]);if(i.length>0){var n={};return t._rows.slice(0,2).forEach(function(t,i){n[t.name]=e.properties.__cf_data__.group[i]}),i.forEach(function(e){n[e.name]=e.value}),r.forEach(function(e){e.func?n[e.name+" ("+e.func+")"]=e.value:n[e.name]=e.value}),{_data:n}}return{_data:e.properties.__cf_data__}}),o=this._fields||[];"row"===this._queryType&&(o=[].concat(h(this._rows),h(this._metrics.map(function(e){var t=e.func?e.name+" ("+e.func+")":e.name,i=e.func?e.label+" ("+e.func+")":e.label;return n({},e,{label:i,name:t})})))),N.getBoolValue(V.get(this._config,"properties.options.showLocation",!0))||(o=o.filter(function(e){return e.name!==t._location}));var a=V.get(this._config,"properties.tooltipTable");(0,c.renderScrollableTooltip)(e.originalEvent,r,o,!0,null,this._mapVisualization,a&&!V.isEmpty(a)?a:null)}}},{key:"_handleRayCastMoveEvent",value:function(e){if(0!==this._mapVisualization._custom3dLayers.length){var t=this._mapVisualization._custom3dLayers.find(function(t){return t.rayCast(e)});t?this._handleMouseMove(e,t.featureItem):this._handleMouseMove(e,null)}}},{key:"_handleRayCastClickEvent",value:function(e){if(0!==this._mapVisualization._custom3dLayers.length){var t=this._mapVisualization._custom3dLayers.find(function(t){return t.rayCast(e)});t?this._handleMouseClick(e,t.featureItem):this._handleMouseClick(e,null)}}},{key:"_removeEventListeners",value:function(){this._map.off("mousemove",this._handleRayCastMoveEvent),this._map.off("click",this._handleRayCastClickEvent),this._map.checkAndRemoveLayerDelegatedListeners("mousemove",this._layerId),this._map.checkAndRemoveLayerDelegatedListeners("click",this._layerId)}},{key:"_addEventListeners",value:function(){this._map.off("mousemove",this._handleRayCastMoveEvent),this._map.on("mousemove",this._handleRayCastMoveEvent),this._map.off("click",this._handleRayCastClickEvent),this._map.on("click",this._handleRayCastClickEvent)}},{key:"data",value:function(e){return this._data=e,this._isCustomData=!0,this._rows=V.get(this._config,"properties.rows"),this._fields=V.get(this._config,"properties.fields"),this._metrics=V.get(this._config,"properties.options.metrics"),this}},{key:"addToMap",value:function(){var e=this;return new Promise(function(){var t=d(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{e._isCustomData?(e._processData(),e._addEventListeners(),i(e)):(e._configureAktive(),v(e._config,e._map.getZoom())?e._aktive.execute().then(function(){e._addEventListeners(),i(e)}).catch(function(e){return r(e)}):(e._addEventListeners(),i(e)))}catch(e){r(e)}case 1:case"end":return t.stop()}},t,e)}));return function(e,i){return t.apply(this,arguments)}}())}},{key:"remove",value:function(){var e=this;return new Promise(function(){var t=d(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{e._removeEventListeners(),e._removeLayer(),e._removeSource(),delete e._mapVisualization._renderedLayers[e._config.name],V.each(V.keys(e),function(t){return delete e[t]}),i(!0)}catch(e){r(e)}case 1:case"end":return t.stop()}},t,e)}));return function(e,i){return t.apply(this,arguments)}}())}}]),e}()}).call(t,i(1))},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),n=i(0);var o=(0,n.getToolkit)().getDependency("lodash"),a="browser"===(0,n.getEnvironment)()?window:e,s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments[2],n=arguments[3],a=arguments[4];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var s=t.location,l=t.id,c=t.featureItem,u=t.layerName;this.vizId=n,this.layerName=u,this.type="custom",this.renderingMode="3d",this.location=s,this.id=l,this.modelConfig=t.modelConfig,this.featureItem=c,this.data={fields:c.properties.__cf_field_values__||[],rows:c.properties.__cf_row_values__||[],metrics:c.properties.__cf_metric_values__||[]},this.scale=this._buildScale(),this.gltfUrl=this._buildUrl(),this.rotation=this._buildRotation(),this.light=this._buildLight(),this.models=i,this.isCluster=o.get(c,"properties.cluster",!1),this.isCluster&&(this.labelConfig=this._buildLabelConfig(a),this.labelRenderer=r)}return r(e,[{key:"_buildLabelConfig",value:function(e){var t=e||"Items",i=o.get(this.featureItem,'properties["__cf_cluster_leaves_features__"]',[]),r=this.modelConfig.clusterLabel||{};return{text:i.length+" "+(r.label||t),color:r.color||"#ffffff",textBorderColor:r.textBorderColor||"#000000"}}},{key:"_buildLight",value:function(){var e=this.modelConfig.light;if(e&&"function"==typeof e)try{return e(this.data)}catch(e){return console.error("Error in 'light' callback: ",e),{color:"#ffffff",intensity:1}}return{color:o.get(e,"color","#ffffff"),intensity:o.get(e,"intensity",1)}}},{key:"_getRotationValue",value:function(e){if(o.isObject(e)){var t=this.data.metrics.find(function(t){return t.name===e._name&&t.func===e._func}),i=this.data.fields.find(function(t){return t.name===e._name}),r=t?t.value:0,n=i?i.value:0;return r||n}return e}},{key:"_getAngles",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"degrees";return"degrees"!==t&&t?"radians"===t?(0,n.validateNum)(e,0):0:(0,n.degreesToRadians)((0,n.validateNum)(e,0))}},{key:"_buildRotation",value:function(){var e=this.modelConfig.rotation||{};if(e&&"function"==typeof e)try{var t=e(this.data);return{x:this._getAngles(t.x,t.format),y:this._getAngles(t.y,t.format),z:this._getAngles(t.z,t.format)}}catch(e){return console.error("Error in 'rotation' callback: ",e),{x:0,y:0,z:0}}return{x:this._getAngles(this._getRotationValue(e.x),e.format),y:this._getAngles(this._getRotationValue(e.y),e.format),z:this._getAngles(this._getRotationValue(e.z),e.format)}}},{key:"_buildScale",value:function(){var e=this.modelConfig.scale;if(e&&"function"==typeof e)try{var t=e(this.data);return t||1}catch(e){return console.error("Error in 'scale' callback: ",e),1}return(0,n.validateNum)(e,1)}},{key:"_buildUrl",value:function(){if(this.modelConfig.urlBuilder&&"function"==typeof this.modelConfig.urlBuilder)try{var e=this.modelConfig.urlBuilder(this.data);return e&&"string"==typeof e?e:this.modelConfig.gltfUrl}catch(e){return console.error("Error in 'urlBuilder': ",e),this.modelConfig.gltfUrl}return this.modelConfig.gltfUrl}},{key:"onAdd",value:function(e,t){var i=this;this.camera=new a.THREE.PerspectiveCamera(28,window.innerWidth/window.innerHeight,.1,1e6),this.center=a.maplibregl.MercatorCoordinate.fromLngLat(this.location,0);var r=this.center,n=r.x,o=r.y,s=r.z,l=this.center.meterInMercatorCoordinateUnits(),c=(new a.THREE.Matrix4).makeScale(l,l,-l),u=(new a.THREE.Matrix4).multiplyMatrices((new a.THREE.Matrix4).makeRotationX(-.5*Math.PI),(new a.THREE.Matrix4).makeRotationY(Math.PI));this.cameraTransform=(new a.THREE.Matrix4).multiplyMatrices(c,u).setPosition(n,o,s),this.scene=this.makeScene(),this.map=e,this.renderer=new a.THREE.WebGLRenderer({canvas:e.getCanvas(),context:t,antialias:!0}),this.renderer.autoClear=!1,this.raycaster=new a.THREE.Raycaster,this.raycaster.near=-1,this.raycaster.far=1e6;var p=this.models.find(function(e){return e.url===i.gltfUrl});p?this.addModelToScene(p.model.clone()):(new a.THREE.GLTFLoader).load(this.gltfUrl,function(e){var t=this,i=this.models.find(function(e){return e.url===t.gltfUrl});i?this.addModelToScene(i.model.clone()):(this.models.push({url:this.gltfUrl,model:e.scene}),this.addModelToScene(e.scene.clone()))}.bind(this))}},{key:"addModelToScene",value:function(e){var t=this.rotation,i=t.x,r=t.y,n=t.z,o=(new a.THREE.Box3).setFromObject(e).getSize(new a.THREE.Vector3).y;if(e.rotation.set(i,r,n),e.scale.set(this.scale,this.scale,this.scale),this.isCluster){var s=document.createElement("div");s.className="cf-3d-model-label cf-3d-label-element "+this.vizId.replace(/\s/g,""),s.id=this.id,s.textContent=this.labelConfig.text,s.style.marginTop="0",s.style.color=this.labelConfig.color,s.style.textShadow="-1px 0px 0px "+this.labelConfig.textBorderColor+", 1px 0px 0px "+this.labelConfig.textBorderColor+", 0px -1px 0px "+this.labelConfig.textBorderColor+", 0px 1px 0px "+this.labelConfig.textBorderColor;var l=new a.THREE.CSS2DObject(s);l.position.set(0,o,0),e.add(l),l.layers.set(0)}this.scene.add(e),this.map.triggerRepaint()}},{key:"makeScene",value:function(){var e=new a.THREE.Scene,t=new a.THREE.HemisphereLight(this.light.color,this.light.color,this.light.intensity),i=(0,n.hexToHsl)(this.light.color);t.color.setHSL(i.h,i.s,.6),t.groundColor.setHSL(i.h,i.s,.75),t.position.set(0,60,0),e.add(t);var r=new a.THREE.DirectionalLight(this.light.color,this.light.intensity);return r.color.setHSL(i.h,i.s,.95),r.position.set(-1,60,1),e.add(r),e}},{key:"render",value:function(e,t){if(this.camera.projectionMatrix=(new a.THREE.Matrix4).fromArray(t).multiply(this.cameraTransform),this.renderer.state.reset(),this.renderer.render(this.scene,this.camera),this.isCluster&&this.labelRenderer.render(this.scene,this.camera),this.labelRenderer){var i=document.getElementById(this.vizId);this.labelRenderer.setSize(i.offsetWidth,i.offsetHeight)}}},{key:"rayCast",value:function(e){var t=new a.THREE.Vector2;t.x=e.point.x/this.map.transform.width*2-1,t.y=1-e.point.y/this.map.transform.height*2;var i=(new a.THREE.Matrix4).copy(this.camera.projectionMatrix).invert(),r=(new a.THREE.Vector3).applyMatrix4(i),n=new a.THREE.Vector3(t.x,t.y,1).applyMatrix4(i).clone().sub(r).normalize();return this.raycaster.set(r,n),this.raycaster.intersectObjects(this.scene.children,!0).length>0}}]),e}();t.default=s}).call(t,i(1))},function(e,t,i){"use strict";var r=i(39),n=i(40),o=i(41);const a=e=>e[0],s=e=>e[1];t.a=class{constructor(e,t=a,i=s,n=64,o=Float64Array){this.nodeSize=n,this.points=e;const l=e.length<65536?Uint16Array:Uint32Array,c=this.ids=new l(e.length),u=this.coords=new o(2*e.length);for(let r=0;r<e.length;r++)c[r]=r,u[2*r]=t(e[r]),u[2*r+1]=i(e[r]);Object(r.a)(c,u,n,0,c.length-1,0)}range(e,t,i,r){return Object(n.a)(this.ids,this.coords,e,t,i,r,this.nodeSize)}within(e,t,i){return Object(o.a)(this.ids,this.coords,e,t,i,this.nodeSize)}}},function(e,t,i){"use strict";function r(e,t,i,r){n(e,i,r),n(t,2*i,2*r),n(t,2*i+1,2*r+1)}function n(e,t,i){const r=e[t];e[t]=e[i],e[i]=r}t.a=function e(t,i,n,o,a,s){if(a-o<=n)return;const l=o+a>>1;!function e(t,i,n,o,a,s){for(;a>o;){if(a-o>600){const r=a-o+1,l=n-o+1,c=Math.log(r),u=.5*Math.exp(2*c/3),p=.5*Math.sqrt(c*u*(r-u)/r)*(l-r/2<0?-1:1),d=Math.max(o,Math.floor(n-l*u/r+p)),h=Math.min(a,Math.floor(n+(r-l)*u/r+p));e(t,i,n,d,h,s)}const l=i[2*n+s];let c=o,u=a;for(r(t,i,o,n),i[2*a+s]>l&&r(t,i,o,a);c<u;){for(r(t,i,c,u),c++,u--;i[2*c+s]<l;)c++;for(;i[2*u+s]>l;)u--}i[2*o+s]===l?r(t,i,o,u):r(t,i,++u,a),u<=n&&(o=u+1),n<=u&&(a=u-1)}}(t,i,l,o,a,s%2);e(t,i,n,o,l-1,s+1);e(t,i,n,l+1,a,s+1)}},function(e,t,i){"use strict";t.a=function(e,t,i,r,n,o,a){const s=[0,e.length-1,0],l=[];let c,u;for(;s.length;){const p=s.pop(),d=s.pop(),h=s.pop();if(d-h<=a){for(let a=h;a<=d;a++)c=t[2*a],u=t[2*a+1],c>=i&&c<=n&&u>=r&&u<=o&&l.push(e[a]);continue}const f=Math.floor((h+d)/2);c=t[2*f],u=t[2*f+1],c>=i&&c<=n&&u>=r&&u<=o&&l.push(e[f]);const _=(p+1)%2;(0===p?i<=c:r<=u)&&(s.push(h),s.push(f-1),s.push(_)),(0===p?n>=c:o>=u)&&(s.push(f+1),s.push(d),s.push(_))}return l}},function(e,t,i){"use strict";function r(e,t,i,r){const n=e-i,o=t-r;return n*n+o*o}t.a=function(e,t,i,n,o,a){const s=[0,e.length-1,0],l=[],c=o*o;for(;s.length;){const u=s.pop(),p=s.pop(),d=s.pop();if(p-d<=a){for(let o=d;o<=p;o++)r(t[2*o],t[2*o+1],i,n)<=c&&l.push(e[o]);continue}const h=Math.floor((d+p)/2),f=t[2*h],_=t[2*h+1];r(f,_,i,n)<=c&&l.push(e[h]);const m=(u+1)%2;(0===u?i-o<=f:n-o<=_)&&(s.push(d),s.push(h-1),s.push(m)),(0===u?i+o>=f:n+o>=_)&&(s.push(h+1),s.push(p),s.push(m))}return l}},function(e,t,i){"use strict";(function(t){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function r(n,o){try{var a=t[n](o),s=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}var a=i(0),s=a.getToolkit,l=a.getAktiveAql,c=a.createLayerAktive,u=a.updateLayerWithDrillConf,p=a.getLayerVisibility,d=a.isLayerVisible,h=a.renderLegend,f=i(2),_=f.error,m=f.sanitize,g=f.getRows,y=f.getJsonRows,v=f.getMetrics,A=f.getMetricPath,b=f.getFilters,w=f.splitData,C=f.createMapLibrePopupInstance,L=f.setPopupPosition,x=f.buildColorExpression,k=f.getColor,I=f.getShapeColor,E=f.getFeatureCollection,M=f.getRandomInt,S=f.addShapeSource,P=f.removeShapeSource,F=f.addShapeLayer,D=f.removeShapeLayer,B=f.getColorFromRange,z=f.removeFeatureState,T=f.getCountField,O=f.shouldProcessData,R=i(3).renderLayersControl,N=i(4).renderDrawControl,V=s(),G=V.getDependency("utils"),j=G.getEnvironment(),Q=V.getDependency("lodash"),H=i(7).default;e.exports=function(){function e(i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mapVisualization=i,this._map=i._map,this._config=r,this._type=r.type,this._sourceIds={},this._layerIds={},this._fillLayerIds=[],this._fillLayerColors={},this._sanitizedName=m(this._config.name),this._featureCollections={},this._isCustomData=!1,this._propsConfig={},this._propPrefix="__cf_data_field_",this._useClickEvent=!0,this._hoveredFeatureIdsMap=new Map,this._window="browser"===j?window:t,this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseLeave=this._handleMouseLeave.bind(this),this._handleMouseClick=this._handleMouseClick.bind(this),this._init()}return n(e,[{key:"_init",value:function(){this._visibility=p(this._config)}},{key:"_configureAktive",value:function(){var e=this;if(this._config.provider&&this._config.source){this._aktive=c(this._mapVisualization._element,this._config);var t=l(this._aktive),i=b(Q.get(this._config,"properties.filters",[])),r=b(Q.get(this._config,"properties.staticFilters",[])),n=b(Q.get(this._config,"properties.clientFilters",[])),a=Q.get(this._config,"properties.textFilter",""),s=Q.get(this._config,"properties.limit");this._rows=g(Q.get(this._config,"properties.options.rows")),this._metrics=v(Q.get(this._config,"properties.options.metrics")),Q.isArray(this._rows)?(this._aktive.rows(this._rows),Q.set(t,"currentDef.rows",this._rows)):(t._rows=[],Q.set(t,"currentDef.rows",[])),Q.set(t,"currentDef.columns",[]),Q.isArray(this._metrics)?this._aktive.metrics(this._metrics):t._metrics=[],s&&this._aktive.limit(s);var d=k(this._config,["#a50026","#d73027","#f46d43","#fdae61","#fee090"]);Q.set(this._config,"properties.options.color",d),this._aktive._options.set("color",d),this._aktive.staticFilters(r),this._aktive.clientFilters(n),this._aktive.filters(i),this._aktive.textfilter(a),this._aktive._layer=this._config,this._aktive._isAktiveLayer=!0,this._aktive._isShapeLayer=!0,this._aktive._parentAktive=this._mapVisualization._aktive,this._aktive.updateWithClientFilter=this._updateWithClientFilter(this),this._aktive._updateLayerWithDrillConf=u(this._aktive),this._mapVisualization._storeLayerAktive(this._aktive),this._aktive.on("execute:start",function(t){e._mapVisualization._runningAktives[e._aktive._elementId]||(e._mapVisualization._runningAktives[e._aktive._elementId]=e._aktive,e._mapVisualization.dispatch({name:"geo:layers-execution-start",element:e._mapVisualization._element}))}),this._aktive.on("execute:stop",function(){var t=o(regeneratorRuntime.mark(function t(i){var r,n,o,a,s;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e._mapVisualization._storeLayerAktive(e._aktive),i.error){t.next=23;break}if(r=w(i.data),!O(e,r)){t.next=21;break}return e._aktive._data=r,e._data=r,n=e._aktive.get().rows,o=e._aktive.get("config").metrics,a=e._aktive.get("config").filters,s=e._aktive.get("config").clientFilters,e._rows=n,e._metrics=o,e._clientFilters=s,Q.set(e._config,"properties.options.rows",n),Q.set(e._config,"properties.options.metrics",o),Q.set(e._config,"properties.filters",a),Q.set(e._config,"properties.clientFilters",s),t.next=19,e._processData();case 19:t.next=23;break;case 21:e._visibility=p(e._config),Q.each(e._layerIds,function(t){Q.isArray(t)&&Q.each(t,function(t){e._map.setLayoutProperty(t,"visibility",e._visibility)})});case 23:delete e._mapVisualization._runningAktives[e._aktive._elementId],Q.isEmpty(e._mapVisualization._runningAktives)&&e._mapVisualization.dispatch({name:"geo:layers-execution-stop",element:e._mapVisualization._element});case 25:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}())}else _("Please specify a provider and a source for the shape layer "+this._config.name)}},{key:"_processShapeUrl",value:function(e){var t=e.shapeUrl,i=e.prevShapeUrl,r=e.prevShapeFeatureProperty,n=e.prevLayerLabel,o=Q.get(this._config,"properties.filters",[]);if(i){var a=o.map(function(e){return V.Filter().fromJSON(e)}).find(function(e){return e.getPath()===n||e.getLabel()===n});if(a){var s=this._window._cachedShapes.get(i).features.find(function(e){return e.properties[r]===a.getValue()[0]});s&&Q.each(s.properties,function(e,i){t=t.replace("{"+i+"}",e)})}}return t}},{key:"_processData",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,i,r,n,o,a,s,l,c,u,d,f,_,m,g,v,b,w,C,L,k,B,z,O,j,U,Y,Z,W,J,q,K=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(this._useClickEvent=!0,this._mapVisualization._removeAllPopups(),this._visibility=p(this._config),t=Q.get(this._config,"properties.shapes",[]),i=Q.get(this._config,"shapesToRemove",[]),r=void 0,n=void 0,o=void 0,a=!0,s=!1,l=void 0,e.prev=9,c=i[Symbol.iterator]();!(a=(u=c.next()).done);a=!0)d=u.value,D(this,this._sanitizedName+"__cf__"+d.name),P(this,this._sanitizedName+"__cf__"+d.name);e.next=17;break;case 13:e.prev=13,e.t0=e.catch(9),s=!0,l=e.t0;case 17:e.prev=17,e.prev=18,!a&&c.return&&c.return();case 20:if(e.prev=20,!s){e.next=23;break}throw l;case 23:return e.finish(20);case 24:return e.finish(17);case 25:delete this._config.shapesToRemove,f=0;case 27:if(!(f<t.length)){e.next=79;break}if(_=f===t.length-1,m=t[f],g=Q.extend(Q.cloneDeep(this._config.properties.options),m),v=Q.get(g,"featureProperty","name"),b=Q.get(g,"name",this._config.name),_||(delete g.rows,delete g.metrics),g.dataField||(w=y(g.rows),g.dataField=Q.get(w,"[0]",{label:b,name:b,type:"ATTRIBUTE"})),C=I(g),L=g.dataField.label||g.dataField.name,k=this._sanitizedName+"__cf__"+L,B=k+"_source",z=m.url,r&&(z=this._processShapeUrl({shapeUrl:z,prevShapeUrl:r,prevShapeFeatureProperty:n,prevLayerLabel:o})),r=z,n=v,o=L,O=this._window._cachedShapes.get(z)){e.next=49;break}return e.next=48,E(z);case 48:O=e.sent;case 49:if(j=Q.cloneDeep(O),_){e.next=75;break}for(U=!0,Y=!1,Z=void 0,e.prev=54,W=j.features[Symbol.iterator]();!(U=(J=W.next()).done);U=!0)(q=J.value).id=M(),q.properties.__cf_source_id__=B,q.properties.__cf_feature_property__=v,q.properties.__cf_label__=L,q.properties.__cf_color__=C,q.properties.__cf_data__={dataField:g.dataField,group:[Q.get(q,"properties."+v)]},q.properties.__cf_isvisibleduetojoin__=!0;e.next=62;break;case 58:e.prev=58,e.t1=e.catch(54),Y=!0,Z=e.t1;case 62:e.prev=62,e.prev=63,!U&&W.return&&W.return();case 65:if(e.prev=65,!Y){e.next=68;break}throw Z;case 68:return e.finish(65);case 69:return e.finish(62);case 70:C.highlightColors.fillColor||(C.highlightColors.fillColor=C.noHighlightColors.fillColor),S(this,k,B,j),F(this,k,B,C,g),e.next=76;break;case 75:!function(){var e=K._metrics[0];K._config.properties.options.color._metric||K._config.properties.options.color.metric(V.Metric().fromJSON(e));var t=A(K._config.properties.options.color._metric);K._min=Q.get(K._config,"properties.options.min"),K._max=Q.get(K._config,"properties.options.max");var i=Q.isNumber(K._min)&&Q.isNumber(K._max),r=j.features,n=r.length,o=K._rows||[],a=K._metrics||[],s=Q.get(K._config,"properties.options.color"),l=s;s._range||s._autoRange||(l=V.Color().palette(s._palette).metric(V.Metric().fromJSON(s._metric)).autoRange({dynamic:!0})),l._metric&&!a.find(function(e){return e.name===l._metric.name})&&a.push(l._metric);for(var c=function(e){var n=r[e],s=Q.get(n,"properties."+v),c=K._data.find(function(e){return e.group[0]===s});if(c){n.properties.__cf_isvisibleduetojoin__=!0,Q.set(c,"dataField",g.dataField);for(var u=1;u<o.length;u++){var p=o[u];n.properties[""+K._propPrefix+p.name]=c.group[u],K._propsConfig[""+K._propPrefix+p.name]=p}for(var d=0;d<a.length;d++){var h=a[d],f=A(h),_=Q.get(c,f),m=h.func?h.name+"_"+h.func:h.name;n.properties[""+K._propPrefix+m]=_,K._propsConfig[""+K._propPrefix+m]="count"!==h.name?h:T(K._aktive,h)}if(Q.has(c,"current.count")&&n.properties.count&&(n.properties.count=c.current.count,K._propsConfig[K._propPrefix+"count"]=T(K._aktive)),!i){var y=Q.get(c,t);K._min||(K._min=y),K._max||(K._max=y),(y<K._min||y>K._max)&&(K._min=Math.min(y,K._min),K._max=Math.max(y,K._max))}}else n.properties.__cf_isvisibleduetojoin__=!1,c={dataField:g.dataField,group:[s]};n.id=M(),n.properties.__cf_source_id__=B,n.properties.__cf_feature_property__=v,n.properties.__cf_label__=L,n.properties.__cf_color__=C,n.properties.__cf_color_definition__=l,n.properties.__cf_data__=c,n.properties.__cf_allow_multi_select__=G.getBoolValue(g.allowMultiSelect)},u=0;u<n;u++)c(u);if(K._min===K._max&&(K._min=0,0===K._max&&(K._max=100)),Q.set(K._config,"properties.min",K._min),Q.set(K._config,"properties.max",K._max),v){var p=C.noHighlightColors.fillColor,d=x(v,K._propPrefix,l,j,p);C.noHighlightColors.fillColor=d,C.highlightColors.fillColor||(C.highlightColors.fillColor=d)}S(K,k,B,j),F(K,k,B,C,g);var h=K._mapVisualization._getShapesFitBoundsTrue();if(g.fitBounds&&1===h.length)K._map.fitBounds(H(j),{linear:!0,duration:g.animationDuration?1e3*g.animationDuration:1200});else if(K._config._checkZoomCenterDifferent){var f=K._mapVisualization._getDifferentCenter();f&&K._map.flyTo({center:f.center,zoom:f.zoom,speed:g.animationDuration||1.2})}delete K._config._checkZoomCenterDifferent}();case 76:f++,e.next=27;break;case 79:(this._clientFilters||[]).forEach(function(e){var t=V.Filter().fromJSON(e);t.getPath()===Q.get(K._rows,"[0].name")&&K._aktive.updateWithClientFilter(t)}),h(this._mapVisualization),R(this._mapVisualization),N(this._mapVisualization);case 83:case"end":return e.stop()}},e,this,[[9,13,17,25],[18,,20,24],[54,58,62,70],[63,,65,69]])}));return function(){return e.apply(this,arguments)}}()},{key:"_updateWithClientFilter",value:function(e){var t=this;return function(i){if(i){e._aktive&&e._aktive.clientFilters(i);var r=i.getValue(),n=i.getLabel(),o=i._operation,a=t._sanitizedName+"__cf__"+n+"_fill_layer",s=t._fillLayerIds.find(function(e){return e===a});if(s){var l=t._fillLayerColors[s],c=l.highlightColors,u=l.noHighlightColors,p=l.clientFilteredOutColor,d=l.clientFilteredOutColorOpacity,h=l.featureProperty,f=l.opacityZoomLevels,_="IN"===o?"==":"!=",m=["case",["boolean",["feature-state","hover"],!1],u.fillColor,["case",[_,["index-of",["get",h],["literal",r]],-1],p,u.fillColor]];if(t._map.setPaintProperty(s,"fill-color",m),!f){var g=["case",[_,["index-of",["get",h],["literal",r]],-1],["case",["boolean",["feature-state","hover"],!1],c.fillOpacity,d],["case",["boolean",["feature-state","hover"],!1],c.fillOpacity,u.fillOpacity]];t._map.setPaintProperty(s,"fill-opacity",g)}}}else{e._aktive&&e._aktive.clientFilters([]);var y=!0,v=!1,A=void 0;try{for(var b,w=t._fillLayerIds[Symbol.iterator]();!(y=(b=w.next()).done);y=!0){var C=b.value,L=t._fillLayerColors[C],x=L.highlightColors,k=L.noHighlightColors;t._map.setPaintProperty(C,"fill-color",k.fillColor),t._map.setPaintProperty(C,"fill-opacity",["case",["boolean",["feature-state","hover"],!1],x.fillOpacity,k.fillOpacity])}}catch(e){v=!0,A=e}finally{try{!y&&w.return&&w.return()}finally{if(v)throw A}}}}}},{key:"_processSelection",value:function(e,t){var i=Q.get(this._config,"properties.filters",[]).map(function(e){return V.Filter().fromJSON(e)}).filter(function(t){return t.getPath()===Q.get(e.data,"dataField.name")||t.getLabel()===Q.get(e.data,"dataField.name")}).map(function(e){return e.getValue()})[0]||[],r=Q.get(l(this._aktive),"_clientFilters",null).map(function(e){return V.Filter().fromJSON(e)}).map(function(e){return e.getValue()})[0]||[];Q.forEach(r,function(e){i.includes(e)||i.push(e)});var n=Q.get(e,"data.group[0]");if(i.includes(n)){if(i.length>0&&!0===t){var o=i;o.includes(n)&&(i=o.filter(function(e){return e!==n})),Q.set(e,"data.group",i)}this._mapVisualization._onChartClick(e)}else!0===t&&(i.push(n),Q.set(e,"data.group",i)),this._mapVisualization._onChartClick(e)}},{key:"_getRenderedFeature",value:function(e){var t=this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds}),i=Q.get(t,"[0]");return i&&this._fillLayerIds.includes(i.layer.id)?i:null}},{key:"_isDrawingModeInProcess",value:function(){return this._mapVisualization._drawShapeControl&&"simple_select"!==this._mapVisualization._drawShapeControl.getMode()}},{key:"_skipMouseEvents",value:function(){return Q.isEmpty(this)||this._isDrawingModeInProcess()}},{key:"_skipMouseEventsAndClick",value:function(){return Q.isEmpty(this)||this._isDrawingModeInProcess()||!this._useClickEvent}},{key:"_handleMouseMove",value:function(e){var t=this;if(!this._skipMouseEvents()){this._map.getCanvas().style.cursor="pointer",z(this._map,this._hoveredFeatureIdsMap);var i=this._getRenderedFeature(e);if(i){this._popup&&this._popup.remove();var n=Q.get(i.properties,"__cf_feature_property__"),o=Q.get(this._config,"properties.options.name",Q.get(i.properties,"__cf_label__")),a=Q.get(i.properties,"__cf_source_id__"),s='<div style="padding: 5px;">';s+='<span style="white-space: nowrap;display: table;"><b>'+o+":</b> "+Q.get(i.properties,n)+'</span>\n            <div style="border-bottom:1px solid #CCC; margin-top: 5px; margin-bottom: 5px"></div>\n            ',Q.each(i.properties,function(e,i){if(i!==n){var r=t._propsConfig[i];if(r){var o="Metric"===r.is?r.hideFunction?r.label:r.label+" ("+r.func+")":r.label;s+='<span style="white-space: nowrap;display: table;">\n                            <b>'+o+":</b> "+G.formatMetricValue(e,r)+"\n                        </span>"}}}),s+="</div>";var l=JSON.parse(Q.get(i.properties,"__cf_color__")),c=l.noHighlightColors.fillColor,u=Q.get(i.properties,"__cf_color_definition__");if(u&&n)if("string"==typeof(u=JSON.parse(u)))c=u;else if("object"===(void 0===u?"undefined":r(u))){var p=i.properties[n];if(u._match&&u._match[p])c=u._match[p];else if(u._metric&&u._range){var d=u._metric,h=""+this._propPrefix+(d.func?d.name+"_"+d.func:d.name),f=Q.get(i.properties,h),_=l.noHighlightColors.originalFillColor;c=u._range?B(u._range,f,_):c}}this._popup=C(this._mapVisualization,"none",c),this._popup.setLngLat(e.lngLat).setHTML(s).addTo(this._map),L(e,this._popup),this._map.setFeatureState({source:a,id:i.id},{hover:!0}),this._hoveredFeatureIdsMap.set(i.id,{hoveredFeatureId:i.id,hoveredSourceId:a}),this._lastHoveredFeatureId!==i.id&&(e.aktive=this._aktive,e.data=JSON.parse(Q.get(i.properties,"__cf_data__")),this._mapVisualization._onChartMouseMove(e)),this._lastHoveredFeatureId=i.id}else this._popup&&this._popup.remove(),delete this._lastHoveredFeatureId}}},{key:"_handleMouseLeave",value:function(e){if(!this._skipMouseEvents()){this._map.getCanvas().style.cursor="",z(this._map,this._hoveredFeatureIdsMap);var t=this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds}),i=Q.get(t,"[0]");i&&this._fillLayerIds.includes(i.layer.id)||(this._popup&&this._popup.remove(),delete this._popup,delete this._lastHoveredFeatureId,e.aktive=this._aktive,e.data={lngLat:e.lngLat},this._mapVisualization._onChartMouseLeave(e))}}},{key:"_handleMouseClick",value:function(e){var t=this;return function(i){if(!t._skipMouseEventsAndClick()){var r=t._getRenderedFeature(i);if(r&&r.layer.id===e){i.aktive=t._aktive,i.data=JSON.parse(Q.get(r.properties,"__cf_data__"));var n=Q.get(r.properties,"__cf_allow_multi_select__");t._processSelection(i,n)}}}}},{key:"_removeEventListeners",value:function(e){this._map.off("mousemove",e,this._handleMouseMove),this._map.off("mouseleave",e,this._handleMouseLeave),this._map.checkAndRemoveLayerDelegatedListeners("mousemove",e),this._map.checkAndRemoveLayerDelegatedListeners("mouseleave",e),this._map.checkAndRemoveLayerDelegatedListeners("click",e)}},{key:"_addEventListeners",value:function(e){this._removeEventListeners(e),Q.get(this._config,"properties.options.allowHover",!0)&&(this._map.on("mousemove",e,this._handleMouseMove),this._map.on("mouseleave",e,this._handleMouseLeave)),Q.get(this._config,"properties.options.allowClick",!0)&&!this._isCustomData&&this._map.on("click",e,this._handleMouseClick(e))}},{key:"data",value:function(e){return this._data=e,this._isCustomData=!0,this._rows=Q.get(this._config,"properties.options.rows"),this._metrics=Q.get(this._config,"properties.options.metrics"),this}},{key:"addToMap",value:function(){var e=this;return new Promise(function(){var t=o(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!e._isCustomData){t.next=7;break}return t.next=4,e._processData();case 4:i(e),t.next=9;break;case 7:e._configureAktive(),d(e._config,e._map.getZoom())?e._aktive.execute().then(function(){return i(e)}).catch(function(e){return r(e)}):i(e);case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),r(t.t0);case 14:case"end":return t.stop()}},t,e,[[0,11]])}));return function(e,i){return t.apply(this,arguments)}}())}},{key:"remove",value:function(){var e=this;return new Promise(function(){var t=o(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{Q.each(e._fillLayerIds,function(t){e._removeEventListeners(t)}),D(e),P(e),delete e._mapVisualization._renderedLayers[e._config.name],Q.each(Q.keys(e),function(t){return delete e[t]}),i(!0)}catch(e){r(e)}case 1:case"end":return t.stop()}},t,e)}));return function(e,i){return t.apply(this,arguments)}}())}}]),e}()}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function r(n,o){try{var a=t[n](o),s=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}var a=i(0),s=a.getToolkit,l=a.getLayerVisibility,c=i(2),u=c.sanitize,p=c.getJsonRows,d=c.getShapeColor,h=c.buildColorExpression,f=c.getColorFromRange,_=c.getFeatureCollection,m=c.getRandomInt,g=c.addShapeSource,y=c.removeShapeSource,v=c.addShapeLayer,A=c.removeShapeLayer,b=c.createMapLibrePopupInstance,w=c.setPopupPosition,C=c.removeFeatureState,L=i(3).renderLayersControl,x=i(4).renderDrawControl,k=s(),I=k.getDependency("utils"),E=I.getEnvironment(),M=k.getDependency("lodash"),S=i(7).default;e.exports=function(){function e(i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mapVisualization=i,this._map=i._map,this._config=r,this._type=r.type,this._sourceIds={},this._layerIds={},this._fillLayerIds=[],this._fillLayerColors={},this._sanitizedName=u(this._config.name),this._featureCollections={},this._shapes={map:{},keys:[]},this._hoveredFeatureIdsMap=new Map,this._window="browser"===E?window:t,this._handleMouseMove=this._handleMouseMove.bind(this),this._handleMouseLeave=this._handleMouseLeave.bind(this),this._init()}return n(e,[{key:"_init",value:function(){this._visibility=l(this._config)}},{key:"_processData",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,i,r,n,o,a,s,c,u,f,y,A,b,w,C,k,I,E,P,F,D,B,z,T;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this._mapVisualization._removeAllPopups(),this._visibility=l(this._config),t=M.get(this._config,"properties.shapes",[]),i=0;case 4:if(!(i<t.length)){e.next=34;break}return r=t[i],e.next=8,_(r.url);case 8:for(n=e.sent,o=M.cloneDeep(n),a=M.extend(M.cloneDeep(this._config.properties.options),r),s=a.rows,c=a.metrics,u=M.get(a,"featureProperty","name"),f=M.get(a,"name",u||this._config.name),a.dataField||(y=p(s),a.dataField=M.get(y,"[0]",{label:f,name:f,type:"ATTRIBUTE"})),A=d(a),b=this._sanitizedName+"__cf__"+f,w=b+"_source",C=M.cloneDeep(M.get(this._config,"properties.options.color")),k=o.features,I=k.length,E=a.dataField.label||a.dataField.name,P=function(e){var t=k[e],i={};t.id=m(),t.properties.__cf_source_id__=w,t.properties.__cf_feature_property__=u,t.properties.__cf_label__=E,t.properties.__cf_color__=A,t.properties.__cf_color_definition__=C,t.properties.__cf_data__={dataField:a.dataField,group:[M.get(t,"properties."+u)]},t.properties.__cf_isvisibleduetojoin__=!0,M.forEach(s,function(e,t){i[e.name]=e}),M.forEach(c,function(e){i[e.name]=e,t.properties[e.name]=Number(t.properties[e.name])}),t.properties.__cf_props_config__=i},F=0;F<I;F++)P(F);M.get(C,"_metric")&&u?(delete C._metric.func,D=A.noHighlightColors.fillColor,B=h(u,"",C,o,D),A.noHighlightColors.fillColor=B):"#CCC"===A.noHighlightColors.fillColor&&M.get(C,"_palette[0]")&&(A.noHighlightColors.fillColor=C._palette[0]),A.highlightColors.fillColor||(A.highlightColors.fillColor=A.noHighlightColors.fillColor),g(this,b,w,o),v(this,b,w,A,a),z=this._mapVisualization._getShapesFitBoundsTrue(),a.fitBounds&&1===z.length?this._map.fitBounds(S(o),{linear:!0,duration:a.animationDuration?1e3*a.animationDuration:1200}):(T=this._mapVisualization._getDifferentCenter())&&this._map.flyTo({center:T.center,zoom:T.zoom,speed:a.animationDuration||1.2});case 31:i++,e.next=4;break;case 34:L(this._mapVisualization),x(this._mapVisualization);case 36:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_isDrawingModeInProcess",value:function(){return this._mapVisualization._drawShapeControl&&"simple_select"!==this._mapVisualization._drawShapeControl.getMode()}},{key:"_skipMouseEvents",value:function(){return M.isEmpty(this)||this._isDrawingModeInProcess()}},{key:"_skipMouseEventsAndClick",value:function(){return M.isEmpty(this)||this._isDrawingModeInProcess()||!this._useClickEvent}},{key:"_handleMouseMove",value:function(e){if(!this._skipMouseEvents()){this._map.getCanvas().style.cursor="pointer",C(this._map,this._hoveredFeatureIdsMap);var t=this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds}),i=M.get(t,"[0]");if(i&&this._fillLayerIds.includes(i.layer.id)){this._popup&&this._popup.remove();var n=M.get(i.properties,"__cf_props_config__",{});"string"==typeof n&&(n=JSON.parse(n));var o=M.get(i.properties,"__cf_feature_property__"),a=M.get(this._config,"properties.options.name",M.get(i.properties,"__cf_label__")),s=M.get(i.properties,"__cf_source_id__"),l='<div style="padding: 5px;">';l+='<span style="white-space: nowrap;display: table;"><b>'+a+":</b> "+M.get(i.properties,o)+"</span>",M.each(this._config.properties.options.rows,function(e){var t=i.properties[e.name],r=e.name;if(![o].includes(r)&&!r.startsWith("__cf_")){var a=n[r];l+=a?'<span style="white-space: nowrap;display: table;"><b>'+a.label+":</b> "+I.formatMetricValue(M.get(i.properties,r),a)+"</span>":'<span style="white-space: nowrap;display: table;"><b>'+r+":</b> "+t+"</span>"}}),l+='<div style="border-bottom:1px solid #CCC; margin-top: 5px; margin-bottom: 5px"></div>',M.each(this._config.properties.options.metrics,function(e){var t=i.properties[e.name],r=e.name;if(![o].includes(r)&&!r.startsWith("__cf_")){var a=n[r];l+=a?'<span style="white-space: nowrap;display: table;"><b>'+a.label+":</b> "+I.formatMetricValue(M.get(i.properties,r),a)+"</span>":'<span style="white-space: nowrap;display: table;"><b>'+r+":</b> "+t+"</span>"}}),l+="</div>";var c=JSON.parse(M.get(i.properties,"__cf_color__")),u=c.noHighlightColors.fillColor,p=M.get(i.properties,"__cf_color_definition__");if(p&&o)if("string"==typeof(p=JSON.parse(p)))u=p;else if("object"===(void 0===p?"undefined":r(p))){var d=i.properties[o];if(p._match&&p._match[d])u=p._match[d];else if(p._metric&&p._range){var h=p._metric,_=h.func?h.name+"_"+h.func:h.name,m=M.get(i.properties,_),g=c.noHighlightColors.originalFillColor;u=p._range?f(p._range,m,g):u}}this._popup=b(this._mapVisualization,"none",u),this._popup.setLngLat(e.lngLat).setHTML(l).addTo(this._map),w(e,this._popup),this._map.setFeatureState({source:s,id:i.id},{hover:!0}),this._hoveredFeatureIdsMap.set(i.id,{hoveredFeatureId:i.id,hoveredSourceId:s}),this._lastHoveredFeatureId!==i.id&&(e.aktive=this._aktive,e.data=JSON.parse(M.get(i.properties,"__cf_data__")),this._mapVisualization._onChartMouseMove(e)),this._lastHoveredFeatureId=i.id}else this._popup&&this._popup.remove(),delete this._lastHoveredFeatureId}}},{key:"_handleMouseLeave",value:function(e){if(!this._skipMouseEvents()){this._map.getCanvas().style.cursor="",C(this._map,this._hoveredFeatureIdsMap);var t=this._map.queryRenderedFeatures(e.point,{layers:this._mapVisualization._tooltipLayerIds}),i=M.get(t,"[0]");i&&this._fillLayerIds.includes(i.layer.id)||(this._popup&&this._popup.remove(),delete this._popup,delete this._lastHoveredFeatureId,e.aktive=this._aktive,e.data={lngLat:e.lngLat},this._mapVisualization._onChartMouseLeave(e))}}},{key:"_removeEventListeners",value:function(e){this._map.off("mousemove",e,this._handleMouseMove),this._map.off("mouseleave",e,this._handleMouseLeave),this._map.checkAndRemoveLayerDelegatedListeners("mousemove",e),this._map.checkAndRemoveLayerDelegatedListeners("mouseleave",e)}},{key:"_addEventListeners",value:function(e){this._removeEventListeners(e),M.get(this._config,"properties.options.allowHover",!0)&&(this._map.on("mousemove",e,this._handleMouseMove),this._map.on("mouseleave",e,this._handleMouseLeave))}},{key:"addToMap",value:function(){var e=this;return new Promise(function(){var t=o(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e._processData();case 3:i(e),t.next=9;break;case 6:t.prev=6,t.t0=t.catch(0),r(t.t0);case 9:case"end":return t.stop()}},t,e,[[0,6]])}));return function(e,i){return t.apply(this,arguments)}}())}},{key:"remove",value:function(){var e=this;return new Promise(function(){var t=o(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{M.each(e._fillLayerIds,function(t){e._removeEventListeners(t)}),e._map.off("click",e._handleMouseClick),A(e),y(e),delete e._mapVisualization._renderedLayers[e._config.name],M.each(M.keys(e),function(t){return delete e[t]}),i(!0)}catch(e){r(e)}case 1:case"end":return t.stop()}},t,e)}));return function(e,i){return t.apply(this,arguments)}}())}}]),e}()}).call(t,i(1))},function(e,t,i){"use strict";(function(t){var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();function n(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,i){return function r(n,o){try{var a=t[n](o),s=a.value}catch(e){return void i(e)}if(!a.done)return Promise.resolve(s).then(function(e){r("next",e)},function(e){r("throw",e)});e(s)}("next")})}}var o=i(0),a=o.getToolkit,s=o.getAktiveAql,l=o.createLayerAktive,c=o.setLocationPrecisionAndFields,u=o.processGeohashData,p=o.isValidPrecisionLevels,d=o.isRawData,h=o.getLayerVisibility,f=o.isLayerVisible,_=o.renderLegend,m=i(2),g=m.error,y=m.sanitize,v=m.getFilters,A=m.splitData,b=m.getLngLatFields,w=m.buildOpacityExpression,C=m.getFields,L=m.shouldProcessData,x=i(3).renderLayersControl,k=i(4).renderDrawControl,I=a(),E=I.getDependency("utils"),M=E.getEnvironment(),S=I.getDependency("lodash"),P=i(10).default,F=i(15);e.exports=function(){function e(i,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mapVisualization=i,this._map=i._map,this._config=r,this._type=r.type,this._sanitizedName=y(this._config.name),this._sourceId=this._sanitizedName+"_source",this._layerId=this._sanitizedName+"_heatmap_layer",this._mainLayerId=this._layerId,this._featureCollection={type:"FeatureCollection",features:[]},this._isCustomData=!1,this._window="browser"===M?window:t,this._init()}return r(e,[{key:"_init",value:function(){this._visibility=h(this._config),this._location=S.get(this._config,"properties.location"),this._precisionLevels=S.get(this._config,"properties.precisionLevels"),this._fields=C(S.get(this._config,"properties.fields"));var e=b(this._location),t=e.lngField,i=e.latField;this._lngField=t,this._latField=i}},{key:"_configureAktive",value:function(){var e=this;if(this._config.provider&&this._config.source){this._aktive=l(this._mapVisualization._element,this._config);var t=s(this._aktive),i=S.get(this._config,"properties.limit"),r=S.get(this._config,"properties.precision"),o=v(S.get(this._config,"properties.filters",[])),a=v(S.get(this._config,"properties.staticFilters",[])),f=S.get(this._config,"properties.textFilter","");if(S.isArray(this._rows)?this._aktive.rows(this._rows):t._rows=[],S.isArray(this._fields)){if(this._location){var _=S.cloneDeep(this._location);S.isArray(_)||(_=[_]),(_=_.reverse()).forEach(function(t){e._fields.includes(t)||e._fields.unshift(t)})}this._aktive.fields(this._fields)}else t._fields=[];i&&this._aktive.limit(i),this._precisionLevels&&this._aktive.set("precisionLevels",this._precisionLevels),c(this._mapVisualization,this._config,this._aktive,this._location,r,this._precisionLevels),this._aktive.staticFilters(a),this._aktive.filters(o),this._aktive.textfilter(f),this._aktive._layer=this._config,this._aktive._isAktiveLayer=!0,this._aktive._isHeatMapLayer=!0,this._aktive._mainLayerId=this._layerId,this._aktive._options.set("isHeatMapLayer ",!0),this._aktive._parentAktive=this._mapVisualization._aktive,this._mapVisualization._storeLayerAktive(this._aktive),this._aktive.on("execute:start",function(t){e._mapVisualization._runningAktives[e._aktive._elementId]||(e._mapVisualization._runningAktives[e._aktive._elementId]=e._aktive,e._mapVisualization.dispatch({name:"geo:layers-execution-start",element:e._mapVisualization._element}))}),this._aktive.on("execute:stop",function(){var t=n(regeneratorRuntime.mark(function t(i){var r,n,o,a,s,l,c;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e._mapVisualization._storeLayerAktive(e._aktive),i.error){t.next=33;break}if(r=u(A(i.data)),!L(e,r)){t.next=31;break}if(e._aktive._data=r,e._data=r,n=E.getBoolValue(S.get(e._config,"properties.options.switchToMarkersAtRaw")),o=S.get(e._config,"properties.precisionLevels"),a=p(o),s=e._map.getZoom(),!!(n&&a&&s>=o.raw.zoom&&d(e._aktive))){t.next=18;break}e._markerLayer&&(e._markerLayer.remove(),delete e._markerLayer),e._aktive._isHeatMapLayer=!0,e._aktive._isMarkerLayer=!1,e._processData(),t.next=29;break;case 18:return e._aktive._isHeatMapLayer=!1,e._aktive._isMarkerLayer=!0,l=e._aktive.get("config").fields,c=e._aktive.get("config").metrics,e._fields=l,e._metrics=c,S.set(e._config,"properties.metrics",c),e._removeLayer(),e._markerLayer=new F(e._mapVisualization,e._config),t.next=29,e._markerLayer.isHeatMapLayerRawMarker().data(r).fields(e._fields).metrics(e._metrics).addToMap();case 29:t.next=33;break;case 31:e._visibility=h(e._config),e._aktive._isHeatMapLayer?e._map.setLayoutProperty(e._layerId,"visibility",e._visibility):e._markerLayer&&(e._map.setLayoutProperty(e._markerLayer._circleLayerId,"visibility",e._visibility),e._map.setLayoutProperty(e._markerLayer._symbolLayerId,"visibility",e._visibility),e._map.setLayoutProperty(e._markerLayer._markerLayerId,"visibility",e._visibility));case 33:delete e._mapVisualization._runningAktives[e._aktive._elementId],S.isEmpty(e._mapVisualization._runningAktives)&&e._mapVisualization.dispatch({name:"geo:layers-execution-stop",element:e._mapVisualization._element});case 35:case"end":return t.stop()}},t,e)}));return function(e){return t.apply(this,arguments)}}())}else g("Please specify a provider and a source for the heatmap layer "+this._config.name)}},{key:"_getDataType",value:function(){return"geohash"===this._data[0].type?"geohash":"raw"}},{key:"_getClusterCounts",value:function(){return this._data.map(function(e){return"geohash"===e.type?e.count:1})}},{key:"_getSuperClusterCounts",value:function(e){return e.map(function(e){return e.properties.cluster_id&&e.properties.point_count?e.properties.point_count:1})}},{key:"_getNormalizeFunction",value:function(e){var t=S.min(e),i=S.max(e);return i-t==0?function(){return 100}:function(e){return(e-t)/(i-t)*100}}},{key:"_createFeature",value:function(e,t,i){var r=parseFloat(e[this._lngField]||e.longitude),n=parseFloat(e[this._latField]||e.latitude);if(!Number.isNaN(r)&&!Number.isNaN(n)){var o="geohash"===t?e.count:1;return{type:"Feature",geometry:{type:"Point",coordinates:[r,n]},properties:{__cf_type__:t,__cf_cluster_count__:o,__cf_cluster_count_percent__:i(o)}}}return null}},{key:"_getGeoJsonFromSuperCluster",value:function(e,t){if("raw"===e&&this._precisionLevels){var i=new P({maxZoom:24}).load(t),r=this._map.getBounds(),n=[r._sw.lng,r._sw.lat,r._ne.lng,r._ne.lat],o=i.getClusters(n,this._map.getZoom()),a=o.length,s=this._getSuperClusterCounts(o),l=this._getNormalizeFunction(s);if(a>0){for(var c=0;c<a;c++){var u=o[c],p=u.properties.point_count||1,d=l(p);Object.assign(u.properties,{__cf_type__:"raw",__cf_cluster_count__:p,__cf_cluster_count_percent__:d})}return o}}return t}},{key:"_processData",value:function(){var e=this;if(this._mapVisualization._removeAllPopups(),this._visibility=h(this._config),this._preprocessor=S.get(this._config,"properties.options.preprocessor"),S.isEmpty(this._data))this._removeLayer();else{this._featureCollection.features=[];var t=this._getDataType(),i=this._getClusterCounts(),r=this._getNormalizeFunction(i),n=this._data.map(function(i){return e._createFeature(i,t,r)}).filter(function(e){return null!==e});this._featureCollection.features=this._getGeoJsonFromSuperCluster(t,n),"function"==typeof this._preprocessor&&this._preprocessor(S.cloneDeep(this._data),this._featureCollection),this._addSource(),this._addLayer()}setTimeout(function(){_(e._mapVisualization),x(e._mapVisualization),k(e._mapVisualization)},1)}},{key:"_addSource",value:function(){var e=this._map.getSource(this._sourceId);e?e.setData(this._featureCollection):this._map.addSource(this._sourceId,{type:"geojson",data:this._featureCollection})}},{key:"_removeSource",value:function(){this._map.getSource(this._sourceId)&&this._map.removeSource(this._sourceId)}},{key:"_addLayer",value:function(){var e=S.get(this._config,"properties.options",{}),t=e["heatmap-weight"],i=void 0===t?1:t,r=e["heatmap-intensity"],n=void 0===r?1:r,o=e["heatmap-color"],a=void 0===o?["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"]:o,s=e["heatmap-radius"],l=void 0===s?30:s,c=e["heatmap-opacity"],u=void 0===c?1:c,p=e.opacityZoomLevels,d=w(p,u),h=this._map.getLayer(this._layerId);h?(this._map.setLayoutProperty(this._layerId,"visibility",this._visibility),this._map.setPaintProperty(this._layerId,"heatmap-weight",i),this._map.setPaintProperty(this._layerId,"heatmap-intensity",n),this._map.setPaintProperty(this._layerId,"heatmap-color",a),this._map.setPaintProperty(this._layerId,"heatmap-radius",l),this._map.setPaintProperty(this._layerId,"heatmap-opacity",d)):this._map.addLayer({id:this._layerId,type:"heatmap",source:this._sourceId,layout:{visibility:this._visibility},paint:{"heatmap-weight":i,"heatmap-intensity":n,"heatmap-color":a,"heatmap-radius":l,"heatmap-opacity":d}}),this._mapVisualization._storeTooltipLayerId(this._layerId),this._mapVisualization._renderedLayers[this._config.name]=this,this._mapVisualization._setVisibilityZoomRange(this._layerId,this._config),this._mapVisualization._reorganizeLayers(),h||this._mapVisualization.dispatch({name:"geo:layer-added",element:this._mapVisualization._element,layer:this._config,mapLibreLayers:this._map.getLayer(this._layerId)})}},{key:"_removeLayer",value:function(){var e=this;this._map.getLayer(this._layerId)&&this._map.removeLayer(this._layerId),S.remove(this._mapVisualization._tooltipLayerIds,function(t){return t===e._layerId})}},{key:"data",value:function(e){return this._data=u(e),this._isCustomData=!0,this}},{key:"addToMap",value:function(){var e=this;return new Promise(function(){var t=n(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{e._isCustomData?(e._processData(),i(e)):(e._configureAktive(),f(e._config,e._map.getZoom())?e._aktive.execute().then(function(){return i(e)}).catch(function(e){return r(e)}):i(e))}catch(e){r(e)}case 1:case"end":return t.stop()}},t,e)}));return function(e,i){return t.apply(this,arguments)}}())}},{key:"remove",value:function(){var e=this;return new Promise(function(){var t=n(regeneratorRuntime.mark(function t(i,r){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:try{e._removeLayer(),e._removeSource(),e._markerLayer&&e._markerLayer.remove(),delete e._mapVisualization._renderedLayers[e._config.name],S.each(S.keys(e),function(t){return delete e[t]}),i(!0)}catch(e){r(e)}case 1:case"end":return t.stop()}},t,e)}));return function(e,i){return t.apply(this,arguments)}}())}}]),e}()}).call(t,i(1))},function(e,t,i){"use strict";var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}();var n=i(2).ZOOM_PRECISION,o=(0,i(0).getToolkit)().getDependency("lodash");e.exports=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._visual=t}return r(e,[{key:"onAdd",value:function(e){return this._container=document.createElement("div"),this._container.id="zoom-center-info-control",this._container.className="maplibregl-ctrl mapboxgl-ctrl",this._container.innerHTML='\n        <div id="'+this._visual._element+'-zoom-center-info" class="zoom-center-info">\n            <small>\n                <strong>zoom:</strong> '+o.round(e.getZoom(),n)+"\n            </small>\n        </div>\n        ",this._container}},{key:"onRemove",value:function(e){this._container.parentNode&&this._container.parentNode.removeChild(this._container),this._container=null}}]),e}()},function(e,t,i){i(47),e.exports=i(48)},function(e,t,i){var r=i(16);"string"==typeof r&&(r=[[e.i,r,""]]);var n={transform:void 0};i(9)(r,n);r.locals&&(e.exports=r.locals)},function(e,t,i){var r=i(16);r&&r.__esModule&&(r=r.default),e.exports="string"==typeof r?r:r.toString()},function(e,t,i){(function(t){!function(t,i){e.exports=i()}(0,function(){"use strict";var e=function(e,t){var i={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},r={on:function(e,t,r){if(void 0===i[e])throw new Error("Invalid event type: "+e);i[e].push({selector:t,fn:r})},render:function(e){t.store.featureChanged(e)}},n=function(e,n){for(var o=i[e],a=o.length;a--;){var s=o[a];if(s.selector(n)){s.fn.call(r,n)||t.store.render(),t.ui.updateMapClasses();break}}};return e.start.call(r),{render:e.render,stop:function(){e.stop&&e.stop()},trash:function(){e.trash&&(e.trash(),t.store.render())},combineFeatures:function(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures:function(){e.uncombineFeatures&&e.uncombineFeatures()},drag:function(e){n("drag",e)},click:function(e){n("click",e)},mousemove:function(e){n("mousemove",e)},mousedown:function(e){n("mousedown",e)},mouseup:function(e){n("mouseup",e)},mouseout:function(e){n("mouseout",e)},keydown:function(e){n("keydown",e)},keyup:function(e){n("keyup",e)},touchstart:function(e){n("touchstart",e)},touchmove:function(e){n("touchmove",e)},touchend:function(e){n("touchend",e)},tap:function(e){n("tap",e)}}};function i(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var r={},n={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:6356752.3142};function o(e){var t=0;if(e&&e.length>0){t+=Math.abs(a(e[0]));for(var i=1;i<e.length;i++)t-=Math.abs(a(e[i]))}return t}function a(e){var t,i,r,o,a,l,c=0,u=e.length;if(u>2){for(l=0;l<u;l++)l===u-2?(r=u-2,o=u-1,a=0):l===u-1?(r=u-1,o=0,a=1):(r=l,o=l+1,a=l+2),t=e[r],i=e[o],c+=(s(e[a][0])-s(t[0]))*Math.sin(s(i[1]));c=c*n.RADIUS*n.RADIUS/2}return c}function s(e){return e*Math.PI/180}r.geometry=function e(t){var i,r=0;switch(t.type){case"Polygon":return o(t.coordinates);case"MultiPolygon":for(i=0;i<t.coordinates.length;i++)r+=o(t.coordinates[i]);return r;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(i=0;i<t.geometries.length;i++)r+=e(t.geometries[i]);return r}},r.ring=a;var l={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},c={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},u={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},p={POLYGON:"polygon",LINE:"line_string",POINT:"point"},d={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},h={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},f={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},_={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},m={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},g={ACTIVE:"true",INACTIVE:"false"},y=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],v=-85,A=Object.freeze({__proto__:null,classes:l,sources:c,cursors:u,types:p,geojsonTypes:d,modes:h,events:f,updateActions:_,meta:m,activeStates:g,interactions:y,LAT_MIN:-90,LAT_RENDERED_MIN:v,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),b={Point:0,LineString:1,MultiLineString:1,Polygon:2};function w(e,t){var i=b[e.geometry.type]-b[t.geometry.type];return 0===i&&e.geometry.type===d.POLYGON?e.area-t.area:i}function C(e){return e.map(function(e){return e.geometry.type===d.POLYGON&&(e.area=r.geometry({type:d.FEATURE,property:{},geometry:e.geometry})),e}).sort(w).map(function(e){return delete e.area,e})}function L(e,t){return void 0===t&&(t=0),[[e.point.x-t,e.point.y-t],[e.point.x+t,e.point.y+t]]}function x(e){if(this._items={},this._nums={},this._length=e?e.length:0,e)for(var t=0,i=e.length;t<i;t++)this.add(e[t]),void 0!==e[t]&&("string"==typeof e[t]?this._items[e[t]]=t:this._nums[e[t]]=t)}x.prototype.add=function(e){return this.has(e)||(this._length++,"string"==typeof e?this._items[e]=this._length:this._nums[e]=this._length),this},x.prototype.delete=function(e){return!1===this.has(e)||(this._length--,delete this._items[e],delete this._nums[e]),this},x.prototype.has=function(e){return!("string"!=typeof e&&"number"!=typeof e||void 0===this._items[e]&&void 0===this._nums[e])},x.prototype.values=function(){var e=this,t=[];return Object.keys(this._items).forEach(function(i){t.push({k:i,v:e._items[i]})}),Object.keys(this._nums).forEach(function(i){t.push({k:JSON.parse(i),v:e._nums[i]})}),t.sort(function(e,t){return e.v-t.v}).map(function(e){return e.k})},x.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var k=[m.FEATURE,m.MIDPOINT,m.VERTEX],I={click:function(e,t,i){return E(e,t,i,i.options.clickBuffer)},touch:function(e,t,i){return E(e,t,i,i.options.touchBuffer)}};function E(e,t,i,r){if(null===i.map)return[];var n=e?L(e,r):t,o={};i.options.styles&&(o.layers=i.options.styles.map(function(e){return e.id}).filter(function(e){return null!=i.map.getLayer(e)}));var a=i.map.queryRenderedFeatures(n,o).filter(function(e){return-1!==k.indexOf(e.properties.meta)}),s=new x,l=[];return a.forEach(function(e){var t=e.properties.id;s.has(t)||(s.add(t),l.push(e))}),C(l)}function M(e,t){var i=I.click(e,null,t),r={mouse:u.NONE};return i[0]&&(r.mouse=i[0].properties.active===g.ACTIVE?u.MOVE:u.POINTER,r.feature=i[0].properties.meta),-1!==t.events.currentModeName().indexOf("draw")&&(r.mouse=u.ADD),t.ui.queueMapClasses(r),t.ui.updateMapClasses(),i[0]}function S(e,t){var i=e.x-t.x,r=e.y-t.y;return Math.sqrt(i*i+r*r)}function P(e,t,i){void 0===i&&(i={});var r=null!=i.fineTolerance?i.fineTolerance:4,n=null!=i.grossTolerance?i.grossTolerance:12,o=null!=i.interval?i.interval:500;e.point=e.point||t.point,e.time=e.time||t.time;var a=S(e.point,t.point);return a<r||a<n&&t.time-e.time<o}function F(e,t,i){void 0===i&&(i={});var r=null!=i.tolerance?i.tolerance:25,n=null!=i.interval?i.interval:250;return e.point=e.point||t.point,e.time=e.time||t.time,S(e.point,t.point)<r&&t.time-e.time<n}var D={exports:{}},B=D.exports=function(e,t){if(t||(t=16),void 0===e&&(e=128),e<=0)return"0";for(var i=Math.log(Math.pow(2,e))/Math.log(t),r=2;i===1/0;r*=2)i=Math.log(Math.pow(2,e/r))/Math.log(t)*r;var n=i-Math.floor(i),o="";for(r=0;r<Math.floor(i);r++)o=Math.floor(Math.random()*t).toString(t)+o;if(n){var a=Math.pow(t,n);o=Math.floor(Math.random()*a).toString(t)+o}var s=parseInt(o,t);return s!==1/0&&s>=Math.pow(2,e)?B(e,t):o};B.rack=function(e,t,i){var r=function(r){var o=0;do{if(o++>10){if(!i)throw new Error("too many ID collisions, use more bits");e+=i}var a=B(e,t)}while(Object.hasOwnProperty.call(n,a));return n[a]=r,a},n=r.hats={};return r.get=function(e){return r.hats[e]},r.set=function(e,t){return r.hats[e]=t,r},r.bits=e||128,r.base=t||16,r};var z=i(D.exports),T=function(e,t){this.ctx=e,this.properties=t.properties||{},this.coordinates=t.geometry.coordinates,this.id=t.id||z(),this.type=t.geometry.type};T.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},T.prototype.incomingCoords=function(e){this.setCoordinates(e)},T.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},T.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},T.prototype.setProperty=function(e,t){this.properties[e]=t},T.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:d.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},T.prototype.internal=function(e){var t={id:this.id,meta:m.FEATURE,"meta:type":this.type,active:g.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(var i in this.properties)t["user_"+i]=this.properties[i];return{type:d.FEATURE,properties:t,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var O=function(e,t){T.call(this,e,t)};(O.prototype=Object.create(T.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},O.prototype.updateCoordinate=function(e,t,i){this.coordinates=3===arguments.length?[t,i]:[e,t],this.changed()},O.prototype.getCoordinate=function(){return this.getCoordinates()};var R=function(e,t){T.call(this,e,t)};(R.prototype=Object.create(T.prototype)).isValid=function(){return this.coordinates.length>1},R.prototype.addCoordinate=function(e,t,i){this.changed();var r=parseInt(e,10);this.coordinates.splice(r,0,[t,i])},R.prototype.getCoordinate=function(e){var t=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[t]))},R.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)},R.prototype.updateCoordinate=function(e,t,i){var r=parseInt(e,10);this.coordinates[r]=[t,i],this.changed()};var N=function(e,t){T.call(this,e,t),this.coordinates=this.coordinates.map(function(e){return e.slice(0,-1)})};(N.prototype=Object.create(T.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(function(e){return e.length>2})},N.prototype.incomingCoords=function(e){this.coordinates=e.map(function(e){return e.slice(0,-1)}),this.changed()},N.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()},N.prototype.addCoordinate=function(e,t,i){this.changed();var r=e.split(".").map(function(e){return parseInt(e,10)});this.coordinates[r[0]].splice(r[1],0,[t,i])},N.prototype.removeCoordinate=function(e){this.changed();var t=e.split(".").map(function(e){return parseInt(e,10)}),i=this.coordinates[t[0]];i&&(i.splice(t[1],1),i.length<3&&this.coordinates.splice(t[0],1))},N.prototype.getCoordinate=function(e){var t=e.split(".").map(function(e){return parseInt(e,10)}),i=this.coordinates[t[0]];return JSON.parse(JSON.stringify(i[t[1]]))},N.prototype.getCoordinates=function(){return this.coordinates.map(function(e){return e.concat([e[0]])})},N.prototype.updateCoordinate=function(e,t,i){this.changed();var r=e.split("."),n=parseInt(r[0],10),o=parseInt(r[1],10);void 0===this.coordinates[n]&&(this.coordinates[n]=[]),this.coordinates[n][o]=[t,i]};var V={MultiPoint:O,MultiLineString:R,MultiPolygon:N},G=function(e,t,i,r,n){var o=i.split("."),a=parseInt(o[0],10),s=o[1]?o.slice(1).join("."):null;return e[a][t](s,r,n)},j=function(e,t){if(T.call(this,e,t),delete this.coordinates,this.model=V[t.geometry.type],void 0===this.model)throw new TypeError(t.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(t.geometry.coordinates)};function Q(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}(j.prototype=Object.create(T.prototype))._coordinatesToFeatures=function(e){var t=this,i=this.model.bind(this);return e.map(function(e){return new i(t.ctx,{id:z(),type:d.FEATURE,properties:{},geometry:{coordinates:e,type:t.type.replace("Multi","")}})})},j.prototype.isValid=function(){return this.features.every(function(e){return e.isValid()})},j.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()},j.prototype.getCoordinate=function(e){return G(this.features,"getCoordinate",e)},j.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(e){return e.type===d.POLYGON?e.getCoordinates():e.coordinates})))},j.prototype.updateCoordinate=function(e,t,i){G(this.features,"updateCoordinate",e,t,i),this.changed()},j.prototype.addCoordinate=function(e,t,i){G(this.features,"addCoordinate",e,t,i),this.changed()},j.prototype.removeCoordinate=function(e){G(this.features,"removeCoordinate",e),this.changed()},j.prototype.getFeatures=function(){return this.features},Q.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)},Q.prototype.setSelectedCoordinates=function(e){var t=this;this._ctx.store.setSelectedCoordinates(e),e.reduce(function(e,i){return void 0===e[i.feature_id]&&(e[i.feature_id]=!0,t._ctx.store.get(i.feature_id).changed()),e},{})},Q.prototype.getSelected=function(){return this._ctx.store.getSelected()},Q.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Q.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)},Q.prototype.getFeature=function(e){return this._ctx.store.get(e)},Q.prototype.select=function(e){return this._ctx.store.select(e)},Q.prototype.deselect=function(e){return this._ctx.store.deselect(e)},Q.prototype.deleteFeature=function(e,t){return void 0===t&&(t={}),this._ctx.store.delete(e,t)},Q.prototype.addFeature=function(e){return this._ctx.store.add(e)},Q.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Q.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Q.prototype.setActionableState=function(e){void 0===e&&(e={});var t={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(t)},Q.prototype.changeMode=function(e,t,i){return void 0===t&&(t={}),void 0===i&&(i={}),this._ctx.events.changeMode(e,t,i)},Q.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)},Q.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)},Q.prototype.featuresAt=function(e,t,i){if(void 0===i&&(i="click"),"click"!==i&&"touch"!==i)throw new Error("invalid buffer type");return I[i](e,t,this._ctx)},Q.prototype.newFeature=function(e){var t=e.geometry.type;return t===d.POINT?new O(this._ctx,e):t===d.LINE_STRING?new R(this._ctx,e):t===d.POLYGON?new N(this._ctx,e):new j(this._ctx,e)},Q.prototype.isInstanceOf=function(e,t){if(e===d.POINT)return t instanceof O;if(e===d.LINE_STRING)return t instanceof R;if(e===d.POLYGON)return t instanceof N;if("MultiFeature"===e)return t instanceof j;throw new Error("Unknown feature class: "+e)},Q.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)},Q.prototype.onSetup=function(){},Q.prototype.onDrag=function(){},Q.prototype.onClick=function(){},Q.prototype.onMouseMove=function(){},Q.prototype.onMouseDown=function(){},Q.prototype.onMouseUp=function(){},Q.prototype.onMouseOut=function(){},Q.prototype.onKeyUp=function(){},Q.prototype.onKeyDown=function(){},Q.prototype.onTouchStart=function(){},Q.prototype.onTouchMove=function(){},Q.prototype.onTouchEnd=function(){},Q.prototype.onTap=function(){},Q.prototype.onStop=function(){},Q.prototype.onTrash=function(){},Q.prototype.onCombineFeature=function(){},Q.prototype.onUncombineFeature=function(){},Q.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var H={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},U=Object.keys(H);function Y(e){return[].concat(e).filter(function(e){return void 0!==e})}function Z(e){var t,i=this;this._features={},this._featureIds=new x,this._selectedFeatureIds=new x,this._selectedCoordinates=[],this._changedFeatureIds=new x,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]},this.render=function(){t||(t=requestAnimationFrame(function(){t=null,function(){var e=this;if(!e.ctx.map||void 0===e.ctx.map.getSource(c.HOT))return l();var t=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:t});var i=[],r=[];e.isDirty?r=e.getAllIds():(i=e.getChangedIds().filter(function(t){return void 0!==e.get(t)}),r=e.sources.hot.filter(function(t){return t.properties.id&&-1===i.indexOf(t.properties.id)&&void 0!==e.get(t.properties.id)}).map(function(e){return e.properties.id})),e.sources.hot=[];var n=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(function(e){var t=e.properties.id||e.properties.parent;return-1===i.indexOf(t)});var o=n!==e.sources.cold.length||r.length>0;function a(i,r){var n=e.get(i).internal(t);e.ctx.events.currentModeRender(n,function(t){e.sources[r].push(t)})}if(i.forEach(function(e){return a(e,"hot")}),r.forEach(function(e){return a(e,"cold")}),o&&e.ctx.map.getSource(c.COLD).setData({type:d.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(c.HOT).setData({type:d.FEATURE_COLLECTION,features:e.sources.hot}),e._emitSelectionChange&&(e.ctx.map.fire(f.SELECTION_CHANGE,{features:e.getSelected().map(function(e){return e.toGeoJSON()}),points:e.getSelectedCoordinates().map(function(e){return{type:d.FEATURE,properties:{},geometry:{type:d.POINT,coordinates:e.coordinates}}})}),e._emitSelectionChange=!1),e._deletedFeaturesToEmit.length){var s=e._deletedFeaturesToEmit.map(function(e){return e.toGeoJSON()});e._deletedFeaturesToEmit=[],e.ctx.map.fire(f.DELETE,{features:s})}function l(){e.isDirty=!1,e.clearChangedIds()}l(),e.ctx.map.fire(f.RENDER,{})}.call(i)}))},this.isDirty=!1}function W(e,t){var i=e._selectedCoordinates.filter(function(t){return e._selectedFeatureIds.has(t.feature_id)});e._selectedCoordinates.length===i.length||t.silent||(e._emitSelectionChange=!0),e._selectedCoordinates=i}Z.prototype.createRenderBatch=function(){var e=this,t=this.render,i=0;return this.render=function(){i++},function(){e.render=t,i>0&&e.render()}},Z.prototype.setDirty=function(){return this.isDirty=!0,this},Z.prototype.featureChanged=function(e){return this._changedFeatureIds.add(e),this},Z.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Z.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Z.prototype.getAllIds=function(){return this._featureIds.values()},Z.prototype.add=function(e){return this.featureChanged(e.id),this._features[e.id]=e,this._featureIds.add(e.id),this},Z.prototype.delete=function(e,t){var i=this;return void 0===t&&(t={}),Y(e).forEach(function(e){i._featureIds.has(e)&&(i._featureIds.delete(e),i._selectedFeatureIds.delete(e),t.silent||-1===i._deletedFeaturesToEmit.indexOf(i._features[e])&&i._deletedFeaturesToEmit.push(i._features[e]),delete i._features[e],i.isDirty=!0)}),W(this,t),this},Z.prototype.get=function(e){return this._features[e]},Z.prototype.getAll=function(){var e=this;return Object.keys(this._features).map(function(t){return e._features[t]})},Z.prototype.select=function(e,t){var i=this;return void 0===t&&(t={}),Y(e).forEach(function(e){i._selectedFeatureIds.has(e)||(i._selectedFeatureIds.add(e),i._changedFeatureIds.add(e),t.silent||(i._emitSelectionChange=!0))}),this},Z.prototype.deselect=function(e,t){var i=this;return void 0===t&&(t={}),Y(e).forEach(function(e){i._selectedFeatureIds.has(e)&&(i._selectedFeatureIds.delete(e),i._changedFeatureIds.add(e),t.silent||(i._emitSelectionChange=!0))}),W(this,t),this},Z.prototype.clearSelected=function(e){return void 0===e&&(e={}),this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this},Z.prototype.setSelected=function(e,t){var i=this;return void 0===t&&(t={}),e=Y(e),this.deselect(this._selectedFeatureIds.values().filter(function(t){return-1===e.indexOf(t)}),{silent:t.silent}),this.select(e.filter(function(e){return!i._selectedFeatureIds.has(e)}),{silent:t.silent}),this},Z.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this},Z.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Z.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Z.prototype.getSelected=function(){var e=this;return this._selectedFeatureIds.values().map(function(t){return e.get(t)})},Z.prototype.getSelectedCoordinates=function(){var e=this;return this._selectedCoordinates.map(function(t){return{coordinates:e.get(t.feature_id).getCoordinate(t.coord_path)}})},Z.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)},Z.prototype.setFeatureProperty=function(e,t,i){this.get(e).setProperty(t,i),this.featureChanged(e)},Z.prototype.storeMapConfig=function(){var e=this;y.forEach(function(t){e.ctx.map[t]&&(e._mapInitialConfig[t]=e.ctx.map[t].isEnabled())})},Z.prototype.restoreMapConfig=function(){var e=this;Object.keys(this._mapInitialConfig).forEach(function(t){e._mapInitialConfig[t]?e.ctx.map[t].enable():e.ctx.map[t].disable()})},Z.prototype.getInitialConfigValue=function(e){return void 0===this._mapInitialConfig[e]||this._mapInitialConfig[e]};var J=Object.prototype.hasOwnProperty,q=i(function(){for(var e=arguments,t={},i=0;i<arguments.length;i++){var r=e[i];for(var n in r)J.call(r,n)&&(t[n]=r[n])}return t}),K=["mode","feature","mouse"];function X(t){var i=null,r=null,n={onRemove:function(){return t.map.off("load",n.connect),clearInterval(r),n.removeLayers(),t.store.restoreMapConfig(),t.ui.removeButtons(),t.events.removeEventListeners(),t.ui.clearMapClasses(),t.boxZoomInitial&&t.map.boxZoom.enable(),t.map=null,t.container=null,t.store=null,i&&i.parentNode&&i.parentNode.removeChild(i),i=null,this},connect:function(){t.map.off("load",n.connect),clearInterval(r),n.addLayers(),t.store.storeMapConfig(),t.events.addEventListeners()},onAdd:function(o){var a=o.fire;return o.fire=function(e,t){var i=arguments;return 1===a.length&&1!==arguments.length&&(i=[q({},{type:e},t)]),a.apply(o,i)},t.map=o,t.events=function(t){var i=Object.keys(t.options.modes).reduce(function(e,i){return e[i]=function(e){var t=Object.keys(e);return function(i,r){void 0===r&&(r={});var n={},o=t.reduce(function(t,i){return t[i]=e[i],t},new Q(i));return{start:function(){var t=this;n=o.onSetup(r),U.forEach(function(i){var r,a=H[i],s=function(){return!1};e[a]&&(s=function(){return!0}),t.on(i,s,(r=a,function(e){return o[r](n,e)}))})},stop:function(){o.onStop(n)},trash:function(){o.onTrash(n)},combineFeatures:function(){o.onCombineFeatures(n)},uncombineFeatures:function(){o.onUncombineFeatures(n)},render:function(e,t){o.toDisplayFeatures(n,e,t)}}}}(t.options.modes[i]),e},{}),r={},n={},o={},a=null,s=null;o.drag=function(e,i){i({point:e.point,time:(new Date).getTime()})?(t.ui.queueMapClasses({mouse:u.DRAG}),s.drag(e)):e.originalEvent.stopPropagation()},o.mousedrag=function(e){o.drag(e,function(e){return!P(r,e)})},o.touchdrag=function(e){o.drag(e,function(e){return!F(n,e)})},o.mousemove=function(e){if(1===(void 0!==e.originalEvent.buttons?e.originalEvent.buttons:e.originalEvent.which))return o.mousedrag(e);var i=M(e,t);e.featureTarget=i,s.mousemove(e)},o.mousedown=function(e){r={time:(new Date).getTime(),point:e.point};var i=M(e,t);e.featureTarget=i,s.mousedown(e)},o.mouseup=function(e){var i=M(e,t);e.featureTarget=i,P(r,{point:e.point,time:(new Date).getTime()})?s.click(e):s.mouseup(e)},o.mouseout=function(e){s.mouseout(e)},o.touchstart=function(e){if(t.options.touchEnabled){n={time:(new Date).getTime(),point:e.point};var i=I.touch(e,null,t)[0];e.featureTarget=i,s.touchstart(e)}},o.touchmove=function(e){if(t.options.touchEnabled)return s.touchmove(e),o.touchdrag(e)},o.touchend=function(e){if(e.originalEvent.preventDefault(),t.options.touchEnabled){var i=I.touch(e,null,t)[0];e.featureTarget=i,F(n,{time:(new Date).getTime(),point:e.point})?s.tap(e):s.touchend(e)}};var l=function(e){return!(8===e||46===e||e>=48&&e<=57)};function c(r,n,o){void 0===o&&(o={}),s.stop();var l=i[r];if(void 0===l)throw new Error(r+" is not valid");a=r;var c=l(t,n);s=e(c,t),o.silent||t.map.fire(f.MODE_CHANGE,{mode:r}),t.store.setDirty(),t.store.render()}o.keydown=function(e){(e.srcElement||e.target).classList.contains("mapboxgl-canvas")&&(8!==e.keyCode&&46!==e.keyCode||!t.options.controls.trash?l(e.keyCode)?s.keydown(e):49===e.keyCode&&t.options.controls.point?c(h.DRAW_POINT):50===e.keyCode&&t.options.controls.line_string?c(h.DRAW_LINE_STRING):51===e.keyCode&&t.options.controls.polygon&&c(h.DRAW_POLYGON):(e.preventDefault(),s.trash()))},o.keyup=function(e){l(e.keyCode)&&s.keyup(e)},o.zoomend=function(){t.store.changeZoom()},o.data=function(e){if("style"===e.dataType){var i=t.setup,r=t.map,n=t.options,o=t.store;n.styles.some(function(e){return r.getLayer(e.id)})||(i.addLayers(),o.setDirty(),o.render())}};var p={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){a=t.options.defaultMode,s=e(i[a](t),t)},changeMode:c,actionable:function(e){var i=!1;Object.keys(e).forEach(function(t){if(void 0===p[t])throw new Error("Invalid action type");p[t]!==e[t]&&(i=!0),p[t]=e[t]}),i&&t.map.fire(f.ACTIONABLE,{actions:p})},currentModeName:function(){return a},currentModeRender:function(e,t){return s.render(e,t)},fire:function(e,t){o[e]&&o[e](t)},addEventListeners:function(){t.map.on("mousemove",o.mousemove),t.map.on("mousedown",o.mousedown),t.map.on("mouseup",o.mouseup),t.map.on("data",o.data),t.map.on("touchmove",o.touchmove),t.map.on("touchstart",o.touchstart),t.map.on("touchend",o.touchend),t.container.addEventListener("mouseout",o.mouseout),t.options.keybindings&&(t.container.addEventListener("keydown",o.keydown),t.container.addEventListener("keyup",o.keyup))},removeEventListeners:function(){t.map.off("mousemove",o.mousemove),t.map.off("mousedown",o.mousedown),t.map.off("mouseup",o.mouseup),t.map.off("data",o.data),t.map.off("touchmove",o.touchmove),t.map.off("touchstart",o.touchstart),t.map.off("touchend",o.touchend),t.container.removeEventListener("mouseout",o.mouseout),t.options.keybindings&&(t.container.removeEventListener("keydown",o.keydown),t.container.removeEventListener("keyup",o.keyup))},trash:function(e){s.trash(e)},combineFeatures:function(){s.combineFeatures()},uncombineFeatures:function(){s.uncombineFeatures()},getMode:function(){return a}}}(t),t.ui=function(e){var t={},i=null,r={mode:null,feature:null,mouse:null},n={mode:null,feature:null,mouse:null};function o(e){n=q(n,e)}function a(){var t,i;if(e.container){var o=[],a=[];K.forEach(function(e){n[e]!==r[e]&&(o.push(e+"-"+r[e]),null!==n[e]&&a.push(e+"-"+n[e]))}),o.length>0&&(t=e.container.classList).remove.apply(t,o),a.length>0&&(i=e.container.classList).add.apply(i,a),r=q(r,n)}}function s(e,t){void 0===t&&(t={});var r=document.createElement("button");return r.className=l.CONTROL_BUTTON+" "+t.className,r.setAttribute("title",t.title),t.container.appendChild(r),r.addEventListener("click",function(r){if(r.preventDefault(),r.stopPropagation(),r.target===i)return c(),void t.onDeactivate();u(e),t.onActivate()},!0),r}function c(){i&&(i.classList.remove(l.ACTIVE_BUTTON),i=null)}function u(e){c();var r=t[e];r&&r&&"trash"!==e&&(r.classList.add(l.ACTIVE_BUTTON),i=r)}return{setActiveButton:u,queueMapClasses:o,updateMapClasses:a,clearMapClasses:function(){o({mode:null,feature:null,mouse:null}),a()},addButtons:function(){var i=e.options.controls,r=document.createElement("div");return r.className=l.CONTROL_GROUP+" "+l.CONTROL_BASE,i?(i[p.LINE]&&(t[p.LINE]=s(p.LINE,{container:r,className:l.CONTROL_BUTTON_LINE,title:"LineString tool "+(e.options.keybindings?"(l)":""),onActivate:function(){return e.events.changeMode(h.DRAW_LINE_STRING)},onDeactivate:function(){return e.events.trash()}})),i[p.POLYGON]&&(t[p.POLYGON]=s(p.POLYGON,{container:r,className:l.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(e.options.keybindings?"(p)":""),onActivate:function(){return e.events.changeMode(h.DRAW_POLYGON)},onDeactivate:function(){return e.events.trash()}})),i[p.POINT]&&(t[p.POINT]=s(p.POINT,{container:r,className:l.CONTROL_BUTTON_POINT,title:"Marker tool "+(e.options.keybindings?"(m)":""),onActivate:function(){return e.events.changeMode(h.DRAW_POINT)},onDeactivate:function(){return e.events.trash()}})),i.trash&&(t.trash=s("trash",{container:r,className:l.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){e.events.trash()}})),i.combine_features&&(t.combine_features=s("combineFeatures",{container:r,className:l.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){e.events.combineFeatures()}})),i.uncombine_features&&(t.uncombine_features=s("uncombineFeatures",{container:r,className:l.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){e.events.uncombineFeatures()}})),r):r},removeButtons:function(){Object.keys(t).forEach(function(e){var i=t[e];i.parentNode&&i.parentNode.removeChild(i),delete t[e]})}}}(t),t.container=o.getContainer(),t.store=new Z(t),i=t.ui.addButtons(),t.options.boxSelect&&(t.boxZoomInitial=o.boxZoom.isEnabled(),o.boxZoom.disable(),o.dragPan.disable(),o.dragPan.enable()),o.loaded()?n.connect():(o.on("load",n.connect),r=setInterval(function(){o.loaded()&&n.connect()},16)),t.events.start(),i},addLayers:function(){t.map.addSource(c.COLD,{data:{type:d.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.map.addSource(c.HOT,{data:{type:d.FEATURE_COLLECTION,features:[]},type:"geojson"}),t.options.styles.forEach(function(e){t.map.addLayer(e)}),t.store.setDirty(!0),t.store.render()},removeLayers:function(){t.options.styles.forEach(function(e){t.map.getLayer(e.id)&&t.map.removeLayer(e.id)}),t.map.getSource(c.COLD)&&t.map.removeSource(c.COLD),t.map.getSource(c.HOT)&&t.map.removeSource(c.HOT)}};return t.setup=n,n}var $=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function ee(e){return function(t){var i=t.featureTarget;return!!i&&!!i.properties&&i.properties.meta===e}}function te(e){return!!e.originalEvent&&!!e.originalEvent.shiftKey&&0===e.originalEvent.button}function ie(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===g.ACTIVE&&e.featureTarget.properties.meta===m.FEATURE}function re(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.active===g.INACTIVE&&e.featureTarget.properties.meta===m.FEATURE}function ne(e){return void 0===e.featureTarget}function oe(e){return!!e.featureTarget&&!!e.featureTarget.properties&&e.featureTarget.properties.meta===m.FEATURE}function ae(e){var t=e.featureTarget;return!!t&&!!t.properties&&t.properties.meta===m.VERTEX}function se(e){return!!e.originalEvent&&!0===e.originalEvent.shiftKey}function le(e){return 27===e.keyCode}function ce(e){return 13===e.keyCode}var ue=Object.freeze({__proto__:null,isOfMetaType:ee,isShiftMousedown:te,isActiveFeature:ie,isInactiveFeature:re,noTarget:ne,isFeature:oe,isVertex:ae,isShiftDown:se,isEscapeKey:le,isEnterKey:ce,isTrue:function(){return!0}}),pe=de;function de(e,t){this.x=e,this.y=t}de.prototype={clone:function(){return new de(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,i=e.y-this.y;return t*t+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,i=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),i=Math.sin(e),r=t*this.x-i*this.y,n=i*this.x+t*this.y;return this.x=r,this.y=n,this},_rotateAround:function(e,t){var i=Math.cos(e),r=Math.sin(e),n=t.x+i*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+i*(this.y-t.y);return this.x=n,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},de.convert=function(e){return e instanceof de?e:Array.isArray(e)?new de(e[0],e[1]):e};var he=i(pe);function fe(e,t){var i=t.getBoundingClientRect();return new he(e.clientX-i.left-(t.clientLeft||0),e.clientY-i.top-(t.clientTop||0))}function _e(e,t,i,r){return{type:d.FEATURE,properties:{meta:m.VERTEX,parent:e,coord_path:i,active:r?g.ACTIVE:g.INACTIVE},geometry:{type:d.POINT,coordinates:t}}}function me(e,t,i){var r=t.geometry.coordinates,n=i.geometry.coordinates;if(r[1]>85||r[1]<v||n[1]>85||n[1]<v)return null;var o={lng:(r[0]+n[0])/2,lat:(r[1]+n[1])/2};return{type:d.FEATURE,properties:{meta:m.MIDPOINT,parent:e,lng:o.lng,lat:o.lat,coord_path:i.properties.coord_path},geometry:{type:d.POINT,coordinates:[o.lng,o.lat]}}}function ge(e,t,i){void 0===t&&(t={}),void 0===i&&(i=null);var r,n=e.geometry,o=n.type,a=n.coordinates,s=e.properties&&e.properties.id,l=[];function c(e,i){var r="",n=null;e.forEach(function(e,o){var a=null!=i?i+"."+o:String(o),c=_e(s,e,a,u(a));if(t.midpoints&&n){var p=me(s,n,c);p&&l.push(p)}n=c;var d=JSON.stringify(e);r!==d&&l.push(c),0===o&&(r=d)})}function u(e){return!!t.selectedPaths&&-1!==t.selectedPaths.indexOf(e)}return o===d.POINT?l.push(_e(s,a,i,u(i))):o===d.POLYGON?a.forEach(function(e,t){c(e,null!==i?i+"."+t:String(t))}):o===d.LINE_STRING?c(a,i):0===o.indexOf(d.MULTI_PREFIX)&&(r=o.replace(d.MULTI_PREFIX,""),a.forEach(function(i,n){var o={type:d.FEATURE,properties:e.properties,geometry:{type:r,coordinates:i}};l=l.concat(ge(o,t,n))})),l}var ye={enable:function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable:function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()},0)}},ve={exports:{}},Ae=function(e){if(!e||!e.type)return null;var t=be[e.type];return t?"geometry"===t?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:e}]}:"feature"===t?{type:"FeatureCollection",features:[e]}:"featurecollection"===t?e:void 0:null},be={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},we=i(Ae),Ce=Ae,Le=function(e){if(e.__esModule)return e;var t=e.default;if("function"==typeof t){var i=function e(){if(this instanceof e){var i=[null];return i.push.apply(i,arguments),new(Function.bind.apply(t,i))}return t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}),i}(Object.freeze({__proto__:null,default:function e(t){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.reduce(function(t,i){return t.concat(e(i))},[]),t;case"Feature":return t.geometry?e(t.geometry).map(function(e){var i={type:"Feature",properties:JSON.parse(JSON.stringify(t.properties)),geometry:e};return void 0!==t.id&&(i.id=t.id),i}):[t];case"MultiPoint":return t.coordinates.map(function(e){return{type:"Point",coordinates:e}});case"MultiPolygon":return t.coordinates.map(function(e){return{type:"Polygon",coordinates:e}});case"MultiLineString":return t.coordinates.map(function(e){return{type:"LineString",coordinates:e}});case"GeometryCollection":return t.geometries.map(e).reduce(function(e,t){return e.concat(t)},[]);case"Point":case"Polygon":case"LineString":return[t]}}}));Le instanceof Function||(Le=Le.default);var xe={exports:{}},ke=xe.exports=function(e){return new Ie(e)};function Ie(e){this.value=e}function Ee(e,t,i){var r=[],n=[],o=!0;return function e(a){var s={},l=!0,c={node:i?Me(a):a,node_:a,path:[].concat(r),parent:n[n.length-1],parents:n,key:r.slice(-1)[0],isRoot:0===r.length,level:r.length,circular:null,update:function(e,t){c.isRoot||(c.parent.node[c.key]=e),c.node=e,t&&(l=!1)},delete:function(e){delete c.parent.node[c.key],e&&(l=!1)},remove:function(e){Fe(c.parent.node)?c.parent.node.splice(c.key,1):delete c.parent.node[c.key],e&&(l=!1)},keys:null,before:function(e){s.before=e},after:function(e){s.after=e},pre:function(e){s.pre=e},post:function(e){s.post=e},stop:function(){o=!1},block:function(){l=!1}};if(!o)return c;function u(){if("object"==typeof c.node&&null!==c.node){c.keys&&c.node_===c.node||(c.keys=Se(c.node)),c.isLeaf=0==c.keys.length;for(var e=0;e<n.length;e++)if(n[e].node_===a){c.circular=n[e];break}}else c.isLeaf=!0,c.keys=null;c.notLeaf=!c.isLeaf,c.notRoot=!c.isRoot}u();var p=t.call(c,c.node);return void 0!==p&&c.update&&c.update(p),s.before&&s.before.call(c,c.node),l?("object"!=typeof c.node||null===c.node||c.circular||(n.push(c),u(),De(c.keys,function(t,n){r.push(t),s.pre&&s.pre.call(c,c.node[t],t);var o=e(c.node[t]);i&&Be.call(c.node,t)&&(c.node[t]=o.node),o.isLast=n==c.keys.length-1,o.isFirst=0==n,s.post&&s.post.call(c,o),r.pop()}),n.pop()),s.after&&s.after.call(c,c.node),c):c}(e).node}function Me(e){if("object"==typeof e&&null!==e){var t;if(Fe(e))t=[];else if("[object Date]"===Pe(e))t=new Date(e.getTime?e.getTime():e);else if(function(e){return"[object RegExp]"===Pe(e)}(e))t=new RegExp(e);else if(function(e){return"[object Error]"===Pe(e)}(e))t={message:e.message};else if(function(e){return"[object Boolean]"===Pe(e)}(e))t=new Boolean(e);else if(function(e){return"[object Number]"===Pe(e)}(e))t=new Number(e);else if(function(e){return"[object String]"===Pe(e)}(e))t=new String(e);else if(Object.create&&Object.getPrototypeOf)t=Object.create(Object.getPrototypeOf(e));else if(e.constructor===Object)t={};else{var i=e.constructor&&e.constructor.prototype||e.__proto__||{},r=function(){};r.prototype=i,t=new r}return De(Se(e),function(i){t[i]=e[i]}),t}return e}Ie.prototype.get=function(e){for(var t=this.value,i=0;i<e.length;i++){var r=e[i];if(!t||!Be.call(t,r)){t=void 0;break}t=t[r]}return t},Ie.prototype.has=function(e){for(var t=this.value,i=0;i<e.length;i++){var r=e[i];if(!t||!Be.call(t,r))return!1;t=t[r]}return!0},Ie.prototype.set=function(e,t){for(var i=this.value,r=0;r<e.length-1;r++){var n=e[r];Be.call(i,n)||(i[n]={}),i=i[n]}return i[e[r]]=t,t},Ie.prototype.map=function(e){return Ee(this.value,e,!0)},Ie.prototype.forEach=function(e){return this.value=Ee(this.value,e,!1),this.value},Ie.prototype.reduce=function(e,t){var i=1===arguments.length,r=i?this.value:t;return this.forEach(function(t){this.isRoot&&i||(r=e.call(this,r,t))}),r},Ie.prototype.paths=function(){var e=[];return this.forEach(function(t){e.push(this.path)}),e},Ie.prototype.nodes=function(){var e=[];return this.forEach(function(t){e.push(this.node)}),e},Ie.prototype.clone=function(){var e=[],t=[];return function i(r){for(var n=0;n<e.length;n++)if(e[n]===r)return t[n];if("object"==typeof r&&null!==r){var o=Me(r);return e.push(r),t.push(o),De(Se(r),function(e){o[e]=i(r[e])}),e.pop(),t.pop(),o}return r}(this.value)};var Se=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t};function Pe(e){return Object.prototype.toString.call(e)}var Fe=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},De=function(e,t){if(e.forEach)return e.forEach(t);for(var i=0;i<e.length;i++)t(e[i],i,e)};De(Se(Ie.prototype),function(e){ke[e]=function(t){var i=[].slice.call(arguments,1),r=new Ie(t);return r[e].apply(r,i)}});var Be=Object.hasOwnProperty||function(e,t){return t in e},ze=xe.exports,Te=Oe;function Oe(e){if(!(this instanceof Oe))return new Oe(e);this._bbox=e||[1/0,1/0,-1/0,-1/0],this._valid=!!e}Oe.prototype.include=function(e){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],e[0]),this._bbox[1]=Math.min(this._bbox[1],e[1]),this._bbox[2]=Math.max(this._bbox[2],e[0]),this._bbox[3]=Math.max(this._bbox[3],e[1]),this},Oe.prototype.equals=function(e){var t;return t=e instanceof Oe?e.bbox():e,this._bbox[0]==t[0]&&this._bbox[1]==t[1]&&this._bbox[2]==t[2]&&this._bbox[3]==t[3]},Oe.prototype.center=function(e){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Oe.prototype.union=function(e){var t;return this._valid=!0,t=e instanceof Oe?e.bbox():e,this._bbox[0]=Math.min(this._bbox[0],t[0]),this._bbox[1]=Math.min(this._bbox[1],t[1]),this._bbox[2]=Math.max(this._bbox[2],t[2]),this._bbox[3]=Math.max(this._bbox[3],t[3]),this},Oe.prototype.bbox=function(){return this._valid?this._bbox:null},Oe.prototype.contains=function(e){if(!e)return this._fastContains();if(!this._valid)return null;var t=e[0],i=e[1];return this._bbox[0]<=t&&this._bbox[1]<=i&&this._bbox[2]>=t&&this._bbox[3]>=i},Oe.prototype.intersect=function(e){return this._valid?(t=e instanceof Oe?e.bbox():e,!(this._bbox[0]>t[2]||this._bbox[2]<t[0]||this._bbox[3]<t[1]||this._bbox[1]>t[3])):null;var t},Oe.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var e="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",e)},Oe.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Re=function(e){if(!e)return[];var t=[];return Le(Ce(e)).features.forEach(function(e){e.geometry&&(t=t.concat(function(e){return function e(t){return Array.isArray(t)&&t.length&&"number"==typeof t[0]?[t]:t.reduce(function(t,i){return Array.isArray(i)&&Array.isArray(i[0])?t.concat(e(i)):(t.push(i),t)},[])}(e)}(e.geometry.coordinates)))}),t},Ne=ze,Ve=Te,Ge={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},je=Object.keys(Ge);function Qe(e){for(var t=Ve(),i=Re(e),r=0;r<i.length;r++)t.include(i[r]);return t}ve.exports=function(e){return Qe(e).bbox()},ve.exports.polygon=function(e){return Qe(e).polygon()},ve.exports.bboxify=function(e){return Ne(e).map(function(e){e&&je.some(function(t){return!!e[t]&&-1!==Ge[t].indexOf(e.type)})&&(e.bbox=Qe(e).bbox(),this.update(e))})};var He=i(ve.exports),Ue=-90;function Ye(e,t){var i=Ue,r=90,n=Ue,o=90,a=270,s=-270;e.forEach(function(e){var t=He(e),l=t[1],c=t[3],u=t[0],p=t[2];l>i&&(i=l),c<r&&(r=c),c>n&&(n=c),l<o&&(o=l),u<a&&(a=u),p>s&&(s=p)});var l=t;return i+l.lat>85&&(l.lat=85-i),n+l.lat>90&&(l.lat=90-n),r+l.lat<-85&&(l.lat=-85-r),o+l.lat<Ue&&(l.lat=Ue-o),a+l.lng<=-270&&(l.lng+=360*Math.ceil(Math.abs(l.lng)/360)),s+l.lng>=270&&(l.lng-=360*Math.ceil(Math.abs(l.lng)/360)),l}function Ze(e,t){var i=Ye(e.map(function(e){return e.toGeoJSON()}),t);e.forEach(function(e){var t,r=e.getCoordinates(),n=function(e){var t={lng:e[0]+i.lng,lat:e[1]+i.lat};return[t.lng,t.lat]},o=function(e){return e.map(function(e){return n(e)})};e.type===d.POINT?t=n(r):e.type===d.LINE_STRING||e.type===d.MULTI_POINT?t=r.map(n):e.type===d.POLYGON||e.type===d.MULTI_LINE_STRING?t=r.map(o):e.type===d.MULTI_POLYGON&&(t=r.map(function(e){return e.map(function(e){return o(e)})})),e.incomingCoords(t)})}var We={onSetup:function(e){var t=this,i={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(i.initiallySelectedFeatureIds.filter(function(e){return void 0!==t.getFeature(e)})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),i},fireUpdate:function(){this.map.fire(f.UPDATE,{action:_.MOVE,features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(){var e=this,t=this.getSelected(),i=t.filter(function(t){return e.isInstanceOf("MultiFeature",t)}),r=!1;if(t.length>1){r=!0;var n=t[0].type.replace("Multi","");t.forEach(function(e){e.type.replace("Multi","")!==n&&(r=!1)})}var o=i.length>0,a=t.length>0;this.setActionableState({combineFeatures:r,uncombineFeatures:o,trash:a})},getUniqueIds:function(e){return e.length?e.map(function(e){return e.properties.id}).filter(function(e){return void 0!==e}).reduce(function(e,t){return e.add(t),e},new x).values():[]},stopExtendedInteractions:function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1},onStop:function(){ye.enable(this)},onMouseMove:function(e,t){return oe(t)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0},onMouseOut:function(e){return!e.dragMoving||this.fireUpdate()}};We.onTap=We.onClick=function(e,t){return ne(t)?this.clickAnywhere(e,t):ee(m.VERTEX)(t)?this.clickOnVertex(e,t):oe(t)?this.clickOnFeature(e,t):void 0},We.clickAnywhere=function(e){var t=this,i=this.getSelectedIds();i.length&&(this.clearSelectedFeatures(),i.forEach(function(e){return t.doRender(e)})),ye.enable(this),this.stopExtendedInteractions(e)},We.clickOnVertex=function(e,t){this.changeMode(h.DIRECT_SELECT,{featureId:t.featureTarget.properties.parent,coordPath:t.featureTarget.properties.coord_path,startPos:t.lngLat}),this.updateUIClasses({mouse:u.MOVE})},We.startOnActiveFeature=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(t.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},We.clickOnFeature=function(e,t){var i=this;ye.disable(this),this.stopExtendedInteractions(e);var r=se(t),n=this.getSelectedIds(),o=t.featureTarget.properties.id,a=this.isSelected(o);if(!r&&a&&this.getFeature(o).type!==d.POINT)return this.changeMode(h.DIRECT_SELECT,{featureId:o});a&&r?(this.deselect(o),this.updateUIClasses({mouse:u.POINTER}),1===n.length&&ye.enable(this)):!a&&r?(this.select(o),this.updateUIClasses({mouse:u.MOVE})):a||r||(n.forEach(function(e){return i.doRender(e)}),this.setSelected(o),this.updateUIClasses({mouse:u.MOVE})),this.doRender(o)},We.onMouseDown=function(e,t){return ie(t)?this.startOnActiveFeature(e,t):this.drawConfig.boxSelect&&te(t)?this.startBoxSelect(e,t):void 0},We.startBoxSelect=function(e,t){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=fe(t.originalEvent,this.map.getContainer()),e.canBoxSelect=!0},We.onTouchStart=function(e,t){if(ie(t))return this.startOnActiveFeature(e,t)},We.onDrag=function(e,t){return e.canDragMove?this.dragMove(e,t):this.drawConfig.boxSelect&&e.canBoxSelect?this.whileBoxSelect(e,t):void 0},We.whileBoxSelect=function(e,t){e.boxSelecting=!0,this.updateUIClasses({mouse:u.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(l.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));var i=fe(t.originalEvent,this.map.getContainer()),r=Math.min(e.boxSelectStartLocation.x,i.x),n=Math.max(e.boxSelectStartLocation.x,i.x),o=Math.min(e.boxSelectStartLocation.y,i.y),a=Math.max(e.boxSelectStartLocation.y,i.y),s="translate("+r+"px, "+o+"px)";e.boxSelectElement.style.transform=s,e.boxSelectElement.style.WebkitTransform=s,e.boxSelectElement.style.width=n-r+"px",e.boxSelectElement.style.height=a-o+"px"},We.dragMove=function(e,t){e.dragMoving=!0,t.originalEvent.stopPropagation();var i={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};Ze(this.getSelected(),i),e.dragMoveLocation=t.lngLat},We.onTouchEnd=We.onMouseUp=function(e,t){var i=this;if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){var r=[e.boxSelectStartLocation,fe(t.originalEvent,this.map.getContainer())],n=this.featuresAt(null,r,"click"),o=this.getUniqueIds(n).filter(function(e){return!i.isSelected(e)});o.length&&(this.select(o),o.forEach(function(e){return i.doRender(e)}),this.updateUIClasses({mouse:u.MOVE}))}this.stopExtendedInteractions(e)},We.toDisplayFeatures=function(e,t,i){t.properties.active=this.isSelected(t.properties.id)?g.ACTIVE:g.INACTIVE,i(t),this.fireActionable(),t.properties.active===g.ACTIVE&&t.geometry.type!==d.POINT&&ge(t).forEach(i)},We.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},We.onCombineFeatures=function(){var e=this.getSelected();if(!(0===e.length||e.length<2)){for(var t=[],i=[],r=e[0].type.replace("Multi",""),n=0;n<e.length;n++){var o=e[n];if(o.type.replace("Multi","")!==r)return;o.type.includes("Multi")?o.getCoordinates().forEach(function(e){t.push(e)}):t.push(o.getCoordinates()),i.push(o.toGeoJSON())}if(i.length>1){var a=this.newFeature({type:d.FEATURE,properties:i[0].properties,geometry:{type:"Multi"+r,coordinates:t}});this.addFeature(a),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([a.id]),this.map.fire(f.COMBINE_FEATURES,{createdFeatures:[a.toGeoJSON()],deletedFeatures:i})}this.fireActionable()}},We.onUncombineFeatures=function(){var e=this,t=this.getSelected();if(0!==t.length){for(var i=[],r=[],n=function(n){var o=t[n];e.isInstanceOf("MultiFeature",o)&&(o.getFeatures().forEach(function(t){e.addFeature(t),t.properties=o.properties,i.push(t.toGeoJSON()),e.select([t.id])}),e.deleteFeature(o.id,{silent:!0}),r.push(o.toGeoJSON()))},o=0;o<t.length;o++)n(o);i.length>1&&this.map.fire(f.UNCOMBINE_FEATURES,{createdFeatures:i,deletedFeatures:r}),this.fireActionable()}};var Je=ee(m.VERTEX),qe=ee(m.MIDPOINT),Ke={fireUpdate:function(){this.map.fire(f.UPDATE,{action:_.CHANGE_COORDINATES,features:this.getSelected().map(function(e){return e.toGeoJSON()})})},fireActionable:function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})},startDragging:function(e,t){this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=t.lngLat},stopDragging:function(e){this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null},onVertex:function(e,t){this.startDragging(e,t);var i=t.featureTarget.properties,r=e.selectedCoordPaths.indexOf(i.coord_path);se(t)||-1!==r?se(t)&&-1===r&&e.selectedCoordPaths.push(i.coord_path):e.selectedCoordPaths=[i.coord_path];var n=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(n)},onMidpoint:function(e,t){this.startDragging(e,t);var i=t.featureTarget.properties;e.feature.addCoordinate(i.coord_path,i.lng,i.lat),this.fireUpdate(),e.selectedCoordPaths=[i.coord_path]},pathsToCoordinates:function(e,t){return t.map(function(t){return{feature_id:e,coord_path:t}})},onFeature:function(e,t){0===e.selectedCoordPaths.length?this.startDragging(e,t):this.stopDragging(e)},dragFeature:function(e,t,i){Ze(this.getSelected(),i),e.dragMoveLocation=t.lngLat},dragVertex:function(e,t,i){for(var r=e.selectedCoordPaths.map(function(t){return e.feature.getCoordinate(t)}),n=Ye(r.map(function(e){return{type:d.FEATURE,properties:{},geometry:{type:d.POINT,coordinates:e}}}),i),o=0;o<r.length;o++){var a=r[o];e.feature.updateCoordinate(e.selectedCoordPaths[o],a[0]+n.lng,a[1]+n.lat)}},clickNoTarget:function(){this.changeMode(h.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(h.SIMPLE_SELECT)},clickActiveFeature:function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()},onSetup:function(e){var t=e.featureId,i=this.getFeature(t);if(!i)throw new Error("You must provide a featureId to enter direct_select mode");if(i.type===d.POINT)throw new TypeError("direct_select mode doesn't handle point features");var r={featureId:t,feature:i,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(t,r.selectedCoordPaths)),this.setSelected(t),ye.disable(this),this.setActionableState({trash:!0}),r},onStop:function(){ye.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(e,t,i){e.featureId===t.properties.id?(t.properties.active=g.ACTIVE,i(t),ge(t,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(i)):(t.properties.active=g.INACTIVE,i(t)),this.fireActionable(e)},onTrash:function(e){e.selectedCoordPaths.sort(function(e,t){return t.localeCompare(e,"en",{numeric:!0})}).forEach(function(t){return e.feature.removeCoordinate(t)}),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),!1===e.feature.isValid()&&(this.deleteFeature([e.featureId]),this.changeMode(h.SIMPLE_SELECT,{}))},onMouseMove:function(e,t){var i=ie(t),r=Je(t),n=qe(t),o=0===e.selectedCoordPaths.length;return i&&o||r&&!o?this.updateUIClasses({mouse:u.MOVE}):this.updateUIClasses({mouse:u.NONE}),(r||i||n)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0},onMouseOut:function(e){return e.dragMoving&&this.fireUpdate(),!0}};Ke.onTouchStart=Ke.onMouseDown=function(e,t){return Je(t)?this.onVertex(e,t):ie(t)?this.onFeature(e,t):qe(t)?this.onMidpoint(e,t):void 0},Ke.onDrag=function(e,t){if(!0===e.canDragMove){e.dragMoving=!0,t.originalEvent.stopPropagation();var i={lng:t.lngLat.lng-e.dragMoveLocation.lng,lat:t.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,t,i):this.dragFeature(e,t,i),e.dragMoveLocation=t.lngLat}},Ke.onClick=function(e,t){return ne(t)?this.clickNoTarget(e,t):ie(t)?this.clickActiveFeature(e,t):re(t)?this.clickInactive(e,t):void this.stopDragging(e)},Ke.onTap=function(e,t){return ne(t)?this.clickNoTarget(e,t):ie(t)?this.clickActiveFeature(e,t):re(t)?this.clickInactive(e,t):void 0},Ke.onTouchEnd=Ke.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};var Xe={};function $e(e,t){return!!e.lngLat&&e.lngLat.lng===t[0]&&e.lngLat.lat===t[1]}Xe.onSetup=function(){var e=this.newFeature({type:d.FEATURE,properties:{},geometry:{type:d.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:u.ADD}),this.activateUIButton(p.POINT),this.setActionableState({trash:!0}),{point:e}},Xe.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)},Xe.onTap=Xe.onClick=function(e,t){this.updateUIClasses({mouse:u.MOVE}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.map.fire(f.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.point.id]})},Xe.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},Xe.toDisplayFeatures=function(e,t,i){var r=t.properties.id===e.point.id;if(t.properties.active=r?g.ACTIVE:g.INACTIVE,!r)return i(t)},Xe.onTrash=Xe.stopDrawingAndRemove,Xe.onKeyUp=function(e,t){if(le(t)||ce(t))return this.stopDrawingAndRemove(e,t)};var et={onSetup:function(){var e=this.newFeature({type:d.FEATURE,properties:{},geometry:{type:d.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),ye.disable(this),this.updateUIClasses({mouse:u.ADD}),this.activateUIButton(p.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&$e(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:u.ADD}),e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate("0."+e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),ae(t)&&this.updateUIClasses({mouse:u.POINTER})}};et.onTap=et.onClick=function(e,t){return ae(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},et.onKeyUp=function(e,t){le(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)):ce(t)&&this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.polygon.id]})},et.onStop=function(e){this.updateUIClasses({mouse:u.NONE}),ye.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.polygon.id)&&(e.polygon.removeCoordinate("0."+e.currentVertexPosition),e.polygon.isValid()?this.map.fire(f.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT,{},{silent:!0})))},et.toDisplayFeatures=function(e,t,i){var r=t.properties.id===e.polygon.id;if(t.properties.active=r?g.ACTIVE:g.INACTIVE,!r)return i(t);if(0!==t.geometry.coordinates.length){var n=t.geometry.coordinates[0].length;if(!(n<3)){if(t.properties.meta=m.FEATURE,i(_e(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),n>3){var o=t.geometry.coordinates[0].length-3;i(_e(e.polygon.id,t.geometry.coordinates[0][o],"0."+o,!1))}if(n<=4){var a=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(i({type:d.FEATURE,properties:t.properties,geometry:{coordinates:a,type:d.LINE_STRING}}),3===n)return}return i(t)}}},et.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)};var tt={onSetup:function(e){var t,i,r=(e=e||{}).featureId,n="forward";if(r){if(!(t=this.getFeature(r)))throw new Error("Could not find a feature with the provided featureId");var o=e.from;if(o&&"Feature"===o.type&&o.geometry&&"Point"===o.geometry.type&&(o=o.geometry),o&&"Point"===o.type&&o.coordinates&&2===o.coordinates.length&&(o=o.coordinates),!o||!Array.isArray(o))throw new Error("Please use the `from` property to indicate which point to continue the line from");var a=t.coordinates.length-1;if(t.coordinates[a][0]===o[0]&&t.coordinates[a][1]===o[1])i=a+1,t.addCoordinate.apply(t,[i].concat(t.coordinates[a]));else{if(t.coordinates[0][0]!==o[0]||t.coordinates[0][1]!==o[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");n="backwards",i=0,t.addCoordinate.apply(t,[i].concat(t.coordinates[0]))}}else t=this.newFeature({type:d.FEATURE,properties:{},geometry:{type:d.LINE_STRING,coordinates:[]}}),i=0,this.addFeature(t);return this.clearSelectedFeatures(),ye.disable(this),this.updateUIClasses({mouse:u.ADD}),this.activateUIButton(p.LINE),this.setActionableState({trash:!0}),{line:t,currentVertexPosition:i,direction:n}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&$e(t,e.line.coordinates[e.currentVertexPosition-1])||"backwards"===e.direction&&$e(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:u.ADD}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),"forward"===e.direction?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),ae(t)&&this.updateUIClasses({mouse:u.POINTER})}};tt.onTap=tt.onClick=function(e,t){if(ae(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},tt.onKeyUp=function(e,t){ce(t)?this.changeMode(h.SIMPLE_SELECT,{featureIds:[e.line.id]}):le(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT))},tt.onStop=function(e){ye.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.line.id)&&(e.line.removeCoordinate(""+e.currentVertexPosition),e.line.isValid()?this.map.fire(f.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT,{},{silent:!0})))},tt.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(h.SIMPLE_SELECT)},tt.toDisplayFeatures=function(e,t,i){var r=t.properties.id===e.line.id;if(t.properties.active=r?g.ACTIVE:g.INACTIVE,!r)return i(t);t.geometry.coordinates.length<2||(t.properties.meta=m.FEATURE,i(_e(e.line.id,t.geometry.coordinates["forward"===e.direction?t.geometry.coordinates.length-2:1],""+("forward"===e.direction?t.geometry.coordinates.length-2:1),!1)),i(t))};var it={simple_select:We,direct_select:Ke,draw_point:Xe,draw_polygon:et,draw_line_string:tt},rt={defaultMode:h.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:$,modes:it,controls:{},userProperties:!1},nt={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},ot={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function at(e,t){return e.map(function(e){return e.source?e:q(e,{id:e.id+"."+t,source:"hot"===t?c.HOT:c.COLD})})}var st={exports:{}};!function(e,i){var r="__lodash_hash_undefined__",n=9007199254740991,o="[object Arguments]",a="[object Array]",s="[object Boolean]",l="[object Date]",c="[object Error]",u="[object Function]",p="[object Map]",d="[object Number]",h="[object Object]",f="[object Promise]",_="[object RegExp]",m="[object Set]",g="[object String]",y="[object Symbol]",v="[object WeakMap]",A="[object ArrayBuffer]",b="[object DataView]",w=/^\[object .+?Constructor\]$/,C=/^(?:0|[1-9]\d*)$/,L={};L["[object Float32Array]"]=L["[object Float64Array]"]=L["[object Int8Array]"]=L["[object Int16Array]"]=L["[object Int32Array]"]=L["[object Uint8Array]"]=L["[object Uint8ClampedArray]"]=L["[object Uint16Array]"]=L["[object Uint32Array]"]=!0,L[o]=L[a]=L[A]=L[s]=L[b]=L[l]=L[c]=L[u]=L[p]=L[d]=L[h]=L[_]=L[m]=L[g]=L[v]=!1;var x="object"==typeof t&&t&&t.Object===Object&&t,k="object"==typeof self&&self&&self.Object===Object&&self,I=x||k||Function("return this")(),E=i&&!i.nodeType&&i,M=E&&e&&!e.nodeType&&e,S=M&&M.exports===E,P=S&&x.process,F=function(){try{return P&&P.binding&&P.binding("util")}catch(e){}}(),D=F&&F.isTypedArray;function B(e,t){for(var i=-1,r=null==e?0:e.length;++i<r;)if(t(e[i],i,e))return!0;return!1}function z(e){var t=-1,i=Array(e.size);return e.forEach(function(e,r){i[++t]=[r,e]}),i}function T(e){var t=-1,i=Array(e.size);return e.forEach(function(e){i[++t]=e}),i}var O,R,N,V=Array.prototype,G=Function.prototype,j=Object.prototype,Q=I["__core-js_shared__"],H=G.toString,U=j.hasOwnProperty,Y=(O=/[^.]+$/.exec(Q&&Q.keys&&Q.keys.IE_PROTO||""))?"Symbol(src)_1."+O:"",Z=j.toString,W=RegExp("^"+H.call(U).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),J=S?I.Buffer:void 0,q=I.Symbol,K=I.Uint8Array,X=j.propertyIsEnumerable,$=V.splice,ee=q?q.toStringTag:void 0,te=Object.getOwnPropertySymbols,ie=J?J.isBuffer:void 0,re=(R=Object.keys,N=Object,function(e){return R(N(e))}),ne=Me(I,"DataView"),oe=Me(I,"Map"),ae=Me(I,"Promise"),se=Me(I,"Set"),le=Me(I,"WeakMap"),ce=Me(Object,"create"),ue=De(ne),pe=De(oe),de=De(ae),he=De(se),fe=De(le),_e=q?q.prototype:void 0,me=_e?_e.valueOf:void 0;function ge(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function ye(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function ve(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function Ae(e){var t=-1,i=null==e?0:e.length;for(this.__data__=new ve;++t<i;)this.add(e[t])}function be(e){var t=this.__data__=new ye(e);this.size=t.size}function we(e,t){for(var i=e.length;i--;)if(Be(e[i][0],t))return i;return-1}function Ce(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ee&&ee in Object(e)?function(e){var t=U.call(e,ee),i=e[ee];try{e[ee]=void 0;var r=!0}catch(e){}var n=Z.call(e);return r&&(t?e[ee]=i:delete e[ee]),n}(e):function(e){return Z.call(e)}(e)}function Le(e){return Ge(e)&&Ce(e)==o}function xe(e,t,i,r,n){return e===t||(null==e||null==t||!Ge(e)&&!Ge(t)?e!=e&&t!=t:function(e,t,i,r,n,u){var f=Te(e),v=Te(t),w=f?a:Pe(e),C=v?a:Pe(t),L=(w=w==o?h:w)==h,x=(C=C==o?h:C)==h,k=w==C;if(k&&Oe(e)){if(!Oe(t))return!1;f=!0,L=!1}if(k&&!L)return u||(u=new be),f||je(e)?ke(e,t,i,r,n,u):function(e,t,i,r,n,o,a){switch(w){case b:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case A:return!(e.byteLength!=t.byteLength||!o(new K(e),new K(t)));case s:case l:case d:return Be(+e,+t);case c:return e.name==t.name&&e.message==t.message;case _:case g:return e==t+"";case p:var u=z;case m:var h=1&r;if(u||(u=T),e.size!=t.size&&!h)return!1;var f=a.get(e);if(f)return f==t;r|=2,a.set(e,t);var v=ke(u(e),u(t),r,n,o,a);return a.delete(e),v;case y:if(me)return me.call(e)==me.call(t)}return!1}(e,t,0,i,r,n,u);if(!(1&i)){var I=L&&U.call(e,"__wrapped__"),E=x&&U.call(t,"__wrapped__");if(I||E){var M=I?e.value():e,S=E?t.value():t;return u||(u=new be),n(M,S,i,r,u)}}return!!k&&(u||(u=new be),function(e,t,i,r,n,o){var a=1&i,s=Ie(e),l=s.length;if(l!=Ie(t).length&&!a)return!1;for(var c=l;c--;){var u=s[c];if(!(a?u in t:U.call(t,u)))return!1}var p=o.get(e);if(p&&o.get(t))return p==t;var d=!0;o.set(e,t),o.set(t,e);for(var h=a;++c<l;){var f=e[u=s[c]],_=t[u];if(r)var m=a?r(_,f,u,t,e,o):r(f,_,u,e,t,o);if(!(void 0===m?f===_||n(f,_,i,r,o):m)){d=!1;break}h||(h="constructor"==u)}if(d&&!h){var g=e.constructor,y=t.constructor;g==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof g&&g instanceof g&&"function"==typeof y&&y instanceof y||(d=!1)}return o.delete(e),o.delete(t),d}(e,t,i,r,n,u))}(e,t,i,r,xe,n))}function ke(e,t,i,r,n,o){var a=1&i,s=e.length,l=t.length;if(s!=l&&!(a&&l>s))return!1;var c=o.get(e);if(c&&o.get(t))return c==t;var u=-1,p=!0,d=2&i?new Ae:void 0;for(o.set(e,t),o.set(t,e);++u<s;){var h=e[u],f=t[u];if(r)var _=a?r(f,h,u,t,e,o):r(h,f,u,e,t,o);if(void 0!==_){if(_)continue;p=!1;break}if(d){if(!B(t,function(e,t){if(a=t,!d.has(a)&&(h===e||n(h,e,i,r,o)))return d.push(t);var a})){p=!1;break}}else if(h!==f&&!n(h,f,i,r,o)){p=!1;break}}return o.delete(e),o.delete(t),p}function Ie(e){return function(e,t,i){var r=Qe(e);return Te(e)?r:function(e,t){for(var i=-1,r=t.length,n=e.length;++i<r;)e[n+i]=t[i];return e}(r,i(e))}(e,0,Se)}function Ee(e,t){var i,r,n=e.__data__;return("string"==(r=typeof(i=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==i:null===i)?n["string"==typeof t?"string":"hash"]:n.map}function Me(e,t){var i=function(e,t){return null==e?void 0:e[t]}(e,t);return function(e){return!(!Ve(e)||function(e){return!!Y&&Y in e}(e))&&(Re(e)?W:w).test(De(e))}(i)?i:void 0}ge.prototype.clear=function(){this.__data__=ce?ce(null):{},this.size=0},ge.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ge.prototype.get=function(e){var t=this.__data__;if(ce){var i=t[e];return i===r?void 0:i}return U.call(t,e)?t[e]:void 0},ge.prototype.has=function(e){var t=this.__data__;return ce?void 0!==t[e]:U.call(t,e)},ge.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=ce&&void 0===t?r:t,this},ye.prototype.clear=function(){this.__data__=[],this.size=0},ye.prototype.delete=function(e){var t=this.__data__,i=we(t,e);return!(i<0||(i==t.length-1?t.pop():$.call(t,i,1),--this.size,0))},ye.prototype.get=function(e){var t=this.__data__,i=we(t,e);return i<0?void 0:t[i][1]},ye.prototype.has=function(e){return we(this.__data__,e)>-1},ye.prototype.set=function(e,t){var i=this.__data__,r=we(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this},ve.prototype.clear=function(){this.size=0,this.__data__={hash:new ge,map:new(oe||ye),string:new ge}},ve.prototype.delete=function(e){var t=Ee(this,e).delete(e);return this.size-=t?1:0,t},ve.prototype.get=function(e){return Ee(this,e).get(e)},ve.prototype.has=function(e){return Ee(this,e).has(e)},ve.prototype.set=function(e,t){var i=Ee(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this},Ae.prototype.add=Ae.prototype.push=function(e){return this.__data__.set(e,r),this},Ae.prototype.has=function(e){return this.__data__.has(e)},be.prototype.clear=function(){this.__data__=new ye,this.size=0},be.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},be.prototype.get=function(e){return this.__data__.get(e)},be.prototype.has=function(e){return this.__data__.has(e)},be.prototype.set=function(e,t){var i=this.__data__;if(i instanceof ye){var r=i.__data__;if(!oe||r.length<199)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new ve(r)}return i.set(e,t),this.size=i.size,this};var Se=te?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var i=-1,r=null==e?0:e.length,n=0,o=[];++i<r;){var a=e[i];t(a)&&(o[n++]=a)}return o}(te(e),function(t){return X.call(e,t)}))}:function(){return[]},Pe=Ce;function Fe(e,t){return!!(t=null==t?n:t)&&("number"==typeof e||C.test(e))&&e>-1&&e%1==0&&e<t}function De(e){if(null!=e){try{return H.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Be(e,t){return e===t||e!=e&&t!=t}(ne&&Pe(new ne(new ArrayBuffer(1)))!=b||oe&&Pe(new oe)!=p||ae&&Pe(ae.resolve())!=f||se&&Pe(new se)!=m||le&&Pe(new le)!=v)&&(Pe=function(e){var t=Ce(e),i=t==h?e.constructor:void 0,r=i?De(i):"";if(r)switch(r){case ue:return b;case pe:return p;case de:return f;case he:return m;case fe:return v}return t});var ze=Le(function(){return arguments}())?Le:function(e){return Ge(e)&&U.call(e,"callee")&&!X.call(e,"callee")},Te=Array.isArray,Oe=ie||function(){return!1};function Re(e){if(!Ve(e))return!1;var t=Ce(e);return t==u||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function Ne(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=n}function Ve(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function Ge(e){return null!=e&&"object"==typeof e}var je=D?function(e){return function(t){return e(t)}}(D):function(e){return Ge(e)&&Ne(e.length)&&!!L[Ce(e)]};function Qe(e){return null!=(t=e)&&Ne(t.length)&&!Re(t)?function(e,t){var i=Te(e),r=!i&&ze(e),n=!i&&!r&&Oe(e),o=!i&&!r&&!n&&je(e),a=i||r||n||o,s=a?function(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}(e.length,String):[],l=s.length;for(var c in e)!t&&!U.call(e,c)||a&&("length"==c||n&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||Fe(c,l))||s.push(c);return s}(e):function(e){if(i=(t=e)&&t.constructor,t!==("function"==typeof i&&i.prototype||j))return re(e);var t,i,r=[];for(var n in Object(e))U.call(e,n)&&"constructor"!=n&&r.push(n);return r}(e);var t}e.exports=function(e,t){return xe(e,t)}}(st,st.exports);var lt=i(st.exports);function ct(e,t){return e.length===t.length&&JSON.stringify(e.map(function(e){return e}).sort())===JSON.stringify(t.map(function(e){return e}).sort())}var ut={Polygon:N,LineString:R,Point:O,MultiPolygon:j,MultiLineString:j,MultiPoint:j},pt=Object.freeze({__proto__:null,CommonSelectors:ue,constrainFeatureMovement:Ye,createMidPoint:me,createSupplementaryPoints:ge,createVertex:_e,doubleClickZoom:ye,euclideanDistance:S,featuresAt:I,getFeatureAtAndSetCursors:M,isClick:P,isEventAtCoordinates:$e,isTap:F,mapEventToBoundingBox:L,ModeHandler:e,moveFeatures:Ze,sortFeatures:C,stringSetsAreEqual:ct,StringSet:x,theme:$,toDenseArray:Y}),dt=function(e,t){var i={options:e=function(e){void 0===e&&(e={});var t=q(e);return e.controls||(t.controls={}),!1===e.displayControlsDefault?t.controls=q(ot,e.controls):t.controls=q(nt,e.controls),(t=q(rt,t)).styles=at(t.styles,"cold").concat(at(t.styles,"hot")),t}(e)};t=function(e,t){return t.modes=h,t.getFeatureIdsAt=function(t){return I.click({point:t},null,e).map(function(e){return e.properties.id})},t.getSelectedIds=function(){return e.store.getSelectedIds()},t.getSelected=function(){return{type:d.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(function(t){return e.store.get(t)}).map(function(e){return e.toGeoJSON()})}},t.getSelectedPoints=function(){return{type:d.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(function(e){return{type:d.FEATURE,properties:{},geometry:{type:d.POINT,coordinates:e.coordinates}}})}},t.set=function(i){if(void 0===i.type||i.type!==d.FEATURE_COLLECTION||!Array.isArray(i.features))throw new Error("Invalid FeatureCollection");var r=e.store.createRenderBatch(),n=e.store.getAllIds().slice(),o=t.add(i),a=new x(o);return(n=n.filter(function(e){return!a.has(e)})).length&&t.delete(n),r(),o},t.add=function(t){var i=JSON.parse(JSON.stringify(we(t))).features.map(function(t){if(t.id=t.id||z(),null===t.geometry)throw new Error("Invalid geometry: null");if(void 0===e.store.get(t.id)||e.store.get(t.id).type!==t.geometry.type){var i=ut[t.geometry.type];if(void 0===i)throw new Error("Invalid geometry type: "+t.geometry.type+".");var r=new i(e,t);e.store.add(r)}else{var n=e.store.get(t.id);n.properties=t.properties,lt(n.properties,t.properties)||e.store.featureChanged(n.id),lt(n.getCoordinates(),t.geometry.coordinates)||n.incomingCoords(t.geometry.coordinates)}return t.id});return e.store.render(),i},t.get=function(t){var i=e.store.get(t);if(i)return i.toGeoJSON()},t.getAll=function(){return{type:d.FEATURE_COLLECTION,features:e.store.getAll().map(function(e){return e.toGeoJSON()})}},t.delete=function(i){return e.store.delete(i,{silent:!0}),t.getMode()!==h.DIRECT_SELECT||e.store.getSelectedIds().length?e.store.render():e.events.changeMode(h.SIMPLE_SELECT,void 0,{silent:!0}),t},t.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:!0}),t.getMode()===h.DIRECT_SELECT?e.events.changeMode(h.SIMPLE_SELECT,void 0,{silent:!0}):e.store.render(),t},t.changeMode=function(i,r){return void 0===r&&(r={}),i===h.SIMPLE_SELECT&&t.getMode()===h.SIMPLE_SELECT?(ct(r.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(r.featureIds,{silent:!0}),e.store.render()),t):(i===h.DIRECT_SELECT&&t.getMode()===h.DIRECT_SELECT&&r.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(i,r,{silent:!0}),t)},t.getMode=function(){return e.events.getMode()},t.trash=function(){return e.events.trash({silent:!0}),t},t.combineFeatures=function(){return e.events.combineFeatures({silent:!0}),t},t.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:!0}),t},t.setFeatureProperty=function(i,r,n){return e.store.setFeatureProperty(i,r,n),t},t}(i,t),i.api=t;var r=X(i);return t.onAdd=r.onAdd,t.onRemove=r.onRemove,t.types=p,t.options=e,t};function ht(e){dt(e,this)}return ht.modes=it,ht.constants=A,ht.lib=pt,ht})}).call(t,i(1))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},n=function(e){setTimeout(function(){e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()},0)},o={onSetup:function(e){var t=this.newFeature({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),n(this),this.updateUIClasses({mouse:"add"}),this.setActionableState({trash:!0}),{rectangle:t}},onTap:function(e,t){e.startPoint&&this.onMouseMove(e,t),this.onClick(e,t)},onClick:function(e,t){e.startPoint&&e.startPoint[0]!==t.lngLat.lng&&e.startPoint[1]!==t.lngLat.lat&&(this.updateUIClasses({mouse:"pointer"}),e.endPoint=[t.lngLat.lng,t.lngLat.lat],this.changeMode("simple_select",{featuresId:e.rectangle.id}));var i=[t.lngLat.lng,t.lngLat.lat];e.startPoint=i},onMouseMove:function(e,t){e.startPoint&&(e.rectangle.updateCoordinate("0.0",e.startPoint[0],e.startPoint[1]),e.rectangle.updateCoordinate("0.1",t.lngLat.lng,e.startPoint[1]),e.rectangle.updateCoordinate("0.2",t.lngLat.lng,t.lngLat.lat),e.rectangle.updateCoordinate("0.3",e.startPoint[0],t.lngLat.lat),e.rectangle.updateCoordinate("0.4",e.startPoint[0],e.startPoint[1]))},onKeyUp:function(e,t){if(27===t.keyCode)return this.changeMode("simple_select")},onStop:function(e){r(this),this.updateUIClasses({mouse:"none"}),this.activateUIButton(),void 0!==this.getFeature(e.rectangle.id)&&(e.rectangle.removeCoordinate("0.4"),e.rectangle.isValid()?this.map.fire("draw.create",{features:[e.rectangle.toGeoJSON()]}):(this.deleteFeature([e.rectangle.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},toDisplayFeatures:function(e,t,i){var r=t.properties.id===e.rectangle.id;return t.properties.active=r?"true":"false",r?e.startPoint?i(t):void 0:i(t)},onTrash:function(e){this.deleteFeature([e.rectangle.id],{silent:!0}),this.changeMode("simple_select")}};t.default=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(52).default,n=i(53).default;t.DRAW_CIRCLE_RADIUS_LABEL_STYLE={id:"gl-draw-radius-label",type:"symbol",filter:["==","meta","draw-circle-radius"],layout:{"text-anchor":"right","text-field":"{radiusLabel}","text-size":16,"text-offset":[-1,0],"text-ignore-placement":!0,"text-allow-overlap":!0},paint:{"text-color":"#fbb03b","text-halo-color":"rgba(0, 0, 0, 1)","text-halo-width":2}},t.DrawCircle={onSetup:function(){var e=this.newFeature({type:"Feature",properties:{center:null,edge:null,radiusKm:0},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:"add"}),this.setActionableState({trash:!0}),{circle:e}},onKeyUp:function(e,t){27===t.keyCode&&(e.circle.properties.center=null,e.circle.properties.radiusKm=0,e.circle.incomingCoords([[]]))},onClick:function(e,t){e.circle.properties.center?(this.updateUIClasses({mouse:"pointer"}),e.circle.properties.radiusKm=r(e.circle.properties.center,[t.lngLat.lng,t.lngLat.lat]),this.changeMode("simple_select",{featuresId:e.circle.id})):e.circle.properties.center=[t.lngLat.lng,t.lngLat.lat]},onMouseMove:function(e,t){if(e.circle.properties.center){var i=[t.lngLat.lng,t.lngLat.lat];e.circle.properties.edge=i,e.circle.properties.radiusKm=r(e.circle.properties.center,i);var o=n(e.circle.properties.center,e.circle.properties.radiusKm);e.circle.incomingCoords(o.geometry.coordinates)}},onStop:function(e){this.updateUIClasses({mouse:"none"}),this.activateUIButton(),void 0!==this.getFeature(e.circle.id)&&(e.circle.properties.center&&e.circle.properties.radiusKm>0?this.map.fire("draw.create",{features:[e.circle.toGeoJSON()]}):(this.deleteFeature([e.circle.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},toDisplayFeatures:function(e,t,i){if(!e.circle.properties.center||!e.circle.properties.edge)return null;t.properties&&(t.properties.active="true");var r="";r=e.circle.properties.radiusKm<=1?Math.round(1e3*e.circle.properties.radiusKm)+" m":e.circle.properties.radiusKm<=10?e.circle.properties.radiusKm.toFixed(1)+" km":Math.round(e.circle.properties.radiusKm)+" km",i({type:"Feature",properties:{meta:"draw-circle-radius",parent:e.circle.id,radiusLabel:r,active:"false"},geometry:{type:"Point",coordinates:e.circle.properties.edge}}),i({type:"Feature",properties:{meta:"draw-circle-radius-line",parent:e.circle.id,active:"true"},geometry:{type:"LineString",coordinates:[e.circle.properties.center,e.circle.properties.edge]}}),i(t)},onTrash:function(e){this.deleteFeature([e.circle.id],{silent:!0}),this.changeMode("simple_select")}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(6),n=i(5);t.default=function(e,t,i){void 0===i&&(i={});var o=Object(r.a)(e),a=Object(r.a)(t),s=Object(n.a)(a[1]-o[1]),l=Object(n.a)(a[0]-o[0]),c=Object(n.a)(o[1]),u=Object(n.a)(a[1]),p=Math.pow(Math.sin(s/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(c)*Math.cos(u);return Object(n.j)(2*Math.atan2(Math.sqrt(p),Math.sqrt(1-p)),i.units)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(54),n=i(5);t.default=function(e,t,i){void 0===i&&(i={});for(var o=i.steps||64,a=i.properties?i.properties:!Array.isArray(e)&&"Feature"===e.type&&e.properties?e.properties:{},s=[],l=0;l<o;l++)s.push(Object(r.a)(e,t,-360*l/o,i).geometry.coordinates);return s.push(s[0]),Object(n.h)([s],a)}},function(e,t,i){"use strict";t.a=function(e,t,i,o){void 0===o&&(o={});var a=Object(n.a)(e),s=Object(r.a)(a[0]),l=Object(r.a)(a[1]),c=Object(r.a)(i),u=Object(r.e)(t,o.units),p=Math.asin(Math.sin(l)*Math.cos(u)+Math.cos(l)*Math.sin(u)*Math.cos(c)),d=s+Math.atan2(Math.sin(c)*Math.sin(u)*Math.cos(l),Math.cos(u)-Math.sin(l)*Math.sin(p)),h=Object(r.i)(d),f=Object(r.i)(p);return Object(r.g)([h,f],o.properties)};var r=i(5),n=i(6)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}]},function(e,t,i){"use strict";e.exports.lc=function(){},e.exports.wm=function(){return!1},e.exports.lcExpiration=function(){}}])});
if(new Function('try {return this===window;}catch(e){ return false;}')() && window['cf_geogl']){
                window['cf_geogl'].getBuildVersion = function() { return '20240502_21_53'; };
                window['cf_geogl'].getVersion = function() { return '5.0.7'; };
            } else {
                module.exports.getBuildVersion = function() { return '20240502_21_53'; };
                module.exports.getVersion = function() { return '5.0.7'; };
            }